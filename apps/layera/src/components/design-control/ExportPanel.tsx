import React from 'react';
import { Box } from '@layera/layout';
import { Button } from '@layera/buttons';
import { Text } from '@layera/typography';

/**
 * ARXES COMPLIANT Export Panel Component
 *
 * Export ÎºÎ±Î¹ Reset Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ Î±Ï€ÏŒ Ï„Î¿ HTML mockup:
 * - exportCSS(): Î£Ï…Î»Î»Î¿Î³Î® CSS variables ÎºÎ±Î¹ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î±ÏÏ‡ÎµÎ¯Î¿Ï…
 * - resetToDefaults(): Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ ÏƒÏ„Î¹Ï‚ default Ï„Î¹Î¼Î­Ï‚
 *
 * Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï…Ï€Î¬ÏÏ‡Î¿Î½Ï„Î± tokens ÎºÎ±Î¹ @layera/* components
 */

export const ExportPanel: React.FC = () => {
  const handleExportCSS = React.useCallback(() => {
    console.log('ğŸš€ Exporting CSS...');

    // Î£Ï…Î»Î»Î¿Î³Î® CSS variables Î±Ï€ÏŒ Ï„Î¿ root element
    const root = document.documentElement;
    const cssVariables: string[] = [];

    // Get computed style
    const computedStyle = getComputedStyle(root);

    // Î£Ï…Î»Î»Î¿Î³Î® live ÎºÎ±Î¹ layera variables
    for (let i = 0; i < computedStyle.length; i++) {
      const property = computedStyle[i];
      if (property.startsWith('--live-') || property.startsWith('--layera-')) {
        const value = computedStyle.getPropertyValue(property);
        cssVariables.push(`  ${property}: ${value};`);
      }
    }

    // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± CSS Ï€ÎµÏÎ¹ÎµÏ‡Î¿Î¼Î­Î½Î¿Ï…
    const cssContent = `:root {\n${cssVariables.join('\n')}\n}\n\n/* Generated by Layera Design Control Panel */\n/* Date: ${new Date().toISOString()} */`;

    // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎºÎ±Î¹ download Î±ÏÏ‡ÎµÎ¯Î¿Ï…
    const blob = new Blob([cssContent], { type: 'text/css' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'layera-theme-export.css';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);

    console.log('âœ… CSS exported successfully!');
  }, []);

  const handleResetToDefaults = React.useCallback(() => {
    console.log('ğŸ”„ Resetting to defaults...');

    // Reset ÏƒÏ„Î¹Ï‚ default Ï„Î¹Î¼Î­Ï‚ Î±Ï€ÏŒ Ï„Î¿ Dynamic Token System
    const root = document.documentElement;

    // Default colors
    const defaultColors = {
      '--live-primary-color': '#4A90E2',
      '--live-secondary-color': '#9013FE',
      '--live-success-color': '#4CAF50',
      '--live-warning-color': '#FF9800',
      '--live-danger-color': '#F44336',
      '--live-info-color': '#2196F3'
    };

    // Default layout values
    const defaultLayout = {
      '--live-component-gap': '16px',
      '--live-padding': '16px',
      '--live-button-padding': '16px',
      '--live-font-size': '16px',
      '--live-border-radius': '8px'
    };

    // Î•Ï†Î±ÏÎ¼Î¿Î³Î® default Ï„Î¹Î¼ÏÎ½
    Object.entries({ ...defaultColors, ...defaultLayout }).forEach(([property, value]) => {
      root.style.setProperty(property, value);
    });

    // Trigger re-render events Î³Î¹Î± Î½Î± ÎµÎ½Î·Î¼ÎµÏÏ‰Î¸Î¿ÏÎ½ Ï„Î± components
    window.dispatchEvent(new CustomEvent('layera:theme-reset'));

    console.log('âœ… Reset completed successfully!');
  }, []);

  return (
    <Box className="layera-flex layera-flex--direction-column layera-flex--gap-md">
      <Text
        className="layera-typography layera-margin-bottom--sm"
        data-size="sm"
        data-color="secondary"
      >
        Î•Î¾Î±Î³Ï‰Î³Î® ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½ ÎºÎ±Î¹ ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ¬ ÏƒÏ„Î¹Ï‚ Î±ÏÏ‡Î¹ÎºÎ­Ï‚ Ï„Î¹Î¼Î­Ï‚
      </Text>

      <Box className="layera-flex layera-flex--gap-sm">
        <Button
          variant="info"
          size="sm"
          onClick={handleExportCSS}
          className="layera-button layera-flex--grow"
        >
          ğŸ’¾ Export CSS
        </Button>

        <Button
          variant="warning"
          size="sm"
          onClick={handleResetToDefaults}
          className="layera-button layera-flex--grow"
        >
          ğŸ”„ Reset
        </Button>
      </Box>

      <Text
        className="layera-typography"
        data-size="xs"
        data-color="secondary"
      >
        Î¤Î¿ Export Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ .css Î±ÏÏ‡ÎµÎ¯Î¿ Î¼Îµ Ï„Î¹Ï‚ Ï„ÏÎ­Ï‡Î¿Ï…ÏƒÎµÏ‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚.
        Î¤Î¿ Reset ÎµÏ€Î±Î½Î±Ï†Î­ÏÎµÎ¹ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Ï„Î¹Î¼Î­Ï‚ ÏƒÏ„Î¹Ï‚ Î±ÏÏ‡Î¹ÎºÎ­Ï‚.
      </Text>
    </Box>
  );
};