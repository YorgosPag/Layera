{"version":3,"sources":["../src/index.ts","../src/hooks/useCADProcessing.ts","../src/types/index.ts","../src/parsers/dxfParser.ts","../src/renderers/cadRenderer.ts","../src/utils/cadValidator.ts"],"sourcesContent":["// Core hook\r\nexport { useCADProcessing } from './hooks/useCADProcessing';\r\nexport type { UseCADProcessingOptions, UseCADProcessingReturn } from './hooks/useCADProcessing';\r\n\r\n// Parsers\r\nexport { LayeraDXFParser } from './parsers/dxfParser';\r\n\r\n// Renderers\r\nexport { CADRenderer } from './renderers/cadRenderer';\r\n\r\n// Utilities\r\nexport {\r\n  validateCADFile,\r\n  validateCADProcessingOptions,\r\n  estimateCADComplexity\r\n} from './utils/cadValidator';\r\n\r\n// Types\r\nexport type {\r\n  CADProcessingOptions,\r\n  CADFormat,\r\n  CADParseOptions,\r\n  CADRenderOptions,\r\n  CADTransformOptions,\r\n  CADOptimizationOptions,\r\n  CADUnits,\r\n  CADData,\r\n  CADHeader,\r\n  CADTables,\r\n  CADLayer,\r\n  CADLineType,\r\n  CADTextStyle,\r\n  CADBlockDefinition,\r\n  CADViewport,\r\n  CADBlock,\r\n  CADEntity,\r\n  CADEntityType,\r\n  CADGeometry,\r\n  CADPoint3D,\r\n  CADColor,\r\n  CADMetadata,\r\n  CADBoundingBox,\r\n  CADStatistics,\r\n  CADProcessingResult,\r\n  CADRenderData,\r\n  CADLayerRenderData,\r\n  CADWarning,\r\n  CADError,\r\n  CADProcessingProgress,\r\n  CADProcessingConfig,\r\n  CADProcessingEvent,\r\n  CADProcessingCallback,\r\n  CADValidationResult,\r\n  CADValidationError,\r\n  CADValidationWarning,\r\n  CADFileInfo,\r\n  CADToGeoJSONOptions,\r\n  CADToSVGOptions,\r\n  CADExportOptions\r\n} from './types';\r\n\r\n// Error classes\r\nexport {\r\n  CADProcessingError,\r\n  DXFParsingError,\r\n  DWGNotSupportedError,\r\n  CADRenderingError\r\n} from './types';","import { useState, useCallback, useRef, useEffect } from 'react';\r\nimport { toast } from '@layera/notifications';\r\nimport { useLayeraTranslation } from '@layera/i18n/hooks';\r\nimport {\r\n  CADData,\r\n  CADProcessingOptions,\r\n  CADProcessingResult,\r\n  CADProcessingProgress,\r\n  CADProcessingError,\r\n  CADRenderData,\r\n  CADValidationResult,\r\n  CADExportOptions,\r\n  DWGNotSupportedError,\r\n  CADFormat\r\n} from '../types';\r\nimport { LayeraDXFParser } from '../parsers/dxfParser';\r\nimport { CADRenderer } from '../renderers/cadRenderer';\r\nimport { validateCADFile } from '../utils/cadValidator';\r\n\r\nexport interface UseCADProcessingOptions {\r\n  defaultOptions?: Partial<CADProcessingOptions>;\r\n  showNotifications?: boolean;\r\n  autoRender?: boolean;\r\n  onProgress?: (progress: CADProcessingProgress) => void;\r\n  onComplete?: (result: CADProcessingResult) => void;\r\n  onError?: (error: CADProcessingError) => void;\r\n}\r\n\r\nexport interface UseCADProcessingReturn {\r\n  // State\r\n  isProcessing: boolean;\r\n  progress: number;\r\n  result: CADProcessingResult | null;\r\n  renderData: CADRenderData | null;\r\n  errors: CADProcessingError[];\r\n\r\n  // Actions\r\n  processCADFile: (file: File, options?: Partial<CADProcessingOptions>) => Promise<CADProcessingResult>;\r\n  renderCAD: (cadData: CADData, options?: CADProcessingOptions['renderOptions']) => Promise<CADRenderData>;\r\n  exportCAD: (cadData: CADData, exportOptions: CADExportOptions) => Promise<Blob>;\r\n  clearResult: () => void;\r\n\r\n  // Validation & utilities\r\n  validateFile: (file: File) => Promise<CADValidationResult>;\r\n  getSupportedFormats: () => CADFormat[];\r\n  estimateProcessingTime: (file: File) => Promise<number>;\r\n}\r\n\r\nexport function useCADProcessing(\r\n  options: UseCADProcessingOptions = {}\r\n): UseCADProcessingReturn {\r\n  const { t } = useLayeraTranslation();\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [progress, setProgress] = useState(0);\r\n  const [result, setResult] = useState<CADProcessingResult | null>(null);\r\n  const [renderData, setRenderData] = useState<CADRenderData | null>(null);\r\n  const [errors, setErrors] = useState<CADProcessingError[]>([]);\r\n\r\n  const dxfParserRef = useRef<LayeraDXFParser | null>(null);\r\n  const cadRendererRef = useRef<CADRenderer | null>(null);\r\n\r\n  const {\r\n    defaultOptions = {},\r\n    showNotifications = true,\r\n    autoRender = true,\r\n    onProgress,\r\n    onComplete,\r\n    onError\r\n  } = options;\r\n\r\n  // Initialize parsers and renderers\r\n  useEffect(() => {\r\n    try {\r\n      dxfParserRef.current = new LayeraDXFParser();\r\n      cadRendererRef.current = new CADRenderer();\r\n    } catch (error) {\r\n      console.error('Failed to initialize CAD processing engines:', error);\r\n      if (showNotifications) {\r\n        toast.error(t('cad.engine.init.error'));\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      // Cleanup if needed\r\n    };\r\n  }, [showNotifications, t]);\r\n\r\n  const reportProgress = useCallback((\r\n    stage: CADProcessingProgress['stage'],\r\n    progress: number,\r\n    message: string,\r\n    currentEntity?: string,\r\n    entitiesProcessed?: number,\r\n    totalEntities?: number\r\n  ) => {\r\n    const progressData: CADProcessingProgress = {\r\n      stage,\r\n      progress,\r\n      message,\r\n      currentEntity,\r\n      entitiesProcessed,\r\n      totalEntities\r\n    };\r\n\r\n    setProgress(progress);\r\n    onProgress?.(progressData);\r\n\r\n    if (showNotifications && stage === 'complete') {\r\n      toast.success(t('cad.processing.success'), {\r\n        duration: 3000\r\n      });\r\n    }\r\n  }, [onProgress, showNotifications, t]);\r\n\r\n  const handleError = useCallback((error: CADProcessingError) => {\r\n    setErrors(prev => [...prev, error]);\r\n    onError?.(error);\r\n\r\n    if (showNotifications) {\r\n      toast.error(t('cad.processing.error', {\r\n        error: error.message\r\n      }), {\r\n        duration: 5000\r\n      });\r\n    }\r\n  }, [onError, showNotifications, t]);\r\n\r\n  const processCADFile = useCallback(async (\r\n    file: File,\r\n    processingOptions?: Partial<CADProcessingOptions>\r\n  ): Promise<CADProcessingResult> => {\r\n    if (!dxfParserRef.current || !cadRendererRef.current) {\r\n      throw new CADProcessingError(\r\n        'CAD processing engines not initialized',\r\n        'ENGINES_NOT_INITIALIZED'\r\n      );\r\n    }\r\n\r\n    const startTime = performance.now();\r\n    const finalOptions: CADProcessingOptions = {\r\n      format: 'dxf', // Will be detected\r\n      ...defaultOptions,\r\n      ...processingOptions\r\n    };\r\n\r\n    try {\r\n      setIsProcessing(true);\r\n      setErrors([]);\r\n\r\n      // Step 1: Detect file format\r\n      reportProgress('parsing', 5, t('cad.detecting.format'));\r\n      const detectedFormat = await detectCADFormat(file);\r\n      finalOptions.format = detectedFormat;\r\n\r\n      // Check format support\r\n      if (detectedFormat === 'dwg') {\r\n        throw new DWGNotSupportedError();\r\n      }\r\n\r\n      if (detectedFormat !== 'dxf') {\r\n        throw new CADProcessingError(\r\n          `Unsupported CAD format: ${detectedFormat}`,\r\n          'UNSUPPORTED_FORMAT'\r\n        );\r\n      }\r\n\r\n      // Step 2: Read file content\r\n      reportProgress('parsing', 15, t('cad.reading.file'));\r\n      const fileContent = await file.text();\r\n\r\n      // Step 3: Parse CAD data\r\n      reportProgress('parsing', 25, t('cad.parsing.data'));\r\n      const cadData = await dxfParserRef.current.parseDXF(\r\n        fileContent,\r\n        finalOptions.parseOptions\r\n      );\r\n\r\n      reportProgress('processing', 50, t('cad.processing.entities'));\r\n\r\n      // Step 4: Apply transformations if needed\r\n      if (finalOptions.transformOptions) {\r\n        // Apply coordinate transformations, unit conversions, etc.\r\n        // Implementation would go here\r\n      }\r\n\r\n      // Step 5: Apply optimizations if needed\r\n      if (finalOptions.optimizationOptions) {\r\n        reportProgress('optimizing', 70, t('cad.optimizing.geometry'));\r\n        // Apply geometry optimizations\r\n        // Implementation would go here\r\n      }\r\n\r\n      // Step 6: Generate render data if auto-render is enabled\r\n      let renderResult: CADRenderData | undefined;\r\n      if (autoRender) {\r\n        reportProgress('rendering', 85, t('cad.rendering.graphics'));\r\n        renderResult = await cadRendererRef.current.render(\r\n          cadData,\r\n          finalOptions.renderOptions\r\n        );\r\n        setRenderData(renderResult);\r\n      }\r\n\r\n      reportProgress('complete', 100, t('cad.processing.completed'));\r\n\r\n      // Create result\r\n      const processingResult: CADProcessingResult = {\r\n        originalFile: file,\r\n        cadData,\r\n        processingTime: performance.now() - startTime,\r\n        warnings: dxfParserRef.current.getWarnings(),\r\n        errors: dxfParserRef.current.getErrors(),\r\n        renderData: renderResult\r\n      };\r\n\r\n      setResult(processingResult);\r\n      onComplete?.(processingResult);\r\n\r\n      return processingResult;\r\n\r\n    } catch (error) {\r\n      const cadError = error instanceof CADProcessingError\r\n        ? error\r\n        : new CADProcessingError(\r\n            error instanceof Error ? error.message : 'Unknown CAD processing error',\r\n            'PROCESSING_FAILED'\r\n          );\r\n\r\n      handleError(cadError);\r\n      throw cadError;\r\n\r\n    } finally {\r\n      setIsProcessing(false);\r\n      setProgress(0);\r\n    }\r\n  }, [defaultOptions, autoRender, reportProgress, handleError, onComplete, t]);\r\n\r\n  const renderCAD = useCallback(async (\r\n    cadData: CADData,\r\n    renderOptions?: CADProcessingOptions['renderOptions']\r\n  ): Promise<CADRenderData> => {\r\n    if (!cadRendererRef.current) {\r\n      throw new CADProcessingError(\r\n        'CAD renderer not initialized',\r\n        'RENDERER_NOT_INITIALIZED'\r\n      );\r\n    }\r\n\r\n    try {\r\n      setIsProcessing(true);\r\n      reportProgress('rendering', 0, t('cad.rendering.start'));\r\n\r\n      const renderResult = await cadRendererRef.current.render(cadData, renderOptions);\r\n      setRenderData(renderResult);\r\n\r\n      reportProgress('complete', 100, t('cad.rendering.completed'));\r\n\r\n      if (showNotifications) {\r\n        toast.success(t('cad.rendering.success'), {\r\n          duration: 3000\r\n        });\r\n      }\r\n\r\n      return renderResult;\r\n\r\n    } catch (error) {\r\n      const renderError = new CADProcessingError(\r\n        `Rendering failed: ${error instanceof Error ? error.message : 'Unknown error'}`,\r\n        'RENDERING_FAILED',\r\n        'rendering'\r\n      );\r\n\r\n      handleError(renderError);\r\n      throw renderError;\r\n\r\n    } finally {\r\n      setIsProcessing(false);\r\n      setProgress(0);\r\n    }\r\n  }, [reportProgress, handleError, showNotifications, t]);\r\n\r\n  const exportCAD = useCallback(async (\r\n    cadData: CADData,\r\n    exportOptions: CADExportOptions\r\n  ): Promise<Blob> => {\r\n    try {\r\n      setIsProcessing(true);\r\n      reportProgress('processing', 0, t('cad.exporting.data'));\r\n\r\n      // Implementation will depend on the export format\r\n      switch (exportOptions.format) {\r\n        case 'geojson':\r\n          return await exportToGeoJSON(cadData, exportOptions.options);\r\n        case 'svg':\r\n          return await exportToSVG(cadData, exportOptions.options);\r\n        case 'dxf':\r\n          return await exportToDXF(cadData, exportOptions.options);\r\n        case 'pdf':\r\n          return await exportToPDF(cadData, exportOptions.options);\r\n        default:\r\n          throw new CADProcessingError(\r\n            `Unsupported export format: ${exportOptions.format}`,\r\n            'UNSUPPORTED_EXPORT_FORMAT'\r\n          );\r\n      }\r\n\r\n    } catch (error) {\r\n      const exportError = new CADProcessingError(\r\n        `Export failed: ${error instanceof Error ? error.message : 'Unknown error'}`,\r\n        'EXPORT_FAILED'\r\n      );\r\n\r\n      handleError(exportError);\r\n      throw exportError;\r\n\r\n    } finally {\r\n      setIsProcessing(false);\r\n      setProgress(0);\r\n    }\r\n  }, [reportProgress, handleError, t]);\r\n\r\n  const clearResult = useCallback(() => {\r\n    setResult(null);\r\n    setRenderData(null);\r\n    setErrors([]);\r\n    setProgress(0);\r\n  }, []);\r\n\r\n  const validateFile = useCallback(async (file: File): Promise<CADValidationResult> => {\r\n    return validateCADFile(file);\r\n  }, []);\r\n\r\n  const getSupportedFormats = useCallback((): CADFormat[] => {\r\n    return ['dxf']; // Currently only DXF is supported\r\n  }, []);\r\n\r\n  const estimateProcessingTime = useCallback(async (file: File): Promise<number> => {\r\n    // Simple estimation based on file size\r\n    const fileSizeMB = file.size / (1024 * 1024);\r\n\r\n    // Base time: 2 seconds per MB for DXF\r\n    let timePerMB = 2000;\r\n\r\n    // Adjust based on file extension\r\n    const extension = file.name.split('.').pop()?.toLowerCase();\r\n    if (extension === 'dwg') {\r\n      timePerMB = 0; // Not supported\r\n    }\r\n\r\n    return Math.round(fileSizeMB * timePerMB);\r\n  }, []);\r\n\r\n  return {\r\n    // State\r\n    isProcessing,\r\n    progress,\r\n    result,\r\n    renderData,\r\n    errors,\r\n\r\n    // Actions\r\n    processCADFile,\r\n    renderCAD,\r\n    exportCAD,\r\n    clearResult,\r\n\r\n    // Validation & utilities\r\n    validateFile,\r\n    getSupportedFormats,\r\n    estimateProcessingTime\r\n  };\r\n}\r\n\r\n// Helper functions\r\nasync function detectCADFormat(file: File): Promise<CADFormat> {\r\n  const extension = file.name.split('.').pop()?.toLowerCase();\r\n\r\n  switch (extension) {\r\n    case 'dxf':\r\n      return 'dxf';\r\n    case 'dwg':\r\n      return 'dwg';\r\n    case 'dwf':\r\n      return 'dwf';\r\n    case 'dgn':\r\n      return 'dgn';\r\n    default:\r\n      // Try to detect from content\r\n      const header = await file.slice(0, 1024).text();\r\n      if (header.includes('SECTION') && header.includes('HEADER')) {\r\n        return 'dxf';\r\n      }\r\n      throw new CADProcessingError(\r\n        `Cannot detect CAD format for file: ${file.name}`,\r\n        'FORMAT_DETECTION_FAILED'\r\n      );\r\n  }\r\n}\r\n\r\n// Placeholder export functions - θα υλοποιηθούν πλήρως\r\nasync function exportToGeoJSON(cadData: CADData, options: unknown): Promise<Blob> {\r\n  // Integration με @layera/file-transformation\r\n  throw new CADProcessingError('GeoJSON export not yet implemented', 'EXPORT_NOT_IMPLEMENTED');\r\n}\r\n\r\nasync function exportToSVG(cadData: CADData, options: unknown): Promise<Blob> {\r\n  // Use CADRenderer to generate SVG\r\n  throw new CADProcessingError('SVG export not yet implemented', 'EXPORT_NOT_IMPLEMENTED');\r\n}\r\n\r\nasync function exportToDXF(cadData: CADData, options: unknown): Promise<Blob> {\r\n  // Serialize back to DXF format\r\n  throw new CADProcessingError('DXF export not yet implemented', 'EXPORT_NOT_IMPLEMENTED');\r\n}\r\n\r\nasync function exportToPDF(cadData: CADData, options: unknown): Promise<Blob> {\r\n  // Convert to PDF format\r\n  throw new CADProcessingError('PDF export not yet implemented', 'EXPORT_NOT_IMPLEMENTED');\r\n}","// Core CAD processing types\r\nexport interface CADProcessingOptions {\r\n  format: CADFormat;\r\n  parseOptions?: CADParseOptions;\r\n  renderOptions?: CADRenderOptions;\r\n  transformOptions?: CADTransformOptions;\r\n  optimizationOptions?: CADOptimizationOptions;\r\n}\r\n\r\nexport type CADFormat = 'dxf' | 'dwg' | 'dwf' | 'dgn';\r\n\r\nexport interface CADParseOptions {\r\n  preserveLayerStructure?: boolean;\r\n  preserveBlockStructure?: boolean;\r\n  preserveTextStyles?: boolean;\r\n  preserveLineTypes?: boolean;\r\n  preserveColors?: boolean;\r\n  parseCustomEntities?: boolean;\r\n  encoding?: 'utf-8' | 'cp1252' | 'iso-8859-1';\r\n  toleranceMode?: 'strict' | 'lenient';\r\n}\r\n\r\nexport interface CADRenderOptions {\r\n  renderLayers?: string[] | 'all';\r\n  renderBlocks?: boolean;\r\n  renderText?: boolean;\r\n  renderDimensions?: boolean;\r\n  renderHatches?: boolean;\r\n  scaleFactor?: number;\r\n  coordinateSystem?: 'model' | 'paper';\r\n  units?: CADUnits;\r\n}\r\n\r\nexport interface CADTransformOptions {\r\n  targetCoordinateSystem?: string;\r\n  unitConversion?: {\r\n    from: CADUnits;\r\n    to: CADUnits;\r\n  };\r\n  geometricTransform?: {\r\n    scale?: { x: number; y: number; z?: number };\r\n    rotation?: number;\r\n    translation?: { x: number; y: number; z?: number };\r\n  };\r\n}\r\n\r\nexport interface CADOptimizationOptions {\r\n  simplifyGeometry?: boolean;\r\n  simplificationTolerance?: number;\r\n  mergeColinearLines?: boolean;\r\n  removeDuplicateEntities?: boolean;\r\n  optimizeBlocks?: boolean;\r\n  stripUnusedLayers?: boolean;\r\n}\r\n\r\nexport type CADUnits = 'mm' | 'cm' | 'm' | 'km' | 'in' | 'ft' | 'yd' | 'mil' | 'units';\r\n\r\n// CAD Data structures\r\nexport interface CADData {\r\n  header: CADHeader;\r\n  tables: CADTables;\r\n  blocks: CADBlock[];\r\n  entities: CADEntity[];\r\n  metadata: CADMetadata;\r\n}\r\n\r\nexport interface CADHeader {\r\n  version: string;\r\n  createdBy?: string;\r\n  modifiedBy?: string;\r\n  creationDate?: Date;\r\n  modificationDate?: Date;\r\n  drawingUnits: CADUnits;\r\n  insertionBasePoint: CADPoint3D;\r\n  extentsMin: CADPoint3D;\r\n  extentsMax: CADPoint3D;\r\n  customProperties: Record<string, unknown>;\r\n}\r\n\r\nexport interface CADTables {\r\n  layers: CADLayer[];\r\n  lineTypes: CADLineType[];\r\n  textStyles: CADTextStyle[];\r\n  blocks: CADBlockDefinition[];\r\n  viewports: CADViewport[];\r\n}\r\n\r\nexport interface CADLayer {\r\n  name: string;\r\n  color: CADColor;\r\n  lineType: string;\r\n  lineWeight: number;\r\n  visible: boolean;\r\n  locked: boolean;\r\n  frozen: boolean;\r\n  plotStyle?: string;\r\n}\r\n\r\nexport interface CADLineType {\r\n  name: string;\r\n  description: string;\r\n  pattern: number[];\r\n  patternLength: number;\r\n}\r\n\r\nexport interface CADTextStyle {\r\n  name: string;\r\n  fontName: string;\r\n  fontSize: number;\r\n  oblique: number;\r\n  widthFactor: number;\r\n  backwards: boolean;\r\n  upsideDown: boolean;\r\n}\r\n\r\nexport interface CADBlockDefinition {\r\n  name: string;\r\n  basePoint: CADPoint3D;\r\n  entities: CADEntity[];\r\n  description?: string;\r\n}\r\n\r\nexport interface CADViewport {\r\n  name: string;\r\n  center: CADPoint3D;\r\n  width: number;\r\n  height: number;\r\n  target: CADPoint3D;\r\n  direction: CADPoint3D;\r\n}\r\n\r\nexport interface CADBlock {\r\n  name: string;\r\n  insertionPoint: CADPoint3D;\r\n  scale: CADPoint3D;\r\n  rotation: number;\r\n  attributes: Record<string, string>;\r\n}\r\n\r\n// CAD Entity types\r\nexport interface CADEntity {\r\n  id: string;\r\n  type: CADEntityType;\r\n  layer: string;\r\n  color: CADColor;\r\n  lineType: string;\r\n  lineWeight: number;\r\n  geometry: CADGeometry;\r\n  extendedData?: Record<string, unknown>;\r\n}\r\n\r\nexport type CADEntityType =\r\n  | 'LINE' | 'CIRCLE' | 'ARC' | 'ELLIPSE' | 'POINT'\r\n  | 'POLYLINE' | 'LWPOLYLINE' | 'SPLINE' | 'TEXT' | 'MTEXT'\r\n  | 'INSERT' | 'DIMENSION' | 'HATCH' | 'SOLID' | 'FACE3D'\r\n  | 'MESH' | 'SURFACE' | 'REGION' | 'BODY' | '3DSOLID';\r\n\r\nexport interface CADGeometry {\r\n  type: CADEntityType;\r\n  points: CADPoint3D[];\r\n  properties: Record<string, unknown>;\r\n}\r\n\r\nexport interface CADPoint3D {\r\n  x: number;\r\n  y: number;\r\n  z: number;\r\n}\r\n\r\nexport interface CADColor {\r\n  type: 'index' | 'rgb' | 'named';\r\n  value: number | string | { r: number; g: number; b: number };\r\n}\r\n\r\nexport interface CADMetadata {\r\n  originalFormat: CADFormat;\r\n  fileSize: number;\r\n  parsingTime: number;\r\n  entityCount: number;\r\n  layerCount: number;\r\n  blockCount: number;\r\n  boundingBox: CADBoundingBox;\r\n  statistics: CADStatistics;\r\n}\r\n\r\nexport interface CADBoundingBox {\r\n  min: CADPoint3D;\r\n  max: CADPoint3D;\r\n  center: CADPoint3D;\r\n  size: CADPoint3D;\r\n}\r\n\r\nexport interface CADStatistics {\r\n  lines: number;\r\n  circles: number;\r\n  arcs: number;\r\n  polylines: number;\r\n  text: number;\r\n  blocks: number;\r\n  other: number;\r\n  totalVertices: number;\r\n  complexityScore: number;\r\n}\r\n\r\n// Processing results\r\nexport interface CADProcessingResult {\r\n  originalFile: File;\r\n  cadData: CADData;\r\n  processingTime: number;\r\n  warnings: CADWarning[];\r\n  errors: CADError[];\r\n  renderData?: CADRenderData;\r\n}\r\n\r\nexport interface CADRenderData {\r\n  svg: string;\r\n  bounds: CADBoundingBox;\r\n  layers: CADLayerRenderData[];\r\n  scale: number;\r\n  viewBox: string;\r\n}\r\n\r\nexport interface CADLayerRenderData {\r\n  name: string;\r\n  visible: boolean;\r\n  elementCount: number;\r\n  svgGroup: string;\r\n}\r\n\r\nexport interface CADWarning {\r\n  code: string;\r\n  message: string;\r\n  entity?: string;\r\n  layer?: string;\r\n  suggestion?: string;\r\n}\r\n\r\nexport interface CADError {\r\n  code: string;\r\n  message: string;\r\n  severity: 'critical' | 'error' | 'warning';\r\n  entity?: string;\r\n  position?: CADPoint3D;\r\n  context?: string;\r\n}\r\n\r\n// Progress tracking\r\nexport interface CADProcessingProgress {\r\n  stage: 'parsing' | 'processing' | 'rendering' | 'optimizing' | 'complete';\r\n  progress: number;\r\n  message: string;\r\n  currentEntity?: string;\r\n  entitiesProcessed?: number;\r\n  totalEntities?: number;\r\n}\r\n\r\n// Error classes\r\nexport class CADProcessingError extends Error {\r\n  constructor(\r\n    message: string,\r\n    public code: string,\r\n    public stage?: CADProcessingProgress['stage'],\r\n    public originalError?: Error\r\n  ) {\r\n    super(message);\r\n    this.name = 'CADProcessingError';\r\n  }\r\n}\r\n\r\nexport class DXFParsingError extends CADProcessingError {\r\n  constructor(message: string, lineNumber?: number) {\r\n    super(\r\n      `DXF parsing failed: ${message}${lineNumber ? ` at line ${lineNumber}` : ''}`,\r\n      'DXF_PARSING_ERROR',\r\n      'parsing'\r\n    );\r\n  }\r\n}\r\n\r\nexport class DWGNotSupportedError extends CADProcessingError {\r\n  constructor() {\r\n    super(\r\n      'DWG format is not yet supported. Please convert to DXF format.',\r\n      'DWG_NOT_SUPPORTED',\r\n      'parsing'\r\n    );\r\n  }\r\n}\r\n\r\nexport class CADRenderingError extends CADProcessingError {\r\n  constructor(message: string, entityType?: string) {\r\n    super(\r\n      `CAD rendering failed: ${message}${entityType ? ` for entity type ${entityType}` : ''}`,\r\n      'CAD_RENDERING_ERROR',\r\n      'rendering'\r\n    );\r\n  }\r\n}\r\n\r\n// Configuration\r\nexport interface CADProcessingConfig {\r\n  defaultParseOptions: CADParseOptions;\r\n  defaultRenderOptions: CADRenderOptions;\r\n  supportedFormats: CADFormat[];\r\n  maxFileSize: number;\r\n  maxEntities: number;\r\n  enableOptimization: boolean;\r\n  renderingEngine: 'svg' | 'canvas' | 'webgl';\r\n}\r\n\r\n// Events and callbacks\r\nexport interface CADProcessingEvent {\r\n  type: 'cad:parsing:started' | 'cad:parsing:progress' | 'cad:parsing:completed' | 'cad:parsing:failed'\r\n      | 'cad:rendering:started' | 'cad:rendering:progress' | 'cad:rendering:completed' | 'cad:rendering:failed';\r\n  data?: unknown;\r\n}\r\n\r\nexport type CADProcessingCallback = (event: CADProcessingEvent) => void;\r\n\r\n// Validation\r\nexport interface CADValidationResult {\r\n  isValid: boolean;\r\n  errors: CADValidationError[];\r\n  warnings: CADValidationWarning[];\r\n  fileInfo: CADFileInfo;\r\n}\r\n\r\nexport interface CADValidationError {\r\n  code: string;\r\n  message: string;\r\n  severity: 'critical' | 'error' | 'warning';\r\n}\r\n\r\nexport interface CADValidationWarning {\r\n  code: string;\r\n  message: string;\r\n  suggestion?: string;\r\n}\r\n\r\nexport interface CADFileInfo {\r\n  format: CADFormat | 'unknown';\r\n  version?: string;\r\n  size: number;\r\n  estimatedComplexity: 'low' | 'medium' | 'high';\r\n  estimatedProcessingTime: number;\r\n}\r\n\r\n// Utility types για συμβατότητα με άλλα LEGO packages\r\nexport interface CADToGeoJSONOptions {\r\n  coordinateSystem?: string;\r\n  preserveLayerInfo?: boolean;\r\n  simplifyGeometry?: boolean;\r\n  tolerance?: number;\r\n}\r\n\r\nexport interface CADToSVGOptions {\r\n  width?: number;\r\n  height?: number;\r\n  preserveAspectRatio?: boolean;\r\n  backgroundColor?: string;\r\n  strokeWidth?: number;\r\n}\r\n\r\n// Export/conversion types\r\nexport interface CADExportOptions {\r\n  format: 'geojson' | 'svg' | 'dxf' | 'pdf';\r\n  options?: CADToGeoJSONOptions | CADToSVGOptions | Record<string, unknown>;\r\n}","import DxfParser from 'dxf-parser';\r\nimport {\r\n  CADData,\r\n  CADHeader,\r\n  CADTables,\r\n  CADEntity,\r\n  CADBlock,\r\n  CADMetadata,\r\n  CADParseOptions,\r\n  CADPoint3D,\r\n  CADColor,\r\n  CADLayer,\r\n  CADEntityType,\r\n  CADGeometry,\r\n  CADBoundingBox,\r\n  CADStatistics,\r\n  DXFParsingError,\r\n  CADWarning,\r\n  CADError\r\n} from '../types';\r\n\r\n/**\r\n * Enhanced DXF parser βασισμένο σε proven patterns από OLD_geo-canvas\r\n * Χρησιμοποιεί την dxf-parser library με επιπλέον features\r\n */\r\nexport class LayeraDXFParser {\r\n  private parser: DxfParser;\r\n  private warnings: CADWarning[] = [];\r\n  private errors: CADError[] = [];\r\n\r\n  constructor() {\r\n    this.parser = new DxfParser();\r\n  }\r\n\r\n  /**\r\n   * Main parsing method\r\n   */\r\n  async parseDXF(\r\n    fileContent: string | ArrayBuffer,\r\n    options: CADParseOptions = {}\r\n  ): Promise<CADData> {\r\n    const startTime = performance.now();\r\n    this.warnings = [];\r\n    this.errors = [];\r\n\r\n    try {\r\n      // Convert ArrayBuffer to string if needed\r\n      const dxfString = typeof fileContent === 'string'\r\n        ? fileContent\r\n        : new TextDecoder(options.encoding || 'utf-8').decode(fileContent);\r\n\r\n      // Validate DXF content\r\n      this.validateDXFContent(dxfString);\r\n\r\n      // Parse με την dxf-parser library\r\n      const parsedDxf = this.parser.parseSync(dxfString);\r\n\r\n      if (!parsedDxf) {\r\n        throw new DXFParsingError('Failed to parse DXF content');\r\n      }\r\n\r\n      // Transform to our CAD data structure\r\n      const cadData = await this.transformToCADData(parsedDxf, options);\r\n\r\n      // Calculate processing time\r\n      cadData.metadata.parsingTime = performance.now() - startTime;\r\n\r\n      return cadData;\r\n\r\n    } catch (error) {\r\n      if (error instanceof DXFParsingError) {\r\n        throw error;\r\n      }\r\n\r\n      throw new DXFParsingError(\r\n        error instanceof Error ? error.message : 'Unknown parsing error'\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validates DXF file content\r\n   */\r\n  private validateDXFContent(content: string): void {\r\n    // Check for DXF header\r\n    if (!content.includes('SECTION') || !content.includes('HEADER')) {\r\n      throw new DXFParsingError('Invalid DXF file: Missing SECTION or HEADER');\r\n    }\r\n\r\n    // Check for minimum required sections\r\n    const requiredSections = ['HEADER', 'ENTITIES'];\r\n    const missingSections = requiredSections.filter(section =>\r\n      !content.includes(section)\r\n    );\r\n\r\n    if (missingSections.length > 0) {\r\n      this.warnings.push({\r\n        code: 'MISSING_SECTIONS',\r\n        message: `Missing DXF sections: ${missingSections.join(', ')}`,\r\n        suggestion: 'Some features may not be available'\r\n      });\r\n    }\r\n\r\n    // Check file size\r\n    if (content.length > 50 * 1024 * 1024) { // 50MB\r\n      this.warnings.push({\r\n        code: 'LARGE_FILE',\r\n        message: 'Large DXF file detected - processing may take time',\r\n        suggestion: 'Consider simplifying the drawing or processing in chunks'\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Transforms dxf-parser output to our CAD data structure\r\n   */\r\n  private async transformToCADData(\r\n    parsedDxf: Record<string, unknown>,\r\n    options: CADParseOptions\r\n  ): Promise<CADData> {\r\n    // Extract header information\r\n    const header = this.extractHeader(parsedDxf);\r\n\r\n    // Extract tables (layers, linetypes, etc.)\r\n    const tables = this.extractTables(parsedDxf, options);\r\n\r\n    // Extract blocks\r\n    const blocks = this.extractBlocks(parsedDxf, options);\r\n\r\n    // Extract entities\r\n    const entities = this.extractEntities(parsedDxf, options);\r\n\r\n    // Calculate metadata\r\n    const metadata = this.calculateMetadata(header, tables, blocks, entities);\r\n\r\n    return {\r\n      header,\r\n      tables,\r\n      blocks,\r\n      entities,\r\n      metadata\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Extracts header information\r\n   */\r\n  private extractHeader(parsedDxf: Record<string, unknown>): CADHeader {\r\n    const header = parsedDxf.header as Record<string, unknown> || {};\r\n\r\n    return {\r\n      version: this.getHeaderValue(header, '$ACADVER', 'AC1015') as string,\r\n      drawingUnits: this.mapDXFUnits(this.getHeaderValue(header, '$INSUNITS', 0) as number),\r\n      insertionBasePoint: this.getHeaderPoint(header, '$INSBASE'),\r\n      extentsMin: this.getHeaderPoint(header, '$EXTMIN'),\r\n      extentsMax: this.getHeaderPoint(header, '$EXTMAX'),\r\n      customProperties: {}\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Extracts tables (layers, linetypes, etc.)\r\n   */\r\n  private extractTables(\r\n    parsedDxf: Record<string, unknown>,\r\n    options: CADParseOptions\r\n  ): CADTables {\r\n    const tables = parsedDxf.tables as Record<string, unknown> || {};\r\n\r\n    return {\r\n      layers: this.extractLayers(tables.layer as Record<string, unknown>[] || []),\r\n      lineTypes: this.extractLineTypes(tables.ltype as Record<string, unknown>[] || []),\r\n      textStyles: this.extractTextStyles(tables.style as Record<string, unknown>[] || []),\r\n      blocks: [],\r\n      viewports: []\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Extracts layer definitions\r\n   */\r\n  private extractLayers(layerData: Record<string, unknown>[]): CADLayer[] {\r\n    return layerData.map(layer => ({\r\n      name: layer.name as string || 'DEFAULT',\r\n      color: this.parseColor(layer.color),\r\n      lineType: layer.lineType as string || 'CONTINUOUS',\r\n      lineWeight: layer.lineWeight as number || 0,\r\n      visible: !(layer.flags as number & 1), // Bit 1 = frozen\r\n      locked: !!(layer.flags as number & 4), // Bit 4 = locked\r\n      frozen: !!(layer.flags as number & 1)   // Bit 1 = frozen\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Extracts line type definitions\r\n   */\r\n  private extractLineTypes(lineTypeData: Record<string, unknown>[]): never[] {\r\n    // Simplified για τώρα - θα υλοποιηθεί πλήρως στο επόμενο στάδιο\r\n    return [];\r\n  }\r\n\r\n  /**\r\n   * Extracts text style definitions\r\n   */\r\n  private extractTextStyles(styleData: Record<string, unknown>[]): never[] {\r\n    // Simplified για τώρα - θα υλοποιηθεί πλήρως στο επόμενο στάδιο\r\n    return [];\r\n  }\r\n\r\n  /**\r\n   * Extracts block definitions\r\n   */\r\n  private extractBlocks(\r\n    parsedDxf: Record<string, unknown>,\r\n    options: CADParseOptions\r\n  ): CADBlock[] {\r\n    if (!options.preserveBlockStructure) return [];\r\n\r\n    const blocks = parsedDxf.blocks as Record<string, unknown> || {};\r\n    // Simplified για τώρα - θα υλοποιηθεί πλήρως στο επόμενο στάδιο\r\n    return [];\r\n  }\r\n\r\n  /**\r\n   * Extracts entities (main geometric data)\r\n   */\r\n  private extractEntities(\r\n    parsedDxf: Record<string, unknown>,\r\n    options: CADParseOptions\r\n  ): CADEntity[] {\r\n    const entities = parsedDxf.entities as Record<string, unknown>[] || [];\r\n    const cadEntities: CADEntity[] = [];\r\n\r\n    for (const entity of entities) {\r\n      try {\r\n        const cadEntity = this.convertEntityToCAD(entity);\r\n        if (cadEntity) {\r\n          cadEntities.push(cadEntity);\r\n        }\r\n      } catch (error) {\r\n        this.errors.push({\r\n          code: 'ENTITY_CONVERSION_ERROR',\r\n          message: `Failed to convert entity: ${error instanceof Error ? error.message : 'Unknown error'}`,\r\n          severity: 'warning',\r\n          entity: entity.type as string || 'unknown'\r\n        });\r\n      }\r\n    }\r\n\r\n    return cadEntities;\r\n  }\r\n\r\n  /**\r\n   * Converts a DXF entity to our CAD entity format\r\n   */\r\n  private convertEntityToCAD(entity: Record<string, unknown>): CADEntity | null {\r\n    const entityType = (entity.type as string)?.toUpperCase();\r\n\r\n    if (!entityType) {\r\n      return null;\r\n    }\r\n\r\n    const baseEntity = {\r\n      id: this.generateEntityId(),\r\n      type: entityType as CADEntityType,\r\n      layer: entity.layer as string || '0',\r\n      color: this.parseColor(entity.color),\r\n      lineType: entity.lineType as string || 'CONTINUOUS',\r\n      lineWeight: entity.lineWeight as number || 0\r\n    };\r\n\r\n    // Convert geometry based on entity type\r\n    const geometry = this.convertEntityGeometry(entity, entityType);\r\n\r\n    if (!geometry) {\r\n      return null;\r\n    }\r\n\r\n    return {\r\n      ...baseEntity,\r\n      geometry\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Converts entity geometry based on type\r\n   */\r\n  private convertEntityGeometry(\r\n    entity: Record<string, unknown>,\r\n    entityType: string\r\n  ): CADGeometry | null {\r\n    switch (entityType) {\r\n      case 'LINE':\r\n        return this.convertLineGeometry(entity);\r\n      case 'CIRCLE':\r\n        return this.convertCircleGeometry(entity);\r\n      case 'ARC':\r\n        return this.convertArcGeometry(entity);\r\n      case 'POLYLINE':\r\n      case 'LWPOLYLINE':\r\n        return this.convertPolylineGeometry(entity);\r\n      case 'TEXT':\r\n      case 'MTEXT':\r\n        return this.convertTextGeometry(entity);\r\n      case 'POINT':\r\n        return this.convertPointGeometry(entity);\r\n      default:\r\n        this.warnings.push({\r\n          code: 'UNSUPPORTED_ENTITY',\r\n          message: `Unsupported entity type: ${entityType}`,\r\n          suggestion: 'Entity will be skipped'\r\n        });\r\n        return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Converts LINE entity geometry\r\n   */\r\n  private convertLineGeometry(entity: Record<string, unknown>): CADGeometry {\r\n    const start = this.getPoint(entity, 'start') || this.getPoint(entity, '');\r\n    const end = this.getPoint(entity, 'end') || this.getPoint(entity, '1');\r\n\r\n    return {\r\n      type: 'LINE',\r\n      points: [start, end],\r\n      properties: {}\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Converts CIRCLE entity geometry\r\n   */\r\n  private convertCircleGeometry(entity: Record<string, unknown>): CADGeometry {\r\n    const center = this.getPoint(entity, 'center') || this.getPoint(entity, '');\r\n    const radius = entity.radius as number || 0;\r\n\r\n    return {\r\n      type: 'CIRCLE',\r\n      points: [center],\r\n      properties: { radius }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Converts ARC entity geometry\r\n   */\r\n  private convertArcGeometry(entity: Record<string, unknown>): CADGeometry {\r\n    const center = this.getPoint(entity, 'center') || this.getPoint(entity, '');\r\n    const radius = entity.radius as number || 0;\r\n    const startAngle = entity.startAngle as number || 0;\r\n    const endAngle = entity.endAngle as number || 0;\r\n\r\n    return {\r\n      type: 'ARC',\r\n      points: [center],\r\n      properties: { radius, startAngle, endAngle }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Converts POLYLINE entity geometry\r\n   */\r\n  private convertPolylineGeometry(entity: Record<string, unknown>): CADGeometry {\r\n    const vertices = entity.vertices as Record<string, unknown>[] || [];\r\n    const points = vertices.map(vertex => this.getPoint(vertex, ''));\r\n\r\n    return {\r\n      type: 'POLYLINE',\r\n      points,\r\n      properties: {\r\n        closed: entity.closed || false\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Converts TEXT entity geometry\r\n   */\r\n  private convertTextGeometry(entity: Record<string, unknown>): CADGeometry {\r\n    const position = this.getPoint(entity, 'start') || this.getPoint(entity, '');\r\n    const text = entity.text as string || '';\r\n    const height = entity.height as number || 1;\r\n\r\n    return {\r\n      type: 'TEXT',\r\n      points: [position],\r\n      properties: { text, height }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Converts POINT entity geometry\r\n   */\r\n  private convertPointGeometry(entity: Record<string, unknown>): CADGeometry {\r\n    const position = this.getPoint(entity, '') || { x: 0, y: 0, z: 0 };\r\n\r\n    return {\r\n      type: 'POINT',\r\n      points: [position],\r\n      properties: {}\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Helper methods\r\n   */\r\n  private getHeaderValue(header: Record<string, unknown>, key: string, defaultValue: unknown): unknown {\r\n    return header[key] || defaultValue;\r\n  }\r\n\r\n  private getHeaderPoint(header: Record<string, unknown>, key: string): CADPoint3D {\r\n    const point = header[key] as Record<string, number> || {};\r\n    return {\r\n      x: point.x || 0,\r\n      y: point.y || 0,\r\n      z: point.z || 0\r\n    };\r\n  }\r\n\r\n  private getPoint(entity: Record<string, unknown>, prefix: string): CADPoint3D {\r\n    const suffix = prefix ? prefix : '';\r\n    return {\r\n      x: entity[`x${suffix}`] as number || entity.x as number || 0,\r\n      y: entity[`y${suffix}`] as number || entity.y as number || 0,\r\n      z: entity[`z${suffix}`] as number || entity.z as number || 0\r\n    };\r\n  }\r\n\r\n  private parseColor(colorValue: unknown): CADColor {\r\n    if (typeof colorValue === 'number') {\r\n      return { type: 'index', value: colorValue };\r\n    }\r\n    return { type: 'index', value: 7 }; // Default white\r\n  }\r\n\r\n  private mapDXFUnits(unitsCode: number): 'mm' | 'cm' | 'm' | 'in' | 'ft' | 'units' {\r\n    const unitsMap: Record<number, 'mm' | 'cm' | 'm' | 'in' | 'ft' | 'units'> = {\r\n      0: 'units',\r\n      1: 'in',\r\n      2: 'ft',\r\n      3: 'mil',\r\n      4: 'mm',\r\n      5: 'cm',\r\n      6: 'm'\r\n    };\r\n    return unitsMap[unitsCode] || 'units';\r\n  }\r\n\r\n  private generateEntityId(): string {\r\n    return `entity-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n  }\r\n\r\n  /**\r\n   * Calculates metadata and statistics\r\n   */\r\n  private calculateMetadata(\r\n    header: CADHeader,\r\n    tables: CADTables,\r\n    blocks: CADBlock[],\r\n    entities: CADEntity[]\r\n  ): CADMetadata {\r\n    // Calculate bounding box\r\n    const boundingBox = this.calculateBoundingBox(entities);\r\n\r\n    // Calculate statistics\r\n    const statistics = this.calculateStatistics(entities);\r\n\r\n    return {\r\n      originalFormat: 'dxf',\r\n      fileSize: 0, // Will be set by the calling code\r\n      parsingTime: 0, // Will be set by the calling code\r\n      entityCount: entities.length,\r\n      layerCount: tables.layers.length,\r\n      blockCount: blocks.length,\r\n      boundingBox,\r\n      statistics\r\n    };\r\n  }\r\n\r\n  private calculateBoundingBox(entities: CADEntity[]): CADBoundingBox {\r\n    if (entities.length === 0) {\r\n      const origin = { x: 0, y: 0, z: 0 };\r\n      return {\r\n        min: origin,\r\n        max: origin,\r\n        center: origin,\r\n        size: origin\r\n      };\r\n    }\r\n\r\n    let minX = Infinity, minY = Infinity, minZ = Infinity;\r\n    let maxX = -Infinity, maxY = -Infinity, maxZ = -Infinity;\r\n\r\n    for (const entity of entities) {\r\n      for (const point of entity.geometry.points) {\r\n        minX = Math.min(minX, point.x);\r\n        minY = Math.min(minY, point.y);\r\n        minZ = Math.min(minZ, point.z);\r\n        maxX = Math.max(maxX, point.x);\r\n        maxY = Math.max(maxY, point.y);\r\n        maxZ = Math.max(maxZ, point.z);\r\n      }\r\n    }\r\n\r\n    const min = { x: minX, y: minY, z: minZ };\r\n    const max = { x: maxX, y: maxY, z: maxZ };\r\n\r\n    return {\r\n      min,\r\n      max,\r\n      center: {\r\n        x: (minX + maxX) / 2,\r\n        y: (minY + maxY) / 2,\r\n        z: (minZ + maxZ) / 2\r\n      },\r\n      size: {\r\n        x: maxX - minX,\r\n        y: maxY - minY,\r\n        z: maxZ - minZ\r\n      }\r\n    };\r\n  }\r\n\r\n  private calculateStatistics(entities: CADEntity[]): CADStatistics {\r\n    const stats: CADStatistics = {\r\n      lines: 0,\r\n      circles: 0,\r\n      arcs: 0,\r\n      polylines: 0,\r\n      text: 0,\r\n      blocks: 0,\r\n      other: 0,\r\n      totalVertices: 0,\r\n      complexityScore: 0\r\n    };\r\n\r\n    for (const entity of entities) {\r\n      stats.totalVertices += entity.geometry.points.length;\r\n\r\n      switch (entity.type) {\r\n        case 'LINE':\r\n          stats.lines++;\r\n          break;\r\n        case 'CIRCLE':\r\n          stats.circles++;\r\n          break;\r\n        case 'ARC':\r\n          stats.arcs++;\r\n          break;\r\n        case 'POLYLINE':\r\n        case 'LWPOLYLINE':\r\n          stats.polylines++;\r\n          break;\r\n        case 'TEXT':\r\n        case 'MTEXT':\r\n          stats.text++;\r\n          break;\r\n        case 'INSERT':\r\n          stats.blocks++;\r\n          break;\r\n        default:\r\n          stats.other++;\r\n      }\r\n    }\r\n\r\n    // Simple complexity calculation\r\n    stats.complexityScore = entities.length * 10 + stats.totalVertices;\r\n\r\n    return stats;\r\n  }\r\n\r\n  /**\r\n   * Gets warnings generated during parsing\r\n   */\r\n  getWarnings(): CADWarning[] {\r\n    return [...this.warnings];\r\n  }\r\n\r\n  /**\r\n   * Gets errors generated during parsing\r\n   */\r\n  getErrors(): CADError[] {\r\n    return [...this.errors];\r\n  }\r\n}","import {\r\n  CADData,\r\n  CADRenderData,\r\n  CADRenderOptions,\r\n  CADLayerRenderData,\r\n  CADEntity,\r\n  CADGeometry,\r\n  CADPoint3D,\r\n  CADRenderingError\r\n} from '../types';\r\n\r\n/**\r\n * CAD renderer που μετατρέπει CAD data σε SVG\r\n * Βασισμένο σε patterns από OLD_geo-canvas DxfEntityRenderer\r\n */\r\nexport class CADRenderer {\r\n  private svgElements: string[] = [];\r\n  private currentScale = 1;\r\n  private currentOffset = { x: 0, y: 0 };\r\n\r\n  /**\r\n   * Main rendering method\r\n   */\r\n  async render(\r\n    cadData: CADData,\r\n    options: CADRenderOptions = {}\r\n  ): Promise<CADRenderData> {\r\n    try {\r\n      this.svgElements = [];\r\n\r\n      // Calculate rendering parameters\r\n      const renderBounds = this.calculateRenderBounds(cadData);\r\n      const scale = this.calculateScale(renderBounds, options);\r\n      const viewBox = this.calculateViewBox(renderBounds, scale);\r\n\r\n      this.currentScale = scale;\r\n      this.currentOffset = {\r\n        x: -renderBounds.min.x * scale,\r\n        y: -renderBounds.min.y * scale\r\n      };\r\n\r\n      // Filter layers to render\r\n      const layersToRender = this.getLayersToRender(cadData, options);\r\n\r\n      // Render layers\r\n      const layerRenderData: CADLayerRenderData[] = [];\r\n\r\n      for (const layer of layersToRender) {\r\n        const layerEntities = cadData.entities.filter(entity => entity.layer === layer.name);\r\n\r\n        if (layerEntities.length > 0) {\r\n          const layerSvg = this.renderLayer(layer.name, layerEntities, options);\r\n          layerRenderData.push({\r\n            name: layer.name,\r\n            visible: layer.visible,\r\n            elementCount: layerEntities.length,\r\n            svgGroup: layerSvg\r\n          });\r\n        }\r\n      }\r\n\r\n      // Combine all SVG elements\r\n      const svg = this.generateFinalSVG(layerRenderData, viewBox, options);\r\n\r\n      return {\r\n        svg,\r\n        bounds: renderBounds,\r\n        layers: layerRenderData,\r\n        scale,\r\n        viewBox\r\n      };\r\n\r\n    } catch (error) {\r\n      throw new CADRenderingError(\r\n        error instanceof Error ? error.message : 'Unknown rendering error'\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calculates the bounding box για rendering\r\n   */\r\n  private calculateRenderBounds(cadData: CADData) {\r\n    return cadData.metadata.boundingBox;\r\n  }\r\n\r\n  /**\r\n   * Calculates appropriate scale για rendering\r\n   */\r\n  private calculateScale(bounds: CADData['metadata']['boundingBox'], options: CADRenderOptions): number {\r\n    if (options.scaleFactor) {\r\n      return options.scaleFactor;\r\n    }\r\n\r\n    // Auto-scale to fit within reasonable SVG dimensions\r\n    const maxDimension = Math.max(bounds.size.x, bounds.size.y);\r\n    const targetSize = 1000; // Target 1000px max dimension\r\n\r\n    return maxDimension > 0 ? targetSize / maxDimension : 1;\r\n  }\r\n\r\n  /**\r\n   * Calculates SVG viewBox\r\n   */\r\n  private calculateViewBox(bounds: CADData['metadata']['boundingBox'], scale: number): string {\r\n    const width = bounds.size.x * scale;\r\n    const height = bounds.size.y * scale;\r\n    const x = bounds.min.x * scale;\r\n    const y = bounds.min.y * scale;\r\n\r\n    return `${x} ${y} ${width} ${height}`;\r\n  }\r\n\r\n  /**\r\n   * Gets layers που θα rendered\r\n   */\r\n  private getLayersToRender(cadData: CADData, options: CADRenderOptions) {\r\n    const allLayers = cadData.tables.layers;\r\n\r\n    if (options.renderLayers === 'all') {\r\n      return allLayers.filter(layer => layer.visible);\r\n    }\r\n\r\n    if (Array.isArray(options.renderLayers)) {\r\n      return allLayers.filter(layer =>\r\n        options.renderLayers!.includes(layer.name) && layer.visible\r\n      );\r\n    }\r\n\r\n    return allLayers.filter(layer => layer.visible);\r\n  }\r\n\r\n  /**\r\n   * Renders a single layer\r\n   */\r\n  private renderLayer(\r\n    layerName: string,\r\n    entities: CADEntity[],\r\n    options: CADRenderOptions\r\n  ): string {\r\n    const layerElements: string[] = [];\r\n\r\n    for (const entity of entities) {\r\n      try {\r\n        const svg = this.renderEntity(entity, options);\r\n        if (svg) {\r\n          layerElements.push(svg);\r\n        }\r\n      } catch (error) {\r\n        console.warn(`Failed to render entity ${entity.id}:`, error);\r\n      }\r\n    }\r\n\r\n    return `<g id=\"layer-${this.escapeId(layerName)}\" class=\"cad-layer\">\\n${layerElements.join('\\n')}\\n</g>`;\r\n  }\r\n\r\n  /**\r\n   * Renders a single entity\r\n   */\r\n  private renderEntity(entity: CADEntity, options: CADRenderOptions): string | null {\r\n    const { geometry, color, lineType, lineWeight } = entity;\r\n\r\n    // Generate style attributes\r\n    const style = this.generateEntityStyle(color, lineType, lineWeight);\r\n\r\n    switch (geometry.type) {\r\n      case 'LINE':\r\n        return this.renderLine(geometry, style);\r\n      case 'CIRCLE':\r\n        return this.renderCircle(geometry, style);\r\n      case 'ARC':\r\n        return this.renderArc(geometry, style);\r\n      case 'POLYLINE':\r\n      case 'LWPOLYLINE':\r\n        return this.renderPolyline(geometry, style);\r\n      case 'TEXT':\r\n      case 'MTEXT':\r\n        return options.renderText ? this.renderText(geometry, style) : null;\r\n      case 'POINT':\r\n        return this.renderPoint(geometry, style);\r\n      default:\r\n        console.warn(`Unsupported entity type for rendering: ${geometry.type}`);\r\n        return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Renders LINE entity\r\n   */\r\n  private renderLine(geometry: CADGeometry, style: string): string {\r\n    if (geometry.points.length < 2) return '';\r\n\r\n    const p1 = this.transformPoint(geometry.points[0]);\r\n    const p2 = this.transformPoint(geometry.points[1]);\r\n\r\n    return `<line x1=\"${p1.x}\" y1=\"${p1.y}\" x2=\"${p2.x}\" y2=\"${p2.y}\" ${style} />`;\r\n  }\r\n\r\n  /**\r\n   * Renders CIRCLE entity\r\n   */\r\n  private renderCircle(geometry: CADGeometry, style: string): string {\r\n    if (geometry.points.length === 0) return '';\r\n\r\n    const center = this.transformPoint(geometry.points[0]);\r\n    const radius = (geometry.properties.radius as number || 0) * this.currentScale;\r\n\r\n    return `<circle cx=\"${center.x}\" cy=\"${center.y}\" r=\"${radius}\" ${style} fill=\"none\" />`;\r\n  }\r\n\r\n  /**\r\n   * Renders ARC entity\r\n   */\r\n  private renderArc(geometry: CADGeometry, style: string): string {\r\n    if (geometry.points.length === 0) return '';\r\n\r\n    const center = this.transformPoint(geometry.points[0]);\r\n    const radius = (geometry.properties.radius as number || 0) * this.currentScale;\r\n    const startAngle = geometry.properties.startAngle as number || 0;\r\n    const endAngle = geometry.properties.endAngle as number || 0;\r\n\r\n    // Convert to SVG path\r\n    const startX = center.x + radius * Math.cos(startAngle);\r\n    const startY = center.y + radius * Math.sin(startAngle);\r\n    const endX = center.x + radius * Math.cos(endAngle);\r\n    const endY = center.y + radius * Math.sin(endAngle);\r\n\r\n    const largeArcFlag = Math.abs(endAngle - startAngle) > Math.PI ? 1 : 0;\r\n\r\n    const pathData = `M ${startX} ${startY} A ${radius} ${radius} 0 ${largeArcFlag} 1 ${endX} ${endY}`;\r\n\r\n    return `<path d=\"${pathData}\" ${style} fill=\"none\" />`;\r\n  }\r\n\r\n  /**\r\n   * Renders POLYLINE entity\r\n   */\r\n  private renderPolyline(geometry: CADGeometry, style: string): string {\r\n    if (geometry.points.length < 2) return '';\r\n\r\n    const points = geometry.points.map(p => {\r\n      const transformed = this.transformPoint(p);\r\n      return `${transformed.x},${transformed.y}`;\r\n    }).join(' ');\r\n\r\n    const closed = geometry.properties.closed as boolean || false;\r\n    const element = closed ? 'polygon' : 'polyline';\r\n\r\n    return `<${element} points=\"${points}\" ${style} fill=\"none\" />`;\r\n  }\r\n\r\n  /**\r\n   * Renders TEXT entity\r\n   */\r\n  private renderText(geometry: CADGeometry, style: string): string {\r\n    if (geometry.points.length === 0) return '';\r\n\r\n    const position = this.transformPoint(geometry.points[0]);\r\n    const text = geometry.properties.text as string || '';\r\n    const height = (geometry.properties.height as number || 1) * this.currentScale;\r\n\r\n    const escapedText = this.escapeXML(text);\r\n\r\n    return `<text x=\"${position.x}\" y=\"${position.y}\" font-size=\"${height}\" ${style}>${escapedText}</text>`;\r\n  }\r\n\r\n  /**\r\n   * Renders POINT entity\r\n   */\r\n  private renderPoint(geometry: CADGeometry, style: string): string {\r\n    if (geometry.points.length === 0) return '';\r\n\r\n    const position = this.transformPoint(geometry.points[0]);\r\n    const size = 2; // Fixed size για points\r\n\r\n    return `<circle cx=\"${position.x}\" cy=\"${position.y}\" r=\"${size}\" ${style} />`;\r\n  }\r\n\r\n  /**\r\n   * Transforms a point από CAD coordinates to SVG coordinates\r\n   */\r\n  private transformPoint(point: CADPoint3D): { x: number; y: number } {\r\n    return {\r\n      x: point.x * this.currentScale + this.currentOffset.x,\r\n      y: -(point.y * this.currentScale) + this.currentOffset.y // Flip Y axis\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Generates CSS style attributes για entity\r\n   */\r\n  private generateEntityStyle(\r\n    color: CADEntity['color'],\r\n    lineType: string,\r\n    lineWeight: number\r\n  ): string {\r\n    const styles: string[] = [];\r\n\r\n    // Color\r\n    const colorValue = this.convertCADColor(color);\r\n    styles.push(`stroke=\"${colorValue}\"`);\r\n\r\n    // Line weight\r\n    const strokeWidth = Math.max(0.5, lineWeight * this.currentScale);\r\n    styles.push(`stroke-width=\"${strokeWidth}\"`);\r\n\r\n    // Line type (simplified)\r\n    if (lineType !== 'CONTINUOUS') {\r\n      styles.push('stroke-dasharray=\"5,5\"'); // Simplified dashed line\r\n    }\r\n\r\n    return styles.join(' ');\r\n  }\r\n\r\n  /**\r\n   * Converts CAD color to CSS color\r\n   */\r\n  private convertCADColor(color: CADEntity['color']): string {\r\n    if (color.type === 'rgb' && typeof color.value === 'object') {\r\n      const rgb = color.value as { r: number; g: number; b: number };\r\n      return `rgb(${rgb.r},${rgb.g},${rgb.b})`;\r\n    }\r\n\r\n    if (color.type === 'index' && typeof color.value === 'number') {\r\n      // AutoCAD color index to RGB mapping (simplified)\r\n      const colorMap: Record<number, string> = {\r\n        0: '#000000', // ByBlock\r\n        1: '#ff0000', // Red\r\n        2: '#ffff00', // Yellow\r\n        3: '#00ff00', // Green\r\n        4: '#00ffff', // Cyan\r\n        5: '#0000ff', // Blue\r\n        6: '#ff00ff', // Magenta\r\n        7: '#ffffff', // White\r\n        8: '#414141', // Dark Gray\r\n        9: '#808080'  // Light Gray\r\n      };\r\n\r\n      return colorMap[color.value] || '#000000';\r\n    }\r\n\r\n    return '#000000'; // Default black\r\n  }\r\n\r\n  /**\r\n   * Generates the final SVG document\r\n   */\r\n  private generateFinalSVG(\r\n    layers: CADLayerRenderData[],\r\n    viewBox: string,\r\n    options: CADRenderOptions\r\n  ): string {\r\n    const width = options.renderOptions?.width || 1000;\r\n    const height = options.renderOptions?.height || 1000;\r\n\r\n    const svgContent = layers.map(layer => layer.svgGroup).join('\\n');\r\n\r\n    return `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<svg xmlns=\"http://www.w3.org/2000/svg\"\r\n     width=\"${width}\"\r\n     height=\"${height}\"\r\n     viewBox=\"${viewBox}\"\r\n     class=\"cad-drawing\">\r\n  <defs>\r\n    <style>\r\n      .cad-layer { }\r\n      .cad-entity { }\r\n    </style>\r\n  </defs>\r\n  ${svgContent}\r\n</svg>`;\r\n  }\r\n\r\n  /**\r\n   * Helper methods\r\n   */\r\n  private escapeId(id: string): string {\r\n    return id.replace(/[^a-zA-Z0-9-_]/g, '_');\r\n  }\r\n\r\n  private escapeXML(text: string): string {\r\n    return text\r\n      .replace(/&/g, '&amp;')\r\n      .replace(/</g, '&lt;')\r\n      .replace(/>/g, '&gt;')\r\n      .replace(/\"/g, '&quot;')\r\n      .replace(/'/g, '&#39;');\r\n  }\r\n}","import {\r\n  CADValidationResult,\r\n  CADValidationError,\r\n  CADValidationWarning,\r\n  CADFileInfo,\r\n  CADFormat\r\n} from '../types';\r\n\r\n/**\r\n * Validates CAD files before processing\r\n */\r\nexport async function validateCADFile(file: File): Promise<CADValidationResult> {\r\n  const errors: CADValidationError[] = [];\r\n  const warnings: CADValidationWarning[] = [];\r\n\r\n  // Basic file validation\r\n  if (!file) {\r\n    errors.push({\r\n      code: 'NO_FILE',\r\n      message: 'Δεν παρέχεται αρχείο',\r\n      severity: 'critical'\r\n    });\r\n\r\n    return {\r\n      isValid: false,\r\n      errors,\r\n      warnings,\r\n      fileInfo: {\r\n        format: 'unknown',\r\n        size: 0,\r\n        estimatedComplexity: 'low',\r\n        estimatedProcessingTime: 0\r\n      }\r\n    };\r\n  }\r\n\r\n  // File size validation\r\n  const maxSize = 100 * 1024 * 1024; // 100MB\r\n  if (file.size > maxSize) {\r\n    errors.push({\r\n      code: 'FILE_TOO_LARGE',\r\n      message: `Το αρχείο είναι πολύ μεγάλο (${formatFileSize(file.size)}). Μέγιστο επιτρεπτό: ${formatFileSize(maxSize)}`,\r\n      severity: 'error'\r\n    });\r\n  }\r\n\r\n  if (file.size === 0) {\r\n    errors.push({\r\n      code: 'EMPTY_FILE',\r\n      message: 'Το αρχείο είναι κενό',\r\n      severity: 'critical'\r\n    });\r\n  }\r\n\r\n  // Format detection and validation\r\n  const fileInfo = await analyzeCADFile(file);\r\n\r\n  if (fileInfo.format === 'unknown') {\r\n    errors.push({\r\n      code: 'UNKNOWN_FORMAT',\r\n      message: 'Δεν αναγνωρίζεται η μορφή του αρχείου CAD',\r\n      severity: 'error'\r\n    });\r\n  }\r\n\r\n  // Format-specific validation\r\n  switch (fileInfo.format) {\r\n    case 'dxf':\r\n      await validateDXFFile(file, errors, warnings);\r\n      break;\r\n    case 'dwg':\r\n      errors.push({\r\n        code: 'DWG_NOT_SUPPORTED',\r\n        message: 'Η μορφή DWG δεν υποστηρίζεται ακόμη. Παρακαλώ μετατρέψτε σε DXF.',\r\n        severity: 'error'\r\n      });\r\n      break;\r\n    default:\r\n      if (fileInfo.format !== 'unknown') {\r\n        errors.push({\r\n          code: 'UNSUPPORTED_FORMAT',\r\n          message: `Η μορφή ${fileInfo.format} δεν υποστηρίζεται`,\r\n          severity: 'error'\r\n        });\r\n      }\r\n  }\r\n\r\n  // Size-based warnings\r\n  if (file.size > 10 * 1024 * 1024) { // 10MB\r\n    warnings.push({\r\n      code: 'LARGE_FILE',\r\n      message: 'Μεγάλο αρχείο - η επεξεργασία μπορεί να πάρει αρκετό χρόνο',\r\n      suggestion: 'Σκεφτείτε να απλοποιήσετε το σχέδιο ή να το χωρίσετε σε μικρότερα μέρη'\r\n    });\r\n  }\r\n\r\n  // Complexity warnings\r\n  if (fileInfo.estimatedComplexity === 'high') {\r\n    warnings.push({\r\n      code: 'HIGH_COMPLEXITY',\r\n      message: 'Υψηλή πολυπλοκότητα σχεδίου',\r\n      suggestion: 'Η επεξεργασία μπορεί να είναι αργή. Σκεφτείτε να αφαιρέσετε περιττά elements.'\r\n    });\r\n  }\r\n\r\n  return {\r\n    isValid: errors.length === 0,\r\n    errors,\r\n    warnings,\r\n    fileInfo\r\n  };\r\n}\r\n\r\n/**\r\n * Analyzes CAD file to extract basic information\r\n */\r\nasync function analyzeCADFile(file: File): Promise<CADFileInfo> {\r\n  const format = detectCADFormat(file);\r\n  const size = file.size;\r\n\r\n  // Estimate complexity based on file size\r\n  let estimatedComplexity: 'low' | 'medium' | 'high' = 'low';\r\n  if (size > 5 * 1024 * 1024) { // > 5MB\r\n    estimatedComplexity = 'high';\r\n  } else if (size > 1 * 1024 * 1024) { // > 1MB\r\n    estimatedComplexity = 'medium';\r\n  }\r\n\r\n  // Estimate processing time (simplified)\r\n  const baseTime = 1000; // 1 second base\r\n  const sizeMultiplier = size / (1024 * 1024); // MB\r\n  const complexityMultiplier = estimatedComplexity === 'high' ? 3 :\r\n                               estimatedComplexity === 'medium' ? 2 : 1;\r\n\r\n  const estimatedProcessingTime = Math.round(baseTime * sizeMultiplier * complexityMultiplier);\r\n\r\n  return {\r\n    format,\r\n    size,\r\n    estimatedComplexity,\r\n    estimatedProcessingTime\r\n  };\r\n}\r\n\r\n/**\r\n * Detects CAD file format based on extension and content\r\n */\r\nfunction detectCADFormat(file: File): CADFormat | 'unknown' {\r\n  const extension = file.name.split('.').pop()?.toLowerCase();\r\n\r\n  switch (extension) {\r\n    case 'dxf':\r\n      return 'dxf';\r\n    case 'dwg':\r\n      return 'dwg';\r\n    case 'dwf':\r\n      return 'dwf';\r\n    case 'dgn':\r\n      return 'dgn';\r\n    default:\r\n      return 'unknown';\r\n  }\r\n}\r\n\r\n/**\r\n * Validates DXF file content\r\n */\r\nasync function validateDXFFile(\r\n  file: File,\r\n  errors: CADValidationError[],\r\n  warnings: CADValidationWarning[]\r\n): Promise<void> {\r\n  try {\r\n    // Read first part of file to check structure\r\n    const headerChunk = await file.slice(0, 4096).text();\r\n\r\n    // Check for DXF header markers\r\n    if (!headerChunk.includes('SECTION')) {\r\n      errors.push({\r\n        code: 'INVALID_DXF_STRUCTURE',\r\n        message: 'Μη έγκυρη δομή DXF: Λείπει η ενότητα SECTION',\r\n        severity: 'error'\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (!headerChunk.includes('HEADER')) {\r\n      warnings.push({\r\n        code: 'MISSING_HEADER_SECTION',\r\n        message: 'Λείπει η ενότητα HEADER στο DXF',\r\n        suggestion: 'Ορισμένες πληροφορίες μπορεί να μην είναι διαθέσιμες'\r\n      });\r\n    }\r\n\r\n    // Check for entities section\r\n    const fullContent = await file.text();\r\n    if (!fullContent.includes('ENTITIES')) {\r\n      warnings.push({\r\n        code: 'MISSING_ENTITIES_SECTION',\r\n        message: 'Λείπει η ενότητα ENTITIES στο DXF',\r\n        suggestion: 'Το αρχείο μπορεί να μην περιέχει γεωμετρικά στοιχεία'\r\n      });\r\n    }\r\n\r\n    // Check for common DXF version indicators\r\n    const versionMatch = fullContent.match(/\\$ACADVER\\s+1\\s+([A-Z0-9]+)/);\r\n    if (versionMatch) {\r\n      const version = versionMatch[1];\r\n      if (version < 'AC1012') { // Very old version\r\n        warnings.push({\r\n          code: 'OLD_DXF_VERSION',\r\n          message: `Παλιά έκδοση DXF (${version})`,\r\n          suggestion: 'Μπορεί να υπάρχουν προβλήματα συμβατότητας'\r\n        });\r\n      }\r\n    }\r\n\r\n    // Check for binary DXF (not supported)\r\n    if (fullContent.charCodeAt(0) === 0) {\r\n      errors.push({\r\n        code: 'BINARY_DXF_NOT_SUPPORTED',\r\n        message: 'Τα δυαδικά αρχεία DXF δεν υποστηρίζονται',\r\n        severity: 'error'\r\n      });\r\n    }\r\n\r\n    // Check encoding\r\n    if (containsNonAsciiCharacters(fullContent)) {\r\n      warnings.push({\r\n        code: 'NON_ASCII_CHARACTERS',\r\n        message: 'Το αρχείο περιέχει μη-ASCII χαρακτήρες',\r\n        suggestion: 'Βεβαιωθείτε ότι η κωδικοποίηση είναι UTF-8'\r\n      });\r\n    }\r\n\r\n  } catch (error) {\r\n    errors.push({\r\n      code: 'FILE_READ_ERROR',\r\n      message: `Σφάλμα ανάγνωσης αρχείου: ${error instanceof Error ? error.message : 'Άγνωστο σφάλμα'}`,\r\n      severity: 'error'\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Checks if string contains non-ASCII characters\r\n */\r\nfunction containsNonAsciiCharacters(text: string): boolean {\r\n  // Check first 1000 characters για performance\r\n  const sample = text.substring(0, 1000);\r\n  return /[^\\x00-\\x7F]/.test(sample);\r\n}\r\n\r\n/**\r\n * Formats file size για human-readable display\r\n */\r\nfunction formatFileSize(bytes: number): string {\r\n  const units = ['B', 'KB', 'MB', 'GB'];\r\n  let size = bytes;\r\n  let unitIndex = 0;\r\n\r\n  while (size >= 1024 && unitIndex < units.length - 1) {\r\n    size /= 1024;\r\n    unitIndex++;\r\n  }\r\n\r\n  return `${size.toFixed(1)} ${units[unitIndex]}`;\r\n}\r\n\r\n/**\r\n * Validates CAD processing options\r\n */\r\nexport function validateCADProcessingOptions(options: Record<string, unknown>): {\r\n  isValid: boolean;\r\n  errors: string[];\r\n  warnings: string[];\r\n} {\r\n  const errors: string[] = [];\r\n  const warnings: string[] = [];\r\n\r\n  // Validate render options\r\n  if (options.renderOptions) {\r\n    const renderOpts = options.renderOptions as Record<string, unknown>;\r\n\r\n    if (renderOpts.scaleFactor && typeof renderOpts.scaleFactor === 'number') {\r\n      if (renderOpts.scaleFactor <= 0) {\r\n        errors.push('Η κλίμακα πρέπει να είναι θετικός αριθμός');\r\n      }\r\n      if (renderOpts.scaleFactor > 1000) {\r\n        warnings.push('Πολύ μεγάλη κλίμακα μπορεί να προκαλέσει προβλήματα απόδοσης');\r\n      }\r\n    }\r\n  }\r\n\r\n  // Validate parse options\r\n  if (options.parseOptions) {\r\n    const parseOpts = options.parseOptions as Record<string, unknown>;\r\n\r\n    if (parseOpts.encoding && typeof parseOpts.encoding === 'string') {\r\n      const validEncodings = ['utf-8', 'cp1252', 'iso-8859-1'];\r\n      if (!validEncodings.includes(parseOpts.encoding)) {\r\n        errors.push(`Μη υποστηριζόμενη κωδικοποίηση: ${parseOpts.encoding}`);\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    isValid: errors.length === 0,\r\n    errors,\r\n    warnings\r\n  };\r\n}\r\n\r\n/**\r\n * Estimates CAD file complexity από το περιεχόμενο\r\n */\r\nexport async function estimateCADComplexity(file: File): Promise<{\r\n  complexity: 'low' | 'medium' | 'high';\r\n  entityCount: number;\r\n  layerCount: number;\r\n  factors: string[];\r\n}> {\r\n  const factors: string[] = [];\r\n  let complexity: 'low' | 'medium' | 'high' = 'low';\r\n\r\n  try {\r\n    const content = await file.text();\r\n\r\n    // Count entities (simplified)\r\n    const entityMatches = content.match(/\\n\\s*0\\s+\\n[A-Z]+/g) || [];\r\n    const entityCount = entityMatches.length;\r\n\r\n    // Count layers (simplified)\r\n    const layerMatches = content.match(/\\n\\s*8\\s+\\n[^\\n]+/g) || [];\r\n    const layerCount = new Set(layerMatches.map(m => m.trim())).size;\r\n\r\n    // Determine complexity\r\n    if (entityCount > 10000) {\r\n      complexity = 'high';\r\n      factors.push('Υψηλός αριθμός entities (>10k)');\r\n    } else if (entityCount > 1000) {\r\n      complexity = 'medium';\r\n      factors.push('Μέτριος αριθμός entities (>1k)');\r\n    }\r\n\r\n    if (layerCount > 50) {\r\n      complexity = 'high';\r\n      factors.push('Πολλά layers (>50)');\r\n    } else if (layerCount > 10) {\r\n      if (complexity === 'low') complexity = 'medium';\r\n      factors.push('Αρκετά layers (>10)');\r\n    }\r\n\r\n    // Check for complex entities\r\n    if (content.includes('POLYLINE') || content.includes('SPLINE')) {\r\n      if (complexity === 'low') complexity = 'medium';\r\n      factors.push('Πολύπλοκα γεωμετρικά στοιχεία');\r\n    }\r\n\r\n    if (content.includes('HATCH') || content.includes('REGION')) {\r\n      complexity = 'high';\r\n      factors.push('Πολύπλοκα fills/regions');\r\n    }\r\n\r\n    return {\r\n      complexity,\r\n      entityCount,\r\n      layerCount,\r\n      factors\r\n    };\r\n\r\n  } catch (error) {\r\n    return {\r\n      complexity: 'medium',\r\n      entityCount: 0,\r\n      layerCount: 0,\r\n      factors: ['Δεν ήταν δυνατή η ανάλυση του αρχείου']\r\n    };\r\n  }\r\n}"],"mappings":"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","names":["DxfParser","progress","detectCADFormat"]}