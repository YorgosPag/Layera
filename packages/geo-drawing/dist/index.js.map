{"version":3,"sources":["../../../node_modules/@babel/runtime/helpers/extends.js","../../../node_modules/void-elements/index.js","../src/index.ts","../src/hooks/useMeasurement.ts","../../../node_modules/react-i18next/dist/es/Trans.js","../../../node_modules/react-i18next/dist/es/TransWithoutContext.js","../../../node_modules/react-i18next/dist/es/utils.js","../../../node_modules/react-i18next/dist/es/unescape.js","../../../node_modules/react-i18next/dist/es/defaults.js","../../../node_modules/react-i18next/dist/es/i18nInstance.js","../../../node_modules/react-i18next/dist/es/context.js","../../../node_modules/react-i18next/dist/es/useTranslation.js","../../../node_modules/react-i18next/dist/es/withTranslation.js","../../../node_modules/react-i18next/dist/es/I18nextProvider.js","../../../node_modules/react-i18next/dist/es/withSSR.js","../../../node_modules/react-i18next/dist/es/useSSR.js","../src/utils/calculations.ts","../src/utils/formatters.ts","../src/hooks/useGeometrySnap.ts","../src/services/osmService.ts","../src/utils/geometry.ts","../src/components/MeasurementControls.tsx","../src/components/MeasurementCanvas.tsx","../src/components/GeometryRenderer.tsx"],"sourcesContent":["function _extends() {\n  return module.exports = _extends = Object.assign ? Object.assign.bind() : function (n) {\n    for (var e = 1; e < arguments.length; e++) {\n      var t = arguments[e];\n      for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]);\n    }\n    return n;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _extends.apply(null, arguments);\n}\nmodule.exports = _extends, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","/**\n * This file automatically generated from `pre-publish.js`.\n * Do not manually edit.\n */\n\nmodule.exports = {\n  \"area\": true,\n  \"base\": true,\n  \"br\": true,\n  \"col\": true,\n  \"embed\": true,\n  \"hr\": true,\n  \"img\": true,\n  \"input\": true,\n  \"link\": true,\n  \"meta\": true,\n  \"param\": true,\n  \"source\": true,\n  \"track\": true,\n  \"wbr\": true\n};\n","/**\n * @layera/geo-drawing - LEGO System για geo-spatial drawing και measurement\n *\n * Ενσωματώνει functionality από OLD_geo-canvas με existing LEGO systems:\n * - @layera/snap-engine & @layera/snap-interactions για snapping\n * - @layera/i18n για internationalization\n * - @layera/theme-switcher για theme-aware colors\n * - @layera/buttons, @layera/cards, @layera/typography για UI\n * - @layera/constants για configuration\n * - @layera/notifications για user feedback\n */\n\n// Types\nexport type {\n  MeasurementMode,\n  DrawingState,\n  GeometryType,\n  MeasurementPoint,\n  MeasurementResult,\n  OSMBuildingProperties,\n  OSMBuildingFeature,\n  GeoJSONFeatureCollection,\n  DrawingConfig,\n  CanvasInteractionEvent\n} from './types';\n\n// Core Hooks\nexport { useMeasurement } from './hooks/useMeasurement';\nexport { useGeometrySnap } from './hooks/useGeometrySnap';\n\n// Components\nexport { MeasurementControls } from './components/MeasurementControls';\nexport { MeasurementCanvas } from './components/MeasurementCanvas';\nexport { GeometryRenderer } from './components/GeometryRenderer';\n\n// Utilities\nexport {\n  calculateProjectedArea,\n  calculateDistance,\n  calculatePointDistance,\n  calculatePolygonCenter,\n  calculatePerimeter,\n  isPointInPolygon,\n  calculateBounds\n} from './utils/calculations';\n\nexport {\n  formatDistance,\n  formatArea,\n  useMeasurementFormatter,\n  formatCoordinatesBySystem,\n  formatBearing\n} from './utils/formatters';\n\nexport {\n  geoJsonToLatLng,\n  latLngToGeoJson,\n  closestPointOnSegment,\n  arePointsEqual,\n  simplifyPolygon,\n  calculateBearing,\n  extractOSMGeometry\n} from './utils/geometry';\n\n// Services\nexport {\n  fetchBuildingOutlines,\n  clearOSMCache,\n  getCacheSize,\n  isBoundsCached,\n  prefetchBuildingOutlines\n} from './services/osmService';\n\n// Constants που θα προστεθούν στο @layera/constants\nexport const GEO_DRAWING_CONSTANTS = {\n  DEFAULT_SNAP_TOLERANCE: 15,\n  MIN_SNAP_ZOOM: 16,\n  DEBOUNCE_MS: 500,\n  REQUEST_TIMEOUT: 30000\n} as const;","import { useState, useCallback, useRef } from 'react';\r\nimport L from 'leaflet';\r\nimport { useTranslation } from 'react-i18next';\r\nimport type { MeasurementMode, MeasurementPoint, MeasurementResult, DrawingState } from '../types';\r\nimport { calculateDistance, calculateProjectedArea } from '../utils/calculations';\r\nimport { useMeasurementFormatter } from '../utils/formatters';\r\nimport { useNotifications } from '@layera/notifications';\r\n\r\n/**\r\n * Core measurement hook για το geo-drawing system\r\n * Μεταφέρθηκε και βελτιώθηκε από OLD_geo-canvas\r\n */\r\nexport const useMeasurement = () => {\r\n  const { t } = useTranslation();\r\n  const { addNotification } = useNotifications();\r\n  const { formatDistanceWithLabels, formatAreaWithLabels } = useMeasurementFormatter();\r\n\r\n  const [mode, setMode] = useState<MeasurementMode>('distance');\r\n  const [state, setState] = useState<DrawingState>('idle');\r\n  const [points, setPoints] = useState<MeasurementPoint[]>([]);\r\n  const [currentResult, setCurrentResult] = useState<MeasurementResult | null>(null);\r\n  const [results, setResults] = useState<MeasurementResult[]>([]);\r\n\r\n  const pointIdCounter = useRef(0);\r\n\r\n  /**\r\n   * Adds a new measurement point\r\n   */\r\n  const addPoint = useCallback((latlng: L.LatLng) => {\r\n    const newPoint: MeasurementPoint = {\r\n      id: `point-${pointIdCounter.current++}`,\r\n      latlng,\r\n      index: points.length\r\n    };\r\n\r\n    const updatedPoints = [...points, newPoint];\r\n    setPoints(updatedPoints);\r\n\r\n    // Start drawing state on first point\r\n    if (points.length === 0) {\r\n      setState('drawing');\r\n    }\r\n\r\n    // Calculate current measurement\r\n    let distance = 0;\r\n    let area = 0;\r\n    let displayValue = '';\r\n\r\n    if (mode === 'distance' && updatedPoints.length >= 2) {\r\n      const latlngs = updatedPoints.map(p => p.latlng);\r\n      distance = calculateDistance(latlngs);\r\n      displayValue = formatDistanceWithLabels(distance);\r\n    } else if (mode === 'area' && updatedPoints.length >= 3) {\r\n      const latlngs = updatedPoints.map(p => p.latlng);\r\n      area = calculateProjectedArea(latlngs);\r\n      displayValue = formatAreaWithLabels(area);\r\n    } else if (mode === 'point') {\r\n      displayValue = `${latlng.lat.toFixed(6)}, ${latlng.lng.toFixed(6)}`;\r\n    }\r\n\r\n    const result: MeasurementResult = {\r\n      type: mode,\r\n      points: updatedPoints,\r\n      ...(mode === 'distance' && distance !== undefined && { distance }),\r\n      ...(mode === 'area' && area !== undefined && { area }),\r\n      displayValue,\r\n      timestamp: Date.now()\r\n    };\r\n\r\n    setCurrentResult(result);\r\n  }, [points, mode, formatDistanceWithLabels, formatAreaWithLabels]);\r\n\r\n  /**\r\n   * Finishes the current measurement\r\n   */\r\n  const finishMeasurement = useCallback(() => {\r\n    if (!currentResult) return;\r\n\r\n    // Validation based on mode\r\n    if (mode === 'distance' && points.length < 2) {\r\n      addNotification({\r\n        type: 'error',\r\n        message: t('geo-drawing.errors.minimum-points-distance')\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (mode === 'area' && points.length < 3) {\r\n      addNotification({\r\n        type: 'error',\r\n        message: t('geo-drawing.errors.minimum-points-area')\r\n      });\r\n      return;\r\n    }\r\n\r\n    setResults(prev => [...prev, currentResult]);\r\n    setState('finished');\r\n\r\n    addNotification({\r\n      type: 'success',\r\n      message: t('geo-drawing.measurement-completed', {\r\n        type: t(`geo-drawing.modes.${mode}`),\r\n        value: currentResult.displayValue\r\n      })\r\n    });\r\n  }, [currentResult, mode, points.length, addNotification, t]);\r\n\r\n  /**\r\n   * Cancels the current measurement\r\n   */\r\n  const cancelMeasurement = useCallback(() => {\r\n    setPoints([]);\r\n    setCurrentResult(null);\r\n    setState('idle');\r\n  }, []);\r\n\r\n  /**\r\n   * Resets all measurements\r\n   */\r\n  const resetAll = useCallback(() => {\r\n    setPoints([]);\r\n    setCurrentResult(null);\r\n    setResults([]);\r\n    setState('idle');\r\n    pointIdCounter.current = 0;\r\n  }, []);\r\n\r\n  /**\r\n   * Changes measurement mode\r\n   */\r\n  const changeMeasurementMode = useCallback((newMode: MeasurementMode) => {\r\n    if (state === 'drawing') {\r\n      // Ask user confirmation if currently drawing\r\n      if (window.confirm(t('geo-drawing.confirm-mode-change'))) {\r\n        cancelMeasurement();\r\n        setMode(newMode);\r\n      }\r\n    } else {\r\n      setMode(newMode);\r\n    }\r\n  }, [state, cancelMeasurement, t]);\r\n\r\n  /**\r\n   * Removes the last point\r\n   */\r\n  const removeLastPoint = useCallback(() => {\r\n    if (points.length === 0) return;\r\n\r\n    const updatedPoints = points.slice(0, -1);\r\n    setPoints(updatedPoints);\r\n\r\n    if (updatedPoints.length === 0) {\r\n      setState('idle');\r\n      setCurrentResult(null);\r\n    } else {\r\n      // Recalculate measurement\r\n      let distance = 0;\r\n      let area = 0;\r\n      let displayValue = '';\r\n\r\n      if (mode === 'distance' && updatedPoints.length >= 2) {\r\n        const latlngs = updatedPoints.map(p => p.latlng);\r\n        distance = calculateDistance(latlngs);\r\n        displayValue = formatDistanceWithLabels(distance);\r\n      } else if (mode === 'area' && updatedPoints.length >= 3) {\r\n        const latlngs = updatedPoints.map(p => p.latlng);\r\n        area = calculateProjectedArea(latlngs);\r\n        displayValue = formatAreaWithLabels(area);\r\n      }\r\n\r\n      const result: MeasurementResult = {\r\n        type: mode,\r\n        points: updatedPoints,\r\n        ...(mode === 'distance' && distance !== undefined && { distance }),\r\n        ...(mode === 'area' && area !== undefined && { area }),\r\n        displayValue,\r\n        timestamp: Date.now()\r\n      };\r\n\r\n      setCurrentResult(result);\r\n    }\r\n  }, [points, mode, formatDistanceWithLabels, formatAreaWithLabels]);\r\n\r\n  /**\r\n   * Removes a specific measurement result\r\n   */\r\n  const removeResult = useCallback((timestamp: number) => {\r\n    setResults(prev => prev.filter(result => result.timestamp !== timestamp));\r\n  }, []);\r\n\r\n  /**\r\n   * Gets current distance (for display during drawing)\r\n   */\r\n  const getCurrentDistance = useCallback((): number => {\r\n    if (points.length < 2) return 0;\r\n    const latlngs = points.map(p => p.latlng);\r\n    return calculateDistance(latlngs);\r\n  }, [points]);\r\n\r\n  /**\r\n   * Gets current area (for display during drawing)\r\n   */\r\n  const getCurrentArea = useCallback((): number => {\r\n    if (points.length < 3) return 0;\r\n    const latlngs = points.map(p => p.latlng);\r\n    return calculateProjectedArea(latlngs);\r\n  }, [points]);\r\n\r\n  return {\r\n    // State\r\n    mode,\r\n    state,\r\n    points,\r\n    currentResult,\r\n    results,\r\n\r\n    // Actions\r\n    addPoint,\r\n    finishMeasurement,\r\n    cancelMeasurement,\r\n    resetAll,\r\n    changeMeasurementMode,\r\n    removeLastPoint,\r\n    removeResult,\r\n\r\n    // Computed values\r\n    getCurrentDistance,\r\n    getCurrentArea,\r\n    isDrawing: state === 'drawing',\r\n    isFinished: state === 'finished',\r\n    canFinish: (mode === 'distance' && points.length >= 2) ||\r\n               (mode === 'area' && points.length >= 3) ||\r\n               (mode === 'point' && points.length >= 1)\r\n  };\r\n};","import { useContext } from 'react';\nimport { nodesToString, Trans as TransWithoutContext } from './TransWithoutContext.js';\nimport { getI18n, I18nContext } from './context.js';\nexport { nodesToString };\nexport function Trans(_ref) {\n  let {\n    children,\n    count,\n    parent,\n    i18nKey,\n    context,\n    tOptions = {},\n    values,\n    defaults,\n    components,\n    ns,\n    i18n: i18nFromProps,\n    t: tFromProps,\n    shouldUnescape,\n    ...additionalProps\n  } = _ref;\n  const {\n    i18n: i18nFromContext,\n    defaultNS: defaultNSFromContext\n  } = useContext(I18nContext) || {};\n  const i18n = i18nFromProps || i18nFromContext || getI18n();\n  const t = tFromProps || i18n && i18n.t.bind(i18n);\n  return TransWithoutContext({\n    children,\n    count,\n    parent,\n    i18nKey,\n    context,\n    tOptions,\n    values,\n    defaults,\n    components,\n    ns: ns || t && t.ns || defaultNSFromContext || i18n && i18n.options && i18n.options.defaultNS,\n    i18n,\n    t: tFromProps,\n    shouldUnescape,\n    ...additionalProps\n  });\n}","import _extends from \"@babel/runtime/helpers/extends\";\nimport React, { isValidElement, cloneElement, createElement, Children } from 'react';\nimport HTML from 'html-parse-stringify';\nimport { warn, warnOnce } from './utils.js';\nimport { getDefaults } from './defaults.js';\nimport { getI18n } from './i18nInstance.js';\nfunction hasChildren(node, checkLength) {\n  if (!node) return false;\n  const base = node.props ? node.props.children : node.children;\n  if (checkLength) return base.length > 0;\n  return !!base;\n}\nfunction getChildren(node) {\n  if (!node) return [];\n  const children = node.props ? node.props.children : node.children;\n  return node.props && node.props.i18nIsDynamicList ? getAsArray(children) : children;\n}\nfunction hasValidReactChildren(children) {\n  if (Object.prototype.toString.call(children) !== '[object Array]') return false;\n  return children.every(child => isValidElement(child));\n}\nfunction getAsArray(data) {\n  return Array.isArray(data) ? data : [data];\n}\nfunction mergeProps(source, target) {\n  const newTarget = {\n    ...target\n  };\n  newTarget.props = Object.assign(source.props, target.props);\n  return newTarget;\n}\nexport function nodesToString(children, i18nOptions) {\n  if (!children) return '';\n  let stringNode = '';\n  const childrenArray = getAsArray(children);\n  const keepArray = i18nOptions.transSupportBasicHtmlNodes && i18nOptions.transKeepBasicHtmlNodesFor ? i18nOptions.transKeepBasicHtmlNodesFor : [];\n  childrenArray.forEach((child, childIndex) => {\n    if (typeof child === 'string') {\n      stringNode += `${child}`;\n    } else if (isValidElement(child)) {\n      const childPropsCount = Object.keys(child.props).length;\n      const shouldKeepChild = keepArray.indexOf(child.type) > -1;\n      const childChildren = child.props.children;\n      if (!childChildren && shouldKeepChild && childPropsCount === 0) {\n        stringNode += `<${child.type}/>`;\n      } else if (!childChildren && (!shouldKeepChild || childPropsCount !== 0)) {\n        stringNode += `<${childIndex}></${childIndex}>`;\n      } else if (child.props.i18nIsDynamicList) {\n        stringNode += `<${childIndex}></${childIndex}>`;\n      } else if (shouldKeepChild && childPropsCount === 1 && typeof childChildren === 'string') {\n        stringNode += `<${child.type}>${childChildren}</${child.type}>`;\n      } else {\n        const content = nodesToString(childChildren, i18nOptions);\n        stringNode += `<${childIndex}>${content}</${childIndex}>`;\n      }\n    } else if (child === null) {\n      warn(`Trans: the passed in value is invalid - seems you passed in a null child.`);\n    } else if (typeof child === 'object') {\n      const {\n        format,\n        ...clone\n      } = child;\n      const keys = Object.keys(clone);\n      if (keys.length === 1) {\n        const value = format ? `${keys[0]}, ${format}` : keys[0];\n        stringNode += `{{${value}}}`;\n      } else {\n        warn(`react-i18next: the passed in object contained more than one variable - the object should look like {{ value, format }} where format is optional.`, child);\n      }\n    } else {\n      warn(`Trans: the passed in value is invalid - seems you passed in a variable like {number} - please pass in variables for interpolation as full objects like {{number}}.`, child);\n    }\n  });\n  return stringNode;\n}\nfunction renderNodes(children, targetString, i18n, i18nOptions, combinedTOpts, shouldUnescape) {\n  if (targetString === '') return [];\n  const keepArray = i18nOptions.transKeepBasicHtmlNodesFor || [];\n  const emptyChildrenButNeedsHandling = targetString && new RegExp(keepArray.map(keep => `<${keep}`).join('|')).test(targetString);\n  if (!children && !emptyChildrenButNeedsHandling && !shouldUnescape) return [targetString];\n  const data = {};\n  function getData(childs) {\n    const childrenArray = getAsArray(childs);\n    childrenArray.forEach(child => {\n      if (typeof child === 'string') return;\n      if (hasChildren(child)) getData(getChildren(child));else if (typeof child === 'object' && !isValidElement(child)) Object.assign(data, child);\n    });\n  }\n  getData(children);\n  const ast = HTML.parse(`<0>${targetString}</0>`);\n  const opts = {\n    ...data,\n    ...combinedTOpts\n  };\n  function renderInner(child, node, rootReactNode) {\n    const childs = getChildren(child);\n    const mappedChildren = mapAST(childs, node.children, rootReactNode);\n    return hasValidReactChildren(childs) && mappedChildren.length === 0 || child.props && child.props.i18nIsDynamicList ? childs : mappedChildren;\n  }\n  function pushTranslatedJSX(child, inner, mem, i, isVoid) {\n    if (child.dummy) {\n      child.children = inner;\n      mem.push(cloneElement(child, {\n        key: i\n      }, isVoid ? undefined : inner));\n    } else {\n      mem.push(...Children.map([child], c => {\n        const props = {\n          ...c.props\n        };\n        delete props.i18nIsDynamicList;\n        return React.createElement(c.type, _extends({}, props, {\n          key: i,\n          ref: c.ref\n        }, isVoid ? {} : {\n          children: inner\n        }));\n      }));\n    }\n  }\n  function mapAST(reactNode, astNode, rootReactNode) {\n    const reactNodes = getAsArray(reactNode);\n    const astNodes = getAsArray(astNode);\n    return astNodes.reduce((mem, node, i) => {\n      const translationContent = node.children && node.children[0] && node.children[0].content && i18n.services.interpolator.interpolate(node.children[0].content, opts, i18n.language);\n      if (node.type === 'tag') {\n        let tmp = reactNodes[parseInt(node.name, 10)];\n        if (rootReactNode.length === 1 && !tmp) tmp = rootReactNode[0][node.name];\n        if (!tmp) tmp = {};\n        const child = Object.keys(node.attrs).length !== 0 ? mergeProps({\n          props: node.attrs\n        }, tmp) : tmp;\n        const isElement = isValidElement(child);\n        const isValidTranslationWithChildren = isElement && hasChildren(node, true) && !node.voidElement;\n        const isEmptyTransWithHTML = emptyChildrenButNeedsHandling && typeof child === 'object' && child.dummy && !isElement;\n        const isKnownComponent = typeof children === 'object' && children !== null && Object.hasOwnProperty.call(children, node.name);\n        if (typeof child === 'string') {\n          const value = i18n.services.interpolator.interpolate(child, opts, i18n.language);\n          mem.push(value);\n        } else if (hasChildren(child) || isValidTranslationWithChildren) {\n          const inner = renderInner(child, node, rootReactNode);\n          pushTranslatedJSX(child, inner, mem, i);\n        } else if (isEmptyTransWithHTML) {\n          const inner = mapAST(reactNodes, node.children, rootReactNode);\n          pushTranslatedJSX(child, inner, mem, i);\n        } else if (Number.isNaN(parseFloat(node.name))) {\n          if (isKnownComponent) {\n            const inner = renderInner(child, node, rootReactNode);\n            pushTranslatedJSX(child, inner, mem, i, node.voidElement);\n          } else if (i18nOptions.transSupportBasicHtmlNodes && keepArray.indexOf(node.name) > -1) {\n            if (node.voidElement) {\n              mem.push(createElement(node.name, {\n                key: `${node.name}-${i}`\n              }));\n            } else {\n              const inner = mapAST(reactNodes, node.children, rootReactNode);\n              mem.push(createElement(node.name, {\n                key: `${node.name}-${i}`\n              }, inner));\n            }\n          } else if (node.voidElement) {\n            mem.push(`<${node.name} />`);\n          } else {\n            const inner = mapAST(reactNodes, node.children, rootReactNode);\n            mem.push(`<${node.name}>${inner}</${node.name}>`);\n          }\n        } else if (typeof child === 'object' && !isElement) {\n          const content = node.children[0] ? translationContent : null;\n          if (content) mem.push(content);\n        } else {\n          pushTranslatedJSX(child, translationContent, mem, i, node.children.length !== 1 || !translationContent);\n        }\n      } else if (node.type === 'text') {\n        const wrapTextNodes = i18nOptions.transWrapTextNodes;\n        const content = shouldUnescape ? i18nOptions.unescape(i18n.services.interpolator.interpolate(node.content, opts, i18n.language)) : i18n.services.interpolator.interpolate(node.content, opts, i18n.language);\n        if (wrapTextNodes) {\n          mem.push(createElement(wrapTextNodes, {\n            key: `${node.name}-${i}`\n          }, content));\n        } else {\n          mem.push(content);\n        }\n      }\n      return mem;\n    }, []);\n  }\n  const result = mapAST([{\n    dummy: true,\n    children: children || []\n  }], ast, getAsArray(children || []));\n  return getChildren(result[0]);\n}\nexport function Trans(_ref) {\n  let {\n    children,\n    count,\n    parent,\n    i18nKey,\n    context,\n    tOptions = {},\n    values,\n    defaults,\n    components,\n    ns,\n    i18n: i18nFromProps,\n    t: tFromProps,\n    shouldUnescape,\n    ...additionalProps\n  } = _ref;\n  const i18n = i18nFromProps || getI18n();\n  if (!i18n) {\n    warnOnce('You will need to pass in an i18next instance by using i18nextReactModule');\n    return children;\n  }\n  const t = tFromProps || i18n.t.bind(i18n) || (k => k);\n  if (context) tOptions.context = context;\n  const reactI18nextOptions = {\n    ...getDefaults(),\n    ...(i18n.options && i18n.options.react)\n  };\n  let namespaces = ns || t.ns || i18n.options && i18n.options.defaultNS;\n  namespaces = typeof namespaces === 'string' ? [namespaces] : namespaces || ['translation'];\n  const nodeAsString = nodesToString(children, reactI18nextOptions);\n  const defaultValue = defaults || nodeAsString || reactI18nextOptions.transEmptyNodeValue || i18nKey;\n  const {\n    hashTransKey\n  } = reactI18nextOptions;\n  const key = i18nKey || (hashTransKey ? hashTransKey(nodeAsString || defaultValue) : nodeAsString || defaultValue);\n  if (i18n.options && i18n.options.interpolation && i18n.options.interpolation.defaultVariables) {\n    values = values && Object.keys(values).length > 0 ? {\n      ...values,\n      ...i18n.options.interpolation.defaultVariables\n    } : {\n      ...i18n.options.interpolation.defaultVariables\n    };\n  }\n  const interpolationOverride = values ? tOptions.interpolation : {\n    interpolation: {\n      ...tOptions.interpolation,\n      prefix: '#$?',\n      suffix: '?$#'\n    }\n  };\n  const combinedTOpts = {\n    ...tOptions,\n    count,\n    ...values,\n    ...interpolationOverride,\n    defaultValue,\n    ns: namespaces\n  };\n  const translation = key ? t(key, combinedTOpts) : defaultValue;\n  if (components) {\n    Object.keys(components).forEach(c => {\n      const comp = components[c];\n      if (typeof comp.type === 'function' || !comp.props || !comp.props.children || translation.indexOf(`${c}/>`) < 0 && translation.indexOf(`${c} />`) < 0) return;\n      function Componentized() {\n        return React.createElement(React.Fragment, null, comp);\n      }\n      components[c] = React.createElement(Componentized, null);\n    });\n  }\n  const content = renderNodes(components || children, translation, i18n, reactI18nextOptions, combinedTOpts, shouldUnescape);\n  const useAsParent = parent !== undefined ? parent : reactI18nextOptions.defaultTransParent;\n  return useAsParent ? createElement(useAsParent, additionalProps, content) : content;\n}","export function warn() {\n  if (console && console.warn) {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    if (typeof args[0] === 'string') args[0] = `react-i18next:: ${args[0]}`;\n    console.warn(...args);\n  }\n}\nconst alreadyWarned = {};\nexport function warnOnce() {\n  for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n    args[_key2] = arguments[_key2];\n  }\n  if (typeof args[0] === 'string' && alreadyWarned[args[0]]) return;\n  if (typeof args[0] === 'string') alreadyWarned[args[0]] = new Date();\n  warn(...args);\n}\nconst loadedClb = (i18n, cb) => () => {\n  if (i18n.isInitialized) {\n    cb();\n  } else {\n    const initialized = () => {\n      setTimeout(() => {\n        i18n.off('initialized', initialized);\n      }, 0);\n      cb();\n    };\n    i18n.on('initialized', initialized);\n  }\n};\nexport function loadNamespaces(i18n, ns, cb) {\n  i18n.loadNamespaces(ns, loadedClb(i18n, cb));\n}\nexport function loadLanguages(i18n, lng, ns, cb) {\n  if (typeof ns === 'string') ns = [ns];\n  ns.forEach(n => {\n    if (i18n.options.ns.indexOf(n) < 0) i18n.options.ns.push(n);\n  });\n  i18n.loadLanguages(lng, loadedClb(i18n, cb));\n}\nfunction oldI18nextHasLoadedNamespace(ns, i18n) {\n  let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  const lng = i18n.languages[0];\n  const fallbackLng = i18n.options ? i18n.options.fallbackLng : false;\n  const lastLng = i18n.languages[i18n.languages.length - 1];\n  if (lng.toLowerCase() === 'cimode') return true;\n  const loadNotPending = (l, n) => {\n    const loadState = i18n.services.backendConnector.state[`${l}|${n}`];\n    return loadState === -1 || loadState === 2;\n  };\n  if (options.bindI18n && options.bindI18n.indexOf('languageChanging') > -1 && i18n.services.backendConnector.backend && i18n.isLanguageChangingTo && !loadNotPending(i18n.isLanguageChangingTo, ns)) return false;\n  if (i18n.hasResourceBundle(lng, ns)) return true;\n  if (!i18n.services.backendConnector.backend || i18n.options.resources && !i18n.options.partialBundledLanguages) return true;\n  if (loadNotPending(lng, ns) && (!fallbackLng || loadNotPending(lastLng, ns))) return true;\n  return false;\n}\nexport function hasLoadedNamespace(ns, i18n) {\n  let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  if (!i18n.languages || !i18n.languages.length) {\n    warnOnce('i18n.languages were undefined or empty', i18n.languages);\n    return true;\n  }\n  const isNewerI18next = i18n.options.ignoreJSONStructure !== undefined;\n  if (!isNewerI18next) {\n    return oldI18nextHasLoadedNamespace(ns, i18n, options);\n  }\n  return i18n.hasLoadedNamespace(ns, {\n    lng: options.lng,\n    precheck: (i18nInstance, loadNotPending) => {\n      if (options.bindI18n && options.bindI18n.indexOf('languageChanging') > -1 && i18nInstance.services.backendConnector.backend && i18nInstance.isLanguageChangingTo && !loadNotPending(i18nInstance.isLanguageChangingTo, ns)) return false;\n    }\n  });\n}\nexport function getDisplayName(Component) {\n  return Component.displayName || Component.name || (typeof Component === 'string' && Component.length > 0 ? Component : 'Unknown');\n}","const matchHtmlEntity = /&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g;\nconst htmlEntities = {\n  '&amp;': '&',\n  '&#38;': '&',\n  '&lt;': '<',\n  '&#60;': '<',\n  '&gt;': '>',\n  '&#62;': '>',\n  '&apos;': \"'\",\n  '&#39;': \"'\",\n  '&quot;': '\"',\n  '&#34;': '\"',\n  '&nbsp;': ' ',\n  '&#160;': ' ',\n  '&copy;': '©',\n  '&#169;': '©',\n  '&reg;': '®',\n  '&#174;': '®',\n  '&hellip;': '…',\n  '&#8230;': '…',\n  '&#x2F;': '/',\n  '&#47;': '/'\n};\nconst unescapeHtmlEntity = m => htmlEntities[m];\nexport const unescape = text => text.replace(matchHtmlEntity, unescapeHtmlEntity);","import { unescape } from './unescape.js';\nlet defaultOptions = {\n  bindI18n: 'languageChanged',\n  bindI18nStore: '',\n  transEmptyNodeValue: '',\n  transSupportBasicHtmlNodes: true,\n  transWrapTextNodes: '',\n  transKeepBasicHtmlNodesFor: ['br', 'strong', 'i', 'p'],\n  useSuspense: true,\n  unescape\n};\nexport function setDefaults() {\n  let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  defaultOptions = {\n    ...defaultOptions,\n    ...options\n  };\n}\nexport function getDefaults() {\n  return defaultOptions;\n}","let i18nInstance;\nexport function setI18n(instance) {\n  i18nInstance = instance;\n}\nexport function getI18n() {\n  return i18nInstance;\n}","import { createContext } from 'react';\nimport { getDefaults, setDefaults } from './defaults.js';\nimport { getI18n, setI18n } from './i18nInstance.js';\nimport { initReactI18next } from './initReactI18next.js';\nexport { getDefaults, setDefaults, getI18n, setI18n, initReactI18next };\nexport const I18nContext = createContext();\nexport class ReportNamespaces {\n  constructor() {\n    this.usedNamespaces = {};\n  }\n  addUsedNamespaces(namespaces) {\n    namespaces.forEach(ns => {\n      if (!this.usedNamespaces[ns]) this.usedNamespaces[ns] = true;\n    });\n  }\n  getUsedNamespaces() {\n    return Object.keys(this.usedNamespaces);\n  }\n}\nexport function composeInitialProps(ForComponent) {\n  return ctx => new Promise(resolve => {\n    const i18nInitialProps = getInitialProps();\n    if (ForComponent.getInitialProps) {\n      ForComponent.getInitialProps(ctx).then(componentsInitialProps => {\n        resolve({\n          ...componentsInitialProps,\n          ...i18nInitialProps\n        });\n      });\n    } else {\n      resolve(i18nInitialProps);\n    }\n  });\n}\nexport function getInitialProps() {\n  const i18n = getI18n();\n  const namespaces = i18n.reportNamespaces ? i18n.reportNamespaces.getUsedNamespaces() : [];\n  const ret = {};\n  const initialI18nStore = {};\n  i18n.languages.forEach(l => {\n    initialI18nStore[l] = {};\n    namespaces.forEach(ns => {\n      initialI18nStore[l][ns] = i18n.getResourceBundle(l, ns) || {};\n    });\n  });\n  ret.initialI18nStore = initialI18nStore;\n  ret.initialLanguage = i18n.language;\n  return ret;\n}","import { useState, useEffect, useContext, useRef } from 'react';\nimport { getI18n, getDefaults, ReportNamespaces, I18nContext } from './context.js';\nimport { warnOnce, loadNamespaces, loadLanguages, hasLoadedNamespace } from './utils.js';\nconst usePrevious = (value, ignore) => {\n  const ref = useRef();\n  useEffect(() => {\n    ref.current = ignore ? ref.current : value;\n  }, [value, ignore]);\n  return ref.current;\n};\nexport function useTranslation(ns) {\n  let props = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const {\n    i18n: i18nFromProps\n  } = props;\n  const {\n    i18n: i18nFromContext,\n    defaultNS: defaultNSFromContext\n  } = useContext(I18nContext) || {};\n  const i18n = i18nFromProps || i18nFromContext || getI18n();\n  if (i18n && !i18n.reportNamespaces) i18n.reportNamespaces = new ReportNamespaces();\n  if (!i18n) {\n    warnOnce('You will need to pass in an i18next instance by using initReactI18next');\n    const notReadyT = (k, optsOrDefaultValue) => {\n      if (typeof optsOrDefaultValue === 'string') return optsOrDefaultValue;\n      if (optsOrDefaultValue && typeof optsOrDefaultValue === 'object' && typeof optsOrDefaultValue.defaultValue === 'string') return optsOrDefaultValue.defaultValue;\n      return Array.isArray(k) ? k[k.length - 1] : k;\n    };\n    const retNotReady = [notReadyT, {}, false];\n    retNotReady.t = notReadyT;\n    retNotReady.i18n = {};\n    retNotReady.ready = false;\n    return retNotReady;\n  }\n  if (i18n.options.react && i18n.options.react.wait !== undefined) warnOnce('It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.');\n  const i18nOptions = {\n    ...getDefaults(),\n    ...i18n.options.react,\n    ...props\n  };\n  const {\n    useSuspense,\n    keyPrefix\n  } = i18nOptions;\n  let namespaces = ns || defaultNSFromContext || i18n.options && i18n.options.defaultNS;\n  namespaces = typeof namespaces === 'string' ? [namespaces] : namespaces || ['translation'];\n  if (i18n.reportNamespaces.addUsedNamespaces) i18n.reportNamespaces.addUsedNamespaces(namespaces);\n  const ready = (i18n.isInitialized || i18n.initializedStoreOnce) && namespaces.every(n => hasLoadedNamespace(n, i18n, i18nOptions));\n  function getT() {\n    return i18n.getFixedT(props.lng || null, i18nOptions.nsMode === 'fallback' ? namespaces : namespaces[0], keyPrefix);\n  }\n  const [t, setT] = useState(getT);\n  let joinedNS = namespaces.join();\n  if (props.lng) joinedNS = `${props.lng}${joinedNS}`;\n  const previousJoinedNS = usePrevious(joinedNS);\n  const isMounted = useRef(true);\n  useEffect(() => {\n    const {\n      bindI18n,\n      bindI18nStore\n    } = i18nOptions;\n    isMounted.current = true;\n    if (!ready && !useSuspense) {\n      if (props.lng) {\n        loadLanguages(i18n, props.lng, namespaces, () => {\n          if (isMounted.current) setT(getT);\n        });\n      } else {\n        loadNamespaces(i18n, namespaces, () => {\n          if (isMounted.current) setT(getT);\n        });\n      }\n    }\n    if (ready && previousJoinedNS && previousJoinedNS !== joinedNS && isMounted.current) {\n      setT(getT);\n    }\n    function boundReset() {\n      if (isMounted.current) setT(getT);\n    }\n    if (bindI18n && i18n) i18n.on(bindI18n, boundReset);\n    if (bindI18nStore && i18n) i18n.store.on(bindI18nStore, boundReset);\n    return () => {\n      isMounted.current = false;\n      if (bindI18n && i18n) bindI18n.split(' ').forEach(e => i18n.off(e, boundReset));\n      if (bindI18nStore && i18n) bindI18nStore.split(' ').forEach(e => i18n.store.off(e, boundReset));\n    };\n  }, [i18n, joinedNS]);\n  const isInitial = useRef(true);\n  useEffect(() => {\n    if (isMounted.current && !isInitial.current) {\n      setT(getT);\n    }\n    isInitial.current = false;\n  }, [i18n, keyPrefix]);\n  const ret = [t, i18n, ready];\n  ret.t = t;\n  ret.i18n = i18n;\n  ret.ready = ready;\n  if (ready) return ret;\n  if (!ready && !useSuspense) return ret;\n  throw new Promise(resolve => {\n    if (props.lng) {\n      loadLanguages(i18n, props.lng, namespaces, () => resolve());\n    } else {\n      loadNamespaces(i18n, namespaces, () => resolve());\n    }\n  });\n}","import { createElement, forwardRef as forwardRefReact } from 'react';\nimport { useTranslation } from './useTranslation.js';\nimport { getDisplayName } from './utils.js';\nexport function withTranslation(ns) {\n  let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  return function Extend(WrappedComponent) {\n    function I18nextWithTranslation(_ref) {\n      let {\n        forwardedRef,\n        ...rest\n      } = _ref;\n      const [t, i18n, ready] = useTranslation(ns, {\n        ...rest,\n        keyPrefix: options.keyPrefix\n      });\n      const passDownProps = {\n        ...rest,\n        t,\n        i18n,\n        tReady: ready\n      };\n      if (options.withRef && forwardedRef) {\n        passDownProps.ref = forwardedRef;\n      } else if (!options.withRef && forwardedRef) {\n        passDownProps.forwardedRef = forwardedRef;\n      }\n      return createElement(WrappedComponent, passDownProps);\n    }\n    I18nextWithTranslation.displayName = `withI18nextTranslation(${getDisplayName(WrappedComponent)})`;\n    I18nextWithTranslation.WrappedComponent = WrappedComponent;\n    const forwardRef = (props, ref) => createElement(I18nextWithTranslation, Object.assign({}, props, {\n      forwardedRef: ref\n    }));\n    return options.withRef ? forwardRefReact(forwardRef) : I18nextWithTranslation;\n  };\n}","import { createElement, useMemo } from 'react';\nimport { I18nContext } from './context.js';\nexport function I18nextProvider(_ref) {\n  let {\n    i18n,\n    defaultNS,\n    children\n  } = _ref;\n  const value = useMemo(() => ({\n    i18n,\n    defaultNS\n  }), [i18n, defaultNS]);\n  return createElement(I18nContext.Provider, {\n    value\n  }, children);\n}","import { createElement } from 'react';\nimport { useSSR } from './useSSR.js';\nimport { composeInitialProps } from './context.js';\nimport { getDisplayName } from './utils.js';\nexport function withSSR() {\n  return function Extend(WrappedComponent) {\n    function I18nextWithSSR(_ref) {\n      let {\n        initialI18nStore,\n        initialLanguage,\n        ...rest\n      } = _ref;\n      useSSR(initialI18nStore, initialLanguage);\n      return createElement(WrappedComponent, {\n        ...rest\n      });\n    }\n    I18nextWithSSR.getInitialProps = composeInitialProps(WrappedComponent);\n    I18nextWithSSR.displayName = `withI18nextSSR(${getDisplayName(WrappedComponent)})`;\n    I18nextWithSSR.WrappedComponent = WrappedComponent;\n    return I18nextWithSSR;\n  };\n}","import { useContext } from 'react';\nimport { getI18n, I18nContext } from './context.js';\nexport function useSSR(initialI18nStore, initialLanguage) {\n  let props = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  const {\n    i18n: i18nFromProps\n  } = props;\n  const {\n    i18n: i18nFromContext\n  } = useContext(I18nContext) || {};\n  const i18n = i18nFromProps || i18nFromContext || getI18n();\n  if (i18n.options && i18n.options.isClone) return;\n  if (initialI18nStore && !i18n.initializedStoreOnce) {\n    i18n.services.resourceStore.data = initialI18nStore;\n    i18n.options.ns = Object.values(initialI18nStore).reduce((mem, lngResources) => {\n      Object.keys(lngResources).forEach(ns => {\n        if (mem.indexOf(ns) < 0) mem.push(ns);\n      });\n      return mem;\n    }, i18n.options.ns);\n    i18n.initializedStoreOnce = true;\n    i18n.isInitialized = true;\n  }\n  if (initialLanguage && !i18n.initializedLanguageOnce) {\n    i18n.changeLanguage(initialLanguage);\n    i18n.initializedLanguageOnce = true;\n  }\n}","import L from 'leaflet';\r\n\r\n/**\r\n * Calculates the area of a polygon using the Shoelace formula on projected coordinates.\r\n * Μεταφέρθηκε από OLD_geo-canvas/components/utils/measurementUtils.ts\r\n * @param latlngs An array of L.LatLng points for the polygon.\r\n * @returns The calculated area in square meters.\r\n */\r\nexport const calculateProjectedArea = (latlngs: L.LatLng[]): number => {\r\n  if (latlngs.length < 3) return 0;\r\n\r\n  // Project points to a cartesian plane (meters) using Web Mercator projection\r\n  const map = L.CRS.EPSG3857;\r\n  const points = latlngs.map(latlng => map.project(latlng));\r\n\r\n  let area = 0;\r\n  const n = points.length;\r\n  for (let i = 0; i < n; i++) {\r\n    const p1 = points[i];\r\n    const p2 = points[(i + 1) % n];\r\n    area += p1.x * p2.y - p2.x * p1.y;\r\n  }\r\n\r\n  return Math.abs(area / 2.0);\r\n};\r\n\r\n/**\r\n * Calculates the total path distance for a series of points.\r\n * Μεταφέρθηκε από OLD_geo-canvas/components/utils/measurementUtils.ts\r\n * @param latlngs An array of L.LatLng points.\r\n * @returns The total distance in meters.\r\n */\r\nexport const calculateDistance = (latlngs: L.LatLng[]): number => {\r\n  if (latlngs.length < 2) {\r\n    return 0;\r\n  }\r\n\r\n  let totalDistance = 0;\r\n  for (let i = 0; i < latlngs.length - 1; i++) {\r\n    totalDistance += latlngs[i].distanceTo(latlngs[i + 1]);\r\n  }\r\n  return totalDistance;\r\n};\r\n\r\n/**\r\n * Calculates the distance between two LatLng points using Haversine formula\r\n * @param point1 First point\r\n * @param point2 Second point\r\n * @returns Distance in meters\r\n */\r\nexport const calculatePointDistance = (point1: L.LatLng, point2: L.LatLng): number => {\r\n  return point1.distanceTo(point2);\r\n};\r\n\r\n/**\r\n * Calculates the center point of a polygon\r\n * @param latlngs Array of polygon vertices\r\n * @returns Center point as LatLng\r\n */\r\nexport const calculatePolygonCenter = (latlngs: L.LatLng[]): L.LatLng => {\r\n  if (latlngs.length === 0) {\r\n    throw new Error('Cannot calculate center of empty polygon');\r\n  }\r\n\r\n  let latSum = 0;\r\n  let lngSum = 0;\r\n\r\n  for (const point of latlngs) {\r\n    latSum += point.lat;\r\n    lngSum += point.lng;\r\n  }\r\n\r\n  return L.latLng(latSum / latlngs.length, lngSum / latlngs.length);\r\n};\r\n\r\n/**\r\n * Calculates the perimeter of a polygon\r\n * @param latlngs Array of polygon vertices\r\n * @returns Perimeter in meters\r\n */\r\nexport const calculatePerimeter = (latlngs: L.LatLng[]): number => {\r\n  if (latlngs.length < 2) return 0;\r\n\r\n  // Close the polygon by adding the first point at the end\r\n  const closedPolygon = [...latlngs, latlngs[0]];\r\n  return calculateDistance(closedPolygon);\r\n};\r\n\r\n/**\r\n * Checks if a point is inside a polygon using ray casting algorithm\r\n * @param point Point to test\r\n * @param polygon Array of polygon vertices\r\n * @returns True if point is inside polygon\r\n */\r\nexport const isPointInPolygon = (point: L.LatLng, polygon: L.LatLng[]): boolean => {\r\n  let inside = false;\r\n  const x = point.lng;\r\n  const y = point.lat;\r\n\r\n  for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {\r\n    const xi = polygon[i].lng;\r\n    const yi = polygon[i].lat;\r\n    const xj = polygon[j].lng;\r\n    const yj = polygon[j].lat;\r\n\r\n    if (((yi > y) !== (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi)) {\r\n      inside = !inside;\r\n    }\r\n  }\r\n\r\n  return inside;\r\n};\r\n\r\n/**\r\n * Calculates the bounding box of a set of points\r\n * @param latlngs Array of points\r\n * @returns Leaflet LatLngBounds object\r\n */\r\nexport const calculateBounds = (latlngs: L.LatLng[]): L.LatLngBounds => {\r\n  if (latlngs.length === 0) {\r\n    throw new Error('Cannot calculate bounds of empty point array');\r\n  }\r\n\r\n  return L.latLngBounds(latlngs);\r\n};","import { useTranslation } from 'react-i18next';\r\n\r\n/**\r\n * Formats a distance in meters into a readable string, switching to kilometers for large distances.\r\n * Μεταφέρθηκε από OLD_geo-canvas/components/utils/measurementUtils.ts\r\n * @param meters The distance in meters.\r\n * @param decimals The number of decimal places to show.\r\n * @returns A formatted string like \"500.00 m\" or \"1.20 km\".\r\n */\r\nexport const formatDistance = (meters: number, decimals: number = 2): string => {\r\n  if (meters === 0) return '0 m';\r\n  if (meters >= 1000) {\r\n    return `${(meters / 1000).toFixed(decimals)} km`;\r\n  }\r\n  return `${meters.toFixed(decimals)} m`;\r\n};\r\n\r\n/**\r\n * Formats an area in square meters into a readable string, switching to hectares or square kilometers.\r\n * Μεταφέρθηκε από OLD_geo-canvas/components/utils/measurementUtils.ts\r\n * @param sqMeters The area in square meters.\r\n * @returns A formatted string like \"500.00 m²\" or \"1.20 ha\".\r\n */\r\nexport const formatArea = (sqMeters: number): string => {\r\n  if (sqMeters === 0) return '0 m²';\r\n  if (sqMeters >= 1000000) {\r\n    return `${(sqMeters / 1000000).toFixed(2)} km²`;\r\n  }\r\n  if (sqMeters >= 10000) {\r\n    return `${(sqMeters / 10000).toFixed(2)} ha`;\r\n  }\r\n  return `${sqMeters.toFixed(2)} m²`;\r\n};\r\n\r\n/**\r\n * Hook for formatted measurement display with i18n support\r\n * Αντικαθιστά τα hardcoded strings με i18n keys\r\n */\r\nexport const useMeasurementFormatter = () => {\r\n  const { t } = useTranslation();\r\n\r\n  const formatDistanceWithLabels = (meters: number, decimals: number = 2): string => {\r\n    if (meters === 0) return `0 ${t('geo-drawing.units.meters')}`;\r\n    if (meters >= 1000) {\r\n      return `${(meters / 1000).toFixed(decimals)} ${t('geo-drawing.units.kilometers')}`;\r\n    }\r\n    return `${meters.toFixed(decimals)} ${t('geo-drawing.units.meters')}`;\r\n  };\r\n\r\n  const formatAreaWithLabels = (sqMeters: number): string => {\r\n    if (sqMeters === 0) return `0 ${t('geo-drawing.units.square-meters')}`;\r\n    if (sqMeters >= 1000000) {\r\n      return `${(sqMeters / 1000000).toFixed(2)} ${t('geo-drawing.units.square-kilometers')}`;\r\n    }\r\n    if (sqMeters >= 10000) {\r\n      return `${(sqMeters / 10000).toFixed(2)} ${t('geo-drawing.units.hectares')}`;\r\n    }\r\n    return `${sqMeters.toFixed(2)} ${t('geo-drawing.units.square-meters')}`;\r\n  };\r\n\r\n  const formatCoordinates = (lat: number, lng: number, decimals: number = 6): string => {\r\n    return `${lat.toFixed(decimals)}, ${lng.toFixed(decimals)}`;\r\n  };\r\n\r\n  const formatPointLabel = (index: number): string => {\r\n    return t('geo-drawing.point-label', { index: index + 1 });\r\n  };\r\n\r\n  return {\r\n    formatDistanceWithLabels,\r\n    formatAreaWithLabels,\r\n    formatCoordinates,\r\n    formatPointLabel,\r\n    // Backward compatibility exports\r\n    formatDistance,\r\n    formatArea\r\n  };\r\n};\r\n\r\n/**\r\n * Formats coordinates to different coordinate systems\r\n */\r\nexport const formatCoordinatesBySystem = (\r\n  lat: number,\r\n  lng: number,\r\n  system: 'WGS84' | 'EGSA87' | 'UTM' = 'WGS84',\r\n  decimals: number = 6\r\n): string => {\r\n  switch (system) {\r\n    case 'WGS84':\r\n      return `${lat.toFixed(decimals)}°N, ${lng.toFixed(decimals)}°E`;\r\n    case 'EGSA87':\r\n      // Basic conversion placeholder - would need proper transformation\r\n      return `X: ${lng.toFixed(2)}, Y: ${lat.toFixed(2)} (ΕΓΣΑ87)`;\r\n    case 'UTM':\r\n      // Basic UTM formatting placeholder\r\n      return `UTM: ${lng.toFixed(0)}E, ${lat.toFixed(0)}N`;\r\n    default:\r\n      return `${lat.toFixed(decimals)}, ${lng.toFixed(decimals)}`;\r\n  }\r\n};\r\n\r\n/**\r\n * Formats bearing/azimuth between two points\r\n * @param bearing Bearing in degrees\r\n * @returns Formatted bearing string\r\n */\r\nexport const formatBearing = (bearing: number): string => {\r\n  const directions = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];\r\n  const index = Math.round(bearing / 45) % 8;\r\n  return `${bearing.toFixed(1)}° (${directions[index]})`;\r\n};","import { useState, useEffect, useCallback, useRef } from 'react';\r\nimport L from 'leaflet';\r\nimport { useMap } from 'react-leaflet';\r\nimport { useSnapEngine } from '@layera/snap-interactions';\r\nimport type { GeoJSONFeatureCollection, OSMBuildingFeature } from '../types';\r\nimport { fetchBuildingOutlines } from '../services/osmService';\r\nimport { extractOSMGeometry } from '../utils/geometry';\r\nimport { CONFIG } from '@layera/constants';\r\n\r\n/**\r\n * Hook που ενσωματώνει το snap-to-geometry με OSM building data\r\n * Βασισμένο στο OLD_geo-canvas/packages/app/src/hooks/useSnapping.ts\r\n * αλλά χρησιμοποιεί το νέο @layera/snap-engine LEGO system\r\n */\r\nexport const useGeometrySnap = (isEnabled: boolean = true) => {\r\n  const map = useMap();\r\n  const [osmData, setOsmData] = useState<GeoJSONFeatureCollection | null>(null);\r\n  const [isSnappingEffective, setIsSnappingEffective] = useState(false);\r\n  const timeoutRef = useRef<number | null>(null);\r\n\r\n  // Initialize snap engine με OSM-specific configuration\r\n  const snapEngine = useSnapEngine({\r\n    tolerance: CONFIG.geoDrawing.snapTolerance,\r\n    enabledTypes: new Set(['vertex', 'edge', 'center', 'nearest']),\r\n    spatialIndexing: true\r\n  });\r\n\r\n  // Effect για fetching OSM data όταν ο χάρτης κινείται\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      const currentZoom = map.getZoom();\r\n      if (!isEnabled || currentZoom < CONFIG.geoDrawing.minSnapZoom) {\r\n        setOsmData(null);\r\n        setIsSnappingEffective(false);\r\n        snapEngine.clearGeometries();\r\n        return;\r\n      }\r\n\r\n      setIsSnappingEffective(true);\r\n      try {\r\n        const geojson = await fetchBuildingOutlines(map.getBounds());\r\n        setOsmData(geojson);\r\n\r\n        // Convert OSM features to geometries για το snap engine\r\n        const geometries: L.LatLng[][] = [];\r\n        geojson.features.forEach((feature: OSMBuildingFeature) => {\r\n          const polygons = extractOSMGeometry(feature);\r\n          geometries.push(...polygons);\r\n        });\r\n\r\n        // Update snap engine με νέα geometries\r\n        snapEngine.setGeometries(geometries);\r\n      } catch (error) {\r\n        console.warn('Failed to fetch OSM data for snapping:', error);\r\n        setOsmData(null);\r\n        setIsSnappingEffective(false);\r\n      }\r\n    };\r\n\r\n    const handleMoveEnd = () => {\r\n      if (timeoutRef.current) {\r\n        clearTimeout(timeoutRef.current);\r\n      }\r\n      // Debounce the fetch request to avoid spamming the API\r\n      timeoutRef.current = window.setTimeout(fetchData, CONFIG.geoDrawing.debounceMs);\r\n    };\r\n\r\n    map.on('moveend zoomend', handleMoveEnd);\r\n    fetchData(); // Initial check/fetch for the current view\r\n\r\n    return () => {\r\n      map.off('moveend zoomend', handleMoveEnd);\r\n      if (timeoutRef.current) {\r\n        clearTimeout(timeoutRef.current);\r\n      }\r\n      setIsSnappingEffective(false);\r\n      snapEngine.clearGeometries();\r\n    };\r\n  }, [map, isEnabled, snapEngine]);\r\n\r\n  /**\r\n   * Performs snapping calculation για ένα cursor point\r\n   * @param latlng Original cursor position\r\n   * @returns Snap result with snapped position\r\n   */\r\n  const getSnappedPoint = useCallback((latlng: L.LatLng) => {\r\n    if (!isEnabled || !isSnappingEffective || map.getZoom() < CONFIG.geoDrawing.minSnapZoom) {\r\n      return {\r\n        snappedLatLng: latlng,\r\n        snapPoint: null,\r\n        snapType: null,\r\n        isSnapped: false\r\n      };\r\n    }\r\n\r\n    return snapEngine.snapToPoint(latlng);\r\n  }, [isEnabled, isSnappingEffective, map, snapEngine]);\r\n\r\n  /**\r\n   * Snap σε κοντινότερο vertex\r\n   */\r\n  const snapToVertex = useCallback((latlng: L.LatLng) => {\r\n    if (!isEnabled || !isSnappingEffective) {\r\n      return { snappedLatLng: latlng, snapPoint: null, isSnapped: false };\r\n    }\r\n\r\n    return snapEngine.snapToVertex(latlng);\r\n  }, [isEnabled, isSnappingEffective, snapEngine]);\r\n\r\n  /**\r\n   * Snap σε κοντινότερο edge\r\n   */\r\n  const snapToEdge = useCallback((latlng: L.LatLng) => {\r\n    if (!isEnabled || !isSnappingEffective) {\r\n      return { snappedLatLng: latlng, snapPoint: null, isSnapped: false };\r\n    }\r\n\r\n    return snapEngine.snapToEdge(latlng);\r\n  }, [isEnabled, isSnappingEffective, snapEngine]);\r\n\r\n  /**\r\n   * Enables/disables specific snap types\r\n   */\r\n  const setSnapTypes = useCallback((types: Set<string>) => {\r\n    snapEngine.setEnabledTypes(types);\r\n  }, [snapEngine]);\r\n\r\n  /**\r\n   * Updates snap tolerance\r\n   */\r\n  const setSnapTolerance = useCallback((tolerance: number) => {\r\n    snapEngine.setTolerance(tolerance);\r\n  }, [snapEngine]);\r\n\r\n  /**\r\n   * Gets building information at a point\r\n   */\r\n  const getBuildingInfo = useCallback((latlng: L.LatLng) => {\r\n    if (!osmData) return null;\r\n\r\n    for (const feature of osmData.features) {\r\n      const polygons = extractOSMGeometry(feature);\r\n      for (const polygon of polygons) {\r\n        // Simple point-in-polygon check\r\n        let inside = false;\r\n        for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {\r\n          if (((polygon[i].lat > latlng.lat) !== (polygon[j].lat > latlng.lat)) &&\r\n              (latlng.lng < (polygon[j].lng - polygon[i].lng) * (latlng.lat - polygon[i].lat) / (polygon[j].lat - polygon[i].lat) + polygon[i].lng)) {\r\n            inside = !inside;\r\n          }\r\n        }\r\n        if (inside) {\r\n          return feature.properties;\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n  }, [osmData]);\r\n\r\n  return {\r\n    // State\r\n    isSnappingEffective,\r\n    osmData,\r\n    snapEngine,\r\n\r\n    // Snap functions\r\n    getSnappedPoint,\r\n    snapToVertex,\r\n    snapToEdge,\r\n\r\n    // Configuration\r\n    setSnapTypes,\r\n    setSnapTolerance,\r\n\r\n    // Utility\r\n    getBuildingInfo,\r\n\r\n    // Backward compatibility με το παλιό API\r\n    snappingData: osmData\r\n  };\r\n};","import L from 'leaflet';\r\nimport type { GeoJSONFeatureCollection } from '../types';\r\nimport { CONFIG } from '@layera/constants';\r\n\r\n// OSM Service για fetching building outlines\r\n// Μεταφέρθηκε από OLD_geo-canvas/packages/app/src/services/osmService.ts\r\n\r\n// Declare the osmtogeojson library loaded from a script tag in index.html\r\ndeclare const osmtogeojson: (data: any) => GeoJSONFeatureCollection;\r\n\r\n// Simple in-memory cache to avoid redundant API calls\r\nconst cache = new Map<string, GeoJSONFeatureCollection>();\r\n\r\n/**\r\n * Fetches building outlines from the OpenStreetMap Overpass API for a given map bounds.\r\n * @param bounds The Leaflet LatLngBounds for which to fetch data.\r\n * @returns A promise that resolves with a GeoJSON FeatureCollection of building polygons.\r\n */\r\nexport const fetchBuildingOutlines = async (bounds: L.LatLngBounds): Promise<GeoJSONFeatureCollection> => {\r\n  // Create a key for the cache, rounding coordinates to group close-by requests\r\n  const boundsStr = `${bounds.getSouth().toFixed(4)},${bounds.getWest().toFixed(4)},${bounds.getNorth().toFixed(4)},${bounds.getEast().toFixed(4)}`;\r\n\r\n  if (cache.has(boundsStr)) {\r\n    return Promise.resolve(cache.get(boundsStr)!);\r\n  }\r\n\r\n  const bbox = `${bounds.getSouth()},${bounds.getWest()},${bounds.getNorth()},${bounds.getEast()}`;\r\n  const query = `\r\n    [out:json][timeout:${CONFIG.osm.requestTimeout / 1000}];\r\n    (\r\n      node[\"building\"](${bbox});\r\n      way[\"building\"](${bbox});\r\n      relation[\"building\"](${bbox});\r\n    );\r\n    out body;\r\n    >;\r\n    out skel qt;\r\n  `;\r\n\r\n  try {\r\n    const response = await fetch(CONFIG.osm.overpassApiUrl, {\r\n      method: 'POST',\r\n      body: `data=${encodeURIComponent(query)}`,\r\n    });\r\n\r\n    if (!response.ok) {\r\n      // Don't pollute console for common errors like 429 Too Many Requests\r\n      if (response.status !== 429 && response.status !== 504) {\r\n        console.error(`Overpass API error: ${response.statusText}`);\r\n      }\r\n      throw new Error(`Network response was not ok: ${response.statusText}`);\r\n    }\r\n\r\n    const osmData = await response.json();\r\n    const geojson = osmtogeojson(osmData) as GeoJSONFeatureCollection;\r\n\r\n    // FIX: Also include MultiPolygons, as complex buildings are often represented this way.\r\n    // This is the primary fix for snapping appearing to not work in some areas.\r\n    geojson.features = geojson.features.filter(f =>\r\n      f.geometry && (f.geometry.type === 'Polygon' || f.geometry.type === 'MultiPolygon')\r\n    );\r\n\r\n    cache.set(boundsStr, geojson);\r\n    return geojson;\r\n  } catch (error) {\r\n    // Silently fail to avoid interrupting user experience\r\n    return { type: 'FeatureCollection', features: [] };\r\n  }\r\n};\r\n\r\n/**\r\n * Clears the OSM data cache\r\n */\r\nexport const clearOSMCache = (): void => {\r\n  cache.clear();\r\n};\r\n\r\n/**\r\n * Gets the current cache size\r\n * @returns Number of cached entries\r\n */\r\nexport const getCacheSize = (): number => {\r\n  return cache.size;\r\n};\r\n\r\n/**\r\n * Checks if bounds are cached\r\n * @param bounds Bounds to check\r\n * @returns True if bounds are in cache\r\n */\r\nexport const isBoundsCached = (bounds: L.LatLngBounds): boolean => {\r\n  const boundsStr = `${bounds.getSouth().toFixed(4)},${bounds.getWest().toFixed(4)},${bounds.getNorth().toFixed(4)},${bounds.getEast().toFixed(4)}`;\r\n  return cache.has(boundsStr);\r\n};\r\n\r\n/**\r\n * Prefetches OSM data for given bounds without returning the data\r\n * Useful for preloading nearby areas\r\n * @param bounds Bounds to prefetch\r\n */\r\nexport const prefetchBuildingOutlines = async (bounds: L.LatLngBounds): Promise<void> => {\r\n  try {\r\n    await fetchBuildingOutlines(bounds);\r\n  } catch (error) {\r\n    // Silently fail for prefetch operations\r\n  }\r\n};","import L from 'leaflet';\r\nimport type { GeometryType, OSMBuildingFeature } from '../types';\r\n\r\n/**\r\n * Geometry utility functions για το geo-drawing system\r\n */\r\n\r\n/**\r\n * Converts GeoJSON coordinates to Leaflet LatLng array\r\n * @param coordinates GeoJSON coordinates array\r\n * @param geometryType Type of geometry\r\n * @returns Array of LatLng points\r\n */\r\nexport const geoJsonToLatLng = (\r\n  coordinates: number[][] | number[][][],\r\n  geometryType: GeometryType\r\n): L.LatLng[] => {\r\n  if (geometryType === 'Polygon' && Array.isArray(coordinates[0]) && Array.isArray(coordinates[0][0])) {\r\n    // Polygon: coordinates[0] is the exterior ring\r\n    const ring = coordinates as number[][][];\r\n    return ring[0].map(coord => L.latLng(coord[1], coord[0]));\r\n  }\r\n\r\n  if (geometryType === 'LineString' && Array.isArray(coordinates[0]) && typeof coordinates[0][0] === 'number') {\r\n    // LineString: coordinates is array of [lng, lat] pairs\r\n    const line = coordinates as number[][];\r\n    return line.map(coord => L.latLng(coord[1], coord[0]));\r\n  }\r\n\r\n  if (geometryType === 'Point' && typeof coordinates[0] === 'number') {\r\n    // Point: coordinates is [lng, lat]\r\n    const point = coordinates as number[];\r\n    return [L.latLng(point[1], point[0])];\r\n  }\r\n\r\n  return [];\r\n};\r\n\r\n/**\r\n * Converts Leaflet LatLng array to GeoJSON coordinates\r\n * @param latlngs Array of LatLng points\r\n * @param geometryType Target geometry type\r\n * @returns GeoJSON coordinates array\r\n */\r\nexport const latLngToGeoJson = (\r\n  latlngs: L.LatLng[],\r\n  geometryType: GeometryType\r\n): number[][] | number[][][] => {\r\n  const coords = latlngs.map(latlng => [latlng.lng, latlng.lat]);\r\n\r\n  if (geometryType === 'Polygon') {\r\n    // Polygon needs to be closed (first point = last point) and wrapped in array\r\n    const closedCoords = [...coords];\r\n    if (coords.length > 0 &&\r\n        (coords[0][0] !== coords[coords.length - 1][0] ||\r\n         coords[0][1] !== coords[coords.length - 1][1])) {\r\n      closedCoords.push(coords[0]);\r\n    }\r\n    return [closedCoords];\r\n  }\r\n\r\n  return coords;\r\n};\r\n\r\n/**\r\n * Calculates the closest point on a line segment to a given point\r\n * @param point Target point\r\n * @param segmentStart Start of line segment\r\n * @param segmentEnd End of line segment\r\n * @returns Closest point on segment and distance\r\n */\r\nexport const closestPointOnSegment = (\r\n  point: L.LatLng,\r\n  segmentStart: L.LatLng,\r\n  segmentEnd: L.LatLng\r\n): { point: L.LatLng; distance: number } => {\r\n  // Convert to projected coordinates for accurate calculations\r\n  const map = L.CRS.EPSG3857;\r\n  const p = map.project(point);\r\n  const a = map.project(segmentStart);\r\n  const b = map.project(segmentEnd);\r\n\r\n  const dx = b.x - a.x;\r\n  const dy = b.y - a.y;\r\n\r\n  if (dx === 0 && dy === 0) {\r\n    // Segment is a point\r\n    const closestPoint = segmentStart;\r\n    return {\r\n      point: closestPoint,\r\n      distance: point.distanceTo(closestPoint)\r\n    };\r\n  }\r\n\r\n  const t = Math.max(0, Math.min(1, ((p.x - a.x) * dx + (p.y - a.y) * dy) / (dx * dx + dy * dy)));\r\n  const closestProjected = L.point(a.x + t * dx, a.y + t * dy);\r\n  const closestPoint = map.unproject(closestProjected);\r\n\r\n  return {\r\n    point: closestPoint,\r\n    distance: point.distanceTo(closestPoint)\r\n  };\r\n};\r\n\r\n/**\r\n * Checks if two LatLng points are approximately equal within tolerance\r\n * @param point1 First point\r\n * @param point2 Second point\r\n * @param tolerance Tolerance in meters\r\n * @returns True if points are within tolerance\r\n */\r\nexport const arePointsEqual = (point1: L.LatLng, point2: L.LatLng, tolerance: number = 0.1): boolean => {\r\n  return point1.distanceTo(point2) <= tolerance;\r\n};\r\n\r\n/**\r\n * Simplifies a polygon using Douglas-Peucker algorithm\r\n * @param latlngs Array of polygon vertices\r\n * @param tolerance Simplification tolerance in meters\r\n * @returns Simplified polygon vertices\r\n */\r\nexport const simplifyPolygon = (latlngs: L.LatLng[], tolerance: number = 1.0): L.LatLng[] => {\r\n  if (latlngs.length <= 2) return latlngs;\r\n\r\n  const douglasPeucker = (points: L.LatLng[], epsilon: number): L.LatLng[] => {\r\n    if (points.length <= 2) return points;\r\n\r\n    let maxDistance = 0;\r\n    let maxIndex = 0;\r\n\r\n    for (let i = 1; i < points.length - 1; i++) {\r\n      const { distance } = closestPointOnSegment(points[i], points[0], points[points.length - 1]);\r\n      if (distance > maxDistance) {\r\n        maxDistance = distance;\r\n        maxIndex = i;\r\n      }\r\n    }\r\n\r\n    if (maxDistance > epsilon) {\r\n      const leftPart = douglasPeucker(points.slice(0, maxIndex + 1), epsilon);\r\n      const rightPart = douglasPeucker(points.slice(maxIndex), epsilon);\r\n      return [...leftPart.slice(0, -1), ...rightPart];\r\n    }\r\n\r\n    return [points[0], points[points.length - 1]];\r\n  };\r\n\r\n  return douglasPeucker(latlngs, tolerance);\r\n};\r\n\r\n/**\r\n * Calculates the bearing between two points\r\n * @param point1 Start point\r\n * @param point2 End point\r\n * @returns Bearing in degrees (0-360)\r\n */\r\nexport const calculateBearing = (point1: L.LatLng, point2: L.LatLng): number => {\r\n  const lat1 = point1.lat * Math.PI / 180;\r\n  const lat2 = point2.lat * Math.PI / 180;\r\n  const deltaLng = (point2.lng - point1.lng) * Math.PI / 180;\r\n\r\n  const y = Math.sin(deltaLng) * Math.cos(lat2);\r\n  const x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(deltaLng);\r\n\r\n  let bearing = Math.atan2(y, x) * 180 / Math.PI;\r\n  return (bearing + 360) % 360;\r\n};\r\n\r\n/**\r\n * Extracts geometry from OSM Building Feature\r\n * @param feature OSM building feature\r\n * @returns Array of LatLng polygons\r\n */\r\nexport const extractOSMGeometry = (feature: OSMBuildingFeature): L.LatLng[][] => {\r\n  const { geometry } = feature;\r\n  const results: L.LatLng[][] = [];\r\n\r\n  if (geometry.type === 'Polygon') {\r\n    const coords = geometry.coordinates as number[][][];\r\n    coords.forEach(ring => {\r\n      const latlngs = ring.map(coord => L.latLng(coord[1], coord[0]));\r\n      results.push(latlngs);\r\n    });\r\n  } else if (geometry.type === 'MultiPolygon') {\r\n    const coords = geometry.coordinates as number[][][][];\r\n    coords.forEach(polygon => {\r\n      polygon.forEach(ring => {\r\n        const latlngs = ring.map(coord => L.latLng(coord[1], coord[0]));\r\n        results.push(latlngs);\r\n      });\r\n    });\r\n  }\r\n\r\n  return results;\r\n};","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Button } from '@layera/buttons';\r\nimport { Card } from '@layera/cards';\r\nimport { Typography } from '@layera/typography';\r\nimport { Layout } from '@layera/layout';\r\nimport { Icons } from '@layera/icons';\r\nimport type { MeasurementMode } from '../types';\r\n\r\ninterface MeasurementControlsProps {\r\n  mode: MeasurementMode;\r\n  distance: number;\r\n  area: number;\r\n  onModeChange: (mode: MeasurementMode) => void;\r\n  onReset: () => void;\r\n  onFinish?: () => void;\r\n  onCancel?: () => void;\r\n  isDrawing: boolean;\r\n  canFinish: boolean;\r\n  displayValue?: string;\r\n}\r\n\r\n/**\r\n * Measurement controls component using LEGO systems\r\n * Βασισμένο στο OLD_geo-canvas/components/measurement/MeasurementControls.tsx\r\n * αλλά ενσωματώνει τα existing LEGO systems\r\n */\r\nexport const MeasurementControls: React.FC<MeasurementControlsProps> = ({\r\n  mode,\r\n  distance,\r\n  area,\r\n  onModeChange,\r\n  onReset,\r\n  onFinish,\r\n  onCancel,\r\n  isDrawing,\r\n  canFinish,\r\n  displayValue\r\n}) => {\r\n  const { t } = useTranslation();\r\n\r\n  return (\r\n    <Card variant=\"floating\" className=\"min-w-[200px]\">\r\n      <Typography variant=\"h6\" className=\"text-center mb-3\">\r\n        {t('geo-drawing.measurement-title')}\r\n      </Typography>\r\n\r\n      {/* Mode Selection */}\r\n      <Layout direction=\"horizontal\" spacing=\"sm\" className=\"mb-3\">\r\n        <Button\r\n          variant={mode === 'distance' ? 'primary' : 'secondary'}\r\n          size=\"sm\"\r\n          onClick={() => onModeChange('distance')}\r\n          disabled={isDrawing}\r\n          className=\"flex-1\"\r\n        >\r\n          <Icons.Rule className=\"w-4 h-4 mr-1\" />\r\n          {t('geo-drawing.modes.distance')}\r\n        </Button>\r\n\r\n        <Button\r\n          variant={mode === 'area' ? 'primary' : 'secondary'}\r\n          size=\"sm\"\r\n          onClick={() => onModeChange('area')}\r\n          disabled={isDrawing}\r\n          className=\"flex-1\"\r\n        >\r\n          <Icons.Square className=\"w-4 h-4 mr-1\" />\r\n          {t('geo-drawing.modes.area')}\r\n        </Button>\r\n      </Layout>\r\n\r\n      <Layout direction=\"horizontal\" spacing=\"sm\" className=\"mb-3\">\r\n        <Button\r\n          variant={mode === 'point' ? 'primary' : 'secondary'}\r\n          size=\"sm\"\r\n          onClick={() => onModeChange('point')}\r\n          disabled={isDrawing}\r\n          className=\"flex-1\"\r\n        >\r\n          <Icons.MapPin className=\"w-4 h-4 mr-1\" />\r\n          {t('geo-drawing.modes.point')}\r\n        </Button>\r\n      </Layout>\r\n\r\n      {/* Current Measurement Display */}\r\n      <Card variant=\"inner\" className=\"mb-3 p-2 min-h-[60px] flex items-center justify-center\">\r\n        <Typography variant=\"body\" className=\"text-center\">\r\n          {displayValue || (\r\n            mode === 'distance'\r\n              ? `${t('geo-drawing.labels.distance')}: ${distance.toFixed(2)} m`\r\n              : mode === 'area'\r\n              ? `${t('geo-drawing.labels.area')}: ${area.toFixed(2)} m²`\r\n              : t('geo-drawing.labels.select-point')\r\n          )}\r\n        </Typography>\r\n      </Card>\r\n\r\n      {/* Action Buttons */}\r\n      <Layout direction=\"vertical\" spacing=\"sm\">\r\n        {isDrawing && (\r\n          <Layout direction=\"horizontal\" spacing=\"sm\">\r\n            {canFinish && onFinish && (\r\n              <Button\r\n                variant=\"success\"\r\n                size=\"sm\"\r\n                onClick={onFinish}\r\n                className=\"flex-1\"\r\n              >\r\n                <Icons.Check className=\"w-4 h-4 mr-1\" />\r\n                {t('geo-drawing.actions.finish')}\r\n              </Button>\r\n            )}\r\n\r\n            {onCancel && (\r\n              <Button\r\n                variant=\"secondary\"\r\n                size=\"sm\"\r\n                onClick={onCancel}\r\n                className=\"flex-1\"\r\n              >\r\n                <Icons.X className=\"w-4 h-4 mr-1\" />\r\n                {t('geo-drawing.actions.cancel')}\r\n              </Button>\r\n            )}\r\n          </Layout>\r\n        )}\r\n\r\n        <Button\r\n          variant=\"danger\"\r\n          size=\"sm\"\r\n          onClick={onReset}\r\n          className=\"w-full\"\r\n        >\r\n          <Icons.Trash className=\"w-4 h-4 mr-1\" />\r\n          {t('geo-drawing.actions.clear')}\r\n        </Button>\r\n      </Layout>\r\n\r\n      {/* Instructions */}\r\n      <Card variant=\"inner\" className=\"mt-3 p-2\">\r\n        <Typography variant=\"caption\" className=\"text-center leading-tight\">\r\n          {isDrawing ? (\r\n            <>\r\n              {t('geo-drawing.instructions.click-add')}<br/>\r\n              {mode !== 'point' && (\r\n                <>\r\n                  {t('geo-drawing.instructions.double-click-finish')}<br/>\r\n                </>\r\n              )}\r\n              {t('geo-drawing.instructions.esc-cancel')}\r\n            </>\r\n          ) : (\r\n            t('geo-drawing.instructions.select-mode')\r\n          )}\r\n        </Typography>\r\n      </Card>\r\n    </Card>\r\n  );\r\n};","import React, { useCallback, useEffect } from 'react';\r\nimport { Polygon, Polyline, CircleMarker, useMapEvents } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport { useTheme } from '@layera/theme-switcher';\r\nimport { useMeasurement } from '../hooks/useMeasurement';\r\nimport { useGeometrySnap } from '../hooks/useGeometrySnap';\r\nimport type { MeasurementMode, CanvasInteractionEvent } from '../types';\r\n\r\ninterface MeasurementCanvasProps {\r\n  mode: MeasurementMode;\r\n  enableSnapping?: boolean;\r\n  onMeasurementChange?: (result: any) => void;\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * Interactive measurement canvas component\r\n * Ενσωματώνει το measurement logic με snap-to-geometry functionality\r\n */\r\nexport const MeasurementCanvas: React.FC<MeasurementCanvasProps> = ({\r\n  mode,\r\n  enableSnapping = true,\r\n  onMeasurementChange,\r\n  className\r\n}) => {\r\n  const { theme } = useTheme();\r\n  const {\r\n    points,\r\n    state,\r\n    addPoint,\r\n    finishMeasurement,\r\n    cancelMeasurement,\r\n    changeMeasurementMode,\r\n    currentResult\r\n  } = useMeasurement();\r\n\r\n  const {\r\n    getSnappedPoint,\r\n    isSnappingEffective\r\n  } = useGeometrySnap(enableSnapping);\r\n\r\n  // Sync external mode changes\r\n  useEffect(() => {\r\n    changeMeasurementMode(mode);\r\n  }, [mode, changeMeasurementMode]);\r\n\r\n  // Notify parent of measurement changes\r\n  useEffect(() => {\r\n    if (currentResult && onMeasurementChange) {\r\n      onMeasurementChange(currentResult);\r\n    }\r\n  }, [currentResult, onMeasurementChange]);\r\n\r\n  // Handle map interactions\r\n  const mapEvents = useMapEvents({\r\n    click: useCallback((e: L.LeafletMouseEvent) => {\r\n      if (state === 'finished') return;\r\n\r\n      let latlng = e.latlng;\r\n      let snapped = false;\r\n      let snapResult;\r\n\r\n      // Apply snapping if enabled\r\n      if (enableSnapping && isSnappingEffective) {\r\n        const result = getSnappedPoint(e.latlng);\r\n        if (result.isSnapped && result.snappedLatLng) {\r\n          latlng = result.snappedLatLng;\r\n          snapped = true;\r\n          snapResult = {\r\n            snapPoint: result.snapPoint!,\r\n            snapType: result.snapType as 'vertex' | 'edge'\r\n          };\r\n        }\r\n      }\r\n\r\n      // Create interaction event\r\n      const interactionEvent: CanvasInteractionEvent = {\r\n        type: 'click',\r\n        latlng,\r\n        originalEvent: e.originalEvent,\r\n        snapped,\r\n        snapResult\r\n      };\r\n\r\n      addPoint(latlng);\r\n    }, [state, enableSnapping, isSnappingEffective, getSnappedPoint, addPoint]),\r\n\r\n    dblclick: useCallback((e: L.LeafletMouseEvent) => {\r\n      e.originalEvent.preventDefault();\r\n      e.originalEvent.stopPropagation();\r\n\r\n      if (state === 'drawing' && mode !== 'point') {\r\n        finishMeasurement();\r\n      }\r\n    }, [state, mode, finishMeasurement]),\r\n\r\n    keydown: useCallback((e: L.LeafletKeyboardEvent) => {\r\n      if (e.originalEvent.key === 'Escape' && state === 'drawing') {\r\n        cancelMeasurement();\r\n      }\r\n    }, [state, cancelMeasurement])\r\n  });\r\n\r\n  // Get theme-aware colors\r\n  const getColors = useCallback(() => {\r\n    const isDark = theme === 'dark';\r\n    return {\r\n      line: isDark ? '#60a5fa' : '#3b82f6',\r\n      fill: isDark ? 'rgba(96, 165, 250, 0.2)' : 'rgba(59, 130, 246, 0.2)',\r\n      point: isDark ? '#f59e0b' : '#d97706',\r\n      pointBorder: isDark ? '#1f2937' : '#ffffff'\r\n    };\r\n  }, [theme]);\r\n\r\n  const colors = getColors();\r\n\r\n  // Render measurement geometry\r\n  const renderGeometry = () => {\r\n    if (points.length === 0) return null;\r\n\r\n    const latlngs = points.map(p => p.latlng);\r\n\r\n    return (\r\n      <>\r\n        {/* Render points */}\r\n        {points.map((point, index) => (\r\n          <CircleMarker\r\n            key={point.id}\r\n            center={point.latlng}\r\n            radius={6}\r\n            pathOptions={{\r\n              color: colors.pointBorder,\r\n              fillColor: colors.point,\r\n              fillOpacity: 1,\r\n              weight: 2\r\n            }}\r\n          />\r\n        ))}\r\n\r\n        {/* Render lines for distance mode or area outline */}\r\n        {((mode === 'distance' || mode === 'area') && latlngs.length >= 2) && (\r\n          <Polyline\r\n            positions={latlngs}\r\n            pathOptions={{\r\n              color: colors.line,\r\n              weight: 3,\r\n              opacity: 0.8,\r\n              dashArray: state === 'drawing' ? '5, 5' : undefined\r\n            }}\r\n          />\r\n        )}\r\n\r\n        {/* Render polygon fill for area mode */}\r\n        {(mode === 'area' && latlngs.length >= 3 && state === 'finished') && (\r\n          <Polygon\r\n            positions={latlngs}\r\n            pathOptions={{\r\n              color: colors.line,\r\n              fillColor: colors.fill,\r\n              fillOpacity: 0.3,\r\n              weight: 2\r\n            }}\r\n          />\r\n        )}\r\n      </>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className={className}>\r\n      {renderGeometry()}\r\n    </div>\r\n  );\r\n};","import React, { useMemo } from 'react';\nimport { Polygon, Polyline, CircleMarker, Popup } from 'react-leaflet';\nimport L from 'leaflet';\nimport { useTheme } from '@layera/theme-switcher';\nimport { Typography } from '@layera/typography';\nimport { useTranslation } from 'react-i18next';\nimport type { MeasurementResult, OSMBuildingFeature } from '../types';\nimport { extractOSMGeometry } from '../utils/geometry';\nimport { useMeasurementFormatter } from '../utils/formatters';\n\ninterface GeometryRendererProps {\n  measurements?: MeasurementResult[];\n  osmFeatures?: OSMBuildingFeature[];\n  showOSMBuildings?: boolean;\n  showMeasurements?: boolean;\n  onMeasurementClick?: (measurement: MeasurementResult) => void;\n  onBuildingClick?: (feature: OSMBuildingFeature) => void;\n}\n\n/**\n * Renders various geometric elements on the map\n * Υποστηρίζει measurement results και OSM building outlines\n */\nexport const GeometryRenderer: React.FC<GeometryRendererProps> = ({\n  measurements = [],\n  osmFeatures = [],\n  showOSMBuildings = true,\n  showMeasurements = true,\n  onMeasurementClick,\n  onBuildingClick\n}) => {\n  const { theme } = useTheme();\n  const { t } = useTranslation();\n  const { formatDistanceWithLabels, formatAreaWithLabels } = useMeasurementFormatter();\n\n  // Get theme-aware colors\n  const colors = useMemo(() => {\n    const isDark = theme === 'dark';\n    return {\n      // Measurement colors\n      measurementLine: isDark ? '#10b981' : '#059669',\n      measurementFill: isDark ? 'rgba(16, 185, 129, 0.2)' : 'rgba(5, 150, 105, 0.2)',\n      measurementPoint: isDark ? '#f59e0b' : '#d97706',\n\n      // OSM building colors\n      buildingLine: isDark ? '#6b7280' : '#9ca3af',\n      buildingFill: isDark ? 'rgba(107, 114, 128, 0.1)' : 'rgba(156, 163, 175, 0.1)',\n      buildingHover: isDark ? '#374151' : '#d1d5db',\n\n      // Border colors\n      border: isDark ? '#1f2937' : '#ffffff'\n    };\n  }, [theme]);\n\n  // Render OSM building outlines\n  const renderOSMBuildings = () => {\n    if (!showOSMBuildings || osmFeatures.length === 0) return null;\n\n    return osmFeatures.map((feature, index) => {\n      const polygons = extractOSMGeometry(feature);\n\n      return polygons.map((polygon, polygonIndex) => {\n        const key = `building-${index}-${polygonIndex}`;\n\n        return (\n          <Polygon\n            key={key}\n            positions={polygon}\n            pathOptions={{\n              color: colors.buildingLine,\n              fillColor: colors.buildingFill,\n              fillOpacity: 0.1,\n              weight: 1,\n              opacity: 0.6\n            }}\n            eventHandlers={{\n              click: () => onBuildingClick?.(feature),\n              mouseover: (e) => {\n                e.target.setStyle({\n                  fillColor: colors.buildingHover,\n                  fillOpacity: 0.3\n                });\n              },\n              mouseout: (e) => {\n                e.target.setStyle({\n                  fillColor: colors.buildingFill,\n                  fillOpacity: 0.1\n                });\n              }\n            }}\n          >\n            {feature.properties.name && (\n              <Popup>\n                <div>\n                  <Typography variant=\"subtitle\" className=\"font-semibold\">\n                    {feature.properties.name}\n                  </Typography>\n                  {feature.properties.building && (\n                    <Typography variant=\"caption\" className=\"text-gray-600\">\n                      {t('geo-drawing.building-type')}: {feature.properties.building}\n                    </Typography>\n                  )}\n                  {feature.properties['addr:street'] && (\n                    <Typography variant=\"caption\" className=\"text-gray-600\">\n                      {feature.properties['addr:street']} {feature.properties['addr:housenumber']}\n                    </Typography>\n                  )}\n                </div>\n              </Popup>\n            )}\n          </Polygon>\n        );\n      });\n    });\n  };\n\n  // Render measurement results\n  const renderMeasurements = () => {\n    if (!showMeasurements || measurements.length === 0) return null;\n\n    return measurements.map((measurement) => {\n      const latlngs = measurement.points.map(p => p.latlng);\n      const key = `measurement-${measurement.timestamp}`;\n\n      return (\n        <React.Fragment key={key}>\n          {/* Render measurement points */}\n          {measurement.points.map((point, index) => (\n            <CircleMarker\n              key={`${key}-point-${index}`}\n              center={point.latlng}\n              radius={5}\n              pathOptions={{\n                color: colors.border,\n                fillColor: colors.measurementPoint,\n                fillOpacity: 1,\n                weight: 2\n              }}\n              eventHandlers={{\n                click: () => onMeasurementClick?.(measurement)\n              }}\n            >\n              <Popup>\n                <div>\n                  <Typography variant=\"subtitle\" className=\"font-semibold\">\n                    {t('geo-drawing.point-info', { index: index + 1 })}\n                  </Typography>\n                  <Typography variant=\"caption\">\n                    {point.latlng.lat.toFixed(6)}, {point.latlng.lng.toFixed(6)}\n                  </Typography>\n                </div>\n              </Popup>\n            </CircleMarker>\n          ))}\n\n          {/* Render lines for distance/area measurements */}\n          {((measurement.type === 'distance' || measurement.type === 'area') && latlngs.length >= 2) && (\n            <Polyline\n              positions={latlngs}\n              pathOptions={{\n                color: colors.measurementLine,\n                weight: 3,\n                opacity: 0.8\n              }}\n              eventHandlers={{\n                click: () => onMeasurementClick?.(measurement)\n              }}\n            >\n              <Popup>\n                <div>\n                  <Typography variant=\"subtitle\" className=\"font-semibold\">\n                    {t(`geo-drawing.modes.${measurement.type}`)}\n                  </Typography>\n                  <Typography variant=\"body\">\n                    {measurement.displayValue}\n                  </Typography>\n                  <Typography variant=\"caption\" className=\"text-gray-600\">\n                    {new Date(measurement.timestamp).toLocaleString()}\n                  </Typography>\n                </div>\n              </Popup>\n            </Polyline>\n          )}\n\n          {/* Render polygon fill for area measurements */}\n          {(measurement.type === 'area' && latlngs.length >= 3) && (\n            <Polygon\n              positions={latlngs}\n              pathOptions={{\n                color: colors.measurementLine,\n                fillColor: colors.measurementFill,\n                fillOpacity: 0.3,\n                weight: 2\n              }}\n              eventHandlers={{\n                click: () => onMeasurementClick?.(measurement)\n              }}\n            >\n              <Popup>\n                <div>\n                  <Typography variant=\"subtitle\" className=\"font-semibold\">\n                    {t('geo-drawing.area-measurement')}\n                  </Typography>\n                  <Typography variant=\"body\">\n                    {measurement.area && formatAreaWithLabels(measurement.area)}\n                  </Typography>\n                  <Typography variant=\"caption\" className=\"text-gray-600\">\n                    {t('geo-drawing.points-count', { count: measurement.points.length })}\n                  </Typography>\n                </div>\n              </Popup>\n            </Polygon>\n          )}\n        </React.Fragment>\n      );\n    });\n  };\n\n  return (\n    <>\n      {renderOSMBuildings()}\n      {renderMeasurements()}\n    </>\n  );\n};"],"mappings":"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","names":["exports","module","_extends","e","exports","module","import_react","import_react","i18nInstance","import_react","import_react","e","import_react","import_react","import_react","import_react","L","import_react","import_leaflet","L","closestPoint","import_constants","import_react","import_react_leaflet","import_jsx_runtime","e","import_react","import_react_leaflet","import_theme_switcher","import_typography","import_jsx_runtime","e","React"]}