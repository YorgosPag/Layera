{"version":3,"sources":["../src/services/fallbackBoundaries.ts","../src/utils/administrativeHierarchy.ts","../src/services/osmService.ts","../src/index.ts"],"names":["findFallbackBoundary"],"mappings":"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","file":"index.js","sourcesContent":["/**\r\n * @layera/geo-mapping - Fallback Boundaries Configuration\r\n *\r\n * Type-safe configuration Î³Î¹Î± fallback polygons ÏŒÏ„Î±Î½ Ï„Î¿ OSM API Î±Ï€Î¿Ï„Ï…Î³Ï‡Î¬Î½ÎµÎ¹.\r\n * ÎšÎ‘ÎœÎ™Î‘ Ï‡ÏÎ®ÏƒÎ· any - TypeScript strict mode.\r\n */\r\n\r\nimport type { GeoJSONFeatureCollection } from '@layera/geo-core';\r\n\r\n/**\r\n * Fallback boundary configuration\r\n */\r\ninterface FallbackBoundary {\r\n  /** Unique keys Î³Î¹Î± matching (Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ variations) */\r\n  keys: string[];\r\n  /** Display name Î³Î¹Î± Ï„Î¿ boundary */\r\n  name: string;\r\n  /** Admin level Î±Ï€ÏŒ OSM */\r\n  adminLevel: string;\r\n  /** Polygon coordinates [lng, lat][] */\r\n  coordinates: number[][];\r\n}\r\n\r\n/**\r\n * Type-safe fallback boundaries registry\r\n *\r\n * Î£Î—ÎœÎ•Î™Î©Î£Î—: Î‘Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î® Î»ÏÏƒÎ·. Î¤Î¿ ÏƒÏ‰ÏƒÏ„ÏŒ ÎµÎ¯Î½Î±Î¹ Î½Î± Î´Î¹Î¿ÏÎ¸Ï‰Î¸ÎµÎ¯\r\n * Ï„Î¿ OSM API integration Î³Î¹Î± ÎºÎ±Î¸Î¿Î»Î¹ÎºÎ® Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· Ï€ÎµÏÎ¹Î¿Ï‡ÏÎ½.\r\n *\r\n * ÎœÎ­Ï‡ÏÎ¹ Ï„ÏŒÏ„Îµ, Ï€ÏÎ¿ÏƒÎ¸Î­Ï„Î¿Ï…Î¼Îµ Î¼ÏŒÎ½Î¿ critical Ï€ÎµÏÎ¹Î¿Ï‡Î­Ï‚ ÎµÎ´Ï.\r\n */\r\nconst FALLBACK_BOUNDARIES: FallbackBoundary[] = [\r\n  // Î˜ÎµÏƒÏƒÎ±Î»Î¿Î½Î¯ÎºÎ· - ÎšÎ­Î½Ï„ÏÎ¿\r\n  {\r\n    keys: ['Î˜ÎµÏƒÏƒÎ±Î»Î¿Î½Î¯ÎºÎ·Ï‚', 'Thessaloniki', 'Î˜ÎµÏƒÏƒÎ±Î»Î¿Î½Î¯ÎºÎ·'],\r\n    name: 'Î”Î®Î¼Î¿Ï‚ Î˜ÎµÏƒÏƒÎ±Î»Î¿Î½Î¯ÎºÎ·Ï‚',\r\n    adminLevel: '8',\r\n    coordinates: [\r\n      // Simplified boundary Î³Î¹Î± demo - ÏƒÏ„Î·Î½ Ï€ÏÎ¬Î¾Î· Î¸Î± Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Ï€Î»Î®ÏÎµÏ‚ polygon\r\n      [22.9352, 40.6401], [22.9600, 40.6401], [22.9600, 40.6250],\r\n      [22.9352, 40.6250], [22.9352, 40.6401]\r\n    ]\r\n  },\r\n\r\n  // ÎœÎ±ÎºÎµÎ´Î¿Î½Î¯Î± regions\r\n  {\r\n    keys: ['ÎšÎµÎ½Ï„ÏÎ¹ÎºÎ®Ï‚ ÎœÎ±ÎºÎµÎ´Î¿Î½Î¯Î±Ï‚', 'Central Macedonia', 'ÎšÎµÎ½Ï„ÏÎ¹ÎºÎ® ÎœÎ±ÎºÎµÎ´Î¿Î½Î¯Î±'],\r\n    name: 'Î ÎµÏÎ¹Ï†Î­ÏÎµÎ¹Î± ÎšÎµÎ½Ï„ÏÎ¹ÎºÎ®Ï‚ ÎœÎ±ÎºÎµÎ´Î¿Î½Î¯Î±Ï‚',\r\n    adminLevel: '4',\r\n    coordinates: [\r\n      // Simplified boundary Î³Î¹Î± demo\r\n      [22.0, 41.5], [24.5, 41.5], [24.5, 40.0],\r\n      [22.0, 40.0], [22.0, 41.5]\r\n    ]\r\n  },\r\n\r\n  // Î‘Î¼Ï€ÎµÎ»ÏŒÎºÎ·Ï€Î¿Î¹ (existing)\r\n  {\r\n    keys: ['Î‘Î¼Ï€ÎµÎ»Î¿ÎºÎ®Ï€Ï‰Î½', 'Ampelokipon', 'ĞĞ¼Ğ¿ĞµĞ»Ğ¾ĞºĞ¸Ğ¿Ğ¾Ğ½', 'Î‘Î¼Ï€ÎµÎ»ÏŒÎºÎ·Ï€Î¿Î¹'],\r\n    name: 'Î”Î·Î¼Î¿Ï„Î¹ÎºÎ® Î•Î½ÏŒÏ„Î·Ï„Î± Î‘Î¼Ï€ÎµÎ»Î¿ÎºÎ®Ï€Ï‰Î½',\r\n    adminLevel: '8',\r\n    coordinates: [\r\n      [22.9166013, 40.6545235], [22.916378, 40.6548432], [22.9161263, 40.654913],\r\n      [22.9159367, 40.6551479], [22.9157414, 40.6553883], [22.9155318, 40.655694],\r\n      [22.9155987, 40.6558613], [22.9154793, 40.6562918], [22.915702, 40.6565594],\r\n      [22.9150123, 40.6571562], [22.914356, 40.6575815], [22.9141897, 40.6577716],\r\n      [22.913965, 40.6580476], [22.9137682, 40.6584715], [22.9130735, 40.6595013],\r\n      [22.9146819, 40.6606645], [22.9195995, 40.6611276], [22.922064, 40.6603006],\r\n      [22.9243559, 40.6589395], [22.928998, 40.6570252], [22.9316767, 40.6565356],\r\n      [22.934234, 40.6567998], [22.9345673, 40.6568327], [22.9344419, 40.6563954],\r\n      [22.9345299, 40.6555972], [22.9346904, 40.654914], [22.9352047, 40.6527174],\r\n      [22.9342228, 40.6523744], [22.9341515, 40.651373], [22.9341167, 40.6510887],\r\n      [22.9340592, 40.6505896], [22.9339901, 40.6498829], [22.9340715, 40.6493217],\r\n      [22.9339464, 40.6484215], [22.9326998, 40.6484637], [22.931444, 40.6490899],\r\n      [22.9313272, 40.6491772], [22.9303401, 40.6495824], [22.929558, 40.6496515],\r\n      [22.9280302, 40.6497943], [22.9267611, 40.6494903], [22.9256199, 40.6492281],\r\n      [22.9243866, 40.6489393], [22.9239727, 40.6488403], [22.9195478, 40.6508989],\r\n      [22.919069, 40.6511528], [22.9186956, 40.651313], [22.9184825, 40.6514636],\r\n      [22.9183194, 40.6516322], [22.9181684, 40.6518332], [22.9180779, 40.6520084],\r\n      [22.9180263, 40.6522166], [22.9179568, 40.6523848], [22.9178432, 40.6525894],\r\n      [22.9171589, 40.6536558], [22.9166013, 40.6545235]\r\n    ]\r\n  }\r\n];\r\n\r\n/**\r\n * Î’ÏÎ¯ÏƒÎºÎµÎ¹ fallback boundary Î¼Îµ Î²Î¬ÏƒÎ· search terms\r\n */\r\nexport const findFallbackBoundary = (\r\n  searchTerms: string[]\r\n): GeoJSONFeatureCollection | null => {\r\n  // Normalize search terms\r\n  const normalizedSearchTerms = searchTerms\r\n    .filter(term => term && typeof term === 'string')\r\n    .map(term => term.toLowerCase().trim());\r\n\r\n  // Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î³Î¹Î± matching boundary\r\n  for (const boundary of FALLBACK_BOUNDARIES) {\r\n    const matches = boundary.keys.some(key => {\r\n      const normalizedKey = key.toLowerCase();\r\n      return normalizedSearchTerms.some(searchTerm =>\r\n        searchTerm.includes(normalizedKey) || normalizedKey.includes(searchTerm)\r\n      );\r\n    });\r\n\r\n    if (matches) {\r\n      console.log(`âœ… Fallback boundary found Î³Î¹Î±: ${boundary.name}`);\r\n      return {\r\n        type: 'FeatureCollection',\r\n        features: [{\r\n          type: 'Feature',\r\n          properties: {\r\n            name: boundary.name,\r\n            admin_level: boundary.adminLevel,\r\n            boundary: 'administrative'\r\n          },\r\n          geometry: {\r\n            type: 'Polygon',\r\n            coordinates: [boundary.coordinates]\r\n          }\r\n        }]\r\n      };\r\n    }\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\n/**\r\n * Î ÏÎ¿ÏƒÎ¸Î­Ï„ÎµÎ¹ Î½Î­Î¿ fallback boundary\r\n */\r\nexport const addFallbackBoundary = (boundary: FallbackBoundary): void => {\r\n  // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î³Î¹Î± duplicates\r\n  const exists = FALLBACK_BOUNDARIES.some(b =>\r\n    b.keys.some(key => boundary.keys.includes(key))\r\n  );\r\n\r\n  if (!exists) {\r\n    FALLBACK_BOUNDARIES.push(boundary);\r\n    console.log(`ğŸ“ Added fallback boundary: ${boundary.name}`);\r\n  }\r\n};\r\n\r\n/**\r\n * Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ ÏŒÎ»Î± Ï„Î± Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± fallback boundaries\r\n */\r\nexport const getAllFallbackBoundaries = (): readonly FallbackBoundary[] => {\r\n  return FALLBACK_BOUNDARIES;\r\n};\r\n\r\n/**\r\n * ÎšÎ±Î¸Î±ÏÎ¯Î¶ÎµÎ¹ ÏŒÎ»Î± Ï„Î± fallback boundaries (Î³Î¹Î± testing)\r\n */\r\nexport const clearFallbackBoundaries = (): void => {\r\n  FALLBACK_BOUNDARIES.length = 0;\r\n};","/**\r\n * Administrative Hierarchy Utils - Î”Î¹Î¿Î¹ÎºÎ·Ï„Î¹ÎºÎ® Î™ÎµÏÎ±ÏÏ‡Î¯Î±\r\n *\r\n * ÎšÎ±Î¸Î¿Î»Î¹ÎºÏŒ ÏƒÏÏƒÏ„Î·Î¼Î± ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚ Î´Î¹Î¿Î¹ÎºÎ·Ï„Î¹ÎºÏÎ½ Î´Î¹Î±Î¹ÏÎ­ÏƒÎµÏ‰Î½ Î¼Îµ:\r\n * - Î™ÎµÏÎ±ÏÏ‡Î¹ÎºÎ® Ï„Î±Î¾Î¹Î½ÏŒÎ¼Î·ÏƒÎ· Î±Ï€ÏŒ Î¼Î¹ÎºÏÏŒ Ï€ÏÎ¿Ï‚ Î¼ÎµÎ³Î¬Î»Î¿\r\n * - ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒ Î´Î¹Ï€Î»ÏŒÏ„Ï…Ï€Ï‰Î½\r\n * - Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· Ï€Î¿Î»Î»Î±Ï€Î»ÏÎ½ Ï‡Ï‰ÏÏÎ½ (Î•Î»Î»Î¬Î´Î±, Î¼ÎµÎ»Î»Î¿Î½Ï„Î¹ÎºÎ¬ Î’Î¿Ï…Î»Î³Î±ÏÎ¯Î± Îº.Î±.)\r\n */\r\n\r\n/**\r\n * Î¤ÏÏ€Î¿Î¹ Î´Î¹Î¿Î¹ÎºÎ·Ï„Î¹ÎºÏÎ½ ÎµÏ€Î¹Ï€Î­Î´Ï‰Î½ Î³Î¹Î± Î•Î»Î»Î¬Î´Î±\r\n */\r\nexport enum GreekAdministrativeLevel {\r\n  STREET = 1,           // ÎŸÎ´ÏŒÏ‚/Î›ÎµÏ‰Ï†ÏŒÏÎ¿Ï‚ + Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ + Î¤.Îš.\r\n  COMMUNITY = 2,        // ÎšÎ¿Î¹Î½ÏŒÏ„Î·Ï„Î±\r\n  NEIGHBORHOOD = 3,     // Î£Ï…Î½Î¿Î¹ÎºÎ¯Î±/Î“ÎµÎ¹Ï„Î¿Î½Î¹Î¬\r\n  VILLAGE = 4,          // Î§Ï‰ÏÎ¹ÏŒ/ÎšÏ‰Î¼ÏŒÏ€Î¿Î»Î·\r\n  MUNICIPAL_UNIT = 5,   // Î”Î·Î¼Î¿Ï„Î¹ÎºÎ® Î•Î½ÏŒÏ„Î·Ï„Î±\r\n  MUNICIPALITY = 6,     // Î”Î®Î¼Î¿Ï‚\r\n  METROPOLITAN = 7,     // ÎœÎ·Ï„ÏÎ¿Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® Î•Î½ÏŒÏ„Î·Ï„Î±\r\n  PREFECTURE = 8,       // ÎÎ¿Î¼ÏŒÏ‚\r\n  REGION = 9,           // Î ÎµÏÎ¹Ï†Î­ÏÎµÎ¹Î±\r\n  DECENTRALIZED = 10,   // Î‘Ï€Î¿ÎºÎµÎ½Ï„ÏÏ‰Î¼Î­Î½Î· Î”Î¹Î¿Î¯ÎºÎ·ÏƒÎ·\r\n  COUNTRY = 11          // Î§ÏÏÎ±\r\n}\r\n\r\n/**\r\n * Patterns Î³Î¹Î± Î±Î½Î±Î³Î½ÏÏÎ¹ÏƒÎ· ÎµÎ»Î»Î·Î½Î¹ÎºÏÎ½ Î´Î¹Î¿Î¹ÎºÎ·Ï„Î¹ÎºÏÎ½ Ï„ÏÏ€Ï‰Î½\r\n */\r\nconst GREEK_PATTERNS = {\r\n  [GreekAdministrativeLevel.STREET]: [\r\n    /^.*?\\s*\\d+/, // ÎŸÎ´ÏŒÏ‚ Î¼Îµ Î±ÏÎ¹Î¸Î¼ÏŒ\r\n    /Î¿Î´ÏŒÏ‚|Î»ÎµÏ‰Ï†ÏŒÏÎ¿Ï‚|Ï€Î»Î±Ï„ÎµÎ¯Î±|Î±Î³Î¯Î¿Ï…|Î±Î³Î¯Î±Ï‚/i\r\n  ],\r\n  [GreekAdministrativeLevel.COMMUNITY]: [\r\n    /ÎºÎ¿Î¹Î½ÏŒÏ„Î·Ï„Î±|community/i\r\n  ],\r\n  [GreekAdministrativeLevel.NEIGHBORHOOD]: [\r\n    /ÏƒÏ…Î½Î¿Î¹ÎºÎ¯Î±|Î³ÎµÎ¹Ï„Î¿Î½Î¹Î¬|Ï€ÎµÏÎ¹Î¿Ï‡Î®/i\r\n  ],\r\n  [GreekAdministrativeLevel.VILLAGE]: [\r\n    /Ï‡Ï‰ÏÎ¹ÏŒ|ÎºÏ‰Î¼ÏŒÏ€Î¿Î»Î·|Î¿Î¹ÎºÎ¹ÏƒÎ¼ÏŒÏ‚/i\r\n  ],\r\n  [GreekAdministrativeLevel.MUNICIPAL_UNIT]: [\r\n    /Î´Î·Î¼Î¿Ï„Î¹ÎºÎ®\\s+ÎµÎ½ÏŒÏ„Î·Ï„Î±|municipal\\s+unit/i\r\n  ],\r\n  [GreekAdministrativeLevel.MUNICIPALITY]: [\r\n    /^Î´Î®Î¼Î¿Ï‚\\s+|municipality\\s+of/i\r\n  ],\r\n  [GreekAdministrativeLevel.METROPOLITAN]: [\r\n    /Î¼Î·Ï„ÏÎ¿Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®\\s+ÎµÎ½ÏŒÏ„Î·Ï„Î±|metropolitan/i\r\n  ],\r\n  [GreekAdministrativeLevel.PREFECTURE]: [\r\n    /Î½Î¿Î¼ÏŒÏ‚|Î½Î¿Î¼Î±ÏÏ‡Î¯Î±|prefecture/i\r\n  ],\r\n  [GreekAdministrativeLevel.REGION]: [\r\n    /Ï€ÎµÏÎ¹Ï†Î­ÏÎµÎ¹Î±|region/i\r\n  ],\r\n  [GreekAdministrativeLevel.DECENTRALIZED]: [\r\n    /Î±Ï€Î¿ÎºÎµÎ½Ï„ÏÏ‰Î¼Î­Î½Î·\\s+Î´Î¹Î¿Î¯ÎºÎ·ÏƒÎ·|decentralized/i\r\n  ],\r\n  [GreekAdministrativeLevel.COUNTRY]: [\r\n    /ÎµÎ»Î»Î¬Î´Î±|greece/i\r\n  ]\r\n};\r\n\r\n/**\r\n * Î‘Î½Î±Î³Î½ÏÏÎ¹ÏƒÎ· ÎµÏ€Î¹Ï€Î­Î´Î¿Ï… Î´Î¹Î¿Î¹ÎºÎ·Ï„Î¹ÎºÎ®Ï‚ Î´Î¹Î±Î¯ÏÎµÏƒÎ·Ï‚\r\n */\r\nexport function getAdministrativeLevel(text: string): GreekAdministrativeLevel {\r\n  const cleanText = text.trim();\r\n\r\n  // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î³Î¹Î± ÎºÎ¬Î¸Îµ ÎµÏ€Î¯Ï€ÎµÎ´Î¿ Î¼Îµ Ï„Î± patterns\r\n  for (const [level, patterns] of Object.entries(GREEK_PATTERNS)) {\r\n    for (const pattern of patterns) {\r\n      if (pattern.test(cleanText)) {\r\n        return parseInt(level) as GreekAdministrativeLevel;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Default: Î±Î½ Î´ÎµÎ½ Î±Î½Î±Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Î±Î¹, Î¸ÎµÏ‰ÏÎ¿ÏÎ¼Îµ ÏŒÏ„Î¹ ÎµÎ¯Î½Î±Î¹ Ï€ÏŒÎ»Î·/Ï€ÎµÏÎ¹Î¿Ï‡Î®\r\n  return GreekAdministrativeLevel.NEIGHBORHOOD;\r\n}\r\n\r\n/**\r\n * ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î´Î¹Ï€Î»ÏŒÏ„Ï…Ï€Ï‰Î½ ÎºÎ±Î¹ Ï€Î±ÏÏŒÎ¼Î¿Î¹Ï‰Î½ Î¿Î½Î¿Î¼Î¬Ï„Ï‰Î½\r\n */\r\nexport function removeDuplicates(items: string[]): string[] {\r\n  const cleaned: string[] = [];\r\n  const seen = new Set<string>();\r\n\r\n  for (const item of items) {\r\n    const normalized = normalizeText(item);\r\n\r\n    // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î³Î¹Î± exact match\r\n    if (seen.has(normalized)) {\r\n      continue;\r\n    }\r\n\r\n    // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î³Î¹Î± Ï€Î±ÏÏŒÎ¼Î¿Î¹Î± Î¿Î½ÏŒÎ¼Î±Ï„Î± (substring)\r\n    const isDuplicate = Array.from(seen).some(existing => {\r\n      return areTextsSimilar(normalized, existing);\r\n    });\r\n\r\n    if (!isDuplicate) {\r\n      seen.add(normalized);\r\n      cleaned.push(item);\r\n    }\r\n  }\r\n\r\n  return cleaned;\r\n}\r\n\r\n/**\r\n * ÎšÎ±Î½Î¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… Î³Î¹Î± ÏƒÏÎ³ÎºÏÎ¹ÏƒÎ·\r\n */\r\nfunction normalizeText(text: string): string {\r\n  return text\r\n    .toLowerCase()\r\n    .replace(/^(Î´Î®Î¼Î¿Ï‚|Î´Î·Î¼Î¿Ï„Î¹ÎºÎ®\\s+ÎµÎ½ÏŒÏ„Î·Ï„Î±|Ï€ÎµÏÎ¹Ï†Î­ÏÎµÎ¹Î±|Î½Î¿Î¼ÏŒÏ‚)\\s+/i, '')\r\n    .replace(/\\s*-\\s*/g, '-')\r\n    .replace(/\\s+/g, ' ')\r\n    .trim();\r\n}\r\n\r\n/**\r\n * ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Î´ÏÎ¿ ÎºÎµÎ¯Î¼ÎµÎ½Î± ÎµÎ¯Î½Î±Î¹ Ï€Î±ÏÏŒÎ¼Î¿Î¹Î± (Î³Î¹Î± Î´Î¹Ï€Î»ÏŒÏ„Ï…Ï€Î±)\r\n * Î•Î™Î”Î™ÎšÎŸÎ£ Î•Î›Î•Î“Î§ÎŸÎ£: \"Î•Î»ÎµÏ…Î¸Î­ÏÎ¹Î¿\" vs \"Î•Î»ÎµÏ…Î¸Î­ÏÎ¹Î¿-ÎšÎ¿ÏÎ´ÎµÎ»Î¹ÏŒ\"\r\n */\r\nfunction areTextsSimilar(text1: string, text2: string): boolean {\r\n  // Exact match\r\n  if (text1 === text2) return true;\r\n\r\n  // Î•Î™Î”Î™ÎšÎŸÎ£ ÎšÎ‘ÎÎŸÎÎ‘Î£: Î‘Î½ Î­Î½Î± ÎºÎµÎ¯Î¼ÎµÎ½Î¿ ÎµÎ¯Î½Î±Î¹ substring Ï„Î¿Ï… Î¬Î»Î»Î¿Ï… ÎšÎ‘Î™ ÎµÎ¯Î½Î±Î¹ Î¼Î¹ÎºÏÏŒÏ„ÎµÏÎ¿ Î±Ï€ÏŒ 50% Ï„Î¿Ï… Î¬Î»Î»Î¿Ï…, Î”Î•Î ÎµÎ¯Î½Î±Î¹ Î´Î¹Ï€Î»ÏŒÏ„Ï…Ï€Î¿\r\n  if (text1.includes(text2)) {\r\n    const ratio = text2.length / text1.length;\r\n    if (ratio < 0.6) return true; // Î¤Î¿ Î¼Î¹ÎºÏÏŒÏ„ÎµÏÎ¿ ÎµÎ¯Î½Î±Î¹ Î´Î¹Ï€Î»ÏŒÏ„Ï…Ï€Î¿\r\n  }\r\n  if (text2.includes(text1)) {\r\n    const ratio = text1.length / text2.length;\r\n    if (ratio < 0.6) return true; // Î¤Î¿ Î¼Î¹ÎºÏÏŒÏ„ÎµÏÎ¿ ÎµÎ¯Î½Î±Î¹ Î´Î¹Ï€Î»ÏŒÏ„Ï…Ï€Î¿\r\n  }\r\n\r\n  // Î Î±ÏÏŒÎ¼Î¿Î¹Î± Î¿Î½ÏŒÎ¼Î±Ï„Î± Î¼Îµ Î¼Î¹ÎºÏÎ­Ï‚ Î´Î¹Î±Ï†Î¿ÏÎ­Ï‚\r\n  const similarity = calculateSimilarity(text1, text2);\r\n  return similarity > 0.85; // 85% similarity threshold\r\n}\r\n\r\n/**\r\n * Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î¿Î¼Î¿Î¹ÏŒÏ„Î·Ï„Î±Ï‚ ÎºÎµÎ¹Î¼Î­Î½Ï‰Î½ (Levenshtein distance)\r\n */\r\nfunction calculateSimilarity(str1: string, str2: string): number {\r\n  const longer = str1.length > str2.length ? str1 : str2;\r\n  const shorter = str1.length > str2.length ? str2 : str1;\r\n\r\n  if (longer.length === 0) return 1;\r\n\r\n  const distance = levenshteinDistance(longer, shorter);\r\n  return (longer.length - distance) / longer.length;\r\n}\r\n\r\n/**\r\n * Levenshtein distance algorithm\r\n */\r\nfunction levenshteinDistance(str1: string, str2: string): number {\r\n  const matrix = Array(str2.length + 1).fill(null).map(() => Array(str1.length + 1).fill(null));\r\n\r\n  for (let i = 0; i <= str1.length; i++) matrix[0][i] = i;\r\n  for (let j = 0; j <= str2.length; j++) matrix[j][0] = j;\r\n\r\n  for (let j = 1; j <= str2.length; j++) {\r\n    for (let i = 1; i <= str1.length; i++) {\r\n      const cost = str1[i - 1] === str2[j - 1] ? 0 : 1;\r\n      matrix[j][i] = Math.min(\r\n        matrix[j][i - 1] + 1,     // deletion\r\n        matrix[j - 1][i] + 1,     // insertion\r\n        matrix[j - 1][i - 1] + cost // substitution\r\n      );\r\n    }\r\n  }\r\n\r\n  return matrix[str2.length][str1.length];\r\n}\r\n\r\n/**\r\n * ÎšÎ¥Î¡Î™Î‘ FUNCTION: Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± display_name ÏƒÎµ Î¹ÎµÏÎ±ÏÏ‡Î¹ÎºÎ® Î´Î¿Î¼Î®\r\n * Î Î±Î¯ÏÎ½ÎµÎ¹ Ï„Î¿ raw display_name Î±Ï€ÏŒ OSM ÎºÎ±Î¹ Ï„Î¿ ÎºÎ¬Î½ÎµÎ¹ ÎºÎ±Î¸Î±ÏÏŒ ÎºÎ±Î¹ Ï„Î±Î¾Î¹Î½Î¿Î¼Î·Î¼Î­Î½Î¿\r\n * Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ ÎºÎ¬Î¸Îµ Î´Î¹Î¿Î¹ÎºÎ·Ï„Î¹ÎºÎ® Î´Î¹Î±Î¯ÏÎµÏƒÎ· ÏƒÎµ Î¾ÎµÏ‡Ï‰ÏÎ¹ÏƒÏ„Î® Î³ÏÎ±Î¼Î¼Î®\r\n */\r\nexport function processDisplayNameToHierarchy(displayName: string): string {\r\n  console.log('ğŸ”„ Processing display name for hierarchy:', displayName);\r\n\r\n  // Split by comma ÎºÎ±Î¹ ÎºÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚\r\n  const parts = displayName\r\n    .split(',')\r\n    .map(part => part.trim())\r\n    .filter(part => part.length > 0);\r\n\r\n  console.log('ğŸ“ Initial parts:', parts);\r\n\r\n  // Î•Î™Î”Î™ÎšÎ— Î›ÎŸÎ“Î™ÎšÎ—: Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î¿Î´Î¿Ï Î¼Îµ Î±ÏÎ¹Î¸Î¼ÏŒ ÎºÎ±Î¹ Î¤.Îš.\r\n  let streetWithNumberAndPostal = '';\r\n  const nonStreetParts: string[] = [];\r\n  let postalCode = '';\r\n\r\n  // Î’ÏÎµÏ‚ postal code\r\n  const postalIndex = parts.findIndex(part => /^\\d{3,5}(-\\d{4})?$/.test(part));\r\n  if (postalIndex !== -1) {\r\n    postalCode = parts[postalIndex];\r\n  }\r\n\r\n  // Î’ÏÎµÏ‚ Î¿Î´ÏŒ Î¼Îµ Î±ÏÎ¹Î¸Î¼ÏŒ (Ï€ÏÏÏ„Î¿ part Ï€Î¿Ï… Î­Ï‡ÎµÎ¹ Î±ÏÎ¹Î¸Î¼ÏŒ)\r\n  const streetIndex = parts.findIndex(part => /^.*?\\s*\\d+/.test(part));\r\n  if (streetIndex !== -1) {\r\n    streetWithNumberAndPostal = postalCode\r\n      ? `${parts[streetIndex]}, ${postalCode}`\r\n      : parts[streetIndex];\r\n  }\r\n\r\n  // ÎœÎ¬Î¶ÎµÏˆÎµ ÏŒÎ»Î± Ï„Î± Î¬Î»Î»Î± parts (ÎµÎºÏ„ÏŒÏ‚ Î±Ï€ÏŒ Î¿Î´ÏŒ ÎºÎ±Î¹ postal code)\r\n  for (let i = 0; i < parts.length; i++) {\r\n    const part = parts[i];\r\n\r\n    // Skip postal codes\r\n    if (/^\\d{3,5}(-\\d{4})?$/.test(part)) continue;\r\n    // Skip pure numbers\r\n    if (/^\\d+$/.test(part)) continue;\r\n    // Skip Ï„Î·Î½ Î¿Î´ÏŒ Ï€Î¿Ï… Î®Î´Î· Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎ±Î¼Îµ\r\n    if (i === streetIndex) continue;\r\n\r\n    nonStreetParts.push(part);\r\n  }\r\n\r\n  console.log('ğŸ›£ï¸ Street with number and postal:', streetWithNumberAndPostal);\r\n  console.log('ğŸ§¹ Non-street parts:', nonStreetParts);\r\n\r\n  // Î‘Ï†Î±Î¯ÏÎµÏƒÎ· Î´Î¹Ï€Î»ÏŒÏ„Ï…Ï€Ï‰Î½ Î±Ï€ÏŒ Ï„Î± non-street parts\r\n  const uniqueNonStreetParts = removeDuplicates(nonStreetParts);\r\n  console.log('âœ¨ Unique non-street parts:', uniqueNonStreetParts);\r\n\r\n  // Î¤Î±Î¾Î¹Î½ÏŒÎ¼Î·ÏƒÎ· ÎºÎ±Ï„Î¬ Î¹ÎµÏÎ±ÏÏ‡Î¹ÎºÏŒ ÎµÏ€Î¯Ï€ÎµÎ´Î¿ (Î¼Î¹ÎºÏÏŒ Ï€ÏÎ¿Ï‚ Î¼ÎµÎ³Î¬Î»Î¿)\r\n  const hierarchicalParts = uniqueNonStreetParts\r\n    .map(part => ({\r\n      text: part,\r\n      level: getAdministrativeLevel(part)\r\n    }))\r\n    .sort((a, b) => a.level - b.level)\r\n    .map(item => item.text);\r\n\r\n  console.log('ğŸ›ï¸ Hierarchically sorted non-street parts:', hierarchicalParts);\r\n\r\n  // Î£Î¥ÎÎŸÎ›Î™ÎšÎ— Î™Î•Î¡Î‘Î¡Î§Î™Î‘: ÎŸÎ´ÏŒÏ‚ Ï€ÏÏÏ„Î±, Î¼ÎµÏ„Î¬ Ï„Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î±\r\n  const finalParts = [];\r\n  if (streetWithNumberAndPostal) {\r\n    finalParts.push(streetWithNumberAndPostal);\r\n  }\r\n  finalParts.push(...hierarchicalParts);\r\n\r\n  // ÎšÎ‘Î˜Î• Î”Î™ÎŸÎ™ÎšÎ—Î¤Î™ÎšÎ— Î”Î™Î‘Î™Î¡Î•Î£Î— Î£Î• ÎÎ•Î§Î©Î¡Î™Î£Î¤Î— Î“Î¡Î‘ÎœÎœÎ—\r\n  const formattedHierarchy = finalParts.join('\\n');\r\n  console.log('ğŸ“‹ Final formatted hierarchy:', formattedHierarchy);\r\n\r\n  return formattedHierarchy;\r\n}\r\n\r\n/**\r\n * ÎœÎµÎ»Î»Î¿Î½Ï„Î¹ÎºÎ® Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· Î³Î¹Î± Î¬Î»Î»ÎµÏ‚ Ï‡ÏÏÎµÏ‚\r\n */\r\nexport function getCountryFromDisplayName(displayName: string): 'greece' | 'bulgaria' | 'unknown' {\r\n  const lowerName = displayName.toLowerCase();\r\n\r\n  if (lowerName.includes('ÎµÎ»Î»Î¬Î´Î±') || lowerName.includes('greece')) {\r\n    return 'greece';\r\n  }\r\n\r\n  if (lowerName.includes('bulgaria') || lowerName.includes('Î²Î¿Ï…Î»Î³Î±ÏÎ¯Î±')) {\r\n    return 'bulgaria';\r\n  }\r\n\r\n  return 'unknown';\r\n}\r\n\r\n/**\r\n * Country-specific processing (Î³Î¹Î± Î¼ÎµÎ»Î»Î¿Î½Ï„Î¹ÎºÎ® ÎµÏ€Î­ÎºÏ„Î±ÏƒÎ·)\r\n */\r\nexport function processDisplayNameByCountry(displayName: string): string {\r\n  const country = getCountryFromDisplayName(displayName);\r\n\r\n  switch (country) {\r\n    case 'greece':\r\n      return processDisplayNameToHierarchy(displayName);\r\n\r\n    case 'bulgaria':\r\n      // TODO: Î¥Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î³Î¹Î± Î’Î¿Ï…Î»Î³Î±ÏÎ¯Î±\r\n      return displayName; // Fallback Ï€ÏÎ¿Ï‚ Ï„Î¿ Ï€Î±ÏÏŒÎ½\r\n\r\n    default:\r\n      // Universal fallback\r\n      return processDisplayNameToHierarchy(displayName);\r\n  }\r\n}","import { OSMAdminCollection } from '../types';\r\nimport { processDisplayNameByCountry } from '../utils/administrativeHierarchy';\r\n\r\n/**\r\n * Fetch administrative boundary for address component using Enterprise BoundaryService\r\n * @param addressComponent - Component Î¼Îµ label ÎºÎ±Î¹ type\r\n * @returns OSM-style admin boundary collection\r\n */\r\nexport const fetchBoundaryByAddressComponent = async (\r\n  addressComponent: { label: string; type: string }\r\n): Promise<OSMAdminCollection> => {\r\n  try {\r\n    console.log(`ğŸŒ Fetching boundary Î³Î¹Î±: ${addressComponent.label}`);\r\n\r\n    // Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ¼Îµ Nominatim Î³Î¹Î± Î½Î± Ï€Î¬ÏÎ¿Ï…Î¼Îµ Ï„Î¿ Î Î›Î—Î¡Î•Î£ POLYGON\r\n    const searchUrl = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(addressComponent.label)}&format=json&limit=1&polygon_geojson=1`;\r\n\r\n    const searchResponse = await fetch(searchUrl, {\r\n      headers: {\r\n        'User-Agent': 'Layera-GeoAlert/1.0'\r\n      }\r\n    });\r\n\r\n    if (!searchResponse.ok) {\r\n      throw new Error(`Nominatim error: ${searchResponse.status}`);\r\n    }\r\n\r\n    const searchData = await searchResponse.json();\r\n\r\n    if (searchData && searchData.length > 0) {\r\n      const result = searchData[0];\r\n\r\n      // Î ÏÎ¿Ï„Î¯Î¼Î·ÏƒÎ·: Î§ÏÎ®ÏƒÎ· Ï„Î¿Ï… Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ¿Ï polygon Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹\r\n      if (result.geojson) {\r\n        console.log(`âœ… Found FULL POLYGON Î³Î¹Î± ${addressComponent.label} Î¼Îµ ${result.geojson.coordinates?.[0]?.length || 0} ÏƒÎ·Î¼ÎµÎ¯Î±`);\r\n\r\n        return {\r\n          type: 'FeatureCollection',\r\n          features: [{\r\n            type: 'Feature',\r\n            properties: {\r\n              name: result.display_name ? processDisplayNameByCountry(result.display_name) : addressComponent.label,\r\n              admin_level: '8',\r\n              boundary: 'administrative',\r\n              osm_id: result.osm_id || 0,\r\n              osm_type: result.osm_type || 'node'\r\n            },\r\n            geometry: result.geojson\r\n          }]\r\n        };\r\n      }\r\n      // Fallback: Î§ÏÎ®ÏƒÎ· bounding box Î±Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ polygon\r\n      else if (result.boundingbox) {\r\n        const bbox = result.boundingbox;\r\n\r\n        // boundingbox format: [south, north, west, east]\r\n        const south = parseFloat(bbox[0]);\r\n        const north = parseFloat(bbox[1]);\r\n        const west = parseFloat(bbox[2]);\r\n        const east = parseFloat(bbox[3]);\r\n\r\n        console.log(`âš ï¸ Using bounding box Î³Î¹Î± ${addressComponent.label} (no polygon available)`);\r\n\r\n        return {\r\n          type: 'FeatureCollection',\r\n          features: [{\r\n            type: 'Feature',\r\n            properties: {\r\n              name: result.display_name ? processDisplayNameByCountry(result.display_name) : addressComponent.label,\r\n              admin_level: '8',\r\n              boundary: 'administrative',\r\n              osm_id: result.osm_id || 0,\r\n              osm_type: result.osm_type || 'node'\r\n            },\r\n            geometry: {\r\n              type: 'Polygon',\r\n              coordinates: [[\r\n                [west, north],\r\n                [east, north],\r\n                [east, south],\r\n                [west, south],\r\n                [west, north]\r\n              ]]\r\n            }\r\n          }]\r\n        };\r\n      }\r\n    }\r\n\r\n    // Default Overpass query Î³Î¹Î± Î¬Î»Î»ÎµÏ‚ Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯ÎµÏ‚\r\n    const query = `\r\n      [out:json][timeout:10];\r\n      (\r\n        relation[\"boundary\"=\"administrative\"][\"name\"~\"${addressComponent.label}\",i];\r\n      );\r\n      out ids;\r\n    `;\r\n\r\n    const response = await fetch('https://overpass-api.de/api/interpreter', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/x-www-form-urlencoded',\r\n      },\r\n      body: `data=${encodeURIComponent(query)}`\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`Overpass API error: ${response.status}`);\r\n    }\r\n\r\n    const data = await response.json();\r\n\r\n    if (data.elements && data.elements.length > 0) {\r\n      console.log(`âœ… OSM boundary IDs found Î³Î¹Î±: ${addressComponent.label} (${data.elements.length} elements)`);\r\n\r\n      // Î•Ï€Î¹ÏƒÏ„ÏÎ­Ï†Î¿Ï…Î¼Îµ null geometry Î³Î¹Î± Ï„ÏÏÎ±\r\n      // Î¤Î¿ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ boundary Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Ï€Î¹Î¿ ÏƒÏÎ½Î¸ÎµÏ„Î¿ query\r\n      return {\r\n        type: 'FeatureCollection',\r\n        features: []\r\n      };\r\n    }\r\n\r\n    console.log(`âš ï¸ No OSM boundary found Î³Î¹Î±: ${addressComponent.label}`);\r\n    return {\r\n      type: 'FeatureCollection',\r\n      features: []\r\n    };\r\n\r\n  } catch (error) {\r\n    console.error(`ğŸš« OSM API error Î³Î¹Î± ${addressComponent.label}:`, error);\r\n\r\n    // Fallback to local boundary system\r\n    console.log(`âš ï¸ Fallback to local boundary system Î³Î¹Î±: ${addressComponent.label}`);\r\n    return await fetchLocalBoundary(addressComponent);\r\n  }\r\n};\r\n\r\n/**\r\n * Fallback boundary fetch using local system\r\n */\r\nasync function fetchLocalBoundary(\r\n  addressComponent: { label: string; type: string }\r\n): Promise<OSMAdminCollection> {\r\n  // Basic query normalization\r\n  const baseName = addressComponent.label\r\n    .replace(/^Î”Î®Î¼Î¿Ï‚\\s+/, '')\r\n    .replace(/^Î”Î·Î¼Î¿Ï„Î¹ÎºÎ®\\s+Î•Î½ÏŒÏ„Î·Ï„Î±\\s+/, '')\r\n    .replace(/^Î ÎµÏÎ¹Ï†Î­ÏÎµÎ¹Î±\\s+/, '')\r\n    .replace(/^Î ÎµÏÎ¹Ï†ÎµÏÎµÎ¹Î±ÎºÎ®\\s+Î•Î½ÏŒÏ„Î·Ï„Î±\\s+/, '')\r\n    .replace(/\\s+-\\s+.*$/, '')\r\n    .replace(/\\s+\\(.+\\)$/, '')\r\n    .trim();\r\n\r\n  console.log('âš ï¸ Fallback to local boundary system Î³Î¹Î±:', baseName);\r\n\r\n  // Use existing fallback system if available\r\n  try {\r\n    const { findFallbackBoundary } = await import('./fallbackBoundaries');\r\n    const searchTerms = [addressComponent.label, baseName];\r\n    const fallbackBoundary = findFallbackBoundary(searchTerms);\r\n\r\n    if (fallbackBoundary) {\r\n      console.log('âœ… Local fallback boundary found');\r\n      return fallbackBoundary;\r\n    }\r\n  } catch (fallbackError) {\r\n    console.warn('âš ï¸ Fallback system not available:', fallbackError);\r\n  }\r\n\r\n  // Ultimate fallback: empty collection\r\n  console.error('ğŸš« No boundary data available Î³Î¹Î±:', addressComponent.label);\r\n  return {\r\n    type: 'FeatureCollection',\r\n    features: []\r\n  };\r\n}\r\n\r\n// Stub functions Î³Î¹Î± compatibility\r\nexport const fetchBuildingOutlines = async () => ({ type: 'FeatureCollection', features: [] });\r\nexport const fetchAdministrativeBoundary = async () => ({ type: 'FeatureCollection', features: [] });\r\nexport const clearOSMCache = async () => {};\r\nexport const getCacheSize = () => 0;\r\nexport const isBoundsCached = () => false;\r\nexport const prefetchBuildingOutlines = async () => {};\r\n\r\n/**\r\n * Convert OSM geometry to GeoJSON geometry\r\n */\r\nfunction convertOSMGeometry(element: any): any {\r\n  if (!element.geometry) return null;\r\n\r\n  if (element.type === 'relation') {\r\n    // For relations, try to build polygon from ways\r\n    const coordinates: number[][][] = [];\r\n\r\n    if (element.geometry && element.geometry.length > 0) {\r\n      const outerRing: number[][] = [];\r\n\r\n      element.geometry.forEach((geom: any) => {\r\n        if (geom.lat && geom.lon) {\r\n          outerRing.push([geom.lon, geom.lat]);\r\n        }\r\n      });\r\n\r\n      if (outerRing.length > 2) {\r\n        // Close the ring if needed\r\n        if (outerRing[0][0] !== outerRing[outerRing.length - 1][0] ||\r\n            outerRing[0][1] !== outerRing[outerRing.length - 1][1]) {\r\n          outerRing.push([...outerRing[0]]);\r\n        }\r\n        coordinates.push(outerRing);\r\n      }\r\n    }\r\n\r\n    if (coordinates.length > 0) {\r\n      return {\r\n        type: 'Polygon',\r\n        coordinates: coordinates\r\n      };\r\n    }\r\n  }\r\n\r\n  if (element.type === 'way') {\r\n    const coordinates: number[][] = [];\r\n\r\n    if (element.geometry) {\r\n      element.geometry.forEach((geom: any) => {\r\n        if (geom.lat && geom.lon) {\r\n          coordinates.push([geom.lon, geom.lat]);\r\n        }\r\n      });\r\n    }\r\n\r\n    if (coordinates.length > 2) {\r\n      // Close the ring if needed for polygon\r\n      if (coordinates[0][0] !== coordinates[coordinates.length - 1][0] ||\r\n          coordinates[0][1] !== coordinates[coordinates.length - 1][1]) {\r\n        coordinates.push([...coordinates[0]]);\r\n      }\r\n\r\n      return {\r\n        type: 'Polygon',\r\n        coordinates: [coordinates]\r\n      };\r\n    }\r\n  }\r\n\r\n  return null;\r\n}","/**\r\n * @layera/geo-mapping\r\n *\r\n * OSM services, administrative boundaries, ÎºÎ±Î¹ external mapping APIs.\r\n * Enterprise Architecture: Business Domain Layer\r\n *\r\n * Depends on: @layera/geo-core, @layera/constants\r\n * Used by: @layera/geo-drawing, @layera/search-module, @layera/map-module\r\n */\r\n\r\n// OSM Services\r\nexport {\r\n  fetchBuildingOutlines,\r\n  fetchAdministrativeBoundary,\r\n  fetchBoundaryByAddressComponent,\r\n  clearOSMCache,\r\n  getCacheSize,\r\n  isBoundsCached,\r\n  prefetchBuildingOutlines\r\n} from './services/osmService';\r\n\r\n// Package metadata\r\nexport const GEO_MAPPING_VERSION = '1.0.0';\r\nexport const GEO_MAPPING_NAME = '@layera/geo-mapping';"]}