{"version":3,"sources":["../src/utils/matrixOperations.ts","../src/utils/coordinateMapping.ts","../src/utils/viewportManager.ts","../src/utils/transformAnimations.ts","../src/utils/canvasUtils.ts","../src/index.ts"],"sourcesContent":["import type { TransformationMatrix, Point2D, BoundingBox } from '../types';\r\n\r\n/**\r\n * Matrix operations utilities για canvas transformations\r\n * Βασισμένο σε industry-standard matrix math operations\r\n */\r\n\r\n/**\r\n * Creates identity transformation matrix\r\n */\r\nexport const createIdentityMatrix = (): TransformationMatrix => ({\r\n  a: 1, b: 0, c: 0,\r\n  d: 1, e: 0, f: 0\r\n});\r\n\r\n/**\r\n * Creates translation matrix\r\n */\r\nexport const createTranslationMatrix = (x: number, y: number): TransformationMatrix => ({\r\n  a: 1, b: 0, c: 0,\r\n  d: 1, e: x, f: y\r\n});\r\n\r\n/**\r\n * Creates scaling matrix\r\n */\r\nexport const createScaleMatrix = (scaleX: number, scaleY: number = scaleX): TransformationMatrix => ({\r\n  a: scaleX, b: 0, c: 0,\r\n  d: scaleY, e: 0, f: 0\r\n});\r\n\r\n/**\r\n * Creates rotation matrix\r\n */\r\nexport const createRotationMatrix = (angle: number): TransformationMatrix => {\r\n  const cos = Math.cos(angle);\r\n  const sin = Math.sin(angle);\r\n\r\n  return {\r\n    a: cos, b: sin, c: -sin,\r\n    d: cos, e: 0, f: 0\r\n  };\r\n};\r\n\r\n/**\r\n * Creates rotation matrix around specific point\r\n */\r\nexport const createRotationAroundPointMatrix = (\r\n  angle: number,\r\n  centerX: number,\r\n  centerY: number\r\n): TransformationMatrix => {\r\n  const cos = Math.cos(angle);\r\n  const sin = Math.sin(angle);\r\n\r\n  return {\r\n    a: cos,\r\n    b: sin,\r\n    c: -sin,\r\n    d: cos,\r\n    e: centerX * (1 - cos) + centerY * sin,\r\n    f: centerY * (1 - cos) - centerX * sin\r\n  };\r\n};\r\n\r\n/**\r\n * Multiplies two transformation matrices\r\n */\r\nexport const multiplyMatrices = (\r\n  m1: TransformationMatrix,\r\n  m2: TransformationMatrix\r\n): TransformationMatrix => ({\r\n  a: m1.a * m2.a + m1.b * m2.c,\r\n  b: m1.a * m2.b + m1.b * m2.d,\r\n  c: m1.c * m2.a + m1.d * m2.c,\r\n  d: m1.c * m2.b + m1.d * m2.d,\r\n  e: m1.e * m2.a + m1.f * m2.c + m2.e,\r\n  f: m1.e * m2.b + m1.f * m2.d + m2.f\r\n});\r\n\r\n/**\r\n * Calculates matrix determinant\r\n */\r\nexport const getMatrixDeterminant = (matrix: TransformationMatrix): number => {\r\n  return matrix.a * matrix.d - matrix.b * matrix.c;\r\n};\r\n\r\n/**\r\n * Calculates inverse transformation matrix\r\n */\r\nexport const invertMatrix = (matrix: TransformationMatrix): TransformationMatrix => {\r\n  const det = getMatrixDeterminant(matrix);\r\n\r\n  if (Math.abs(det) < 1e-10) {\r\n    throw new Error('Matrix is not invertible (determinant is zero)');\r\n  }\r\n\r\n  const invDet = 1 / det;\r\n\r\n  return {\r\n    a: matrix.d * invDet,\r\n    b: -matrix.b * invDet,\r\n    c: -matrix.c * invDet,\r\n    d: matrix.a * invDet,\r\n    e: (matrix.c * matrix.f - matrix.d * matrix.e) * invDet,\r\n    f: (matrix.b * matrix.e - matrix.a * matrix.f) * invDet\r\n  };\r\n};\r\n\r\n/**\r\n * Transforms a point using transformation matrix\r\n */\r\nexport const transformPoint = (\r\n  point: Point2D,\r\n  matrix: TransformationMatrix\r\n): Point2D => ({\r\n  x: matrix.a * point.x + matrix.c * point.y + matrix.e,\r\n  y: matrix.b * point.x + matrix.d * point.y + matrix.f\r\n});\r\n\r\n/**\r\n * Transforms multiple points efficiently\r\n */\r\nexport const transformPoints = (\r\n  points: Point2D[],\r\n  matrix: TransformationMatrix\r\n): Point2D[] => points.map(point => transformPoint(point, matrix));\r\n\r\n/**\r\n * Transforms bounding box using transformation matrix\r\n */\r\nexport const transformBoundingBox = (\r\n  bounds: BoundingBox,\r\n  matrix: TransformationMatrix\r\n): BoundingBox => {\r\n  // Transform all four corners\r\n  const corners: Point2D[] = [\r\n    { x: bounds.minX, y: bounds.minY },\r\n    { x: bounds.maxX, y: bounds.minY },\r\n    { x: bounds.maxX, y: bounds.maxY },\r\n    { x: bounds.minX, y: bounds.maxY }\r\n  ];\r\n\r\n  const transformedCorners = transformPoints(corners, matrix);\r\n\r\n  // Find new bounds\r\n  const xs = transformedCorners.map(p => p.x);\r\n  const ys = transformedCorners.map(p => p.y);\r\n\r\n  const minX = Math.min(...xs);\r\n  const maxX = Math.max(...xs);\r\n  const minY = Math.min(...ys);\r\n  const maxY = Math.max(...ys);\r\n\r\n  return {\r\n    minX,\r\n    minY,\r\n    maxX,\r\n    maxY,\r\n    width: maxX - minX,\r\n    height: maxY - minY\r\n  };\r\n};\r\n\r\n/**\r\n * Decomposes transformation matrix into components\r\n */\r\nexport const decompose = (matrix: TransformationMatrix) => {\r\n  const { a, b, c, d, e, f } = matrix;\r\n\r\n  // Extract translation\r\n  const translation = { x: e, y: f };\r\n\r\n  // Extract scale\r\n  const scaleX = Math.sqrt(a * a + b * b);\r\n  const scaleY = Math.sqrt(c * c + d * d);\r\n\r\n  // Extract rotation\r\n  const rotation = Math.atan2(b, a);\r\n\r\n  // Extract skew\r\n  const skewX = Math.atan2(a * c + b * d, scaleX * scaleX);\r\n  const skewY = 0; // For affine transformations\r\n\r\n  return {\r\n    translation,\r\n    scale: { x: scaleX, y: scaleY },\r\n    rotation,\r\n    skew: { x: skewX, y: skewY }\r\n  };\r\n};\r\n\r\n/**\r\n * Composes transformation from individual components\r\n */\r\nexport const compose = (\r\n  translation: Point2D = { x: 0, y: 0 },\r\n  scale: Point2D = { x: 1, y: 1 },\r\n  rotation: number = 0,\r\n  origin: Point2D = { x: 0, y: 0 }\r\n): TransformationMatrix => {\r\n  // Create individual transformation matrices\r\n  const translateToOrigin = createTranslationMatrix(-origin.x, -origin.y);\r\n  const scaleMatrix = createScaleMatrix(scale.x, scale.y);\r\n  const rotateMatrix = createRotationMatrix(rotation);\r\n  const translateFromOrigin = createTranslationMatrix(origin.x, origin.y);\r\n  const translateMatrix = createTranslationMatrix(translation.x, translation.y);\r\n\r\n  // Compose transformations: translate * translateFromOrigin * rotate * scale * translateToOrigin\r\n  let result = translateToOrigin;\r\n  result = multiplyMatrices(scaleMatrix, result);\r\n  result = multiplyMatrices(rotateMatrix, result);\r\n  result = multiplyMatrices(translateFromOrigin, result);\r\n  result = multiplyMatrices(translateMatrix, result);\r\n\r\n  return result;\r\n};\r\n\r\n/**\r\n * Checks if matrix is identity matrix\r\n */\r\nexport const isIdentity = (matrix: TransformationMatrix, tolerance: number = 1e-10): boolean => {\r\n  const identity = createIdentityMatrix();\r\n\r\n  return Math.abs(matrix.a - identity.a) < tolerance &&\r\n         Math.abs(matrix.b - identity.b) < tolerance &&\r\n         Math.abs(matrix.c - identity.c) < tolerance &&\r\n         Math.abs(matrix.d - identity.d) < tolerance &&\r\n         Math.abs(matrix.e - identity.e) < tolerance &&\r\n         Math.abs(matrix.f - identity.f) < tolerance;\r\n};\r\n\r\n/**\r\n * Interpolates between two matrices για animations\r\n */\r\nexport const interpolateMatrix = (\r\n  from: TransformationMatrix,\r\n  to: TransformationMatrix,\r\n  t: number\r\n): TransformationMatrix => {\r\n  const clampedT = Math.max(0, Math.min(1, t));\r\n\r\n  return {\r\n    a: from.a + (to.a - from.a) * clampedT,\r\n    b: from.b + (to.b - from.b) * clampedT,\r\n    c: from.c + (to.c - from.c) * clampedT,\r\n    d: from.d + (to.d - from.d) * clampedT,\r\n    e: from.e + (to.e - from.e) * clampedT,\r\n    f: from.f + (to.f - from.f) * clampedT\r\n  };\r\n};\r\n\r\n/**\r\n * Converts matrix to CSS transform string\r\n */\r\nexport const matrixToCSSTransform = (matrix: TransformationMatrix): string => {\r\n  return `matrix(${matrix.a}, ${matrix.b}, ${matrix.c}, ${matrix.d}, ${matrix.e}, ${matrix.f})`;\r\n};\r\n\r\n/**\r\n * Converts matrix to SVG transform string\r\n */\r\nexport const matrixToSVGTransform = (matrix: TransformationMatrix): string => {\r\n  return `matrix(${matrix.a} ${matrix.b} ${matrix.c} ${matrix.d} ${matrix.e} ${matrix.f})`;\r\n};","import type {\r\n  Point2D,\r\n  CoordinateSystem,\r\n  CoordinateMapping,\r\n  TransformationMatrix,\r\n  Viewport\r\n} from '../types';\r\nimport {\r\n  createIdentityMatrix,\r\n  createScaleMatrix,\r\n  createTranslationMatrix,\r\n  createRotationMatrix,\r\n  multiplyMatrices,\r\n  invertMatrix,\r\n  transformPoint\r\n} from './matrixOperations';\r\n\r\n/**\r\n * Coordinate mapping utilities για screen to world conversions\r\n * Enterprise-grade coordinate system transformations\r\n */\r\n\r\n/**\r\n * Creates coordinate mapping between screen and world coordinates\r\n */\r\nexport const createCoordinateMapping = (\r\n  viewport: Viewport,\r\n  coordinateSystem: CoordinateSystem\r\n): CoordinateMapping => {\r\n  let currentSystem = { ...coordinateSystem };\r\n  let cachedMatrix: TransformationMatrix | null = null;\r\n  let cachedInverseMatrix: TransformationMatrix | null = null;\r\n\r\n  const updateMatrices = () => {\r\n    // Create transformation matrix: screen -> world\r\n    let matrix = createIdentityMatrix();\r\n\r\n    // 1. Translate viewport offset\r\n    matrix = multiplyMatrices(\r\n      createTranslationMatrix(-viewport.x, -viewport.y),\r\n      matrix\r\n    );\r\n\r\n    // 2. Apply viewport inverse scale\r\n    matrix = multiplyMatrices(\r\n      createScaleMatrix(1 / viewport.scale),\r\n      matrix\r\n    );\r\n\r\n    // 3. Apply coordinate system transformations\r\n    // Origin translation\r\n    matrix = multiplyMatrices(\r\n      createTranslationMatrix(currentSystem.origin.x, currentSystem.origin.y),\r\n      matrix\r\n    );\r\n\r\n    // Rotation\r\n    if (currentSystem.rotation !== 0) {\r\n      matrix = multiplyMatrices(\r\n        createRotationMatrix(-currentSystem.rotation), // Inverse rotation για screen to world\r\n        matrix\r\n      );\r\n    }\r\n\r\n    // Scaling\r\n    matrix = multiplyMatrices(\r\n      createScaleMatrix(\r\n        currentSystem.flipX ? -currentSystem.scaleX : currentSystem.scaleX,\r\n        currentSystem.flipY ? -currentSystem.scaleY : currentSystem.scaleY\r\n      ),\r\n      matrix\r\n    );\r\n\r\n    cachedMatrix = matrix;\r\n    cachedInverseMatrix = invertMatrix(matrix);\r\n  };\r\n\r\n  // Initialize matrices\r\n  updateMatrices();\r\n\r\n  return {\r\n    screenToWorld: (screenPoint: Point2D): Point2D => {\r\n      if (!cachedMatrix) updateMatrices();\r\n      return transformPoint(screenPoint, cachedMatrix!);\r\n    },\r\n\r\n    worldToScreen: (worldPoint: Point2D): Point2D => {\r\n      if (!cachedInverseMatrix) updateMatrices();\r\n      return transformPoint(worldPoint, cachedInverseMatrix!);\r\n    },\r\n\r\n    getMatrix: (): TransformationMatrix => {\r\n      if (!cachedMatrix) updateMatrices();\r\n      return { ...cachedMatrix! };\r\n    },\r\n\r\n    updateSystem: (system: Partial<CoordinateSystem>): void => {\r\n      currentSystem = { ...currentSystem, ...system };\r\n      cachedMatrix = null;\r\n      cachedInverseMatrix = null;\r\n    }\r\n  };\r\n};\r\n\r\n/**\r\n * Creates coordinate mapping for specific canvas element\r\n */\r\nexport const createCanvasCoordinateMapping = (\r\n  canvas: HTMLCanvasElement,\r\n  coordinateSystem: CoordinateSystem\r\n): CoordinateMapping => {\r\n  const rect = canvas.getBoundingClientRect();\r\n\r\n  const viewport: Viewport = {\r\n    x: 0,\r\n    y: 0,\r\n    width: rect.width,\r\n    height: rect.height,\r\n    scale: 1,\r\n    rotation: 0\r\n  };\r\n\r\n  return createCoordinateMapping(viewport, coordinateSystem);\r\n};\r\n\r\n/**\r\n * Converts mouse/touch event coordinates to canvas coordinates\r\n */\r\nexport const getCanvasCoordinates = (\r\n  event: MouseEvent | TouchEvent,\r\n  canvas: HTMLCanvasElement\r\n): Point2D => {\r\n  const rect = canvas.getBoundingClientRect();\r\n\r\n  let clientX: number;\r\n  let clientY: number;\r\n\r\n  if (event instanceof MouseEvent) {\r\n    clientX = event.clientX;\r\n    clientY = event.clientY;\r\n  } else {\r\n    // TouchEvent - use first touch\r\n    const touch = event.touches[0] || event.changedTouches[0];\r\n    if (!touch) {\r\n      throw new Error('No touch point found in touch event');\r\n    }\r\n    clientX = touch.clientX;\r\n    clientY = touch.clientY;\r\n  }\r\n\r\n  return {\r\n    x: clientX - rect.left,\r\n    y: clientY - rect.top\r\n  };\r\n};\r\n\r\n/**\r\n * Geographic coordinate system utilities\r\n */\r\nexport const geoCoordinates = {\r\n  /**\r\n   * Converts latitude/longitude to Web Mercator (EPSG:3857)\r\n   */\r\n  latLngToWebMercator: (lat: number, lng: number): Point2D => {\r\n    const x = lng * 20037508.34 / 180;\r\n    let y = Math.log(Math.tan((90 + lat) * Math.PI / 360)) / (Math.PI / 180);\r\n    y = y * 20037508.34 / 180;\r\n\r\n    return { x, y };\r\n  },\r\n\r\n  /**\r\n   * Converts Web Mercator to latitude/longitude\r\n   */\r\n  webMercatorToLatLng: (x: number, y: number): Point2D => {\r\n    const lng = x * 180 / 20037508.34;\r\n    let lat = y * 180 / 20037508.34;\r\n    lat = 180 / Math.PI * (2 * Math.atan(Math.exp(lat * Math.PI / 180)) - Math.PI / 2);\r\n\r\n    return { x: lng, y: lat };\r\n  },\r\n\r\n  /**\r\n   * Creates coordinate system για geographic data\r\n   */\r\n  createGeoCoordinateSystem: (\r\n    bounds: { north: number; south: number; east: number; west: number },\r\n    canvasSize: { width: number; height: number }\r\n  ): CoordinateSystem => {\r\n    // Convert geographic bounds to Web Mercator\r\n    const nw = geoCoordinates.latLngToWebMercator(bounds.north, bounds.west);\r\n    const se = geoCoordinates.latLngToWebMercator(bounds.south, bounds.east);\r\n\r\n    const mercatorWidth = se.x - nw.x;\r\n    const mercatorHeight = nw.y - se.y; // Note: y is flipped in Mercator\r\n\r\n    const scaleX = canvasSize.width / mercatorWidth;\r\n    const scaleY = canvasSize.height / mercatorHeight;\r\n\r\n    return {\r\n      origin: { x: -nw.x, y: -se.y },\r\n      scaleX,\r\n      scaleY,\r\n      rotation: 0,\r\n      flipX: false,\r\n      flipY: true // Geographic coordinates have origin at bottom-left\r\n    };\r\n  }\r\n};\r\n\r\n/**\r\n * Grid coordinate utilities\r\n */\r\nexport const gridCoordinates = {\r\n  /**\r\n   * Snaps point to grid\r\n   */\r\n  snapToGrid: (point: Point2D, gridSize: number): Point2D => ({\r\n    x: Math.round(point.x / gridSize) * gridSize,\r\n    y: Math.round(point.y / gridSize) * gridSize\r\n  }),\r\n\r\n  /**\r\n   * Gets grid points within bounding area\r\n   */\r\n  getGridPoints: (\r\n    bounds: { minX: number; minY: number; maxX: number; maxY: number },\r\n    gridSize: number\r\n  ): Point2D[] => {\r\n    const points: Point2D[] = [];\r\n\r\n    const startX = Math.floor(bounds.minX / gridSize) * gridSize;\r\n    const endX = Math.ceil(bounds.maxX / gridSize) * gridSize;\r\n    const startY = Math.floor(bounds.minY / gridSize) * gridSize;\r\n    const endY = Math.ceil(bounds.maxY / gridSize) * gridSize;\r\n\r\n    for (let x = startX; x <= endX; x += gridSize) {\r\n      for (let y = startY; y <= endY; y += gridSize) {\r\n        points.push({ x, y });\r\n      }\r\n    }\r\n\r\n    return points;\r\n  },\r\n\r\n  /**\r\n   * Creates coordinate system για grid-based layouts\r\n   */\r\n  createGridCoordinateSystem: (\r\n    _gridSize: number,\r\n    origin: Point2D = { x: 0, y: 0 }\r\n  ): CoordinateSystem => ({\r\n    origin,\r\n    scaleX: 1,\r\n    scaleY: 1,\r\n    rotation: 0,\r\n    flipX: false,\r\n    flipY: false\r\n  })\r\n};\r\n\r\n/**\r\n * Utility για converting between different coordinate systems\r\n */\r\nexport const convertCoordinates = (\r\n  point: Point2D,\r\n  fromSystem: CoordinateMapping,\r\n  toSystem: CoordinateMapping\r\n): Point2D => {\r\n  // Convert from source system to screen coordinates\r\n  const screenPoint = fromSystem.worldToScreen(point);\r\n\r\n  // Convert from screen coordinates to target system\r\n  return toSystem.screenToWorld(screenPoint);\r\n};","import type {\r\n  Viewport,\r\n  CanvasTransform,\r\n  BoundingBox,\r\n  Point2D,\r\n  CanvasConstraints,\r\n  InteractionState\r\n} from '../types';\r\nimport {\r\n  createIdentityMatrix,\r\n  createTranslationMatrix,\r\n  createScaleMatrix,\r\n  multiplyMatrices\r\n} from './matrixOperations';\r\n\r\n/**\r\n * Viewport management utilities για canvas zoom/pan operations\r\n * Enterprise-grade viewport control με constraints και smooth interactions\r\n */\r\n\r\n/**\r\n * Creates viewport manager για canvas zoom/pan operations\r\n */\r\nexport class ViewportManager {\r\n  private viewport: Viewport;\r\n  private constraints: CanvasConstraints;\r\n  private interaction: InteractionState;\r\n  private callbacks: {\r\n    onViewportChange?: (viewport: Viewport) => void;\r\n    onTransformChange?: (transform: CanvasTransform) => void;\r\n  } = {};\r\n\r\n  constructor(\r\n    initialViewport: Viewport,\r\n    constraints: CanvasConstraints = {\r\n      minScale: 0.1,\r\n      maxScale: 10,\r\n      lockAspectRatio: false,\r\n      snapToGrid: false,\r\n      gridSize: 10\r\n    }\r\n  ) {\r\n    this.viewport = { ...initialViewport };\r\n    this.constraints = { ...constraints };\r\n    this.interaction = {\r\n      isDragging: false,\r\n      isZooming: false\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Gets current viewport state\r\n   */\r\n  getViewport(): Viewport {\r\n    return { ...this.viewport };\r\n  }\r\n\r\n  /**\r\n   * Gets current transformation\r\n   */\r\n  getTransform(): CanvasTransform {\r\n    const matrix = this.calculateTransformMatrix();\r\n\r\n    return {\r\n      matrix,\r\n      viewport: this.getViewport(),\r\n      scale: this.viewport.scale,\r\n      translation: { x: this.viewport.x, y: this.viewport.y },\r\n      rotation: this.viewport.rotation,\r\n      origin: { x: this.viewport.width / 2, y: this.viewport.height / 2 }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Sets viewport change callback\r\n   */\r\n  onViewportChange(callback: (viewport: Viewport) => void): void {\r\n    this.callbacks.onViewportChange = callback;\r\n  }\r\n\r\n  /**\r\n   * Sets transform change callback\r\n   */\r\n  onTransformChange(callback: (transform: CanvasTransform) => void): void {\r\n    this.callbacks.onTransformChange = callback;\r\n  }\r\n\r\n  /**\r\n   * Updates viewport and notifies callbacks\r\n   */\r\n  private updateViewport(newViewport: Partial<Viewport>): void {\r\n    this.viewport = { ...this.viewport, ...newViewport };\r\n    this.applyConstraints();\r\n\r\n    this.callbacks.onViewportChange?.(this.getViewport());\r\n    this.callbacks.onTransformChange?.(this.getTransform());\r\n  }\r\n\r\n  /**\r\n   * Applies constraints to current viewport\r\n   */\r\n  private applyConstraints(): void {\r\n    // Scale constraints\r\n    this.viewport.scale = Math.max(\r\n      this.constraints.minScale,\r\n      Math.min(this.constraints.maxScale, this.viewport.scale)\r\n    );\r\n\r\n    // Bounding box constraints\r\n    if (this.constraints.boundingBox) {\r\n      const bounds = this.constraints.boundingBox;\r\n\r\n      // Calculate visible area in world coordinates\r\n      const viewWidth = this.viewport.width / this.viewport.scale;\r\n      const viewHeight = this.viewport.height / this.viewport.scale;\r\n\r\n      // Constrain pan to keep content visible\r\n      this.viewport.x = Math.max(\r\n        bounds.minX - viewWidth * 0.9,\r\n        Math.min(bounds.maxX - viewWidth * 0.1, this.viewport.x)\r\n      );\r\n\r\n      this.viewport.y = Math.max(\r\n        bounds.minY - viewHeight * 0.9,\r\n        Math.min(bounds.maxY - viewHeight * 0.1, this.viewport.y)\r\n      );\r\n    }\r\n\r\n    // Grid snapping\r\n    if (this.constraints.snapToGrid && !this.interaction.isDragging) {\r\n      const gridSize = this.constraints.gridSize;\r\n      this.viewport.x = Math.round(this.viewport.x / gridSize) * gridSize;\r\n      this.viewport.y = Math.round(this.viewport.y / gridSize) * gridSize;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calculates transformation matrix για current viewport\r\n   */\r\n  private calculateTransformMatrix() {\r\n    let matrix = createIdentityMatrix();\r\n\r\n    // Apply translation\r\n    matrix = multiplyMatrices(\r\n      createTranslationMatrix(this.viewport.x, this.viewport.y),\r\n      matrix\r\n    );\r\n\r\n    // Apply scale\r\n    matrix = multiplyMatrices(\r\n      createScaleMatrix(this.viewport.scale),\r\n      matrix\r\n    );\r\n\r\n    return matrix;\r\n  }\r\n\r\n  /**\r\n   * Zooms viewport by factor at specific point\r\n   */\r\n  zoom(factor: number, center?: Point2D): void {\r\n    const zoomCenter = center || {\r\n      x: this.viewport.width / 2,\r\n      y: this.viewport.height / 2\r\n    };\r\n\r\n    const newScale = this.viewport.scale * factor;\r\n    const clampedScale = Math.max(\r\n      this.constraints.minScale,\r\n      Math.min(this.constraints.maxScale, newScale)\r\n    );\r\n\r\n    const actualFactor = clampedScale / this.viewport.scale;\r\n\r\n    if (actualFactor === 1) return; // No change needed\r\n\r\n    // Adjust pan to keep zoom center fixed\r\n    const dx = (zoomCenter.x - this.viewport.x) * (1 - actualFactor);\r\n    const dy = (zoomCenter.y - this.viewport.y) * (1 - actualFactor);\r\n\r\n    this.updateViewport({\r\n      scale: clampedScale,\r\n      x: this.viewport.x + dx,\r\n      y: this.viewport.y + dy\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Pans viewport by offset\r\n   */\r\n  pan(deltaX: number, deltaY: number): void {\r\n    this.updateViewport({\r\n      x: this.viewport.x + deltaX,\r\n      y: this.viewport.y + deltaY\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fits content to viewport\r\n   */\r\n  fitToContent(contentBounds: BoundingBox, padding: number = 0.1): void {\r\n    const paddingX = contentBounds.width * padding;\r\n    const paddingY = contentBounds.height * padding;\r\n\r\n    const scaleX = this.viewport.width / (contentBounds.width + paddingX * 2);\r\n    const scaleY = this.viewport.height / (contentBounds.height + paddingY * 2);\r\n\r\n    const scale = Math.min(scaleX, scaleY);\r\n    const constrainedScale = Math.max(\r\n      this.constraints.minScale,\r\n      Math.min(this.constraints.maxScale, scale)\r\n    );\r\n\r\n    // Center content in viewport\r\n    const centerX = contentBounds.minX + contentBounds.width / 2;\r\n    const centerY = contentBounds.minY + contentBounds.height / 2;\r\n\r\n    this.updateViewport({\r\n      scale: constrainedScale,\r\n      x: this.viewport.width / 2 - centerX * constrainedScale,\r\n      y: this.viewport.height / 2 - centerY * constrainedScale\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Centers viewport on specific point\r\n   */\r\n  centerOn(worldPoint: Point2D): void {\r\n    this.updateViewport({\r\n      x: this.viewport.width / 2 - worldPoint.x * this.viewport.scale,\r\n      y: this.viewport.height / 2 - worldPoint.y * this.viewport.scale\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Starts pan interaction\r\n   */\r\n  startPan(startPoint: Point2D): void {\r\n    this.interaction = {\r\n      isDragging: true,\r\n      isZooming: false,\r\n      startPosition: startPoint,\r\n      lastPointerPosition: startPoint,\r\n      startTransform: this.getTransform()\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Updates pan interaction\r\n   */\r\n  updatePan(currentPoint: Point2D): void {\r\n    if (!this.interaction.isDragging || !this.interaction.lastPointerPosition) {\r\n      return;\r\n    }\r\n\r\n    const deltaX = currentPoint.x - this.interaction.lastPointerPosition.x;\r\n    const deltaY = currentPoint.y - this.interaction.lastPointerPosition.y;\r\n\r\n    this.pan(deltaX / this.viewport.scale, deltaY / this.viewport.scale);\r\n    this.interaction.lastPointerPosition = currentPoint;\r\n  }\r\n\r\n  /**\r\n   * Ends pan interaction\r\n   */\r\n  endPan(): void {\r\n    this.interaction = {\r\n      isDragging: false,\r\n      isZooming: false\r\n    };\r\n\r\n    // Apply final constraints (like grid snapping)\r\n    this.applyConstraints();\r\n    this.callbacks.onViewportChange?.(this.getViewport());\r\n    this.callbacks.onTransformChange?.(this.getTransform());\r\n  }\r\n\r\n  /**\r\n   * Handles mouse wheel zoom\r\n   */\r\n  handleWheel(event: WheelEvent, canvas: HTMLCanvasElement): void {\r\n    event.preventDefault();\r\n\r\n    const rect = canvas.getBoundingClientRect();\r\n    const zoomCenter = {\r\n      x: event.clientX - rect.left,\r\n      y: event.clientY - rect.top\r\n    };\r\n\r\n    // Determine zoom direction and factor\r\n    const delta = event.deltaY > 0 ? -1 : 1;\r\n    const zoomFactor = Math.pow(1.1, delta);\r\n\r\n    this.zoom(zoomFactor, zoomCenter);\r\n  }\r\n\r\n  /**\r\n   * Handles touch pinch zoom\r\n   */\r\n  handlePinchZoom(\r\n    touch1: Point2D,\r\n    touch2: Point2D,\r\n    previousTouch1?: Point2D,\r\n    previousTouch2?: Point2D\r\n  ): void {\r\n    if (!previousTouch1 || !previousTouch2) {\r\n      return;\r\n    }\r\n\r\n    // Calculate current and previous distances\r\n    const currentDistance = Math.sqrt(\r\n      Math.pow(touch2.x - touch1.x, 2) + Math.pow(touch2.y - touch1.y, 2)\r\n    );\r\n\r\n    const previousDistance = Math.sqrt(\r\n      Math.pow(previousTouch2.x - previousTouch1.x, 2) +\r\n      Math.pow(previousTouch2.y - previousTouch1.y, 2)\r\n    );\r\n\r\n    if (previousDistance === 0) return;\r\n\r\n    const zoomFactor = currentDistance / previousDistance;\r\n    const zoomCenter = {\r\n      x: (touch1.x + touch2.x) / 2,\r\n      y: (touch1.y + touch2.y) / 2\r\n    };\r\n\r\n    this.zoom(zoomFactor, zoomCenter);\r\n  }\r\n\r\n  /**\r\n   * Converts screen coordinates to world coordinates\r\n   */\r\n  screenToWorld(screenPoint: Point2D): Point2D {\r\n    return {\r\n      x: (screenPoint.x - this.viewport.x) / this.viewport.scale,\r\n      y: (screenPoint.y - this.viewport.y) / this.viewport.scale\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Converts world coordinates to screen coordinates\r\n   */\r\n  worldToScreen(worldPoint: Point2D): Point2D {\r\n    return {\r\n      x: worldPoint.x * this.viewport.scale + this.viewport.x,\r\n      y: worldPoint.y * this.viewport.scale + this.viewport.y\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Gets visible world bounds\r\n   */\r\n  getVisibleBounds(): BoundingBox {\r\n    const topLeft = this.screenToWorld({ x: 0, y: 0 });\r\n    const bottomRight = this.screenToWorld({\r\n      x: this.viewport.width,\r\n      y: this.viewport.height\r\n    });\r\n\r\n    return {\r\n      minX: topLeft.x,\r\n      minY: topLeft.y,\r\n      maxX: bottomRight.x,\r\n      maxY: bottomRight.y,\r\n      width: bottomRight.x - topLeft.x,\r\n      height: bottomRight.y - topLeft.y\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Updates constraints\r\n   */\r\n  updateConstraints(newConstraints: Partial<CanvasConstraints>): void {\r\n    this.constraints = { ...this.constraints, ...newConstraints };\r\n    this.applyConstraints();\r\n    this.callbacks.onViewportChange?.(this.getViewport());\r\n  }\r\n\r\n  /**\r\n   * Resets viewport to initial state\r\n   */\r\n  reset(): void {\r\n    this.viewport = {\r\n      x: 0,\r\n      y: 0,\r\n      width: this.viewport.width,\r\n      height: this.viewport.height,\r\n      scale: 1,\r\n      rotation: 0\r\n    };\r\n\r\n    this.interaction = {\r\n      isDragging: false,\r\n      isZooming: false\r\n    };\r\n\r\n    this.callbacks.onViewportChange?.(this.getViewport());\r\n    this.callbacks.onTransformChange?.(this.getTransform());\r\n  }\r\n}","import type {\r\n  TransformAnimation,\r\n  CanvasTransform,\r\n  Point2D\r\n} from '../types';\r\nimport { interpolateMatrix } from './matrixOperations';\r\n\r\n/**\r\n * Transform animation utilities για smooth transitions\r\n * Enterprise-grade animations με easing functions και callback support\r\n */\r\n\r\n/**\r\n * Easing functions για animations\r\n */\r\nexport const easingFunctions = {\r\n  linear: (t: number): number => t,\r\n\r\n  easeIn: (t: number): number => t * t,\r\n\r\n  easeOut: (t: number): number => t * (2 - t),\r\n\r\n  easeInOut: (t: number): number =>\r\n    t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t,\r\n\r\n  easeInCubic: (t: number): number => t * t * t,\r\n\r\n  easeOutCubic: (t: number): number => (--t) * t * t + 1,\r\n\r\n  easeInOutCubic: (t: number): number =>\r\n    t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1,\r\n\r\n  easeInQuart: (t: number): number => t * t * t * t,\r\n\r\n  easeOutQuart: (t: number): number => 1 - (--t) * t * t * t,\r\n\r\n  easeInOutQuart: (t: number): number =>\r\n    t < 0.5 ? 8 * t * t * t * t : 1 - 8 * (--t) * t * t * t,\r\n\r\n  elastic: (t: number): number => {\r\n    if (t === 0 || t === 1) return t;\r\n    const p = 0.3;\r\n    const s = p / 4;\r\n    return -(Math.pow(2, 10 * (t -= 1)) * Math.sin((t - s) * (2 * Math.PI) / p));\r\n  },\r\n\r\n  bounce: (t: number): number => {\r\n    if (t < 1 / 2.75) {\r\n      return 7.5625 * t * t;\r\n    } else if (t < 2 / 2.75) {\r\n      return 7.5625 * (t -= 1.5 / 2.75) * t + 0.75;\r\n    } else if (t < 2.5 / 2.75) {\r\n      return 7.5625 * (t -= 2.25 / 2.75) * t + 0.9375;\r\n    } else {\r\n      return 7.5625 * (t -= 2.625 / 2.75) * t + 0.984375;\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Animation manager για transform animations\r\n */\r\nexport class TransformAnimator {\r\n  private activeAnimations: Map<string, {\r\n    animation: TransformAnimation;\r\n    startTime: number;\r\n    rafId: number;\r\n  }> = new Map();\r\n\r\n  /**\r\n   * Starts a transform animation\r\n   */\r\n  animate(\r\n    id: string,\r\n    animation: TransformAnimation\r\n  ): Promise<void> {\r\n    // Cancel existing animation με same ID\r\n    this.cancel(id);\r\n\r\n    return new Promise<void>((resolve) => {\r\n      const startTime = performance.now();\r\n      const easingFn = easingFunctions[animation.easing] || easingFunctions.linear;\r\n\r\n      const animateFrame = (currentTime: number) => {\r\n        const elapsed = currentTime - startTime;\r\n        const progress = Math.min(elapsed / animation.duration, 1);\r\n        const easedProgress = easingFn(progress);\r\n\r\n        // Interpolate transform values\r\n        const currentTransform = this.interpolateTransform(\r\n          animation.from,\r\n          animation.to,\r\n          easedProgress\r\n        );\r\n\r\n        // Call update callback\r\n        animation.onUpdate?.(currentTransform);\r\n\r\n        if (progress >= 1) {\r\n          // Animation complete\r\n          this.activeAnimations.delete(id);\r\n          animation.onComplete?.();\r\n          resolve();\r\n        } else {\r\n          // Continue animation\r\n          const rafId = requestAnimationFrame(animateFrame);\r\n          const activeAnim = this.activeAnimations.get(id);\r\n          if (activeAnim) {\r\n            activeAnim.rafId = rafId;\r\n          }\r\n        }\r\n      };\r\n\r\n      const rafId = requestAnimationFrame(animateFrame);\r\n      this.activeAnimations.set(id, {\r\n        animation,\r\n        startTime,\r\n        rafId\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Cancels active animation\r\n   */\r\n  cancel(id: string): void {\r\n    const activeAnim = this.activeAnimations.get(id);\r\n    if (activeAnim) {\r\n      cancelAnimationFrame(activeAnim.rafId);\r\n      this.activeAnimations.delete(id);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cancels all active animations\r\n   */\r\n  cancelAll(): void {\r\n    this.activeAnimations.forEach((_, id) => this.cancel(id));\r\n  }\r\n\r\n  /**\r\n   * Checks if animation is active\r\n   */\r\n  isAnimating(id: string): boolean {\r\n    return this.activeAnimations.has(id);\r\n  }\r\n\r\n  /**\r\n   * Gets list of active animation IDs\r\n   */\r\n  getActiveAnimations(): string[] {\r\n    return Array.from(this.activeAnimations.keys());\r\n  }\r\n\r\n  /**\r\n   * Interpolates between two transform states\r\n   */\r\n  private interpolateTransform(\r\n    from: Partial<CanvasTransform>,\r\n    to: Partial<CanvasTransform>,\r\n    t: number\r\n  ): CanvasTransform {\r\n    // Create default transform if not provided\r\n    const defaultTransform: CanvasTransform = {\r\n      matrix: { a: 1, b: 0, c: 0, d: 1, e: 0, f: 0 },\r\n      viewport: { x: 0, y: 0, width: 800, height: 600, scale: 1, rotation: 0 },\r\n      scale: 1,\r\n      translation: { x: 0, y: 0 },\r\n      rotation: 0,\r\n      origin: { x: 0, y: 0 }\r\n    };\r\n\r\n    const fromTransform = { ...defaultTransform, ...from };\r\n    const toTransform = { ...defaultTransform, ...to };\r\n\r\n    // Interpolate matrix\r\n    const interpolatedMatrix = interpolateMatrix(\r\n      fromTransform.matrix,\r\n      toTransform.matrix,\r\n      t\r\n    );\r\n\r\n    // Interpolate viewport\r\n    const interpolatedViewport = {\r\n      x: fromTransform.viewport.x + (toTransform.viewport.x - fromTransform.viewport.x) * t,\r\n      y: fromTransform.viewport.y + (toTransform.viewport.y - fromTransform.viewport.y) * t,\r\n      width: fromTransform.viewport.width + (toTransform.viewport.width - fromTransform.viewport.width) * t,\r\n      height: fromTransform.viewport.height + (toTransform.viewport.height - fromTransform.viewport.height) * t,\r\n      scale: fromTransform.viewport.scale + (toTransform.viewport.scale - fromTransform.viewport.scale) * t,\r\n      rotation: fromTransform.viewport.rotation + (toTransform.viewport.rotation - fromTransform.viewport.rotation) * t\r\n    };\r\n\r\n    // Interpolate other properties\r\n    const interpolatedScale = fromTransform.scale + (toTransform.scale - fromTransform.scale) * t;\r\n    const interpolatedRotation = fromTransform.rotation + (toTransform.rotation - fromTransform.rotation) * t;\r\n\r\n    const interpolatedTranslation = {\r\n      x: fromTransform.translation.x + (toTransform.translation.x - fromTransform.translation.x) * t,\r\n      y: fromTransform.translation.y + (toTransform.translation.y - fromTransform.translation.y) * t\r\n    };\r\n\r\n    const interpolatedOrigin = {\r\n      x: fromTransform.origin.x + (toTransform.origin.x - fromTransform.origin.x) * t,\r\n      y: fromTransform.origin.y + (toTransform.origin.y - fromTransform.origin.y) * t\r\n    };\r\n\r\n    return {\r\n      matrix: interpolatedMatrix,\r\n      viewport: interpolatedViewport,\r\n      scale: interpolatedScale,\r\n      translation: interpolatedTranslation,\r\n      rotation: interpolatedRotation,\r\n      origin: interpolatedOrigin\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Global animator instance\r\n */\r\nexport const globalAnimator = new TransformAnimator();\r\n\r\n/**\r\n * High-level animation functions\r\n */\r\nexport const animations = {\r\n  /**\r\n   * Animates zoom to specific scale\r\n   */\r\n  zoomTo: (\r\n    targetScale: number,\r\n    _center: Point2D,\r\n    duration: number = 300,\r\n    easing: keyof typeof easingFunctions = 'easeOut'\r\n  ): Promise<void> => {\r\n    return globalAnimator.animate('zoom', {\r\n      duration,\r\n      easing,\r\n      from: { scale: 1 },\r\n      to: { scale: targetScale },\r\n      onUpdate: (transform) => {\r\n        // This would be handled by the viewport manager\r\n        console.log('Zoom animation update:', transform);\r\n      }\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Animates pan to specific position\r\n   */\r\n  panTo: (\r\n    targetPosition: Point2D,\r\n    duration: number = 300,\r\n    easing: keyof typeof easingFunctions = 'easeOut'\r\n  ): Promise<void> => {\r\n    return globalAnimator.animate('pan', {\r\n      duration,\r\n      easing,\r\n      from: { translation: { x: 0, y: 0 } },\r\n      to: { translation: targetPosition },\r\n      onUpdate: (transform) => {\r\n        console.log('Pan animation update:', transform);\r\n      }\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Animates rotation to specific angle\r\n   */\r\n  rotateTo: (\r\n    targetRotation: number,\r\n    duration: number = 300,\r\n    easing: keyof typeof easingFunctions = 'easeInOut'\r\n  ): Promise<void> => {\r\n    return globalAnimator.animate('rotate', {\r\n      duration,\r\n      easing,\r\n      from: { rotation: 0 },\r\n      to: { rotation: targetRotation },\r\n      onUpdate: (transform) => {\r\n        console.log('Rotation animation update:', transform);\r\n      }\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Smooth transition between two complete transform states\r\n   */\r\n  transitionTo: (\r\n    fromTransform: CanvasTransform,\r\n    toTransform: CanvasTransform,\r\n    duration: number = 500,\r\n    easing: keyof typeof easingFunctions = 'easeInOut'\r\n  ): Promise<void> => {\r\n    return globalAnimator.animate('transition', {\r\n      duration,\r\n      easing,\r\n      from: fromTransform,\r\n      to: toTransform,\r\n      onUpdate: (transform) => {\r\n        console.log('Transition animation update:', transform);\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * Animation utilities\r\n */\r\nexport const animationUtils = {\r\n  /**\r\n   * Creates spring animation parameters\r\n   */\r\n  createSpringAnimation: (\r\n    stiffness: number = 100,\r\n    damping: number = 10,\r\n    mass: number = 1\r\n  ) => {\r\n    const w0 = Math.sqrt(stiffness / mass);\r\n    const zeta = damping / (2 * Math.sqrt(stiffness * mass));\r\n\r\n    if (zeta < 1) {\r\n      // Under-damped\r\n      const wd = w0 * Math.sqrt(1 - zeta * zeta);\r\n      return (t: number) => {\r\n        const e = Math.exp(-zeta * w0 * t);\r\n        return 1 - e * (Math.cos(wd * t) + (zeta * w0 / wd) * Math.sin(wd * t));\r\n      };\r\n    } else if (zeta === 1) {\r\n      // Critically damped\r\n      return (t: number) => 1 - Math.exp(-w0 * t) * (1 + w0 * t);\r\n    } else {\r\n      // Over-damped\r\n      const r1 = -w0 * (zeta + Math.sqrt(zeta * zeta - 1));\r\n      const r2 = -w0 * (zeta - Math.sqrt(zeta * zeta - 1));\r\n      return (t: number) => {\r\n        const c1 = -r2 / (r1 - r2);\r\n        const c2 = r1 / (r1 - r2);\r\n        return 1 - c1 * Math.exp(r1 * t) - c2 * Math.exp(r2 * t);\r\n      };\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Calculates optimal animation duration based on distance\r\n   */\r\n  calculateDuration: (\r\n    startValue: number,\r\n    endValue: number,\r\n    baseSpeed: number = 1000 // units per second\r\n  ): number => {\r\n    const distance = Math.abs(endValue - startValue);\r\n    return Math.max(200, Math.min(1000, distance / baseSpeed * 1000));\r\n  },\r\n\r\n  /**\r\n   * Creates stepped animation για discrete values\r\n   */\r\n  createSteppedAnimation: (steps: number) => {\r\n    return (t: number): number => {\r\n      return Math.floor(t * steps) / steps;\r\n    };\r\n  }\r\n};","import type {\r\n  TransformContext,\r\n  CanvasTransform,\r\n  TransformationMatrix,\r\n  Point2D,\r\n  BoundingBox\r\n} from '../types';\r\n// Matrix operations imported as needed\r\n\r\n/**\r\n * Canvas utilities για applying transformations to 2D context\r\n * Enterprise-grade canvas transformation helpers\r\n */\r\n\r\n/**\r\n * Creates transform context wrapper για canvas\r\n */\r\nexport const createTransformContext = (\r\n  canvas: HTMLCanvasElement,\r\n  initialTransform?: CanvasTransform\r\n): TransformContext => {\r\n  const ctx = canvas.getContext('2d');\r\n  if (!ctx) {\r\n    throw new Error('Could not get 2D rendering context from canvas');\r\n  }\r\n\r\n  let currentTransform: CanvasTransform = initialTransform || {\r\n    matrix: { a: 1, b: 0, c: 0, d: 1, e: 0, f: 0 },\r\n    viewport: { x: 0, y: 0, width: canvas.width, height: canvas.height, scale: 1, rotation: 0 },\r\n    scale: 1,\r\n    translation: { x: 0, y: 0 },\r\n    rotation: 0,\r\n    origin: { x: 0, y: 0 }\r\n  };\r\n\r\n  const transformStack: CanvasTransform[] = [];\r\n\r\n  return {\r\n    ctx,\r\n    transform: currentTransform,\r\n\r\n    applyTransform: (): void => {\r\n      const { matrix } = currentTransform;\r\n      ctx.setTransform(matrix.a, matrix.b, matrix.c, matrix.d, matrix.e, matrix.f);\r\n    },\r\n\r\n    resetTransform: (): void => {\r\n      ctx.resetTransform();\r\n      currentTransform = {\r\n        matrix: { a: 1, b: 0, c: 0, d: 1, e: 0, f: 0 },\r\n        viewport: currentTransform.viewport,\r\n        scale: 1,\r\n        translation: { x: 0, y: 0 },\r\n        rotation: 0,\r\n        origin: { x: 0, y: 0 }\r\n      };\r\n    },\r\n\r\n    save: (): void => {\r\n      ctx.save();\r\n      transformStack.push({ ...currentTransform });\r\n    },\r\n\r\n    restore: (): void => {\r\n      ctx.restore();\r\n      const savedTransform = transformStack.pop();\r\n      if (savedTransform) {\r\n        currentTransform = savedTransform;\r\n      }\r\n    }\r\n  };\r\n};\r\n\r\n/**\r\n * Applies transformation matrix to canvas context\r\n */\r\nexport const applyMatrixToContext = (\r\n  ctx: CanvasRenderingContext2D,\r\n  matrix: TransformationMatrix\r\n): void => {\r\n  ctx.setTransform(matrix.a, matrix.b, matrix.c, matrix.d, matrix.e, matrix.f);\r\n};\r\n\r\n/**\r\n * Draws grid on canvas με transformation support\r\n */\r\nexport const drawGrid = (\r\n  ctx: CanvasRenderingContext2D,\r\n  gridSize: number,\r\n  bounds: BoundingBox,\r\n  options: {\r\n    majorGridColor?: string;\r\n    minorGridColor?: string;\r\n    majorGridInterval?: number;\r\n    lineWidth?: number;\r\n    alpha?: number;\r\n  } = {}\r\n): void => {\r\n  const {\r\n    majorGridColor = '#ddd',\r\n    minorGridColor = '#f0f0f0',\r\n    majorGridInterval = 5,\r\n    lineWidth = 1,\r\n    alpha = 1\r\n  } = options;\r\n\r\n  ctx.save();\r\n  ctx.globalAlpha = alpha;\r\n  ctx.lineWidth = lineWidth;\r\n\r\n  // Calculate grid boundaries\r\n  const startX = Math.floor(bounds.minX / gridSize) * gridSize;\r\n  const endX = Math.ceil(bounds.maxX / gridSize) * gridSize;\r\n  const startY = Math.floor(bounds.minY / gridSize) * gridSize;\r\n  const endY = Math.ceil(bounds.maxY / gridSize) * gridSize;\r\n\r\n  // Draw vertical lines\r\n  ctx.beginPath();\r\n  for (let x = startX; x <= endX; x += gridSize) {\r\n    const isMajor = Math.round(x / gridSize) % majorGridInterval === 0;\r\n    ctx.strokeStyle = isMajor ? majorGridColor : minorGridColor;\r\n\r\n    ctx.moveTo(x, bounds.minY);\r\n    ctx.lineTo(x, bounds.maxY);\r\n    ctx.stroke();\r\n  }\r\n\r\n  // Draw horizontal lines\r\n  ctx.beginPath();\r\n  for (let y = startY; y <= endY; y += gridSize) {\r\n    const isMajor = Math.round(y / gridSize) % majorGridInterval === 0;\r\n    ctx.strokeStyle = isMajor ? majorGridColor : minorGridColor;\r\n\r\n    ctx.moveTo(bounds.minX, y);\r\n    ctx.lineTo(bounds.maxX, y);\r\n    ctx.stroke();\r\n  }\r\n\r\n  ctx.restore();\r\n};\r\n\r\n/**\r\n * Draws coordinate axes\r\n */\r\nexport const drawAxes = (\r\n  ctx: CanvasRenderingContext2D,\r\n  bounds: BoundingBox,\r\n  options: {\r\n    xAxisColor?: string;\r\n    yAxisColor?: string;\r\n    lineWidth?: number;\r\n    showLabels?: boolean;\r\n    labelFont?: string;\r\n    labelColor?: string;\r\n  } = {}\r\n): void => {\r\n  const {\r\n    xAxisColor = '#333',\r\n    yAxisColor = '#333',\r\n    lineWidth = 2,\r\n    showLabels = true,\r\n    labelFont = '12px Arial',\r\n    labelColor = '#666'\r\n  } = options;\r\n\r\n  ctx.save();\r\n  ctx.lineWidth = lineWidth;\r\n\r\n  // Draw X axis (y = 0)\r\n  if (bounds.minY <= 0 && bounds.maxY >= 0) {\r\n    ctx.strokeStyle = xAxisColor;\r\n    ctx.beginPath();\r\n    ctx.moveTo(bounds.minX, 0);\r\n    ctx.lineTo(bounds.maxX, 0);\r\n    ctx.stroke();\r\n\r\n    if (showLabels) {\r\n      ctx.fillStyle = labelColor;\r\n      ctx.font = labelFont;\r\n      ctx.textAlign = 'center';\r\n      ctx.textBaseline = 'top';\r\n      ctx.fillText('X', bounds.maxX - 10, 5);\r\n    }\r\n  }\r\n\r\n  // Draw Y axis (x = 0)\r\n  if (bounds.minX <= 0 && bounds.maxX >= 0) {\r\n    ctx.strokeStyle = yAxisColor;\r\n    ctx.beginPath();\r\n    ctx.moveTo(0, bounds.minY);\r\n    ctx.lineTo(0, bounds.maxY);\r\n    ctx.stroke();\r\n\r\n    if (showLabels) {\r\n      ctx.fillStyle = labelColor;\r\n      ctx.font = labelFont;\r\n      ctx.textAlign = 'left';\r\n      ctx.textBaseline = 'middle';\r\n      ctx.fillText('Y', 5, bounds.minY + 10);\r\n    }\r\n  }\r\n\r\n  ctx.restore();\r\n};\r\n\r\n/**\r\n * Draws scale ruler\r\n */\r\nexport const drawRuler = (\r\n  ctx: CanvasRenderingContext2D,\r\n  position: 'top' | 'bottom' | 'left' | 'right',\r\n  bounds: BoundingBox,\r\n  scale: number,\r\n  options: {\r\n    height?: number;\r\n    backgroundColor?: string;\r\n    textColor?: string;\r\n    tickColor?: string;\r\n    font?: string;\r\n    unit?: string;\r\n  } = {}\r\n): void => {\r\n  const {\r\n    height = 30,\r\n    backgroundColor = 'rgba(255, 255, 255, 0.9)',\r\n    textColor = '#333',\r\n    tickColor = '#666',\r\n    font = '11px Arial',\r\n    unit = ''\r\n  } = options;\r\n\r\n  ctx.save();\r\n\r\n  // Calculate ruler area\r\n  let rulerBounds: BoundingBox;\r\n  switch (position) {\r\n    case 'top':\r\n      rulerBounds = { minX: bounds.minX, minY: bounds.minY, maxX: bounds.maxX, maxY: bounds.minY + height, width: bounds.width, height };\r\n      break;\r\n    case 'bottom':\r\n      rulerBounds = { minX: bounds.minX, minY: bounds.maxY - height, maxX: bounds.maxX, maxY: bounds.maxY, width: bounds.width, height };\r\n      break;\r\n    case 'left':\r\n      rulerBounds = { minX: bounds.minX, minY: bounds.minY, maxX: bounds.minX + height, maxY: bounds.maxY, width: height, height: bounds.height };\r\n      break;\r\n    case 'right':\r\n      rulerBounds = { minX: bounds.maxX - height, minY: bounds.minY, maxX: bounds.maxX, maxY: bounds.maxY, width: height, height: bounds.height };\r\n      break;\r\n  }\r\n\r\n  // Draw background\r\n  ctx.fillStyle = backgroundColor;\r\n  ctx.fillRect(rulerBounds.minX, rulerBounds.minY, rulerBounds.width, rulerBounds.height);\r\n\r\n  // Configure text\r\n  ctx.font = font;\r\n  ctx.fillStyle = textColor;\r\n  ctx.strokeStyle = tickColor;\r\n  ctx.lineWidth = 1;\r\n\r\n  // Calculate tick spacing\r\n  const pixelsPerUnit = scale;\r\n  const minTickSpacing = 50; // minimum pixels between major ticks\r\n  const unitSpacing = Math.pow(10, Math.floor(Math.log10(minTickSpacing / pixelsPerUnit)));\r\n\r\n  if (position === 'top' || position === 'bottom') {\r\n    // Horizontal ruler\r\n    const startValue = Math.floor(bounds.minX / unitSpacing) * unitSpacing;\r\n    const endValue = Math.ceil(bounds.maxX / unitSpacing) * unitSpacing;\r\n\r\n    ctx.textAlign = 'center';\r\n    ctx.textBaseline = position === 'top' ? 'bottom' : 'top';\r\n\r\n    for (let value = startValue; value <= endValue; value += unitSpacing) {\r\n      const x = value;\r\n      const y1 = position === 'top' ? rulerBounds.maxY : rulerBounds.minY;\r\n      const y2 = position === 'top' ? rulerBounds.maxY - height * 0.6 : rulerBounds.minY + height * 0.6;\r\n      const textY = position === 'top' ? rulerBounds.maxY - 2 : rulerBounds.minY + 2;\r\n\r\n      // Draw tick\r\n      ctx.beginPath();\r\n      ctx.moveTo(x, y1);\r\n      ctx.lineTo(x, y2);\r\n      ctx.stroke();\r\n\r\n      // Draw label\r\n      const label = value === 0 ? '0' : `${value}${unit}`;\r\n      ctx.fillText(label, x, textY);\r\n    }\r\n  } else {\r\n    // Vertical ruler\r\n    const startValue = Math.floor(bounds.minY / unitSpacing) * unitSpacing;\r\n    const endValue = Math.ceil(bounds.maxY / unitSpacing) * unitSpacing;\r\n\r\n    ctx.textAlign = position === 'left' ? 'right' : 'left';\r\n    ctx.textBaseline = 'middle';\r\n\r\n    for (let value = startValue; value <= endValue; value += unitSpacing) {\r\n      const y = value;\r\n      const x1 = position === 'left' ? rulerBounds.maxX : rulerBounds.minX;\r\n      const x2 = position === 'left' ? rulerBounds.maxX - height * 0.6 : rulerBounds.minX + height * 0.6;\r\n      const textX = position === 'left' ? rulerBounds.maxX - 2 : rulerBounds.minX + 2;\r\n\r\n      // Draw tick\r\n      ctx.beginPath();\r\n      ctx.moveTo(x1, y);\r\n      ctx.lineTo(x2, y);\r\n      ctx.stroke();\r\n\r\n      // Draw label\r\n      const label = value === 0 ? '0' : `${value}${unit}`;\r\n      ctx.fillText(label, textX, y);\r\n    }\r\n  }\r\n\r\n  ctx.restore();\r\n};\r\n\r\n/**\r\n * Draws crosshair cursor\r\n */\r\nexport const drawCrosshair = (\r\n  ctx: CanvasRenderingContext2D,\r\n  center: Point2D,\r\n  bounds: BoundingBox,\r\n  options: {\r\n    color?: string;\r\n    lineWidth?: number;\r\n    dashPattern?: number[];\r\n    alpha?: number;\r\n  } = {}\r\n): void => {\r\n  const {\r\n    color = '#ff0000',\r\n    lineWidth = 1,\r\n    dashPattern = [5, 5],\r\n    alpha = 0.7\r\n  } = options;\r\n\r\n  ctx.save();\r\n  ctx.strokeStyle = color;\r\n  ctx.lineWidth = lineWidth;\r\n  ctx.globalAlpha = alpha;\r\n  ctx.setLineDash(dashPattern);\r\n\r\n  // Vertical line\r\n  ctx.beginPath();\r\n  ctx.moveTo(center.x, bounds.minY);\r\n  ctx.lineTo(center.x, bounds.maxY);\r\n  ctx.stroke();\r\n\r\n  // Horizontal line\r\n  ctx.beginPath();\r\n  ctx.moveTo(bounds.minX, center.y);\r\n  ctx.lineTo(bounds.maxX, center.y);\r\n  ctx.stroke();\r\n\r\n  ctx.restore();\r\n};\r\n\r\n/**\r\n * Utility για measuring text dimensions\r\n */\r\nexport const measureText = (\r\n  ctx: CanvasRenderingContext2D,\r\n  text: string,\r\n  font?: string\r\n): { width: number; height: number } => {\r\n  ctx.save();\r\n\r\n  if (font) {\r\n    ctx.font = font;\r\n  }\r\n\r\n  const metrics = ctx.measureText(text);\r\n  const height = metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent;\r\n\r\n  ctx.restore();\r\n\r\n  return {\r\n    width: metrics.width,\r\n    height: height || 12 // fallback height\r\n  };\r\n};\r\n\r\n/**\r\n * High DPI canvas setup utility\r\n */\r\nexport const setupHighDPICanvas = (canvas: HTMLCanvasElement): {\r\n  ctx: CanvasRenderingContext2D;\r\n  ratio: number;\r\n} => {\r\n  const ctx = canvas.getContext('2d');\r\n  if (!ctx) {\r\n    throw new Error('Could not get 2D rendering context');\r\n  }\r\n\r\n  const ratio = window.devicePixelRatio || 1;\r\n\r\n  // Set actual canvas size\r\n  const rect = canvas.getBoundingClientRect();\r\n  canvas.width = rect.width * ratio;\r\n  canvas.height = rect.height * ratio;\r\n\r\n  // Scale context to match device pixel ratio\r\n  ctx.scale(ratio, ratio);\r\n\r\n  // Set CSS size to maintain appearance\r\n  canvas.style.width = rect.width + 'px';\r\n  canvas.style.height = rect.height + 'px';\r\n\r\n  return { ctx, ratio };\r\n};","/**\r\n * @layera/canvas-transforms\r\n * Enterprise-grade canvas transformation utilities για Layera ecosystem\r\n *\r\n * Features:\r\n * - Matrix transformation operations (2D & 3D)\r\n * - Coordinate system mapping (screen ↔ world)\r\n * - Viewport management με zoom/pan support\r\n * - Transform animations με easing functions\r\n * - Canvas utilities για rendering με transformations\r\n * - Geographic coordinate support (lat/lng ↔ Web Mercator)\r\n * - Grid and ruler rendering utilities\r\n * - High DPI canvas support\r\n * - Enterprise-grade TypeScript typing\r\n */\r\n\r\n// Core Types\r\nexport type {\r\n  Point2D,\r\n  Point3D,\r\n  BoundingBox,\r\n  Viewport,\r\n  TransformationMatrix,\r\n  CanvasTransform,\r\n  CoordinateSystem,\r\n  CoordinateMapping,\r\n  ZoomPanState,\r\n  InteractionState,\r\n  TransformAnimation,\r\n  CanvasConstraints,\r\n  GeometryTransform,\r\n  TransformContext\r\n} from './types';\r\n\r\n// Matrix Operations\r\nexport {\r\n  createIdentityMatrix,\r\n  createTranslationMatrix,\r\n  createScaleMatrix,\r\n  createRotationMatrix,\r\n  createRotationAroundPointMatrix,\r\n  multiplyMatrices,\r\n  getMatrixDeterminant,\r\n  invertMatrix,\r\n  transformPoint,\r\n  transformPoints,\r\n  transformBoundingBox,\r\n  decompose,\r\n  compose,\r\n  isIdentity,\r\n  interpolateMatrix,\r\n  matrixToCSSTransform,\r\n  matrixToSVGTransform\r\n} from './utils/matrixOperations';\r\n\r\n// Coordinate Mapping\r\nexport {\r\n  createCoordinateMapping,\r\n  createCanvasCoordinateMapping,\r\n  getCanvasCoordinates,\r\n  geoCoordinates,\r\n  gridCoordinates,\r\n  convertCoordinates\r\n} from './utils/coordinateMapping';\r\n\r\n// Viewport Management\r\nexport { ViewportManager } from './utils/viewportManager';\r\n\r\n// Transform Animations\r\nexport {\r\n  TransformAnimator,\r\n  easingFunctions,\r\n  globalAnimator,\r\n  animations,\r\n  animationUtils\r\n} from './utils/transformAnimations';\r\n\r\n// Canvas Utilities\r\nexport {\r\n  createTransformContext,\r\n  applyMatrixToContext,\r\n  drawGrid,\r\n  drawAxes,\r\n  drawRuler,\r\n  drawCrosshair,\r\n  measureText,\r\n  setupHighDPICanvas\r\n} from './utils/canvasUtils';\r\n\r\n// Default configurations\r\nexport const DEFAULT_VIEWPORT = {\r\n  x: 0,\r\n  y: 0,\r\n  width: 800,\r\n  height: 600,\r\n  scale: 1,\r\n  rotation: 0\r\n};\r\n\r\nexport const DEFAULT_CONSTRAINTS = {\r\n  minScale: 0.1,\r\n  maxScale: 10,\r\n  lockAspectRatio: false,\r\n  snapToGrid: false,\r\n  gridSize: 10\r\n};\r\n\r\nexport const DEFAULT_COORDINATE_SYSTEM = {\r\n  origin: { x: 0, y: 0 },\r\n  scaleX: 1,\r\n  scaleY: 1,\r\n  rotation: 0,\r\n  flipX: false,\r\n  flipY: false\r\n};"],"mappings":"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","names":["rafId"]}