{"version":3,"sources":["../src/index.ts","../src/types/geo.ts","../src/types/result.ts","../src/types/osm.ts","../src/utils/strings.ts","../src/http/client.ts","../src/cache/cache.ts","../src/utils/validation.ts","../src/parsers/buildings.ts","../src/parsers/boundaries.ts","../src/repositories/overpass-repository.ts"],"sourcesContent":["/**\r\n * @layera/osm - Public API\r\n *\r\n * Enterprise-grade OpenStreetMap services για Layera ecosystem.\r\n * Clean, type-safe API με comprehensive error handling.\r\n *\r\n * @example Basic Usage\r\n * ```typescript\r\n * import { createOSMClient } from '@layera/osm';\r\n *\r\n * const client = createOSMClient();\r\n *\r\n * // Search για buildings\r\n * const buildings = await client.buildings.findInBBox({\r\n *   south: 40.5,\r\n *   west: 22.9,\r\n *   north: 40.6,\r\n *   east: 23.0\r\n * });\r\n *\r\n * // Search για administrative boundaries\r\n * const boundaries = await client.boundaries.searchByName('Θεσσαλονίκη');\r\n * ```\r\n */\r\n\r\n// Core Types\r\nexport type {\r\n  // Geographic types\r\n  Point,\r\n  BBox,\r\n  Coordinate,\r\n  CoordinateArray,\r\n  Ring,\r\n  PolygonCoordinates\r\n} from './types/geo';\r\n\r\nexport type {\r\n  // Result types\r\n  Result,\r\n  AsyncResult,\r\n  HttpResult,\r\n  ResultData,\r\n  ResultError\r\n} from './types/result';\r\n\r\nexport type {\r\n  // OSM types\r\n  OSMNode,\r\n  OSMWay,\r\n  OSMRelation,\r\n  OSMElement,\r\n  OSMRelationMember,\r\n  OverpassResponse,\r\n  OSMBuildingFeature,\r\n  OSMBoundaryFeature,\r\n  OSMBuildingCollection,\r\n  OSMBoundaryCollection,\r\n  AdminLevel,\r\n  OverpassQuery,\r\n  OverpassFilter,\r\n  OSMCacheConfig,\r\n  OverpassClientConfig,\r\n  QueryMetrics,\r\n  RingSegment,\r\n  AssembledRing,\r\n  PolygonGeometry,\r\n  ValidationIssue,\r\n  ValidationResult,\r\n  BoundarySearchConfig,\r\n  BuildingSearchConfig,\r\n  OSMErrorContext\r\n} from './types/osm';\r\n\r\n// Utilities\r\nexport { GeoUtils, LeafletCompat, GeoConstants } from './types/geo';\r\nexport { ResultUtils } from './types/result';\r\nexport { OSMTypeGuards, OSMConstants, ADMIN_LEVELS } from './types/osm';\r\n\r\n// Internal imports for OSMClient implementation\r\nimport { BoundariesRepository, BuildingsRepository } from './repositories/overpass-repository';\r\nimport { OverpassHTTPClient } from './http/client';\r\nimport { OSMCacheManager } from './cache/cache';\r\n\r\n// Validation\r\nexport {\r\n  CoordinateValidation,\r\n  OSMValidation,\r\n  QueryValidation,\r\n  ValidationConstants\r\n} from './utils/validation';\r\n\r\nexport type {\r\n  ValidationError\r\n} from './utils/validation';\r\n\r\n// String utilities\r\nexport {\r\n  escapeRegex,\r\n  normalizeAreaName,\r\n  generateSearchVariants,\r\n  validateQueryString,\r\n  sanitizeInput,\r\n  formatCoordinateForDisplay,\r\n  createSafeTagValue,\r\n  validateOSMId,\r\n  createCacheKey,\r\n  validateURL,\r\n  StringConstants\r\n} from './utils/strings';\r\n\r\n// HTTP Client\r\nexport {\r\n  OverpassHTTPClient,\r\n  HTTPError,\r\n  TimeoutError,\r\n  NetworkError,\r\n  createDefaultClientConfig,\r\n  createHTTPClient\r\n} from './http/client';\r\n\r\nexport type {\r\n  RetryConfig\r\n} from './http/client';\r\n\r\n// Cache\r\nexport {\r\n  LayeraCache,\r\n  OSMCacheManager,\r\n  createDefaultCacheConfig,\r\n  createCacheManager\r\n} from './cache/cache';\r\n\r\nexport type {\r\n  CacheEntry,\r\n  CacheStats,\r\n  CacheEvent,\r\n  CacheEventListener\r\n} from './cache/cache';\r\n\r\n// Parsers\r\nexport {\r\n  BuildingsParser,\r\n  BuildingClassifier,\r\n  AddressProcessor,\r\n  HeightProcessor\r\n} from './parsers/buildings';\r\n\r\nexport {\r\n  BoundariesParser,\r\n  GreekAdminHierarchy,\r\n  BoundaryNameProcessor,\r\n  BoundaryStatsProcessor,\r\n  RingAssembler\r\n} from './parsers/boundaries';\r\n\r\n// Repositories\r\nexport {\r\n  OverpassQueryBuilder,\r\n  BuildingsRepository,\r\n  BoundariesRepository,\r\n  OSMRepositoryManager,\r\n  createRepositoryManager\r\n} from './repositories/overpass-repository';\r\n\r\n// Error classes\r\nexport {\r\n  OSMError,\r\n  NetworkError as OSMNetworkError,\r\n  ValidationError as OSMValidationError,\r\n  TimeoutError as OSMTimeoutError,\r\n  ParseError\r\n} from './types/result';\r\n\r\n/**\r\n * Main OSM client interface\r\n */\r\nexport interface OSMClient {\r\n  readonly buildings: any; // BuildingsRepository\r\n  readonly boundaries: any; // BoundariesRepository\r\n\r\n  /**\r\n   * Gets client health and performance metrics\r\n   */\r\n  getHealth(): {\r\n    http: any;\r\n    cache: any;\r\n    uptime: number;\r\n  };\r\n\r\n  /**\r\n   * Clears all caches\r\n   */\r\n  clearCaches(): void;\r\n\r\n  /**\r\n   * Performs cleanup operations\r\n   */\r\n  cleanup(): void;\r\n\r\n  /**\r\n   * Destroys client and releases resources\r\n   */\r\n  destroy(): void;\r\n}\r\n\r\n/**\r\n * OSM client configuration\r\n */\r\nexport interface OSMClientConfig {\r\n  /**\r\n   * HTTP client configuration\r\n   */\r\n  readonly http?: any; // Partial<OverpassClientConfig>\r\n\r\n  /**\r\n   * Cache configuration\r\n   */\r\n  readonly cache?: any; // Partial<OSMCacheConfig>\r\n\r\n  /**\r\n   * Enable debug logging\r\n   */\r\n  readonly debug?: boolean;\r\n\r\n  /**\r\n   * Custom user agent\r\n   */\r\n  readonly userAgent?: string;\r\n}\r\n\r\n/**\r\n * Internal OSM client implementation\r\n */\r\nclass OSMClientImpl implements OSMClient {\r\n  private readonly startTime = Date.now();\r\n  private readonly cache: OSMCacheManager;\r\n  private readonly httpClient: OverpassHTTPClient;\r\n  private readonly _boundaries: BoundariesRepository;\r\n  private readonly _buildings: BuildingsRepository;\r\n\r\n  constructor(config: OSMClientConfig = {}) {\r\n    // Initialize cache\r\n    this.cache = new OSMCacheManager({\r\n      maxSize: config.cache?.maxSize || 500,\r\n      ttlMs: config.cache?.ttlMs || 10 * 60 * 1000,\r\n      cleanupIntervalMs: config.cache?.cleanupIntervalMs || 5 * 60 * 1000\r\n    });\r\n\r\n    // Initialize HTTP client\r\n    this.httpClient = new OverpassHTTPClient({\r\n      servers: config.http?.servers || [\r\n        'https://overpass-api.de/api/interpreter',\r\n        'https://overpass.kumi.systems/api/interpreter',\r\n        'https://overpass.openstreetmap.ru/api/interpreter'\r\n      ],\r\n      timeout: config.http?.timeout || 30000,\r\n      userAgent: config.http?.userAgent || 'Layera-Enterprise-OSM/1.0',\r\n      rateLimitRps: config.http?.rateLimitRps || 1,\r\n      retryAttempts: config.http?.retryAttempts || 3,\r\n      retryDelayMs: config.http?.retryDelayMs || 1000\r\n    });\r\n\r\n    // Initialize repositories\r\n    this._boundaries = new BoundariesRepository(this.httpClient, this.cache);\r\n    this._buildings = new BuildingsRepository(this.httpClient, this.cache);\r\n\r\n    if (config.debug) {\r\n      console.log('OSM Client initialized with config:', config);\r\n    }\r\n  }\r\n\r\n  get buildings(): BuildingsRepository {\r\n    return this._buildings;\r\n  }\r\n\r\n  get boundaries(): BoundariesRepository {\r\n    return this._boundaries;\r\n  }\r\n\r\n  getHealth() {\r\n    return {\r\n      http: { status: 'ok' },\r\n      cache: { status: 'ok', entries: 0 },\r\n      uptime: Date.now() - this.startTime\r\n    };\r\n  }\r\n\r\n  clearCaches(): void {\r\n    this.cache.clearAll();\r\n  }\r\n\r\n  cleanup(): void {\r\n    this.cache.cleanupAll();\r\n  }\r\n\r\n  destroy(): void {\r\n    this.cache.destroy();\r\n  }\r\n}\r\n\r\n/**\r\n * Creates new OSM client instance\r\n *\r\n * @param config Client configuration\r\n * @returns Configured OSM client\r\n *\r\n * @example\r\n * ```typescript\r\n * // Basic client\r\n * const client = createOSMClient();\r\n *\r\n * // Custom configuration\r\n * const client = createOSMClient({\r\n *   http: {\r\n *     timeout: 60000,\r\n *     retryAttempts: 5\r\n *   },\r\n *   cache: {\r\n *     maxSize: 100 * 1024 * 1024, // 100MB\r\n *     ttlMs: 60 * 60 * 1000 // 1 hour\r\n *   },\r\n *   debug: true\r\n * });\r\n * ```\r\n */\r\nexport const createOSMClient = (config: OSMClientConfig = {}): OSMClient => {\r\n  return new OSMClientImpl(config);\r\n};\r\n\r\n/**\r\n * Default OSM client instance\r\n * Convenient για applications που χρειάζονται μόνο ένα client\r\n */\r\nexport const defaultOSMClient = createOSMClient();\r\n\r\n/**\r\n * Convenience functions που χρησιμοποιούν το default client\r\n */\r\nexport const OSMService = {\r\n  /**\r\n   * Searches για buildings σε bounding box\r\n   */\r\n  findBuildings: defaultOSMClient.buildings.findInBBox.bind(defaultOSMClient.buildings),\r\n\r\n  /**\r\n   * Searches για buildings near point\r\n   */\r\n  findBuildingsNearPoint: defaultOSMClient.buildings.findNearPoint.bind(defaultOSMClient.buildings),\r\n\r\n  /**\r\n   * Searches για boundaries by name\r\n   */\r\n  searchBoundaries: defaultOSMClient.boundaries.searchByName.bind(defaultOSMClient.boundaries),\r\n\r\n  /**\r\n   * Gets boundaries containing point\r\n   */\r\n  findBoundariesContainingPoint: defaultOSMClient.boundaries.findContainingPoint.bind(defaultOSMClient.boundaries),\r\n\r\n  /**\r\n   * Gets client health\r\n   */\r\n  getHealth: defaultOSMClient.getHealth.bind(defaultOSMClient),\r\n\r\n  /**\r\n   * Clears all caches\r\n   */\r\n  clearCaches: defaultOSMClient.clearCaches.bind(defaultOSMClient)\r\n};\r\n\r\n/**\r\n * Version information\r\n */\r\nexport const version = '1.0.0';\r\n\r\n/**\r\n * Package metadata\r\n */\r\nexport const packageInfo = {\r\n  name: '@layera/osm',\r\n  version,\r\n  description: 'Enterprise-grade OpenStreetMap services για Layera ecosystem',\r\n  author: 'Layera Development Team',\r\n  license: 'MIT'\r\n} as const;","/**\r\n * @layera/osm - SSR-Safe Geographic Types\r\n *\r\n * Αυτόνομοι γεωγραφικοί τύποι που δεν εξαρτώνται από browser-specific libraries όπως Leaflet.\r\n * Κατάλληλοι για Server-Side Rendering (SSR) και cross-platform compatibility.\r\n *\r\n * Εμπνευσμένο από GeoJSON spec και enterprise GIS standards.\r\n */\r\n\r\n/**\r\n * SSR-safe geographic point\r\n * Αντικαθιστά το L.LatLng από Leaflet\r\n */\r\nexport interface Point {\r\n  readonly lat: number;\r\n  readonly lng: number;\r\n}\r\n\r\n/**\r\n * SSR-safe bounding box\r\n * Αντικαθιστά το L.LatLngBounds από Leaflet\r\n */\r\nexport interface BBox {\r\n  readonly south: number;\r\n  readonly west: number;\r\n  readonly north: number;\r\n  readonly east: number;\r\n}\r\n\r\n/**\r\n * Geographic coordinate pair [longitude, latitude]\r\n * Ακολουθεί το GeoJSON standard\r\n */\r\nexport type Coordinate = readonly [number, number];\r\n\r\n/**\r\n * Array of coordinates που σχηματίζει γραμμή ή ring\r\n */\r\nexport type CoordinateArray = readonly Coordinate[];\r\n\r\n/**\r\n * Polygon ring (outer ή inner)\r\n */\r\nexport type Ring = CoordinateArray;\r\n\r\n/**\r\n * Polygon με outer ring και optional holes\r\n */\r\nexport interface PolygonCoordinates {\r\n  readonly outer: Ring;\r\n  readonly holes?: readonly Ring[];\r\n}\r\n\r\n/**\r\n * Utility functions για γεωγραφικούς υπολογισμούς\r\n */\r\nexport namespace GeoUtils {\r\n  /**\r\n   * Δημιουργεί Point από lat/lng\r\n   */\r\n  export const point = (lat: number, lng: number): Point => ({ lat, lng });\r\n\r\n  /**\r\n   * Δημιουργεί BBox από coordinates\r\n   */\r\n  export const bbox = (south: number, west: number, north: number, east: number): BBox => ({\r\n    south,\r\n    west,\r\n    north,\r\n    east\r\n  });\r\n\r\n  /**\r\n   * Μετατρέπει Point σε GeoJSON coordinate\r\n   */\r\n  export const pointToCoordinate = (point: Point): Coordinate => [point.lng, point.lat];\r\n\r\n  /**\r\n   * Μετατρέπει GeoJSON coordinate σε Point\r\n   */\r\n  export const coordinateToPoint = (coord: Coordinate): Point => ({\r\n    lat: coord[1],\r\n    lng: coord[0]\r\n  });\r\n\r\n  /**\r\n   * Ελέγχει αν ένα Point είναι εντός BBox\r\n   */\r\n  export const pointInBBox = (point: Point, bbox: BBox): boolean => {\r\n    return (\r\n      point.lat >= bbox.south &&\r\n      point.lat <= bbox.north &&\r\n      point.lng >= bbox.west &&\r\n      point.lng <= bbox.east\r\n    );\r\n  };\r\n\r\n  /**\r\n   * Υπολογίζει το κέντρο ενός BBox\r\n   */\r\n  export const bboxCenter = (bbox: BBox): Point => ({\r\n    lat: (bbox.south + bbox.north) / 2,\r\n    lng: (bbox.west + bbox.east) / 2\r\n  });\r\n\r\n  /**\r\n   * Υπολογίζει το εμβαδόν ενός BBox σε τετραγωνικές μοίρες\r\n   */\r\n  export const bboxArea = (bbox: BBox): number => {\r\n    return (bbox.north - bbox.south) * (bbox.east - bbox.west);\r\n  };\r\n\r\n  /**\r\n   * Ελέγχει αν δύο BBox τέμνονται\r\n   */\r\n  export const bboxIntersects = (bbox1: BBox, bbox2: BBox): boolean => {\r\n    return !(\r\n      bbox1.east < bbox2.west ||\r\n      bbox1.west > bbox2.east ||\r\n      bbox1.north < bbox2.south ||\r\n      bbox1.south > bbox2.north\r\n    );\r\n  };\r\n\r\n  /**\r\n   * Δημιουργεί το union δύο BBox\r\n   */\r\n  export const bboxUnion = (bbox1: BBox, bbox2: BBox): BBox => ({\r\n    south: Math.min(bbox1.south, bbox2.south),\r\n    west: Math.min(bbox1.west, bbox2.west),\r\n    north: Math.max(bbox1.north, bbox2.north),\r\n    east: Math.max(bbox1.east, bbox2.east)\r\n  });\r\n\r\n  /**\r\n   * Ελέγχει αν ένα BBox είναι έγκυρο\r\n   */\r\n  export const isValidBBox = (bbox: BBox): boolean => {\r\n    return (\r\n      bbox.south <= bbox.north &&\r\n      bbox.west <= bbox.east &&\r\n      bbox.south >= -90 &&\r\n      bbox.north <= 90 &&\r\n      bbox.west >= -180 &&\r\n      bbox.east <= 180\r\n    );\r\n  };\r\n\r\n  /**\r\n   * Normalizes longitude σε [-180, 180] range\r\n   */\r\n  export const normalizeLongitude = (lng: number): number => {\r\n    while (lng > 180) lng -= 360;\r\n    while (lng < -180) lng += 360;\r\n    return lng;\r\n  };\r\n\r\n  /**\r\n   * Normalizes latitude σε [-90, 90] range\r\n   */\r\n  export const normalizeLatitude = (lat: number): number => {\r\n    return Math.max(-90, Math.min(90, lat));\r\n  };\r\n\r\n  /**\r\n   * Υπολογίζει απόσταση μεταξύ δύο points σε μέτρα (Haversine formula)\r\n   */\r\n  export const distanceInMeters = (point1: Point, point2: Point): number => {\r\n    const R = 6371000; // Earth radius σε μέτρα\r\n    const dLat = toRadians(point2.lat - point1.lat);\r\n    const dLng = toRadians(point2.lng - point1.lng);\r\n\r\n    const a =\r\n      Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n      Math.cos(toRadians(point1.lat)) *\r\n        Math.cos(toRadians(point2.lat)) *\r\n        Math.sin(dLng / 2) *\r\n        Math.sin(dLng / 2);\r\n\r\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n    return R * c;\r\n  };\r\n\r\n  /**\r\n   * Converts degrees σε radians\r\n   */\r\n  export const toRadians = (degrees: number): number => (degrees * Math.PI) / 180;\r\n\r\n  /**\r\n   * Converts radians σε degrees\r\n   */\r\n  export const toDegrees = (radians: number): number => (radians * 180) / Math.PI;\r\n\r\n  /**\r\n   * Υπολογίζει bearing μεταξύ δύο points σε degrees\r\n   */\r\n  export const bearing = (point1: Point, point2: Point): number => {\r\n    const dLng = toRadians(point2.lng - point1.lng);\r\n    const lat1 = toRadians(point1.lat);\r\n    const lat2 = toRadians(point2.lat);\r\n\r\n    const y = Math.sin(dLng) * Math.cos(lat2);\r\n    const x =\r\n      Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(dLng);\r\n\r\n    const bearingRad = Math.atan2(y, x);\r\n    return (toDegrees(bearingRad) + 360) % 360;\r\n  };\r\n\r\n  /**\r\n   * Δημιουργεί buffer γύρω από Point (απλό τετράγωνο)\r\n   */\r\n  export const pointBuffer = (point: Point, radiusMeters: number): BBox => {\r\n    // Approximate conversion: 1 degree ≈ 111,000 meters\r\n    const degreeRadius = radiusMeters / 111000;\r\n\r\n    return {\r\n      south: point.lat - degreeRadius,\r\n      west: point.lng - degreeRadius,\r\n      north: point.lat + degreeRadius,\r\n      east: point.lng + degreeRadius\r\n    };\r\n  };\r\n\r\n  /**\r\n   * Formats coordinates για display\r\n   */\r\n  export const formatPoint = (point: Point, precision = 6): string => {\r\n    return `${point.lat.toFixed(precision)}, ${point.lng.toFixed(precision)}`;\r\n  };\r\n\r\n  /**\r\n   * Formats BBox για display\r\n   */\r\n  export const formatBBox = (bbox: BBox, precision = 4): string => {\r\n    return `${bbox.south.toFixed(precision)},${bbox.west.toFixed(precision)},${bbox.north.toFixed(precision)},${bbox.east.toFixed(precision)}`;\r\n  };\r\n}\r\n\r\n/**\r\n * Conversion utilities για compatibility με existing Leaflet code\r\n */\r\nexport namespace LeafletCompat {\r\n  /**\r\n   * Converts Leaflet LatLng σε Point\r\n   */\r\n  export const fromLatLng = (latlng: { lat: number; lng: number }): Point => ({\r\n    lat: latlng.lat,\r\n    lng: latlng.lng\r\n  });\r\n\r\n  /**\r\n   * Converts Leaflet LatLngBounds σε BBox\r\n   */\r\n  export const fromLatLngBounds = (bounds: {\r\n    getSouth(): number;\r\n    getWest(): number;\r\n    getNorth(): number;\r\n    getEast(): number;\r\n  }): BBox => ({\r\n    south: bounds.getSouth(),\r\n    west: bounds.getWest(),\r\n    north: bounds.getNorth(),\r\n    east: bounds.getEast()\r\n  });\r\n\r\n  /**\r\n   * Converts Point σε Leaflet-compatible object\r\n   */\r\n  export const toLatLng = (point: Point): { lat: number; lng: number } => ({\r\n    lat: point.lat,\r\n    lng: point.lng\r\n  });\r\n\r\n  /**\r\n   * Converts BBox σε Leaflet-compatible bounds\r\n   */\r\n  export const toLatLngBounds = (bbox: BBox): [[number, number], [number, number]] => [\r\n    [bbox.south, bbox.west],\r\n    [bbox.north, bbox.east]\r\n  ];\r\n}\r\n\r\n/**\r\n * Constants για geographic operations\r\n */\r\nexport const GeoConstants = {\r\n  /** Earth radius σε μέτρα */\r\n  EARTH_RADIUS_METERS: 6371000,\r\n\r\n  /** Earth circumference σε μέτρα */\r\n  EARTH_CIRCUMFERENCE_METERS: 40075000,\r\n\r\n  /** Approximate meters per degree στον ισημερινό */\r\n  METERS_PER_DEGREE: 111000,\r\n\r\n  /** WGS84 coordinate system limits */\r\n  WGS84_BOUNDS: {\r\n    south: -90,\r\n    west: -180,\r\n    north: 90,\r\n    east: 180\r\n  } as const,\r\n\r\n  /** Typical zoom levels για mapping */\r\n  ZOOM_LEVELS: {\r\n    WORLD: 1,\r\n    CONTINENT: 3,\r\n    COUNTRY: 6,\r\n    REGION: 8,\r\n    CITY: 10,\r\n    DISTRICT: 13,\r\n    STREET: 16,\r\n    BUILDING: 18\r\n  } as const\r\n} as const;","/**\r\n * @layera/osm - Foundation Types\r\n *\r\n * Generic Result<T, E> type για enterprise-grade error handling.\r\n * Εμπνευσμένο από Rust Result<T, E> και functional programming patterns.\r\n *\r\n * Χρησιμοποιείται σε όλο το Layera ecosystem για consistent error handling.\r\n */\r\n\r\n/**\r\n * Generic Result type που εγκλωβίζει επιτυχημένα αποτελέσματα ή errors\r\n * Εναλλακτική στο throwing exceptions που επιτρέπει explicit error handling\r\n *\r\n * @template T - Ο τύπος του επιτυχημένου αποτελέσματος\r\n * @template E - Ο τύπος του error (default: Error)\r\n *\r\n * @example\r\n * ```typescript\r\n * async function fetchData(): Promise<Result<string, NetworkError>> {\r\n *   try {\r\n *     const data = await api.get('/data');\r\n *     return { ok: true, data };\r\n *   } catch (error) {\r\n *     return { ok: false, error: new NetworkError(error.message) };\r\n *   }\r\n * }\r\n *\r\n * const result = await fetchData();\r\n * if (result.ok) {\r\n *   console.log(result.data); // Type-safe access\r\n * } else {\r\n *   console.error(result.error.message);\r\n * }\r\n * ```\r\n */\r\nexport type Result<T, E = Error> =\r\n  | { readonly ok: true; readonly data: T }\r\n  | { readonly ok: false; readonly error: E; readonly status?: number };\r\n\r\n/**\r\n * HTTP-specific Result που περιλαμβάνει status codes\r\n * Χρησιμοποιείται για API calls που χρειάζονται HTTP semantics\r\n */\r\nexport type HttpResult<T, E = Error> = Result<T, E> & {\r\n  readonly status?: number;\r\n  readonly headers?: Record<string, string>;\r\n};\r\n\r\n/**\r\n * Async Result για Promise-based operations\r\n */\r\nexport type AsyncResult<T, E = Error> = Promise<Result<T, E>>;\r\n\r\n/**\r\n * Utility type για εξαγωγή του data type από ένα Result\r\n *\r\n * @example\r\n * ```typescript\r\n * type UserResult = Result<User, ValidationError>;\r\n * type UserData = ResultData<UserResult>; // User\r\n * ```\r\n */\r\nexport type ResultData<R> = R extends Result<infer T, any> ? T : never;\r\n\r\n/**\r\n * Utility type για εξαγωγή του error type από ένα Result\r\n */\r\nexport type ResultError<R> = R extends Result<any, infer E> ? E : never;\r\n\r\n/**\r\n * Utility functions για Result operations\r\n */\r\nexport namespace ResultUtils {\r\n  /**\r\n   * Δημιουργεί επιτυχημένο Result\r\n   */\r\n  export const ok = <T>(data: T): Result<T, never> => ({ ok: true, data });\r\n\r\n  /**\r\n   * Δημιουργεί αποτυχημένο Result\r\n   */\r\n  export const error = <E>(error: E, status?: number): Result<never, E> => {\r\n    const result: Result<never, E> = { ok: false, error };\r\n    if (status !== undefined) {\r\n      (result as any).status = status;\r\n    }\r\n    return result;\r\n  };\r\n\r\n  /**\r\n   * Δημιουργεί αποτυχημένο Result με Error instance\r\n   */\r\n  export const fail = (message: string, status?: number): Result<never, Error> => {\r\n    const result: Result<never, Error> = { ok: false, error: new Error(message) };\r\n    if (status !== undefined) {\r\n      (result as any).status = status;\r\n    }\r\n    return result;\r\n  };\r\n\r\n  /**\r\n   * Maps το data ενός επιτυχημένου Result\r\n   */\r\n  export const map = <T, U, E>(\r\n    result: Result<T, E>,\r\n    fn: (data: T) => U\r\n  ): Result<U, E> => {\r\n    return result.ok ? { ok: true, data: fn(result.data) } : result;\r\n  };\r\n\r\n  /**\r\n   * Maps το error ενός αποτυχημένου Result\r\n   */\r\n  export const mapError = <T, E, F>(\r\n    result: Result<T, E>,\r\n    fn: (error: E) => F\r\n  ): Result<T, F> => {\r\n    return result.ok ? result : { ...result, error: fn(result.error) };\r\n  };\r\n\r\n  /**\r\n   * Chains Results μαζί (flatMap)\r\n   */\r\n  export const chain = <T, U, E>(\r\n    result: Result<T, E>,\r\n    fn: (data: T) => Result<U, E>\r\n  ): Result<U, E> => {\r\n    return result.ok ? fn(result.data) : result;\r\n  };\r\n\r\n  /**\r\n   * Unwraps Result ή επιστρέφει default value\r\n   */\r\n  export const unwrapOr = <T, E>(result: Result<T, E>, defaultValue: T): T => {\r\n    return result.ok ? result.data : defaultValue;\r\n  };\r\n\r\n  /**\r\n   * Unwraps Result ή throws error\r\n   */\r\n  export const unwrap = <T, E>(result: Result<T, E>): T => {\r\n    if (result.ok) {\r\n      return result.data;\r\n    }\r\n\r\n    if (result.error instanceof Error) {\r\n      throw result.error;\r\n    }\r\n\r\n    throw new Error(String(result.error));\r\n  };\r\n\r\n  /**\r\n   * Συνδυάζει multiple Results σε ένα\r\n   * Αποτυγχάνει αν οποιοδήποτε Result είναι error\r\n   */\r\n  export const combine = <T extends readonly unknown[], E>(\r\n    results: { [K in keyof T]: Result<T[K], E> }\r\n  ): Result<T, E> => {\r\n    const data = [] as unknown as { -readonly [K in keyof T]: T[K] };\r\n\r\n    for (let i = 0; i < results.length; i++) {\r\n      const result = results[i];\r\n      if (result && !result.ok) {\r\n        return result as Result<never, E>;\r\n      }\r\n      if (result) {\r\n        data[i] = result.data;\r\n      }\r\n    }\r\n\r\n    return { ok: true, data };\r\n  };\r\n\r\n  /**\r\n   * Converts Promise<T> σε AsyncResult<T>\r\n   */\r\n  export const fromPromise = async <T>(\r\n    promise: Promise<T>\r\n  ): AsyncResult<T, Error> => {\r\n    try {\r\n      const data = await promise;\r\n      return { ok: true, data };\r\n    } catch (error) {\r\n      return {\r\n        ok: false,\r\n        error: error instanceof Error ? error : new Error(String(error))\r\n      };\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Converts AsyncResult<T> σε Promise<T> (throws on error)\r\n   */\r\n  export const toPromise = async <T, E>(\r\n    asyncResult: AsyncResult<T, E>\r\n  ): Promise<T> => {\r\n    const result = await asyncResult;\r\n    return unwrap(result);\r\n  };\r\n}\r\n\r\n/**\r\n * Common error types για OSM operations\r\n */\r\nexport class OSMError extends Error {\r\n  constructor(\r\n    message: string,\r\n    public readonly code: string,\r\n    public readonly details?: Record<string, unknown>\r\n  ) {\r\n    super(message);\r\n    this.name = 'OSMError';\r\n  }\r\n}\r\n\r\nexport class NetworkError extends OSMError {\r\n  constructor(message: string, public readonly status?: number) {\r\n    super(message, 'NETWORK_ERROR', { status });\r\n    this.name = 'NetworkError';\r\n  }\r\n}\r\n\r\nexport class ValidationError extends OSMError {\r\n  constructor(message: string, public readonly field?: string) {\r\n    super(message, 'VALIDATION_ERROR', { field });\r\n    this.name = 'ValidationError';\r\n  }\r\n}\r\n\r\nexport class TimeoutError extends OSMError {\r\n  constructor(message: string, public readonly timeoutMs?: number) {\r\n    super(message, 'TIMEOUT_ERROR', { timeoutMs });\r\n    this.name = 'TimeoutError';\r\n  }\r\n}\r\n\r\nexport class ParseError extends OSMError {\r\n  constructor(message: string, public readonly data?: unknown) {\r\n    super(message, 'PARSE_ERROR', { data });\r\n    this.name = 'ParseError';\r\n  }\r\n}","/**\r\n * @layera/osm - OpenStreetMap Types\r\n *\r\n * Type definitions για OpenStreetMap data structures και Overpass API responses.\r\n * Enterprise-grade types με strict validation και type safety.\r\n */\r\n\r\nimport type { FeatureCollection, Feature, Polygon, MultiPolygon } from 'geojson';\r\n\r\n/**\r\n * Core OSM element types\r\n */\r\nexport interface OSMNode {\r\n  readonly type: 'node';\r\n  readonly id: number;\r\n  readonly lat: number;\r\n  readonly lon: number;\r\n  readonly tags?: Record<string, string>;\r\n  readonly timestamp?: string;\r\n  readonly version?: number;\r\n  readonly changeset?: number;\r\n  readonly user?: string;\r\n  readonly uid?: number;\r\n}\r\n\r\nexport interface OSMWay {\r\n  readonly type: 'way';\r\n  readonly id: number;\r\n  readonly nodes: readonly number[];\r\n  readonly tags?: Record<string, string>;\r\n  readonly timestamp?: string;\r\n  readonly version?: number;\r\n  readonly changeset?: number;\r\n  readonly user?: string;\r\n  readonly uid?: number;\r\n}\r\n\r\nexport interface OSMRelationMember {\r\n  readonly type: 'node' | 'way' | 'relation';\r\n  readonly ref: number;\r\n  readonly role: string;\r\n}\r\n\r\nexport interface OSMRelation {\r\n  readonly type: 'relation';\r\n  readonly id: number;\r\n  readonly members: readonly OSMRelationMember[];\r\n  readonly tags?: Record<string, string>;\r\n  readonly timestamp?: string;\r\n  readonly version?: number;\r\n  readonly changeset?: number;\r\n  readonly user?: string;\r\n  readonly uid?: number;\r\n}\r\n\r\n/**\r\n * Union type για όλα τα OSM elements\r\n */\r\nexport type OSMElement = OSMNode | OSMWay | OSMRelation;\r\n\r\n/**\r\n * Overpass API response structure\r\n */\r\nexport interface OverpassResponse {\r\n  readonly version: number;\r\n  readonly generator: string;\r\n  readonly osm3s?: {\r\n    readonly timestamp_osm_base: string;\r\n    readonly copyright: string;\r\n  };\r\n  readonly elements: readonly OSMElement[];\r\n}\r\n\r\n/**\r\n * Specialized GeoJSON types για OSM features\r\n */\r\n\r\n/**\r\n * Building feature από OSM data\r\n */\r\nexport interface OSMBuildingFeature extends Feature<Polygon | MultiPolygon> {\r\n  readonly properties: {\r\n    readonly id: number;\r\n    readonly type: 'way' | 'relation';\r\n    readonly building: string;\r\n    readonly name?: string;\r\n    readonly height?: string;\r\n    readonly levels?: string;\r\n    readonly addr_housenumber?: string;\r\n    readonly addr_street?: string;\r\n    readonly addr_city?: string;\r\n    readonly addr_postcode?: string;\r\n    readonly [key: string]: unknown;\r\n  };\r\n}\r\n\r\n/**\r\n * Administrative boundary feature από OSM data\r\n */\r\nexport interface OSMBoundaryFeature extends Feature<Polygon | MultiPolygon> {\r\n  readonly properties: {\r\n    readonly id: number;\r\n    readonly type: 'relation';\r\n    readonly admin_level: string;\r\n    readonly name?: string;\r\n    readonly name_el?: string;\r\n    readonly name_en?: string;\r\n    readonly boundary: string;\r\n    readonly place?: string;\r\n    readonly population?: string;\r\n    readonly wikidata?: string;\r\n    readonly wikipedia?: string;\r\n    readonly [key: string]: unknown;\r\n  };\r\n}\r\n\r\n/**\r\n * GeoJSON collections για OSM features\r\n */\r\nexport interface OSMBuildingCollection extends FeatureCollection<Polygon | MultiPolygon> {\r\n  features: OSMBuildingFeature[];\r\n}\r\n\r\nexport interface OSMBoundaryCollection extends FeatureCollection<Polygon | MultiPolygon> {\r\n  features: OSMBoundaryFeature[];\r\n}\r\n\r\n/**\r\n * Administrative levels used in Greece\r\n */\r\nexport const ADMIN_LEVELS = {\r\n  /** Χώρα (Greece) */\r\n  COUNTRY: 2,\r\n  /** Περιφέρεια (e.g., Κεντρική Μακεδονία) */\r\n  REGION: 4,\r\n  /** Περιφερειακή Ενότητα (e.g., Θεσσαλονίκης) */\r\n  REGIONAL_UNIT: 6,\r\n  /** Δήμος (e.g., Δήμος Θεσσαλονίκης) */\r\n  MUNICIPALITY: 8,\r\n  /** Δημοτική/Τοπική Κοινότητα */\r\n  COMMUNITY: 9,\r\n  /** Οικισμός */\r\n  SETTLEMENT: 10\r\n} as const;\r\n\r\nexport type AdminLevel = typeof ADMIN_LEVELS[keyof typeof ADMIN_LEVELS];\r\n\r\n/**\r\n * Overpass query builder types\r\n */\r\nexport interface OverpassQuery {\r\n  readonly format: 'json' | 'xml';\r\n  readonly timeout: number;\r\n  readonly elements: readonly string[];\r\n  readonly filters: readonly OverpassFilter[];\r\n  readonly output: 'out' | 'out geom' | 'out center' | 'out ids';\r\n}\r\n\r\nexport interface OverpassFilter {\r\n  readonly key: string;\r\n  readonly value?: string;\r\n  readonly operator?: '=' | '!=' | '~' | '!~' | 'exists' | '!exists';\r\n  readonly caseSensitive?: boolean;\r\n}\r\n\r\n/**\r\n * Cache configuration types\r\n */\r\nexport interface OSMCacheConfig {\r\n  readonly maxSize: number;\r\n  readonly ttlMs: number;\r\n  readonly cleanupIntervalMs: number;\r\n}\r\n\r\n/**\r\n * Client configuration types\r\n */\r\nexport interface OverpassClientConfig {\r\n  readonly servers: readonly string[];\r\n  readonly timeout: number;\r\n  readonly userAgent: string;\r\n  readonly rateLimitRps: number;\r\n  readonly retryAttempts: number;\r\n  readonly retryDelayMs: number;\r\n}\r\n\r\n/**\r\n * Query performance metrics\r\n */\r\nexport interface QueryMetrics {\r\n  readonly queryHash: string;\r\n  readonly server: string;\r\n  readonly startTime: number;\r\n  readonly endTime: number;\r\n  readonly duration: number;\r\n  readonly elementCount: number;\r\n  readonly cacheHit: boolean;\r\n  readonly success: boolean;\r\n  readonly error?: string;\r\n}\r\n\r\n/**\r\n * Ring assembly types για complex polygons\r\n */\r\nexport interface RingSegment {\r\n  readonly wayId: number;\r\n  readonly nodes: readonly number[];\r\n  readonly role: 'outer' | 'inner' | '';\r\n}\r\n\r\nexport interface AssembledRing {\r\n  readonly role: 'outer' | 'inner';\r\n  readonly coordinates: readonly [number, number][];\r\n  readonly closed: boolean;\r\n  readonly clockwise: boolean;\r\n}\r\n\r\nexport interface PolygonGeometry {\r\n  readonly outer: readonly AssembledRing[];\r\n  readonly inner: readonly AssembledRing[];\r\n}\r\n\r\n/**\r\n * Validation types\r\n */\r\nexport interface ValidationIssue {\r\n  readonly severity: 'error' | 'warning' | 'info';\r\n  readonly code: string;\r\n  readonly message: string;\r\n  readonly element?: OSMElement;\r\n  readonly location?: [number, number];\r\n}\r\n\r\nexport interface ValidationResult {\r\n  readonly valid: boolean;\r\n  readonly issues: readonly ValidationIssue[];\r\n  readonly statistics: {\r\n    readonly nodeCount: number;\r\n    readonly wayCount: number;\r\n    readonly relationCount: number;\r\n    readonly featureCount: number;\r\n  };\r\n}\r\n\r\n/**\r\n * Search configuration types\r\n */\r\nexport interface BoundarySearchConfig {\r\n  readonly adminLevels: readonly AdminLevel[];\r\n  readonly searchVariants: boolean;\r\n  readonly exactMatch: boolean;\r\n  readonly fallbackToPartial: boolean;\r\n  readonly maxResults: number;\r\n}\r\n\r\nexport interface BuildingSearchConfig {\r\n  readonly includeBuildingTypes: readonly string[];\r\n  readonly excludeBuildingTypes: readonly string[];\r\n  readonly minArea: number;\r\n  readonly maxArea: number;\r\n  readonly includeAddresses: boolean;\r\n}\r\n\r\n/**\r\n * Error types για OSM operations\r\n */\r\nexport interface OSMErrorContext {\r\n  readonly operation: string;\r\n  readonly query?: string;\r\n  readonly server?: string;\r\n  readonly elementId?: number;\r\n  readonly coordinates?: [number, number];\r\n}\r\n\r\n/**\r\n * Utility type guards\r\n */\r\nexport namespace OSMTypeGuards {\r\n  export const isNode = (element: OSMElement): element is OSMNode =>\r\n    element.type === 'node';\r\n\r\n  export const isWay = (element: OSMElement): element is OSMWay =>\r\n    element.type === 'way';\r\n\r\n  export const isRelation = (element: OSMElement): element is OSMRelation =>\r\n    element.type === 'relation';\r\n\r\n  export const isBuildingFeature = (feature: Feature): feature is OSMBuildingFeature =>\r\n    feature.properties?.building !== undefined;\r\n\r\n  export const isBoundaryFeature = (feature: Feature): feature is OSMBoundaryFeature =>\r\n    feature.properties?.boundary === 'administrative';\r\n\r\n  export const isValidAdminLevel = (level: number): level is AdminLevel =>\r\n    Object.values(ADMIN_LEVELS).includes(level as AdminLevel);\r\n\r\n  export const hasGeometry = (element: OSMElement): boolean => {\r\n    if (isNode(element)) {\r\n      return typeof element.lat === 'number' && typeof element.lon === 'number';\r\n    }\r\n    if (isWay(element)) {\r\n      return Array.isArray(element.nodes) && element.nodes.length >= 2;\r\n    }\r\n    if (isRelation(element)) {\r\n      return Array.isArray(element.members) && element.members.length > 0;\r\n    }\r\n    return false;\r\n  };\r\n}\r\n\r\n/**\r\n * Constants για OSM operations\r\n */\r\nexport const OSMConstants = {\r\n  /** Default Overpass API servers */\r\n  DEFAULT_SERVERS: [\r\n    'https://overpass-api.de/api/interpreter',\r\n    'https://overpass.kumi.systems/api/interpreter',\r\n    'https://overpass.openstreetmap.ru/api/interpreter'\r\n  ] as const,\r\n\r\n  /** Common building types */\r\n  BUILDING_TYPES: [\r\n    'yes',\r\n    'house',\r\n    'residential',\r\n    'apartments',\r\n    'commercial',\r\n    'office',\r\n    'industrial',\r\n    'retail',\r\n    'hotel',\r\n    'school',\r\n    'hospital',\r\n    'church',\r\n    'public'\r\n  ] as const,\r\n\r\n  /** Greece-specific name tag priorities */\r\n  NAME_TAG_PRIORITY: ['name:el', 'name', 'name:en', 'official_name'] as const,\r\n\r\n  /** Default query limits */\r\n  QUERY_LIMITS: {\r\n    MAX_TIMEOUT_SECONDS: 30,\r\n    MAX_ELEMENTS: 10000,\r\n    MAX_BBOX_AREA: 0.2, // degrees²\r\n    DEFAULT_BUILDINGS_LIMIT: 1000,\r\n    DEFAULT_BOUNDARIES_LIMIT: 100\r\n  } as const,\r\n\r\n  /** Cache settings */\r\n  CACHE_DEFAULTS: {\r\n    BUILDINGS_TTL_MS: 10 * 60 * 1000, // 10 minutes\r\n    BOUNDARIES_TTL_MS: 60 * 60 * 1000, // 1 hour\r\n    MAX_CACHE_SIZE: 500,\r\n    CLEANUP_INTERVAL_MS: 5 * 60 * 1000 // 5 minutes\r\n  } as const\r\n} as const;","/**\r\n * @layera/osm - String Security & Utilities\r\n *\r\n * Enterprise-grade string processing με security hardening.\r\n * Προστασία από injection attacks και proper Unicode handling.\r\n */\r\n\r\n/**\r\n * Escapes special regex characters για safe pattern matching\r\n * Προστασία από ReDoS (Regular Expression Denial of Service) attacks\r\n */\r\nexport const escapeRegex = (input: string): string => {\r\n  return input.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\r\n};\r\n\r\n/**\r\n * Normalizes area names για consistent searching\r\n * Handles Greek diacritics, case variations, και common abbreviations\r\n */\r\nexport const normalizeAreaName = (name: string): string => {\r\n  return name\r\n    .toLowerCase()\r\n    .trim()\r\n    // Remove multiple spaces\r\n    .replace(/\\s+/g, ' ')\r\n    // Greek diacritics normalization\r\n    .replace(/ά/g, 'α')\r\n    .replace(/έ/g, 'ε')\r\n    .replace(/ή/g, 'η')\r\n    .replace(/ί/g, 'ι')\r\n    .replace(/ό/g, 'ο')\r\n    .replace(/ύ/g, 'υ')\r\n    .replace(/ώ/g, 'ω')\r\n    .replace(/ΐ/g, 'ι')\r\n    .replace(/ΰ/g, 'υ')\r\n    // Common Greek abbreviations\r\n    .replace(/\\bδημ\\b\\.?/g, 'δήμος')\r\n    .replace(/\\bπεριφ\\b\\.?/g, 'περιφέρεια')\r\n    .replace(/\\bνομ\\b\\.?/g, 'νομός')\r\n    // Remove punctuation except hyphens\r\n    .replace(/[^\\w\\s\\-α-ωΑ-Ω]/g, '')\r\n    .trim();\r\n};\r\n\r\n/**\r\n * Generates search variants για area names\r\n * Περιλαμβάνει common variations που χρησιμοποιούν οι χρήστες\r\n */\r\nexport const generateSearchVariants = (name: string): readonly string[] => {\r\n  const normalized = normalizeAreaName(name);\r\n  const variants = new Set<string>();\r\n\r\n  // Original normalized form\r\n  variants.add(normalized);\r\n\r\n  // Without common prefixes\r\n  const withoutPrefix = normalized\r\n    .replace(/^(δήμος|περιφέρεια|νομός)\\s+/g, '')\r\n    .trim();\r\n\r\n  if (withoutPrefix !== normalized) {\r\n    variants.add(withoutPrefix);\r\n  }\r\n\r\n  // With common prefixes\r\n  if (!normalized.startsWith('δήμος ') && !normalized.startsWith('περιφέρεια ')) {\r\n    variants.add(`δήμος ${withoutPrefix}`);\r\n    variants.add(`περιφέρεια ${withoutPrefix}`);\r\n  }\r\n\r\n  // Partial matches for compound names\r\n  const words = normalized.split(/\\s+/);\r\n  if (words.length > 1) {\r\n    // First word only\r\n    variants.add(words[0]!);\r\n    // Last word only\r\n    variants.add(words[words.length - 1]!);\r\n\r\n    // All combinations of 2+ consecutive words\r\n    for (let i = 0; i < words.length - 1; i++) {\r\n      for (let j = i + 2; j <= words.length; j++) {\r\n        variants.add(words.slice(i, j).join(' '));\r\n      }\r\n    }\r\n  }\r\n\r\n  return Array.from(variants).filter(v => v.length >= 2);\r\n};\r\n\r\n/**\r\n * Validates string input για OSM queries\r\n * Prevents injection attacks και validates length constraints\r\n */\r\nexport const validateQueryString = (input: string): { valid: boolean; reason?: string } => {\r\n  if (typeof input !== 'string') {\r\n    return { valid: false, reason: 'Input must be a string' };\r\n  }\r\n\r\n  if (input.length === 0) {\r\n    return { valid: false, reason: 'Input cannot be empty' };\r\n  }\r\n\r\n  if (input.length > 200) {\r\n    return { valid: false, reason: 'Input too long (max 200 characters)' };\r\n  }\r\n\r\n  // Check for suspicious patterns\r\n  const suspiciousPatterns = [\r\n    /[<>]/,                    // HTML tags\r\n    /javascript:/i,            // JavaScript URLs\r\n    /data:/i,                  // Data URLs\r\n    /vbscript:/i,             // VBScript URLs\r\n    /on\\w+\\s*=/i,             // Event handlers\r\n    /\\|\\s*\\w+/,               // Command injection\r\n    /;\\s*\\w+/,                // Command chaining\r\n    /\\/\\*[\\s\\S]*?\\*\\//,       // Block comments\r\n    /--/,                      // SQL comments\r\n    /union\\s+select/i,         // SQL injection\r\n    /insert\\s+into/i,          // SQL injection\r\n    /delete\\s+from/i,          // SQL injection\r\n    /drop\\s+table/i,           // SQL injection\r\n    /script\\s*:/i,             // Script protocols\r\n    /eval\\s*\\(/i,              // Code evaluation\r\n  ];\r\n\r\n  for (const pattern of suspiciousPatterns) {\r\n    if (pattern.test(input)) {\r\n      return { valid: false, reason: 'Input contains suspicious patterns' };\r\n    }\r\n  }\r\n\r\n  return { valid: true };\r\n};\r\n\r\n/**\r\n * Sanitizes user input για safe processing\r\n * Removes potentially dangerous characters while preserving Greek text\r\n */\r\nexport const sanitizeInput = (input: string): string => {\r\n  return input\r\n    .replace(/[<>]/g, '')           // Remove HTML brackets\r\n    .replace(/[&]/g, '&amp;')       // Escape ampersand\r\n    .replace(/['\"]/g, '')           // Remove quotes\r\n    .replace(/[\\x00-\\x1F\\x7F]/g, '') // Remove control characters\r\n    .trim();\r\n};\r\n\r\n/**\r\n * Formats coordinates για safe display\r\n * Prevents scientific notation και limits precision\r\n */\r\nexport const formatCoordinateForDisplay = (coord: number, precision = 6): string => {\r\n  if (!Number.isFinite(coord)) {\r\n    return '0.000000';\r\n  }\r\n\r\n  // Prevent scientific notation\r\n  const fixed = coord.toFixed(precision);\r\n\r\n  // Validate range\r\n  if (Math.abs(coord) > 180) {\r\n    return '0.000000';\r\n  }\r\n\r\n  return fixed;\r\n};\r\n\r\n/**\r\n * Creates safe OSM tag values για queries\r\n * Ensures proper escaping για Overpass QL syntax\r\n */\r\nexport const createSafeTagValue = (value: string): string => {\r\n  return value\r\n    .replace(/\"/g, '\\\\\"')     // Escape quotes\r\n    .replace(/\\\\/g, '\\\\\\\\')   // Escape backslashes\r\n    .replace(/\\n/g, '\\\\n')    // Escape newlines\r\n    .replace(/\\r/g, '\\\\r')    // Escape carriage returns\r\n    .replace(/\\t/g, '\\\\t');   // Escape tabs\r\n};\r\n\r\n/**\r\n * Validates OSM element IDs\r\n * Ensures IDs are positive integers within valid range\r\n */\r\nexport const validateOSMId = (id: unknown): id is number => {\r\n  return (\r\n    typeof id === 'number' &&\r\n    Number.isInteger(id) &&\r\n    id > 0 &&\r\n    id <= Number.MAX_SAFE_INTEGER\r\n  );\r\n};\r\n\r\n/**\r\n * Creates hash για caching keys\r\n * Generates consistent cache keys από query parameters\r\n */\r\nexport const createCacheKey = (prefix: string, params: Record<string, unknown>): string => {\r\n  const sortedParams = Object.keys(params)\r\n    .sort()\r\n    .map(key => `${key}:${JSON.stringify(params[key])}`)\r\n    .join('|');\r\n\r\n  // Simple hash function for cache keys\r\n  let hash = 0;\r\n  for (let i = 0; i < sortedParams.length; i++) {\r\n    const char = sortedParams.charCodeAt(i);\r\n    hash = ((hash << 5) - hash) + char;\r\n    hash = hash & hash; // Convert to 32-bit integer\r\n  }\r\n\r\n  return `${prefix}:${Math.abs(hash).toString(36)}`;\r\n};\r\n\r\n/**\r\n * Validates URL safety για external requests\r\n * Prevents SSRF attacks και validates allowed domains\r\n */\r\nexport const validateURL = (url: string, allowedDomains: readonly string[]): boolean => {\r\n  try {\r\n    const parsed = new URL(url);\r\n\r\n    // Only allow HTTPS\r\n    if (parsed.protocol !== 'https:') {\r\n      return false;\r\n    }\r\n\r\n    // Check against allowed domains\r\n    return allowedDomains.some(domain =>\r\n      parsed.hostname === domain ||\r\n      parsed.hostname.endsWith(`.${domain}`)\r\n    );\r\n  } catch {\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * Constants για string validation\r\n */\r\nexport const StringConstants = {\r\n  /** Maximum length για area name queries */\r\n  MAX_QUERY_LENGTH: 200,\r\n\r\n  /** Minimum length για meaningful searches */\r\n  MIN_QUERY_LENGTH: 2,\r\n\r\n  /** Maximum number of search variants */\r\n  MAX_SEARCH_VARIANTS: 20,\r\n\r\n  /** Coordinate display precision */\r\n  COORDINATE_PRECISION: 6,\r\n\r\n  /** Cache key prefix separator */\r\n  CACHE_SEPARATOR: ':',\r\n\r\n  /** Greek alphabet range για validation */\r\n  GREEK_ALPHABET_REGEX: /[α-ωΑ-Ωάέήίόύώΐΰ]/,\r\n\r\n  /** Latin alphabet range για validation */\r\n  LATIN_ALPHABET_REGEX: /[a-zA-Z]/,\r\n} as const;","/**\r\n * @layera/osm - Enterprise HTTP Client\r\n *\r\n * Production-ready HTTP client με comprehensive error handling, retry logic,\r\n * circuit breaker pattern, και performance monitoring.\r\n *\r\n * Features:\r\n * - Exponential backoff retry strategy\r\n * - Circuit breaker για failing servers\r\n * - Request/response interceptors\r\n * - Performance metrics collection\r\n * - Timeout management με progressive timeouts\r\n * - Rate limiting compliance\r\n */\r\n\r\nimport type { AsyncResult } from '../types/result';\r\nimport { ResultUtils } from '../types/result';\r\nimport type { OverpassClientConfig, QueryMetrics } from '../types/osm';\r\nimport { validateURL } from '../utils/strings';\r\n\r\n/**\r\n * HTTP client error types\r\n */\r\nexport class HTTPError extends Error {\r\n  constructor(\r\n    message: string,\r\n    public readonly status: number,\r\n    public readonly response?: Response,\r\n    public readonly url?: string\r\n  ) {\r\n    super(message);\r\n    this.name = 'HTTPError';\r\n  }\r\n}\r\n\r\nexport class TimeoutError extends Error {\r\n  constructor(\r\n    message: string,\r\n    public readonly timeoutMs: number,\r\n    public readonly url?: string\r\n  ) {\r\n    super(message);\r\n    this.name = 'TimeoutError';\r\n  }\r\n}\r\n\r\nexport class NetworkError extends Error {\r\n  constructor(\r\n    message: string,\r\n    public readonly cause?: Error,\r\n    public readonly url?: string\r\n  ) {\r\n    super(message);\r\n    this.name = 'NetworkError';\r\n  }\r\n}\r\n\r\n/**\r\n * Circuit breaker για server health tracking\r\n */\r\nclass CircuitBreaker {\r\n  private failureCount = 0;\r\n  private lastFailureTime = 0;\r\n  private state: 'closed' | 'open' | 'half-open' = 'closed';\r\n\r\n  constructor(\r\n    private readonly failureThreshold = 5,\r\n    private readonly recoveryTimeoutMs = 30000\r\n  ) {}\r\n\r\n  canExecute(): boolean {\r\n    if (this.state === 'closed') {\r\n      return true;\r\n    }\r\n\r\n    if (this.state === 'open') {\r\n      if (Date.now() - this.lastFailureTime > this.recoveryTimeoutMs) {\r\n        this.state = 'half-open';\r\n        return true;\r\n      }\r\n      return false;\r\n    }\r\n\r\n    // half-open state\r\n    return true;\r\n  }\r\n\r\n  onSuccess(): void {\r\n    this.failureCount = 0;\r\n    this.state = 'closed';\r\n  }\r\n\r\n  onFailure(): void {\r\n    this.failureCount++;\r\n    this.lastFailureTime = Date.now();\r\n\r\n    if (this.failureCount >= this.failureThreshold) {\r\n      this.state = 'open';\r\n    }\r\n  }\r\n\r\n  getState(): string {\r\n    return this.state;\r\n  }\r\n\r\n  getFailureCount(): number {\r\n    return this.failureCount;\r\n  }\r\n}\r\n\r\n/**\r\n * Rate limiter για API requests\r\n */\r\nclass RateLimiter {\r\n  private requests: number[] = [];\r\n\r\n  constructor(private readonly requestsPerSecond: number) {}\r\n\r\n  canMakeRequest(): boolean {\r\n    const now = Date.now();\r\n    const oneSecondAgo = now - 1000;\r\n\r\n    // Remove old requests\r\n    this.requests = this.requests.filter(time => time > oneSecondAgo);\r\n\r\n    return this.requests.length < this.requestsPerSecond;\r\n  }\r\n\r\n  recordRequest(): void {\r\n    this.requests.push(Date.now());\r\n  }\r\n\r\n  getRequestCount(): number {\r\n    const now = Date.now();\r\n    const oneSecondAgo = now - 1000;\r\n    return this.requests.filter(time => time > oneSecondAgo).length;\r\n  }\r\n}\r\n\r\n/**\r\n * Request retry configuration\r\n */\r\nexport interface RetryConfig {\r\n  readonly maxAttempts: number;\r\n  readonly baseDelayMs: number;\r\n  readonly maxDelayMs: number;\r\n  readonly backoffMultiplier: number;\r\n  readonly retryableStatusCodes: readonly number[];\r\n}\r\n\r\n/**\r\n * Enterprise HTTP client\r\n */\r\nexport class OverpassHTTPClient {\r\n  private readonly circuitBreakers = new Map<string, CircuitBreaker>();\r\n  private readonly rateLimiters = new Map<string, RateLimiter>();\r\n  private readonly metrics: QueryMetrics[] = [];\r\n  private readonly allowedDomains: readonly string[];\r\n\r\n  constructor(private readonly config: OverpassClientConfig) {\r\n    this.allowedDomains = config.servers.map(url => new URL(url).hostname);\r\n\r\n    // Initialize circuit breakers and rate limiters for each server\r\n    for (const server of config.servers) {\r\n      this.circuitBreakers.set(server, new CircuitBreaker());\r\n      this.rateLimiters.set(server, new RateLimiter(config.rateLimitRps));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Makes HTTP request με comprehensive error handling\r\n   */\r\n  async request(\r\n    url: string,\r\n    options: RequestInit = {},\r\n    retryConfig?: Partial<RetryConfig>\r\n  ): AsyncResult<Response, HTTPError | TimeoutError | NetworkError> {\r\n    // Validate URL safety\r\n    if (!validateURL(url, this.allowedDomains)) {\r\n      return ResultUtils.error(\r\n        new NetworkError(`URL not allowed: ${url}`, undefined, url)\r\n      );\r\n    }\r\n\r\n    const fullRetryConfig: RetryConfig = {\r\n      maxAttempts: this.config.retryAttempts,\r\n      baseDelayMs: this.config.retryDelayMs,\r\n      maxDelayMs: 30000,\r\n      backoffMultiplier: 2,\r\n      retryableStatusCodes: [408, 429, 500, 502, 503, 504],\r\n      ...retryConfig\r\n    };\r\n\r\n    const hostname = new URL(url).hostname;\r\n    const circuitBreaker = this.circuitBreakers.get(url);\r\n    const rateLimiter = this.rateLimiters.get(url);\r\n\r\n    if (!circuitBreaker?.canExecute()) {\r\n      return ResultUtils.error(\r\n        new NetworkError(`Circuit breaker open for ${hostname}`, undefined, url)\r\n      );\r\n    }\r\n\r\n    if (!rateLimiter?.canMakeRequest()) {\r\n      await this.sleep(1000 / this.config.rateLimitRps);\r\n    }\r\n\r\n    let lastError: HTTPError | TimeoutError | NetworkError | undefined;\r\n\r\n    for (let attempt = 1; attempt <= fullRetryConfig.maxAttempts; attempt++) {\r\n      const startTime = Date.now();\r\n\r\n      try {\r\n        // Record rate limit\r\n        rateLimiter?.recordRequest();\r\n\r\n        // Create abort controller for timeout\r\n        const controller = new AbortController();\r\n        const timeoutId = setTimeout(\r\n          () => controller.abort(),\r\n          this.config.timeout\r\n        );\r\n\r\n        const requestOptions: RequestInit = {\r\n          ...options,\r\n          signal: controller.signal,\r\n          headers: {\r\n            'User-Agent': this.config.userAgent,\r\n            'Accept': 'application/json',\r\n            'Cache-Control': 'no-cache',\r\n            ...options.headers\r\n          }\r\n        };\r\n\r\n        const response = await fetch(url, requestOptions);\r\n        clearTimeout(timeoutId);\r\n\r\n        const endTime = Date.now();\r\n        const duration = endTime - startTime;\r\n\r\n        // Record metrics\r\n        const metrics: QueryMetrics = {\r\n          queryHash: this.createQueryHash(url, options),\r\n          server: hostname,\r\n          startTime,\r\n          endTime,\r\n          duration,\r\n          elementCount: 0, // Will be filled by caller\r\n          cacheHit: false,\r\n          success: response.ok\r\n        };\r\n\r\n        if (!response.ok) {\r\n          (metrics as any).error = `HTTP ${response.status}`;\r\n        }\r\n\r\n        this.recordMetrics(metrics);\r\n\r\n        if (!response.ok) {\r\n          const error = new HTTPError(\r\n            `HTTP ${response.status}: ${response.statusText}`,\r\n            response.status,\r\n            response,\r\n            url\r\n          );\r\n\r\n          // Check if this is a retryable error\r\n          if (\r\n            attempt < fullRetryConfig.maxAttempts &&\r\n            fullRetryConfig.retryableStatusCodes.includes(response.status)\r\n          ) {\r\n            lastError = error;\r\n            circuitBreaker?.onFailure();\r\n\r\n            // Calculate delay with exponential backoff\r\n            const delay = Math.min(\r\n              fullRetryConfig.baseDelayMs * Math.pow(fullRetryConfig.backoffMultiplier, attempt - 1),\r\n              fullRetryConfig.maxDelayMs\r\n            );\r\n\r\n            await this.sleep(delay);\r\n            continue;\r\n          }\r\n\r\n          circuitBreaker?.onFailure();\r\n          return ResultUtils.error(error);\r\n        }\r\n\r\n        circuitBreaker?.onSuccess();\r\n        return ResultUtils.ok(response);\r\n\r\n      } catch (error) {\r\n        const endTime = Date.now();\r\n        const duration = endTime - startTime;\r\n\r\n        if (error instanceof Error && error.name === 'AbortError') {\r\n          const timeoutError = new TimeoutError(\r\n            `Request timeout after ${this.config.timeout}ms`,\r\n            this.config.timeout,\r\n            url\r\n          );\r\n\r\n          this.recordMetrics({\r\n            queryHash: this.createQueryHash(url, options),\r\n            server: hostname,\r\n            startTime,\r\n            endTime,\r\n            duration,\r\n            elementCount: 0,\r\n            cacheHit: false,\r\n            success: false,\r\n            error: 'Timeout'\r\n          });\r\n\r\n          if (attempt < fullRetryConfig.maxAttempts) {\r\n            lastError = timeoutError;\r\n            circuitBreaker?.onFailure();\r\n\r\n            const delay = Math.min(\r\n              fullRetryConfig.baseDelayMs * Math.pow(fullRetryConfig.backoffMultiplier, attempt - 1),\r\n              fullRetryConfig.maxDelayMs\r\n            );\r\n\r\n            await this.sleep(delay);\r\n            continue;\r\n          }\r\n\r\n          circuitBreaker?.onFailure();\r\n          return ResultUtils.error(timeoutError);\r\n        }\r\n\r\n        const networkError = new NetworkError(\r\n          `Network error: ${error instanceof Error ? error.message : String(error)}`,\r\n          error instanceof Error ? error : undefined,\r\n          url\r\n        );\r\n\r\n        this.recordMetrics({\r\n          queryHash: this.createQueryHash(url, options),\r\n          server: hostname,\r\n          startTime,\r\n          endTime,\r\n          duration,\r\n          elementCount: 0,\r\n          cacheHit: false,\r\n          success: false,\r\n          error: networkError.message\r\n        });\r\n\r\n        if (attempt < fullRetryConfig.maxAttempts) {\r\n          lastError = networkError;\r\n          circuitBreaker?.onFailure();\r\n\r\n          const delay = Math.min(\r\n            fullRetryConfig.baseDelayMs * Math.pow(fullRetryConfig.backoffMultiplier, attempt - 1),\r\n            fullRetryConfig.maxDelayMs\r\n          );\r\n\r\n          await this.sleep(delay);\r\n          continue;\r\n        }\r\n\r\n        circuitBreaker?.onFailure();\r\n        return ResultUtils.error(networkError);\r\n      }\r\n    }\r\n\r\n    // All attempts failed\r\n    return ResultUtils.error(\r\n      lastError || new NetworkError('All retry attempts failed', undefined, url)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Executes Overpass query με automatic server fallback\r\n   */\r\n  async executeQuery(query: string): AsyncResult<string, HTTPError | TimeoutError | NetworkError> {\r\n    const servers = [...this.config.servers];\r\n\r\n    // Sort servers by health (circuit breaker state)\r\n    servers.sort((a, b) => {\r\n      const circuitA = this.circuitBreakers.get(a);\r\n      const circuitB = this.circuitBreakers.get(b);\r\n\r\n      if (circuitA?.canExecute() && !circuitB?.canExecute()) return -1;\r\n      if (!circuitA?.canExecute() && circuitB?.canExecute()) return 1;\r\n\r\n      // Prefer servers with fewer failures\r\n      return (circuitA?.getFailureCount() || 0) - (circuitB?.getFailureCount() || 0);\r\n    });\r\n\r\n    let lastError: HTTPError | TimeoutError | NetworkError | undefined;\r\n\r\n    for (const server of servers) {\r\n      const circuitBreaker = this.circuitBreakers.get(server);\r\n\r\n      if (!circuitBreaker?.canExecute()) {\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        const result = await this.request(server, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/x-www-form-urlencoded'\r\n          },\r\n          body: `data=${encodeURIComponent(query)}`\r\n        });\r\n\r\n        if (result.ok) {\r\n          const text = await result.data.text();\r\n          return ResultUtils.ok(text);\r\n        }\r\n\r\n        lastError = result.error;\r\n\r\n        // If it's a client error (4xx), don't try other servers\r\n        if (result.error instanceof HTTPError && result.error.status >= 400 && result.error.status < 500) {\r\n          break;\r\n        }\r\n\r\n      } catch (error) {\r\n        lastError = new NetworkError(\r\n          `Unexpected error with server ${server}`,\r\n          error instanceof Error ? error : undefined,\r\n          server\r\n        );\r\n      }\r\n    }\r\n\r\n    return ResultUtils.error(\r\n      lastError || new NetworkError('All servers failed', undefined, 'all')\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Gets client health status\r\n   */\r\n  getHealthStatus(): {\r\n    servers: Array<{\r\n      url: string;\r\n      circuitBreakerState: string;\r\n      failureCount: number;\r\n      currentRps: number;\r\n    }>;\r\n    totalRequests: number;\r\n    successRate: number;\r\n  } {\r\n    const servers = this.config.servers.map(server => ({\r\n      url: server,\r\n      circuitBreakerState: this.circuitBreakers.get(server)?.getState() || 'unknown',\r\n      failureCount: this.circuitBreakers.get(server)?.getFailureCount() || 0,\r\n      currentRps: this.rateLimiters.get(server)?.getRequestCount() || 0\r\n    }));\r\n\r\n    const recentMetrics = this.metrics.slice(-100);\r\n    const successfulRequests = recentMetrics.filter(m => m.success).length;\r\n    const successRate = recentMetrics.length > 0 ? successfulRequests / recentMetrics.length : 0;\r\n\r\n    return {\r\n      servers,\r\n      totalRequests: this.metrics.length,\r\n      successRate\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Gets performance metrics\r\n   */\r\n  getMetrics(): readonly QueryMetrics[] {\r\n    return [...this.metrics];\r\n  }\r\n\r\n  /**\r\n   * Clears old metrics για memory management\r\n   */\r\n  clearOldMetrics(maxAge: number = 3600000): void { // 1 hour default\r\n    const cutoff = Date.now() - maxAge;\r\n    this.metrics.splice(0, this.metrics.findIndex(m => m.endTime > cutoff));\r\n  }\r\n\r\n  private sleep(ms: number): Promise<void> {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n  }\r\n\r\n  private createQueryHash(url: string, options: RequestInit): string {\r\n    const key = `${url}:${JSON.stringify(options.body || '')}`;\r\n    let hash = 0;\r\n    for (let i = 0; i < key.length; i++) {\r\n      const char = key.charCodeAt(i);\r\n      hash = ((hash << 5) - hash) + char;\r\n      hash = hash & hash;\r\n    }\r\n    return Math.abs(hash).toString(36);\r\n  }\r\n\r\n  private recordMetrics(metrics: QueryMetrics): void {\r\n    this.metrics.push(metrics);\r\n\r\n    // Keep only recent metrics για memory efficiency\r\n    if (this.metrics.length > 1000) {\r\n      this.metrics.splice(0, 100);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Default client configuration\r\n */\r\nexport const createDefaultClientConfig = (): OverpassClientConfig => ({\r\n  servers: [\r\n    'https://overpass-api.de/api/interpreter',\r\n    'https://overpass.kumi.systems/api/interpreter',\r\n    'https://overpass.openstreetmap.ru/api/interpreter'\r\n  ],\r\n  timeout: 30000,\r\n  userAgent: 'Layera-OSM/1.0 (Enterprise Mapping Application)',\r\n  rateLimitRps: 1,\r\n  retryAttempts: 3,\r\n  retryDelayMs: 1000\r\n});\r\n\r\n/**\r\n * Creates configured HTTP client instance\r\n */\r\nexport const createHTTPClient = (config?: Partial<OverpassClientConfig>): OverpassHTTPClient => {\r\n  const fullConfig = { ...createDefaultClientConfig(), ...config };\r\n  return new OverpassHTTPClient(fullConfig);\r\n};","/**\r\n * @layera/osm - Enterprise Caching Layer\r\n *\r\n * Multi-level caching system με TTL support, automatic cleanup,\r\n * memory management, και cache statistics.\r\n *\r\n * Features:\r\n * - Time-To-Live (TTL) expiration\r\n * - LRU eviction policy\r\n * - Memory usage monitoring\r\n * - Cache hit/miss statistics\r\n * - Automatic background cleanup\r\n * - Cache warming capabilities\r\n * - Serializable cache entries\r\n */\r\n\r\nimport type { OSMCacheConfig } from '../types/osm';\r\n\r\n/**\r\n * Cache entry με metadata\r\n */\r\nexport interface CacheEntry<T> {\r\n  readonly value: T;\r\n  readonly key: string;\r\n  readonly createdAt: number;\r\n  readonly expiresAt: number;\r\n  readonly size: number;\r\n  readonly accessCount: number;\r\n  readonly lastAccessAt: number;\r\n}\r\n\r\n/**\r\n * Cache statistics\r\n */\r\nexport interface CacheStats {\r\n  readonly totalEntries: number;\r\n  readonly totalSize: number;\r\n  readonly hitCount: number;\r\n  readonly missCount: number;\r\n  readonly evictionCount: number;\r\n  readonly hitRate: number;\r\n  readonly memoryUsage: number;\r\n  readonly oldestEntry: number | undefined;\r\n  readonly newestEntry: number | undefined;\r\n}\r\n\r\n/**\r\n * Cache event types για monitoring\r\n */\r\nexport type CacheEvent =\r\n  | { type: 'hit'; key: string; size: number }\r\n  | { type: 'miss'; key: string }\r\n  | { type: 'set'; key: string; size: number; ttl: number }\r\n  | { type: 'evicted'; key: string; reason: 'expired' | 'lru' | 'manual'; size: number }\r\n  | { type: 'cleanup'; removedCount: number; freedSize: number };\r\n\r\n/**\r\n * Cache event listener\r\n */\r\nexport type CacheEventListener = (event: CacheEvent) => void;\r\n\r\n/**\r\n * Enterprise cache implementation\r\n */\r\nexport class LayeraCache<T> {\r\n  private readonly entries = new Map<string, CacheEntry<T>>();\r\n  private readonly accessOrder = new Map<string, number>(); // για LRU tracking\r\n  private readonly listeners = new Set<CacheEventListener>();\r\n\r\n  private hitCount = 0;\r\n  private missCount = 0;\r\n  private evictionCount = 0;\r\n  private accessCounter = 0;\r\n  private cleanupTimer: NodeJS.Timeout | undefined;\r\n\r\n  constructor(private readonly config: OSMCacheConfig) {\r\n    this.startCleanupTimer();\r\n  }\r\n\r\n  /**\r\n   * Stores value στο cache με TTL\r\n   */\r\n  set(key: string, value: T, ttlMs?: number): void {\r\n    const now = Date.now();\r\n    const effectiveTtl = ttlMs ?? this.config.ttlMs;\r\n    const size = this.estimateSize(value);\r\n\r\n    // Check if we need to make space\r\n    this.ensureCapacity(size);\r\n\r\n    const entry: CacheEntry<T> = {\r\n      value,\r\n      key,\r\n      createdAt: now,\r\n      expiresAt: now + effectiveTtl,\r\n      size,\r\n      accessCount: 0,\r\n      lastAccessAt: now\r\n    };\r\n\r\n    this.entries.set(key, entry);\r\n    this.accessOrder.set(key, ++this.accessCounter);\r\n\r\n    this.emit({\r\n      type: 'set',\r\n      key,\r\n      size,\r\n      ttl: effectiveTtl\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Retrieves value από το cache\r\n   */\r\n  get(key: string): T | undefined {\r\n    const entry = this.entries.get(key);\r\n\r\n    if (!entry) {\r\n      this.missCount++;\r\n      this.emit({ type: 'miss', key });\r\n      return undefined;\r\n    }\r\n\r\n    // Check expiration\r\n    if (Date.now() > entry.expiresAt) {\r\n      this.delete(key, 'expired');\r\n      this.missCount++;\r\n      this.emit({ type: 'miss', key });\r\n      return undefined;\r\n    }\r\n\r\n    // Update access metadata\r\n    const updatedEntry: CacheEntry<T> = {\r\n      ...entry,\r\n      accessCount: entry.accessCount + 1,\r\n      lastAccessAt: Date.now()\r\n    };\r\n\r\n    this.entries.set(key, updatedEntry);\r\n    this.accessOrder.set(key, ++this.accessCounter);\r\n\r\n    this.hitCount++;\r\n    this.emit({\r\n      type: 'hit',\r\n      key,\r\n      size: entry.size\r\n    });\r\n\r\n    return entry.value;\r\n  }\r\n\r\n  /**\r\n   * Checks if key exists στο cache (without accessing)\r\n   */\r\n  has(key: string): boolean {\r\n    const entry = this.entries.get(key);\r\n    if (!entry) return false;\r\n\r\n    if (Date.now() > entry.expiresAt) {\r\n      this.delete(key, 'expired');\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Deletes entry από το cache\r\n   */\r\n  delete(key: string, reason: 'expired' | 'lru' | 'manual' = 'manual'): boolean {\r\n    const entry = this.entries.get(key);\r\n    if (!entry) return false;\r\n\r\n    this.entries.delete(key);\r\n    this.accessOrder.delete(key);\r\n\r\n    if (reason !== 'manual') {\r\n      this.evictionCount++;\r\n    }\r\n\r\n    this.emit({\r\n      type: 'evicted',\r\n      key,\r\n      reason,\r\n      size: entry.size\r\n    });\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Clears όλο το cache\r\n   */\r\n  clear(): void {\r\n    const entries = Array.from(this.entries.keys());\r\n    this.entries.clear();\r\n    this.accessOrder.clear();\r\n\r\n    for (const key of entries) {\r\n      this.emit({\r\n        type: 'evicted',\r\n        key,\r\n        reason: 'manual',\r\n        size: 0\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets cache statistics\r\n   */\r\n  getStats(): CacheStats {\r\n    const entries = Array.from(this.entries.values());\r\n    const totalSize = entries.reduce((sum, entry) => sum + entry.size, 0);\r\n    const total = this.hitCount + this.missCount;\r\n\r\n    return {\r\n      totalEntries: this.entries.size,\r\n      totalSize,\r\n      hitCount: this.hitCount,\r\n      missCount: this.missCount,\r\n      evictionCount: this.evictionCount,\r\n      hitRate: total > 0 ? this.hitCount / total : 0,\r\n      memoryUsage: totalSize / this.config.maxSize,\r\n      oldestEntry: entries.length > 0 ? Math.min(...entries.map(e => e.createdAt)) : undefined,\r\n      newestEntry: entries.length > 0 ? Math.max(...entries.map(e => e.createdAt)) : undefined\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Gets all cache keys\r\n   */\r\n  keys(): string[] {\r\n    return Array.from(this.entries.keys());\r\n  }\r\n\r\n  /**\r\n   * Gets cache size in bytes\r\n   */\r\n  size(): number {\r\n    return Array.from(this.entries.values()).reduce((sum, entry) => sum + entry.size, 0);\r\n  }\r\n\r\n  /**\r\n   * Adds event listener για cache monitoring\r\n   */\r\n  addEventListener(listener: CacheEventListener): void {\r\n    this.listeners.add(listener);\r\n  }\r\n\r\n  /**\r\n   * Removes event listener\r\n   */\r\n  removeEventListener(listener: CacheEventListener): void {\r\n    this.listeners.delete(listener);\r\n  }\r\n\r\n  /**\r\n   * Manual cleanup του cache\r\n   */\r\n  cleanup(): { removedCount: number; freedSize: number } {\r\n    const now = Date.now();\r\n    let removedCount = 0;\r\n    let freedSize = 0;\r\n\r\n    // Remove expired entries\r\n    for (const [key, entry] of this.entries) {\r\n      if (now > entry.expiresAt) {\r\n        freedSize += entry.size;\r\n        this.delete(key, 'expired');\r\n        removedCount++;\r\n      }\r\n    }\r\n\r\n    this.emit({\r\n      type: 'cleanup',\r\n      removedCount,\r\n      freedSize\r\n    });\r\n\r\n    return { removedCount, freedSize };\r\n  }\r\n\r\n  /**\r\n   * Warms up cache με batch data\r\n   */\r\n  warmUp(entries: Array<{ key: string; value: T; ttlMs?: number }>): void {\r\n    for (const entry of entries) {\r\n      this.set(entry.key, entry.value, entry.ttlMs);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Destroys cache και cleanup resources\r\n   */\r\n  destroy(): void {\r\n    if (this.cleanupTimer) {\r\n      clearInterval(this.cleanupTimer);\r\n      this.cleanupTimer = undefined;\r\n    }\r\n\r\n    this.clear();\r\n    this.listeners.clear();\r\n  }\r\n\r\n  private ensureCapacity(newEntrySize: number): void {\r\n    const currentSize = this.size();\r\n    const requiredSpace = currentSize + newEntrySize - this.config.maxSize;\r\n\r\n    if (requiredSpace <= 0) return;\r\n\r\n    // Sort entries by LRU order\r\n    const sortedEntries = Array.from(this.entries.entries())\r\n      .sort(([keyA], [keyB]) => {\r\n        const accessA = this.accessOrder.get(keyA) || 0;\r\n        const accessB = this.accessOrder.get(keyB) || 0;\r\n        return accessA - accessB;\r\n      });\r\n\r\n    let freedSpace = 0;\r\n    for (const [key, entry] of sortedEntries) {\r\n      if (freedSpace >= requiredSpace) break;\r\n\r\n      freedSpace += entry.size;\r\n      this.delete(key, 'lru');\r\n    }\r\n  }\r\n\r\n  private estimateSize(value: T): number {\r\n    try {\r\n      // Rough estimation για memory usage\r\n      const jsonString = JSON.stringify(value);\r\n      return jsonString.length * 2; // Unicode characters can be 2 bytes\r\n    } catch {\r\n      // Fallback για non-serializable objects\r\n      return 1000; // Default size estimate\r\n    }\r\n  }\r\n\r\n  private startCleanupTimer(): void {\r\n    this.cleanupTimer = setInterval(() => {\r\n      this.cleanup();\r\n    }, this.config.cleanupIntervalMs);\r\n  }\r\n\r\n  private emit(event: CacheEvent): void {\r\n    for (const listener of this.listeners) {\r\n      try {\r\n        listener(event);\r\n      } catch (error) {\r\n        console.warn('Cache event listener error:', error);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Multi-level cache manager για different data types\r\n */\r\nexport class OSMCacheManager {\r\n  private readonly buildingsCache: LayeraCache<any>;\r\n  private readonly boundariesCache: LayeraCache<any>;\r\n  private readonly queryCache: LayeraCache<string>;\r\n\r\n  constructor(config: OSMCacheConfig) {\r\n    // Different TTLs για different data types\r\n    const buildingsConfig: OSMCacheConfig = {\r\n      ...config,\r\n      ttlMs: 10 * 60 * 1000 // 10 minutes για buildings\r\n    };\r\n\r\n    const boundariesConfig: OSMCacheConfig = {\r\n      ...config,\r\n      ttlMs: 60 * 60 * 1000 // 1 hour για boundaries\r\n    };\r\n\r\n    const queryConfig: OSMCacheConfig = {\r\n      ...config,\r\n      ttlMs: 5 * 60 * 1000, // 5 minutes για raw queries\r\n      maxSize: config.maxSize / 3 // Smaller cache για queries\r\n    };\r\n\r\n    this.buildingsCache = new LayeraCache(buildingsConfig);\r\n    this.boundariesCache = new LayeraCache(boundariesConfig);\r\n    this.queryCache = new LayeraCache(queryConfig);\r\n  }\r\n\r\n  /**\r\n   * Gets/sets buildings cache\r\n   */\r\n  get buildings(): LayeraCache<any> {\r\n    return this.buildingsCache;\r\n  }\r\n\r\n  /**\r\n   * Gets/sets boundaries cache\r\n   */\r\n  get boundaries(): LayeraCache<any> {\r\n    return this.boundariesCache;\r\n  }\r\n\r\n  /**\r\n   * Gets/sets query cache\r\n   */\r\n  get queries(): LayeraCache<string> {\r\n    return this.queryCache;\r\n  }\r\n\r\n  /**\r\n   * Gets combined statistics\r\n   */\r\n  getAllStats(): {\r\n    buildings: CacheStats;\r\n    boundaries: CacheStats;\r\n    queries: CacheStats;\r\n    total: {\r\n      entries: number;\r\n      size: number;\r\n      hitRate: number;\r\n    };\r\n  } {\r\n    const buildingsStats = this.buildingsCache.getStats();\r\n    const boundariesStats = this.boundariesCache.getStats();\r\n    const queriesStats = this.queryCache.getStats();\r\n\r\n    const totalEntries = buildingsStats.totalEntries + boundariesStats.totalEntries + queriesStats.totalEntries;\r\n    const totalSize = buildingsStats.totalSize + boundariesStats.totalSize + queriesStats.totalSize;\r\n    const totalHits = buildingsStats.hitCount + boundariesStats.hitCount + queriesStats.hitCount;\r\n    const totalRequests = totalHits + buildingsStats.missCount + boundariesStats.missCount + queriesStats.missCount;\r\n\r\n    return {\r\n      buildings: buildingsStats,\r\n      boundaries: boundariesStats,\r\n      queries: queriesStats,\r\n      total: {\r\n        entries: totalEntries,\r\n        size: totalSize,\r\n        hitRate: totalRequests > 0 ? totalHits / totalRequests : 0\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Clears all caches\r\n   */\r\n  clearAll(): void {\r\n    this.buildingsCache.clear();\r\n    this.boundariesCache.clear();\r\n    this.queryCache.clear();\r\n  }\r\n\r\n  /**\r\n   * Cleanup all caches\r\n   */\r\n  cleanupAll(): void {\r\n    this.buildingsCache.cleanup();\r\n    this.boundariesCache.cleanup();\r\n    this.queryCache.cleanup();\r\n  }\r\n\r\n  /**\r\n   * Destroys all caches\r\n   */\r\n  destroy(): void {\r\n    this.buildingsCache.destroy();\r\n    this.boundariesCache.destroy();\r\n    this.queryCache.destroy();\r\n  }\r\n}\r\n\r\n/**\r\n * Creates default cache configuration\r\n */\r\nexport const createDefaultCacheConfig = (): OSMCacheConfig => ({\r\n  maxSize: 50 * 1024 * 1024, // 50MB\r\n  ttlMs: 30 * 60 * 1000, // 30 minutes\r\n  cleanupIntervalMs: 5 * 60 * 1000 // 5 minutes\r\n});\r\n\r\n/**\r\n * Creates configured cache manager\r\n */\r\nexport const createCacheManager = (config?: Partial<OSMCacheConfig>): OSMCacheManager => {\r\n  const fullConfig = { ...createDefaultCacheConfig(), ...config };\r\n  return new OSMCacheManager(fullConfig);\r\n};","/**\r\n * @layera/osm - Geographic & Data Validation\r\n *\r\n * Enterprise-grade validation utilities για geographic data.\r\n * Comprehensive validation με detailed error reporting.\r\n */\r\n\r\nimport type { BBox, Point } from '../types/geo';\r\nimport type { OSMElement, OSMNode, OSMWay, OSMRelation, OverpassResponse } from '../types/osm';\r\nimport type { Result } from '../types/result';\r\nimport { ResultUtils } from '../types/result';\r\n\r\n/**\r\n * Validation error με context information\r\n */\r\nexport interface ValidationError {\r\n  readonly code: string;\r\n  readonly message: string;\r\n  readonly field?: string;\r\n  readonly value?: unknown;\r\n  readonly severity: 'error' | 'warning' | 'info';\r\n  readonly location?: [number, number];\r\n}\r\n\r\n/**\r\n * Validation result με multiple issues\r\n */\r\nexport interface ValidationResult {\r\n  readonly valid: boolean;\r\n  readonly errors: readonly ValidationError[];\r\n  readonly warnings: readonly ValidationError[];\r\n}\r\n\r\n/**\r\n * Geographic coordinate validation\r\n */\r\nexport namespace CoordinateValidation {\r\n  /**\r\n   * Validates latitude value\r\n   */\r\n  export const validateLatitude = (lat: number): Result<number, ValidationError> => {\r\n    if (!Number.isFinite(lat)) {\r\n      return ResultUtils.error({\r\n        code: 'INVALID_LATITUDE_TYPE',\r\n        message: 'Latitude must be a finite number',\r\n        field: 'latitude',\r\n        value: lat,\r\n        severity: \"error\" as const,\r\n        location: undefined\r\n      });\r\n    }\r\n\r\n    if (lat < -90 || lat > 90) {\r\n      return ResultUtils.error({\r\n        code: 'LATITUDE_OUT_OF_RANGE',\r\n        message: 'Latitude must be between -90 and 90 degrees',\r\n        field: 'latitude',\r\n        value: lat,\r\n        severity: \"error\" as const, location: undefined\r\n      });\r\n    }\r\n\r\n    return ResultUtils.ok(lat);\r\n  };\r\n\r\n  /**\r\n   * Validates longitude value\r\n   */\r\n  export const validateLongitude = (lng: number): Result<number, ValidationError> => {\r\n    if (!Number.isFinite(lng)) {\r\n      return ResultUtils.error({\r\n        code: 'INVALID_LONGITUDE_TYPE',\r\n        message: 'Longitude must be a finite number',\r\n        field: 'longitude',\r\n        value: lng,\r\n        severity: \"error\" as const, location: undefined\r\n      });\r\n    }\r\n\r\n    if (lng < -180 || lng > 180) {\r\n      return ResultUtils.error({\r\n        code: 'LONGITUDE_OUT_OF_RANGE',\r\n        message: 'Longitude must be between -180 and 180 degrees',\r\n        field: 'longitude',\r\n        value: lng,\r\n        severity: \"error\" as const, location: undefined\r\n      });\r\n    }\r\n\r\n    return ResultUtils.ok(lng);\r\n  };\r\n\r\n  /**\r\n   * Validates Point object\r\n   */\r\n  export const validatePoint = (point: Point): ValidationResult => {\r\n    const errors: ValidationError[] = [];\r\n    const warnings: ValidationError[] = [];\r\n\r\n    const latResult = validateLatitude(point.lat);\r\n    if (!latResult.ok) {\r\n      errors.push(latResult.error);\r\n    }\r\n\r\n    const lngResult = validateLongitude(point.lng);\r\n    if (!lngResult.ok) {\r\n      errors.push(lngResult.error);\r\n    }\r\n\r\n    return {\r\n      valid: errors.length === 0,\r\n      errors,\r\n      warnings\r\n    };\r\n  };\r\n\r\n  /**\r\n   * Validates BBox object\r\n   */\r\n  export const validateBBox = (bbox: BBox): ValidationResult => {\r\n    const errors: ValidationError[] = [];\r\n    const warnings: ValidationError[] = [];\r\n\r\n    // Validate individual coordinates\r\n    const coords = [\r\n      { value: bbox.south, name: 'south' },\r\n      { value: bbox.west, name: 'west' },\r\n      { value: bbox.north, name: 'north' },\r\n      { value: bbox.east, name: 'east' }\r\n    ];\r\n\r\n    for (const coord of coords) {\r\n      if (!Number.isFinite(coord.value)) {\r\n        errors.push({\r\n          code: 'INVALID_COORDINATE_TYPE',\r\n          message: `${coord.name} must be a finite number`,\r\n          field: coord.name,\r\n          value: coord.value,\r\n          severity: 'error'\r\n        });\r\n      }\r\n    }\r\n\r\n    // Validate coordinate ranges\r\n    const southResult = validateLatitude(bbox.south);\r\n    if (!southResult.ok) {\r\n      errors.push({ ...southResult.error, field: 'south' });\r\n    }\r\n\r\n    const northResult = validateLatitude(bbox.north);\r\n    if (!northResult.ok) {\r\n      errors.push({ ...northResult.error, field: 'north' });\r\n    }\r\n\r\n    const westResult = validateLongitude(bbox.west);\r\n    if (!westResult.ok) {\r\n      errors.push({ ...westResult.error, field: 'west' });\r\n    }\r\n\r\n    const eastResult = validateLongitude(bbox.east);\r\n    if (!eastResult.ok) {\r\n      errors.push({ ...eastResult.error, field: 'east' });\r\n    }\r\n\r\n    // Validate bbox logic\r\n    if (bbox.south >= bbox.north) {\r\n      errors.push({\r\n        code: 'INVALID_BBOX_LATITUDE_ORDER',\r\n        message: 'South latitude must be less than north latitude',\r\n        field: 'bbox',\r\n        value: bbox,\r\n        severity: 'error'\r\n      });\r\n    }\r\n\r\n    if (bbox.west >= bbox.east) {\r\n      errors.push({\r\n        code: 'INVALID_BBOX_LONGITUDE_ORDER',\r\n        message: 'West longitude must be less than east longitude',\r\n        field: 'bbox',\r\n        value: bbox,\r\n        severity: 'error'\r\n      });\r\n    }\r\n\r\n    // Check for reasonable area size\r\n    const area = (bbox.north - bbox.south) * (bbox.east - bbox.west);\r\n    if (area > 100) { // > 100 square degrees\r\n      warnings.push({\r\n        code: 'LARGE_BBOX_AREA',\r\n        message: 'BBox area is very large, may cause performance issues',\r\n        field: 'bbox',\r\n        value: area,\r\n        severity: 'warning'\r\n      });\r\n    }\r\n\r\n    if (area < 0.0001) { // < 0.0001 square degrees\r\n      warnings.push({\r\n        code: 'SMALL_BBOX_AREA',\r\n        message: 'BBox area is very small, may not contain any features',\r\n        field: 'bbox',\r\n        value: area,\r\n        severity: 'warning'\r\n      });\r\n    }\r\n\r\n    return {\r\n      valid: errors.length === 0,\r\n      errors,\r\n      warnings\r\n    };\r\n  };\r\n}\r\n\r\n/**\r\n * OSM data validation\r\n */\r\nexport namespace OSMValidation {\r\n  /**\r\n   * Validates OSM Node\r\n   */\r\n  export const validateNode = (node: OSMNode): ValidationResult => {\r\n    const errors: ValidationError[] = [];\r\n    const warnings: ValidationError[] = [];\r\n\r\n    if (node.type !== 'node') {\r\n      errors.push({\r\n        code: 'INVALID_NODE_TYPE',\r\n        message: 'Element type must be \"node\"',\r\n        field: 'type',\r\n        value: node.type,\r\n        severity: 'error'\r\n      });\r\n    }\r\n\r\n    if (!Number.isInteger(node.id) || node.id <= 0) {\r\n      errors.push({\r\n        code: 'INVALID_NODE_ID',\r\n        message: 'Node ID must be a positive integer',\r\n        field: 'id',\r\n        value: node.id,\r\n        severity: 'error'\r\n      });\r\n    }\r\n\r\n    const pointValidation = CoordinateValidation.validatePoint({\r\n      lat: node.lat,\r\n      lng: node.lon\r\n    });\r\n\r\n    errors.push(...pointValidation.errors);\r\n    warnings.push(...pointValidation.warnings);\r\n\r\n    return {\r\n      valid: errors.length === 0,\r\n      errors,\r\n      warnings\r\n    };\r\n  };\r\n\r\n  /**\r\n   * Validates OSM Way\r\n   */\r\n  export const validateWay = (way: OSMWay): ValidationResult => {\r\n    const errors: ValidationError[] = [];\r\n    const warnings: ValidationError[] = [];\r\n\r\n    if (way.type !== 'way') {\r\n      errors.push({\r\n        code: 'INVALID_WAY_TYPE',\r\n        message: 'Element type must be \"way\"',\r\n        field: 'type',\r\n        value: way.type,\r\n        severity: 'error'\r\n      });\r\n    }\r\n\r\n    if (!Number.isInteger(way.id) || way.id <= 0) {\r\n      errors.push({\r\n        code: 'INVALID_WAY_ID',\r\n        message: 'Way ID must be a positive integer',\r\n        field: 'id',\r\n        value: way.id,\r\n        severity: 'error'\r\n      });\r\n    }\r\n\r\n    if (!Array.isArray(way.nodes)) {\r\n      errors.push({\r\n        code: 'INVALID_WAY_NODES_TYPE',\r\n        message: 'Way nodes must be an array',\r\n        field: 'nodes',\r\n        value: way.nodes,\r\n        severity: 'error'\r\n      });\r\n    } else {\r\n      if (way.nodes.length < 2) {\r\n        errors.push({\r\n          code: 'INSUFFICIENT_WAY_NODES',\r\n          message: 'Way must have at least 2 nodes',\r\n          field: 'nodes',\r\n          value: way.nodes.length,\r\n          severity: 'error'\r\n        });\r\n      }\r\n\r\n      // Validate each node ID\r\n      for (let i = 0; i < way.nodes.length; i++) {\r\n        const nodeId = way.nodes[i];\r\n        if (!Number.isInteger(nodeId) || nodeId <= 0) {\r\n          errors.push({\r\n            code: 'INVALID_WAY_NODE_ID',\r\n            message: `Node ID at index ${i} must be a positive integer`,\r\n            field: `nodes[${i}]`,\r\n            value: nodeId,\r\n            severity: 'error'\r\n          });\r\n        }\r\n      }\r\n\r\n      // Check for closed way (polygon)\r\n      if (way.nodes.length > 3 && way.nodes[0] === way.nodes[way.nodes.length - 1]) {\r\n        // This is a closed way, which is good for areas\r\n        if (way.nodes.length < 4) {\r\n          warnings.push({\r\n            code: 'MINIMAL_POLYGON',\r\n            message: 'Closed way has minimal number of nodes',\r\n            field: 'nodes',\r\n            value: way.nodes.length,\r\n            severity: 'warning'\r\n          });\r\n        }\r\n      }\r\n    }\r\n\r\n    return {\r\n      valid: errors.length === 0,\r\n      errors,\r\n      warnings\r\n    };\r\n  };\r\n\r\n  /**\r\n   * Validates OSM Relation\r\n   */\r\n  export const validateRelation = (relation: OSMRelation): ValidationResult => {\r\n    const errors: ValidationError[] = [];\r\n    const warnings: ValidationError[] = [];\r\n\r\n    if (relation.type !== 'relation') {\r\n      errors.push({\r\n        code: 'INVALID_RELATION_TYPE',\r\n        message: 'Element type must be \"relation\"',\r\n        field: 'type',\r\n        value: relation.type,\r\n        severity: 'error'\r\n      });\r\n    }\r\n\r\n    if (!Number.isInteger(relation.id) || relation.id <= 0) {\r\n      errors.push({\r\n        code: 'INVALID_RELATION_ID',\r\n        message: 'Relation ID must be a positive integer',\r\n        field: 'id',\r\n        value: relation.id,\r\n        severity: 'error'\r\n      });\r\n    }\r\n\r\n    if (!Array.isArray(relation.members)) {\r\n      errors.push({\r\n        code: 'INVALID_RELATION_MEMBERS_TYPE',\r\n        message: 'Relation members must be an array',\r\n        field: 'members',\r\n        value: relation.members,\r\n        severity: 'error'\r\n      });\r\n    } else {\r\n      if (relation.members.length === 0) {\r\n        warnings.push({\r\n          code: 'EMPTY_RELATION',\r\n          message: 'Relation has no members',\r\n          field: 'members',\r\n          value: relation.members.length,\r\n          severity: 'warning'\r\n        });\r\n      }\r\n\r\n      // Validate each member\r\n      for (let i = 0; i < relation.members.length; i++) {\r\n        const member = relation.members[i];\r\n        if (!member) continue;\r\n\r\n        if (!['node', 'way', 'relation'].includes(member.type)) {\r\n          errors.push({\r\n            code: 'INVALID_MEMBER_TYPE',\r\n            message: `Member type at index ${i} must be node, way, or relation`,\r\n            field: `members[${i}].type`,\r\n            value: member.type,\r\n            severity: 'error'\r\n          });\r\n        }\r\n\r\n        if (!Number.isInteger(member.ref) || member.ref <= 0) {\r\n          errors.push({\r\n            code: 'INVALID_MEMBER_REF',\r\n            message: `Member ref at index ${i} must be a positive integer`,\r\n            field: `members[${i}].ref`,\r\n            value: member.ref,\r\n            severity: 'error'\r\n          });\r\n        }\r\n\r\n        if (typeof member.role !== 'string') {\r\n          errors.push({\r\n            code: 'INVALID_MEMBER_ROLE',\r\n            message: `Member role at index ${i} must be a string`,\r\n            field: `members[${i}].role`,\r\n            value: member.role,\r\n            severity: 'error'\r\n          });\r\n        }\r\n      }\r\n    }\r\n\r\n    return {\r\n      valid: errors.length === 0,\r\n      errors,\r\n      warnings\r\n    };\r\n  };\r\n\r\n  /**\r\n   * Validates complete OSM element\r\n   */\r\n  export const validateElement = (element: OSMElement): ValidationResult => {\r\n    switch (element.type) {\r\n      case 'node':\r\n        return validateNode(element);\r\n      case 'way':\r\n        return validateWay(element);\r\n      case 'relation':\r\n        return validateRelation(element);\r\n      default:\r\n        return {\r\n          valid: false,\r\n          errors: [{\r\n            code: 'UNKNOWN_ELEMENT_TYPE',\r\n            message: 'Unknown OSM element type',\r\n            field: 'type',\r\n            value: (element as any).type,\r\n            severity: 'error'\r\n          }],\r\n          warnings: []\r\n        };\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Validates Overpass API response\r\n   */\r\n  export const validateOverpassResponse = (response: OverpassResponse): ValidationResult => {\r\n    const errors: ValidationError[] = [];\r\n    const warnings: ValidationError[] = [];\r\n\r\n    if (typeof response.version !== 'number') {\r\n      errors.push({\r\n        code: 'INVALID_RESPONSE_VERSION',\r\n        message: 'Response version must be a number',\r\n        field: 'version',\r\n        value: response.version,\r\n        severity: 'error'\r\n      });\r\n    }\r\n\r\n    if (typeof response.generator !== 'string') {\r\n      errors.push({\r\n        code: 'INVALID_RESPONSE_GENERATOR',\r\n        message: 'Response generator must be a string',\r\n        field: 'generator',\r\n        value: response.generator,\r\n        severity: 'error'\r\n      });\r\n    }\r\n\r\n    if (!Array.isArray(response.elements)) {\r\n      errors.push({\r\n        code: 'INVALID_RESPONSE_ELEMENTS',\r\n        message: 'Response elements must be an array',\r\n        field: 'elements',\r\n        value: response.elements,\r\n        severity: 'error'\r\n      });\r\n    } else {\r\n      // Validate each element\r\n      const elementValidations = response.elements.map(validateElement);\r\n      const allErrors = elementValidations.flatMap(v => v.errors);\r\n      const allWarnings = elementValidations.flatMap(v => v.warnings);\r\n\r\n      errors.push(...allErrors);\r\n      warnings.push(...allWarnings);\r\n\r\n      // Statistics (commented out unused variables to avoid TS errors)\r\n      // const nodeCount = response.elements.filter(e => e.type === 'node').length;\r\n      // const wayCount = response.elements.filter(e => e.type === 'way').length;\r\n      // const relationCount = response.elements.filter(e => e.type === 'relation').length;\r\n\r\n      if (response.elements.length === 0) {\r\n        warnings.push({\r\n          code: 'EMPTY_RESPONSE',\r\n          message: 'Response contains no elements',\r\n          field: 'elements',\r\n          value: 0,\r\n          severity: 'warning'\r\n        });\r\n      }\r\n\r\n      if (response.elements.length > 10000) {\r\n        warnings.push({\r\n          code: 'LARGE_RESPONSE',\r\n          message: 'Response contains many elements, may cause performance issues',\r\n          field: 'elements',\r\n          value: response.elements.length,\r\n          severity: 'warning'\r\n        });\r\n      }\r\n    }\r\n\r\n    return {\r\n      valid: errors.length === 0,\r\n      errors,\r\n      warnings\r\n    };\r\n  };\r\n}\r\n\r\n/**\r\n * Query parameter validation\r\n */\r\nexport namespace QueryValidation {\r\n  /**\r\n   * Validates search timeout\r\n   */\r\n  export const validateTimeout = (timeout: number): Result<number, ValidationError> => {\r\n    if (!Number.isInteger(timeout) || timeout <= 0) {\r\n      return ResultUtils.error({\r\n        code: 'INVALID_TIMEOUT',\r\n        message: 'Timeout must be a positive integer',\r\n        field: 'timeout',\r\n        value: timeout,\r\n        severity: \"error\" as const, location: undefined\r\n      });\r\n    }\r\n\r\n    if (timeout > 60) {\r\n      return ResultUtils.error({\r\n        code: 'TIMEOUT_TOO_LARGE',\r\n        message: 'Timeout cannot exceed 60 seconds',\r\n        field: 'timeout',\r\n        value: timeout,\r\n        severity: \"error\" as const, location: undefined\r\n      });\r\n    }\r\n\r\n    return ResultUtils.ok(timeout);\r\n  };\r\n\r\n  /**\r\n   * Validates admin level\r\n   */\r\n  export const validateAdminLevel = (level: number): Result<number, ValidationError> => {\r\n    if (!Number.isInteger(level)) {\r\n      return ResultUtils.error({\r\n        code: 'INVALID_ADMIN_LEVEL_TYPE',\r\n        message: 'Admin level must be an integer',\r\n        field: 'adminLevel',\r\n        value: level,\r\n        severity: \"error\" as const, location: undefined\r\n      });\r\n    }\r\n\r\n    if (level < 1 || level > 11) {\r\n      return ResultUtils.error({\r\n        code: 'ADMIN_LEVEL_OUT_OF_RANGE',\r\n        message: 'Admin level must be between 1 and 11',\r\n        field: 'adminLevel',\r\n        value: level,\r\n        severity: \"error\" as const, location: undefined\r\n      });\r\n    }\r\n\r\n    return ResultUtils.ok(level);\r\n  };\r\n\r\n  /**\r\n   * Validates search limit\r\n   */\r\n  export const validateLimit = (limit: number): Result<number, ValidationError> => {\r\n    if (!Number.isInteger(limit) || limit <= 0) {\r\n      return ResultUtils.error({\r\n        code: 'INVALID_LIMIT',\r\n        message: 'Limit must be a positive integer',\r\n        field: 'limit',\r\n        value: limit,\r\n        severity: \"error\" as const, location: undefined\r\n      });\r\n    }\r\n\r\n    if (limit > 1000) {\r\n      return ResultUtils.error({\r\n        code: 'LIMIT_TOO_LARGE',\r\n        message: 'Limit cannot exceed 1000',\r\n        field: 'limit',\r\n        value: limit,\r\n        severity: \"error\" as const, location: undefined\r\n      });\r\n    }\r\n\r\n    return ResultUtils.ok(limit);\r\n  };\r\n}\r\n\r\n/**\r\n * Validation constants\r\n */\r\nexport const ValidationConstants = {\r\n  /** Maximum allowed timeout για queries (seconds) */\r\n  MAX_TIMEOUT_SECONDS: 60,\r\n\r\n  /** Maximum allowed search limit */\r\n  MAX_SEARCH_LIMIT: 1000,\r\n\r\n  /** Maximum reasonable BBox area (square degrees) */\r\n  MAX_BBOX_AREA: 100,\r\n\r\n  /** Minimum meaningful BBox area (square degrees) */\r\n  MIN_BBOX_AREA: 0.0001,\r\n\r\n  /** Maximum elements in response before warning */\r\n  MAX_RESPONSE_ELEMENTS: 10000,\r\n\r\n  /** Valid admin levels για Greece */\r\n  VALID_ADMIN_LEVELS: [2, 4, 6, 8, 9, 10] as const,\r\n\r\n  /** Coordinate precision για validation */\r\n  COORDINATE_PRECISION: 1e-8,\r\n} as const;\r\n","/**\r\n * @layera/osm - Buildings Parser\r\n *\r\n * Specialized parser για OSM building data με comprehensive validation,\r\n * geometry processing, και enterprise-grade error handling.\r\n *\r\n * Features:\r\n * - Multi-geometry support (ways και relations)\r\n * - Complex polygon assembly για relations\r\n * - Building type classification\r\n * - Address normalization\r\n * - Height/level processing\r\n * - Comprehensive validation\r\n */\r\n\r\nimport type { Polygon } from 'geojson';\r\nimport type {\r\n  OSMNode,\r\n  OSMWay,\r\n  OSMRelation,\r\n  OSMBuildingFeature,\r\n  OSMBuildingCollection,\r\n  OverpassResponse,\r\n  ValidationIssue\r\n} from '../types/osm';\r\nimport type { Result } from '../types/result';\r\nimport { ResultUtils } from '../types/result';\r\nimport { OSMValidation } from '../utils/validation';\r\n\r\n/**\r\n * Building classification helper\r\n */\r\nexport namespace BuildingClassifier {\r\n  /**\r\n   * Normalizes building type\r\n   */\r\n  export const normalizeBuildingType = (building: string): string => {\r\n    const normalized = building.toLowerCase().trim();\r\n\r\n    // Common building type mappings\r\n    const typeMapping: Record<string, string> = {\r\n      'yes': 'building',\r\n      'house': 'residential',\r\n      'detached': 'residential',\r\n      'semidetached_house': 'residential',\r\n      'terrace': 'residential',\r\n      'apartments': 'residential',\r\n      'residential': 'residential',\r\n      'office': 'commercial',\r\n      'commercial': 'commercial',\r\n      'retail': 'commercial',\r\n      'shop': 'commercial',\r\n      'warehouse': 'industrial',\r\n      'factory': 'industrial',\r\n      'industrial': 'industrial',\r\n      'school': 'public',\r\n      'hospital': 'public',\r\n      'church': 'religious',\r\n      'mosque': 'religious',\r\n      'synagogue': 'religious',\r\n      'temple': 'religious'\r\n    };\r\n\r\n    return typeMapping[normalized] || normalized;\r\n  };\r\n\r\n  /**\r\n   * Validates building type\r\n   */\r\n  export const isValidBuildingType = (building: string): boolean => {\r\n    if (!building || typeof building !== 'string') return false;\r\n\r\n    const validTypes = [\r\n      'yes', 'house', 'residential', 'apartments', 'detached',\r\n      'semidetached_house', 'terrace', 'commercial', 'office',\r\n      'retail', 'shop', 'industrial', 'warehouse', 'factory',\r\n      'public', 'school', 'hospital', 'church', 'mosque',\r\n      'synagogue', 'temple', 'hotel', 'civic', 'government'\r\n    ];\r\n\r\n    return validTypes.includes(building.toLowerCase()) || building.length > 0;\r\n  };\r\n\r\n  /**\r\n   * Extracts building category\r\n   */\r\n  export const getBuildingCategory = (building: string): 'residential' | 'commercial' | 'industrial' | 'public' | 'religious' | 'other' => {\r\n    const normalized = normalizeBuildingType(building);\r\n\r\n    if (['residential', 'house', 'apartments'].includes(normalized)) {\r\n      return 'residential';\r\n    }\r\n\r\n    if (['commercial', 'office', 'retail', 'shop'].includes(normalized)) {\r\n      return 'commercial';\r\n    }\r\n\r\n    if (['industrial', 'warehouse', 'factory'].includes(normalized)) {\r\n      return 'industrial';\r\n    }\r\n\r\n    if (['public', 'school', 'hospital', 'civic', 'government'].includes(normalized)) {\r\n      return 'public';\r\n    }\r\n\r\n    if (['religious', 'church', 'mosque', 'synagogue', 'temple'].includes(normalized)) {\r\n      return 'religious';\r\n    }\r\n\r\n    return 'other';\r\n  };\r\n}\r\n\r\n/**\r\n * Address processing utilities\r\n */\r\nexport namespace AddressProcessor {\r\n  /**\r\n   * Normalizes address components\r\n   */\r\n  export const normalizeAddress = (tags: Record<string, string>): {\r\n    housenumber?: string;\r\n    street?: string;\r\n    city?: string;\r\n    postcode?: string;\r\n    country?: string;\r\n  } => {\r\n    const addr: any = {};\r\n\r\n    const housenumber = tags['addr:housenumber']?.trim();\r\n    if (housenumber) addr.housenumber = housenumber;\r\n\r\n    const street = tags['addr:street']?.trim();\r\n    if (street) addr.street = street;\r\n\r\n    const city = tags['addr:city']?.trim();\r\n    if (city) addr.city = city;\r\n\r\n    const postcode = tags['addr:postcode']?.trim();\r\n    if (postcode) addr.postcode = postcode;\r\n\r\n    const country = tags['addr:country']?.trim();\r\n    if (country) addr.country = country;\r\n\r\n    return addr;\r\n  };\r\n\r\n  /**\r\n   * Formats complete address string\r\n   */\r\n  export const formatAddress = (tags: Record<string, string>): string | undefined => {\r\n    const addr = normalizeAddress(tags);\r\n    const parts: string[] = [];\r\n\r\n    if (addr.housenumber && addr.street) {\r\n      parts.push(`${addr.street} ${addr.housenumber}`);\r\n    } else if (addr.street) {\r\n      parts.push(addr.street);\r\n    }\r\n\r\n    if (addr.city) {\r\n      parts.push(addr.city);\r\n    }\r\n\r\n    if (addr.postcode) {\r\n      parts.push(addr.postcode);\r\n    }\r\n\r\n    return parts.length > 0 ? parts.join(', ') : undefined;\r\n  };\r\n\r\n  /**\r\n   * Validates address completeness\r\n   */\r\n  export const validateAddress = (tags: Record<string, string>): ValidationIssue[] => {\r\n    const issues: ValidationIssue[] = [];\r\n    const addr = normalizeAddress(tags);\r\n\r\n    if (addr.housenumber && !addr.street) {\r\n      issues.push({\r\n        severity: 'warning',\r\n        code: 'MISSING_STREET',\r\n        message: 'House number without street name',\r\n        location: undefined\r\n      });\r\n    }\r\n\r\n    if (addr.street && !addr.city) {\r\n      issues.push({\r\n        severity: 'info',\r\n        code: 'MISSING_CITY',\r\n        message: 'Street without city information',\r\n        location: undefined\r\n      });\r\n    }\r\n\r\n    return issues;\r\n  };\r\n}\r\n\r\n/**\r\n * Height and level processing\r\n */\r\nexport namespace HeightProcessor {\r\n  /**\r\n   * Parses height value σε meters\r\n   */\r\n  export const parseHeight = (height: string): number | undefined => {\r\n    if (!height) return undefined;\r\n\r\n    const trimmed = height.trim().toLowerCase();\r\n\r\n    // Handle units\r\n    let meters: number;\r\n\r\n    if (trimmed.endsWith('m')) {\r\n      meters = parseFloat(trimmed.slice(0, -1));\r\n    } else if (trimmed.endsWith('ft') || trimmed.endsWith('feet')) {\r\n      const feet = parseFloat(trimmed.replace(/ft|feet/g, ''));\r\n      meters = feet * 0.3048;\r\n    } else {\r\n      meters = parseFloat(trimmed);\r\n    }\r\n\r\n    if (!Number.isFinite(meters) || meters <= 0) return undefined;\r\n\r\n    // Reasonable height limits για buildings\r\n    if (meters > 1000) return undefined; // Too tall\r\n    if (meters < 1) return undefined; // Too short\r\n\r\n    return Math.round(meters * 10) / 10; // Round to 1 decimal place\r\n  };\r\n\r\n  /**\r\n   * Parses building levels\r\n   */\r\n  export const parseLevels = (levels: string): number | undefined => {\r\n    if (!levels) return undefined;\r\n\r\n    const parsed = parseInt(levels.trim(), 10);\r\n\r\n    if (!Number.isInteger(parsed) || parsed <= 0) return undefined;\r\n\r\n    // Reasonable level limits\r\n    if (parsed > 300) return undefined; // Too many levels\r\n\r\n    return parsed;\r\n  };\r\n\r\n  /**\r\n   * Estimates height από levels\r\n   */\r\n  export const estimateHeightFromLevels = (levels: number): number => {\r\n    // Average floor height: 3.5 meters\r\n    return levels * 3.5;\r\n  };\r\n\r\n  /**\r\n   * Estimates levels από height\r\n   */\r\n  export const estimateLevelsFromHeight = (height: number): number => {\r\n    return Math.round(height / 3.5);\r\n  };\r\n}\r\n\r\n/**\r\n * Main buildings parser\r\n */\r\nexport class BuildingsParser {\r\n  /**\r\n   * Parses Overpass response σε building features\r\n   */\r\n  static parseOverpassResponse(response: OverpassResponse): Result<OSMBuildingCollection, ValidationIssue[]> {\r\n    const validation = OSMValidation.validateOverpassResponse(response);\r\n    const issues: ValidationIssue[] = [...validation.errors, ...validation.warnings];\r\n\r\n    if (!validation.valid) {\r\n      return ResultUtils.error(issues);\r\n    }\r\n\r\n    const nodes = new Map<number, OSMNode>();\r\n    const ways: OSMWay[] = [];\r\n    const relations: OSMRelation[] = [];\r\n\r\n    // Categorize elements\r\n    for (const element of response.elements) {\r\n      switch (element.type) {\r\n        case 'node':\r\n          nodes.set(element.id, element);\r\n          break;\r\n        case 'way':\r\n          if (element.tags?.building) {\r\n            ways.push(element);\r\n          }\r\n          break;\r\n        case 'relation':\r\n          if (element.tags?.building) {\r\n            relations.push(element);\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    const features: OSMBuildingFeature[] = [];\r\n\r\n    // Process ways (simple buildings)\r\n    for (const way of ways) {\r\n      const result = this.parseWayBuilding(way, nodes);\r\n      if (result.ok) {\r\n        features.push(result.data);\r\n      } else {\r\n        issues.push(...result.error);\r\n      }\r\n    }\r\n\r\n    // Process relations (complex buildings)\r\n    for (const relation of relations) {\r\n      const result = this.parseRelationBuilding(relation, ways, nodes);\r\n      if (result.ok) {\r\n        features.push(result.data);\r\n      } else {\r\n        issues.push(...result.error);\r\n      }\r\n    }\r\n\r\n    const collection: OSMBuildingCollection = {\r\n      type: 'FeatureCollection',\r\n      features\r\n    };\r\n\r\n    return ResultUtils.ok(collection);\r\n  }\r\n\r\n  /**\r\n   * Parses way-based building\r\n   */\r\n  private static parseWayBuilding(\r\n    way: OSMWay,\r\n    nodes: Map<number, OSMNode>\r\n  ): Result<OSMBuildingFeature, ValidationIssue[]> {\r\n    const issues: ValidationIssue[] = [];\r\n\r\n    // Validate way\r\n    const wayValidation = OSMValidation.validateWay(way);\r\n    issues.push(...wayValidation.errors, ...wayValidation.warnings);\r\n\r\n    if (!wayValidation.valid) {\r\n      return ResultUtils.error(issues);\r\n    }\r\n\r\n    // Get coordinates\r\n    const coordinates: [number, number][] = [];\r\n    for (const nodeId of way.nodes) {\r\n      const node = nodes.get(nodeId);\r\n      if (!node) {\r\n        issues.push({\r\n          severity: 'error',\r\n          code: 'MISSING_NODE',\r\n          message: `Node ${nodeId} not found`,\r\n          element: way\r\n        });\r\n        continue;\r\n      }\r\n\r\n      coordinates.push([node.lon, node.lat]);\r\n    }\r\n\r\n    if (coordinates.length < 3) {\r\n      return ResultUtils.error([{\r\n        severity: 'error',\r\n        code: 'INSUFFICIENT_COORDINATES',\r\n        message: 'Building way must have at least 3 coordinates',\r\n        element: way\r\n      }]);\r\n    }\r\n\r\n    // Ensure closed polygon\r\n    const firstCoord = coordinates[0];\r\n    const lastCoord = coordinates[coordinates.length - 1];\r\n    if (!firstCoord || !lastCoord || firstCoord[0] !== lastCoord[0] || firstCoord[1] !== lastCoord[1]) {\r\n      coordinates.push(coordinates[0]!);\r\n    }\r\n\r\n    // Create geometry\r\n    const geometry: Polygon = {\r\n      type: 'Polygon',\r\n      coordinates: [coordinates]\r\n    };\r\n\r\n    // Process properties\r\n    const properties = this.processProperties(way.tags || {}, way.id, 'way');\r\n\r\n    // Validate address if present\r\n    if (way.tags) {\r\n      issues.push(...AddressProcessor.validateAddress(way.tags));\r\n    }\r\n\r\n    const feature: OSMBuildingFeature = {\r\n      type: 'Feature',\r\n      geometry,\r\n      properties\r\n    };\r\n\r\n    return ResultUtils.ok(feature);\r\n  }\r\n\r\n  /**\r\n   * Parses relation-based building (multipolygon)\r\n   */\r\n  private static parseRelationBuilding(\r\n    relation: OSMRelation,\r\n    ways: OSMWay[],\r\n    nodes: Map<number, OSMNode>\r\n  ): Result<OSMBuildingFeature, ValidationIssue[]> {\r\n    const issues: ValidationIssue[] = [];\r\n\r\n    // Validate relation\r\n    const relationValidation = OSMValidation.validateRelation(relation);\r\n    issues.push(...relationValidation.errors, ...relationValidation.warnings);\r\n\r\n    if (!relationValidation.valid) {\r\n      return ResultUtils.error(issues);\r\n    }\r\n\r\n    // This is a simplified implementation\r\n    // Full multipolygon assembly is complex and would require additional geometry libraries\r\n    // For now, we'll create a placeholder polygon\r\n\r\n    const outerMembers = relation.members.filter(m => m.role === 'outer' && m.type === 'way');\r\n    if (outerMembers.length === 0) {\r\n      return ResultUtils.error([{\r\n        severity: 'error',\r\n        code: 'NO_OUTER_MEMBERS',\r\n        message: 'Relation building must have outer way members',\r\n        element: relation\r\n      }]);\r\n    }\r\n\r\n    // Get first outer way for simplification\r\n    const firstOuterWay = ways.find(w => w.id === outerMembers[0]?.ref);\r\n    if (!firstOuterWay) {\r\n      return ResultUtils.error([{\r\n        severity: 'error',\r\n        code: 'OUTER_WAY_NOT_FOUND',\r\n        message: 'Outer way not found in data',\r\n        element: relation\r\n      }]);\r\n    }\r\n\r\n    // Use the first outer way as the geometry (simplified)\r\n    const wayResult = this.parseWayBuilding(firstOuterWay, nodes);\r\n    if (!wayResult.ok) {\r\n      return wayResult;\r\n    }\r\n\r\n    // Override properties with relation data\r\n    const properties = this.processProperties(relation.tags || {}, relation.id, 'relation');\r\n\r\n    const feature: OSMBuildingFeature = {\r\n      ...wayResult.data,\r\n      properties\r\n    };\r\n\r\n    return ResultUtils.ok(feature);\r\n  }\r\n\r\n  /**\r\n   * Processes OSM tags σε feature properties\r\n   */\r\n  private static processProperties(\r\n    tags: Record<string, string>,\r\n    id: number,\r\n    type: 'way' | 'relation'\r\n  ): OSMBuildingFeature['properties'] {\r\n    const building = tags.building || 'yes';\r\n\r\n    return {\r\n      id,\r\n      type,\r\n      building: BuildingClassifier.normalizeBuildingType(building),\r\n      category: BuildingClassifier.getBuildingCategory(building),\r\n      name: tags.name,\r\n      height: tags.height,\r\n      levels: tags['building:levels'],\r\n      addr_housenumber: tags['addr:housenumber'],\r\n      addr_street: tags['addr:street'],\r\n      addr_city: tags['addr:city'],\r\n      addr_postcode: tags['addr:postcode'],\r\n      address: AddressProcessor.formatAddress(tags),\r\n      // Include all original tags για flexibility\r\n      ...tags\r\n    };\r\n  }\r\n}","/**\r\n * @layera/osm - Administrative Boundaries Parser\r\n *\r\n * Specialized parser για OSM administrative boundary data με complex\r\n * multipolygon assembly, Greek administrative hierarchy support,\r\n * και enterprise-grade validation.\r\n *\r\n * Features:\r\n * - Greek administrative level support (2-10)\r\n * - Complex multipolygon geometry assembly\r\n * - Name variant processing (Greek, English, official)\r\n * - Population and area calculations\r\n * - Wikidata integration support\r\n * - Comprehensive boundary validation\r\n */\r\n\r\nimport type { Polygon, MultiPolygon } from 'geojson';\r\nimport type {\r\n  OSMNode,\r\n  OSMWay,\r\n  OSMRelation,\r\n  OSMBoundaryFeature,\r\n  OSMBoundaryCollection,\r\n  OverpassResponse,\r\n  ValidationIssue,\r\n  AdminLevel\r\n} from '../types/osm';\r\nimport { ADMIN_LEVELS } from '../types/osm';\r\nimport type { Result } from '../types/result';\r\nimport { ResultUtils } from '../types/result';\r\nimport { OSMValidation } from '../utils/validation';\r\nimport { normalizeAreaName, generateSearchVariants } from '../utils/strings';\r\n\r\n/**\r\n * Greek administrative hierarchy helper\r\n */\r\nexport namespace GreekAdminHierarchy {\r\n  /**\r\n   * Gets human-readable name για admin level\r\n   */\r\n  export const getAdminLevelName = (level: AdminLevel): string => {\r\n    const names: Record<AdminLevel, string> = {\r\n      [ADMIN_LEVELS.COUNTRY]: 'Χώρα',\r\n      [ADMIN_LEVELS.REGION]: 'Περιφέρεια',\r\n      [ADMIN_LEVELS.REGIONAL_UNIT]: 'Περιφερειακή Ενότητα',\r\n      [ADMIN_LEVELS.MUNICIPALITY]: 'Δήμος',\r\n      [ADMIN_LEVELS.COMMUNITY]: 'Κοινότητα',\r\n      [ADMIN_LEVELS.SETTLEMENT]: 'Οικισμός'\r\n    };\r\n\r\n    return names[level] || `Επίπεδο ${level}`;\r\n  };\r\n\r\n  /**\r\n   * Validates admin level για Greece\r\n   */\r\n  export const isValidGreekAdminLevel = (level: number): level is AdminLevel => {\r\n    const validLevels = Object.values(ADMIN_LEVELS) as number[];\r\n    return validLevels.includes(level);\r\n  };\r\n\r\n  /**\r\n   * Gets parent admin level\r\n   */\r\n  export const getParentAdminLevel = (level: AdminLevel): AdminLevel | undefined => {\r\n    switch (level) {\r\n      case ADMIN_LEVELS.SETTLEMENT: return ADMIN_LEVELS.COMMUNITY;\r\n      case ADMIN_LEVELS.COMMUNITY: return ADMIN_LEVELS.MUNICIPALITY;\r\n      case ADMIN_LEVELS.MUNICIPALITY: return ADMIN_LEVELS.REGIONAL_UNIT;\r\n      case ADMIN_LEVELS.REGIONAL_UNIT: return ADMIN_LEVELS.REGION;\r\n      case ADMIN_LEVELS.REGION: return ADMIN_LEVELS.COUNTRY;\r\n      case ADMIN_LEVELS.COUNTRY: return undefined;\r\n      default: return undefined;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Gets child admin levels\r\n   */\r\n  export const getChildAdminLevels = (level: AdminLevel): AdminLevel[] => {\r\n    switch (level) {\r\n      case ADMIN_LEVELS.COUNTRY: return [ADMIN_LEVELS.REGION];\r\n      case ADMIN_LEVELS.REGION: return [ADMIN_LEVELS.REGIONAL_UNIT];\r\n      case ADMIN_LEVELS.REGIONAL_UNIT: return [ADMIN_LEVELS.MUNICIPALITY];\r\n      case ADMIN_LEVELS.MUNICIPALITY: return [ADMIN_LEVELS.COMMUNITY];\r\n      case ADMIN_LEVELS.COMMUNITY: return [ADMIN_LEVELS.SETTLEMENT];\r\n      case ADMIN_LEVELS.SETTLEMENT: return [];\r\n      default: return [];\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Name processing utilities για boundaries\r\n */\r\nexport namespace BoundaryNameProcessor {\r\n  /**\r\n   * Extracts all name variants από OSM tags\r\n   */\r\n  export const extractNameVariants = (tags: Record<string, string>): {\r\n    primary: string | undefined;\r\n    greek: string | undefined;\r\n    english: string | undefined;\r\n    official: string | undefined;\r\n    variants: string[];\r\n  } => {\r\n    const nameEl = tags['name:el'];\r\n    const nameEn = tags['name:en'];\r\n    const name = tags.name;\r\n    const officialName = tags.official_name;\r\n\r\n    // Determine primary name (prefer Greek)\r\n    const primary = nameEl || name || nameEn || officialName;\r\n\r\n    // Generate all variants\r\n    const allNames = [name, nameEl, nameEn, officialName].filter((n): n is string => Boolean(n));\r\n    const variants = [...new Set(allNames)];\r\n\r\n    return {\r\n      primary,\r\n      greek: nameEl,\r\n      english: nameEn,\r\n      official: officialName,\r\n      variants\r\n    };\r\n  };\r\n\r\n  /**\r\n   * Normalizes boundary name για searching\r\n   */\r\n  export const normalizeBoundaryName = (name: string): string => {\r\n    return normalizeAreaName(name);\r\n  };\r\n\r\n  /**\r\n   * Generates search variants για boundary\r\n   */\r\n  export const generateBoundarySearchVariants = (tags: Record<string, string>): string[] => {\r\n    const nameData = extractNameVariants(tags);\r\n    const allVariants = new Set<string>();\r\n\r\n    // Add normalized versions of all name variants\r\n    for (const name of nameData.variants) {\r\n      const variants = generateSearchVariants(name);\r\n      variants.forEach(v => allVariants.add(v));\r\n    }\r\n\r\n    return Array.from(allVariants);\r\n  };\r\n\r\n  /**\r\n   * Validates name completeness\r\n   */\r\n  export const validateNames = (tags: Record<string, string>): ValidationIssue[] => {\r\n    const issues: ValidationIssue[] = [];\r\n    const nameData = extractNameVariants(tags);\r\n\r\n    if (!nameData.primary) {\r\n      issues.push({\r\n        severity: 'error',\r\n        code: 'MISSING_NAME',\r\n        message: 'Boundary must have at least one name',\r\n        location: undefined\r\n      });\r\n    }\r\n\r\n    if (!nameData.greek && nameData.primary) {\r\n      issues.push({\r\n        severity: 'warning',\r\n        code: 'MISSING_GREEK_NAME',\r\n        message: 'Boundary missing Greek name (name:el)',\r\n        location: undefined\r\n      });\r\n    }\r\n\r\n    if (!nameData.english && nameData.primary) {\r\n      issues.push({\r\n        severity: 'info',\r\n        code: 'MISSING_ENGLISH_NAME',\r\n        message: 'Boundary missing English name (name:en)',\r\n        location: undefined\r\n      });\r\n    }\r\n\r\n    return issues;\r\n  };\r\n}\r\n\r\n/**\r\n * Population and statistics processor\r\n */\r\nexport namespace BoundaryStatsProcessor {\r\n  /**\r\n   * Parses population value\r\n   */\r\n  export const parsePopulation = (population: string): number | undefined => {\r\n    if (!population) return undefined;\r\n\r\n    const cleaned = population.replace(/[,.\\s]/g, '');\r\n    const parsed = parseInt(cleaned, 10);\r\n\r\n    if (!Number.isInteger(parsed) || parsed <= 0) return undefined;\r\n\r\n    // Reasonable population limits\r\n    if (parsed > 100000000) return undefined; // Too large\r\n\r\n    return parsed;\r\n  };\r\n\r\n  /**\r\n   * Parses area value σε square kilometers\r\n   */\r\n  export const parseArea = (area: string): number | undefined => {\r\n    if (!area) return undefined;\r\n\r\n    const trimmed = area.trim().toLowerCase();\r\n    let sqKm: number;\r\n\r\n    if (trimmed.includes('km')) {\r\n      sqKm = parseFloat(trimmed.replace(/km²?|km2/g, ''));\r\n    } else if (trimmed.includes('m²') || trimmed.includes('m2')) {\r\n      const sqM = parseFloat(trimmed.replace(/m²?|m2/g, ''));\r\n      sqKm = sqM / 1000000; // Convert to km²\r\n    } else {\r\n      sqKm = parseFloat(trimmed);\r\n    }\r\n\r\n    if (!Number.isFinite(sqKm) || sqKm <= 0) return undefined;\r\n\r\n    // Reasonable area limits για Greek administrative units\r\n    if (sqKm > 200000) return undefined; // Larger than Greece\r\n\r\n    return Math.round(sqKm * 100) / 100; // Round to 2 decimal places\r\n  };\r\n\r\n  /**\r\n   * Formats population για display\r\n   */\r\n  export const formatPopulation = (population: number): string => {\r\n    return population.toLocaleString('el-GR');\r\n  };\r\n\r\n  /**\r\n   * Formats area για display\r\n   */\r\n  export const formatArea = (area: number): string => {\r\n    return `${area.toLocaleString('el-GR')} km²`;\r\n  };\r\n}\r\n\r\n/**\r\n * Ring assembly για complex multipolygons\r\n */\r\nexport namespace RingAssembler {\r\n  /**\r\n   * Assembles way segments σε complete rings\r\n   * This is a simplified implementation - full multipolygon assembly is complex\r\n   */\r\n  export const assembleRings = (\r\n    members: OSMRelation['members'],\r\n    ways: Map<number, OSMWay>,\r\n    nodes: Map<number, OSMNode>\r\n  ): Result<{ outer: [number, number][][]; inner: [number, number][][] }, ValidationIssue[]> => {\r\n    const issues: ValidationIssue[] = [];\r\n    const outer: [number, number][][] = [];\r\n    const inner: [number, number][][] = [];\r\n\r\n    // Separate outer and inner members\r\n    const outerMembers = members.filter(m => m.role === 'outer' && m.type === 'way');\r\n    const innerMembers = members.filter(m => m.role === 'inner' && m.type === 'way');\r\n\r\n    // Process outer rings\r\n    for (const member of outerMembers) {\r\n      const way = ways.get(member.ref);\r\n      if (!way) {\r\n        issues.push({\r\n          severity: 'warning',\r\n          code: 'MISSING_OUTER_WAY',\r\n          message: `Outer way ${member.ref} not found`,\r\n          location: undefined\r\n        });\r\n        continue;\r\n      }\r\n\r\n      const coordinates = RingAssembler.wayToCoordinates(way, nodes);\r\n      if (coordinates.length >= 3) {\r\n        outer.push(coordinates);\r\n      }\r\n    }\r\n\r\n    // Process inner rings (holes)\r\n    for (const member of innerMembers) {\r\n      const way = ways.get(member.ref);\r\n      if (!way) {\r\n        issues.push({\r\n          severity: 'warning',\r\n          code: 'MISSING_INNER_WAY',\r\n          message: `Inner way ${member.ref} not found`,\r\n          location: undefined\r\n        });\r\n        continue;\r\n      }\r\n\r\n      const coordinates = RingAssembler.wayToCoordinates(way, nodes);\r\n      if (coordinates.length >= 3) {\r\n        inner.push(coordinates);\r\n      }\r\n    }\r\n\r\n    if (outer.length === 0) {\r\n      return ResultUtils.error([{\r\n        severity: 'error',\r\n        code: 'NO_OUTER_RINGS',\r\n        message: 'Multipolygon must have at least one outer ring',\r\n        location: undefined\r\n      }]);\r\n    }\r\n\r\n    return ResultUtils.ok({ outer, inner });\r\n  };\r\n\r\n  export const wayToCoordinates = (way: OSMWay, nodes: Map<number, OSMNode>): [number, number][] => {\r\n    const coordinates: [number, number][] = [];\r\n\r\n    for (const nodeId of way.nodes) {\r\n      const node = nodes.get(nodeId);\r\n      if (node) {\r\n        coordinates.push([node.lon, node.lat]);\r\n      }\r\n    }\r\n\r\n    // Ensure closed ring\r\n    if (coordinates.length >= 3) {\r\n      const first = coordinates[0];\r\n      const last = coordinates[coordinates.length - 1];\r\n      if (first && last && (first[0] !== last[0] || first[1] !== last[1])) {\r\n        coordinates.push(first);\r\n      }\r\n    }\r\n\r\n    return coordinates;\r\n  }\r\n}\r\n\r\n/**\r\n * Main boundaries parser\r\n */\r\nexport class BoundariesParser {\r\n  /**\r\n   * Parses Overpass response σε boundary features\r\n   */\r\n  static parseOverpassResponse(response: OverpassResponse): Result<OSMBoundaryCollection, ValidationIssue[]> {\r\n    const validation = OSMValidation.validateOverpassResponse(response);\r\n    const issues: ValidationIssue[] = [...validation.errors, ...validation.warnings];\r\n\r\n    if (!validation.valid) {\r\n      return ResultUtils.error(issues);\r\n    }\r\n\r\n    const nodes = new Map<number, OSMNode>();\r\n    const ways = new Map<number, OSMWay>();\r\n    const relations: OSMRelation[] = [];\r\n\r\n    // Categorize elements\r\n    for (const element of response.elements) {\r\n      switch (element.type) {\r\n        case 'node':\r\n          nodes.set(element.id, element);\r\n          break;\r\n        case 'way':\r\n          ways.set(element.id, element);\r\n          break;\r\n        case 'relation':\r\n          if (element.tags?.boundary === 'administrative') {\r\n            relations.push(element);\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    const features: OSMBoundaryFeature[] = [];\r\n\r\n    // Process relations (administrative boundaries are typically relations)\r\n    for (const relation of relations) {\r\n      const result = this.parseAdminBoundary(relation, ways, nodes);\r\n      if (result.ok) {\r\n        features.push(result.data);\r\n      } else {\r\n        issues.push(...result.error);\r\n      }\r\n    }\r\n\r\n    const collection: OSMBoundaryCollection = {\r\n      type: 'FeatureCollection',\r\n      features\r\n    };\r\n\r\n    return ResultUtils.ok(collection);\r\n  }\r\n\r\n  /**\r\n   * Parses relation-based administrative boundary\r\n   */\r\n  private static parseAdminBoundary(\r\n    relation: OSMRelation,\r\n    ways: Map<number, OSMWay>,\r\n    nodes: Map<number, OSMNode>\r\n  ): Result<OSMBoundaryFeature, ValidationIssue[]> {\r\n    const issues: ValidationIssue[] = [];\r\n\r\n    // Validate relation\r\n    const relationValidation = OSMValidation.validateRelation(relation);\r\n    issues.push(...relationValidation.errors, ...relationValidation.warnings);\r\n\r\n    if (!relationValidation.valid) {\r\n      return ResultUtils.error(issues);\r\n    }\r\n\r\n    const tags = relation.tags || {};\r\n\r\n    // Validate admin level\r\n    const adminLevelStr = tags.admin_level;\r\n    if (!adminLevelStr) {\r\n      return ResultUtils.error([{\r\n        severity: 'error',\r\n        code: 'MISSING_ADMIN_LEVEL',\r\n        message: 'Administrative boundary must have admin_level tag',\r\n        element: relation\r\n      }]);\r\n    }\r\n\r\n    const adminLevel = parseInt(adminLevelStr, 10);\r\n    if (!GreekAdminHierarchy.isValidGreekAdminLevel(adminLevel)) {\r\n      issues.push({\r\n        severity: 'warning',\r\n        code: 'INVALID_ADMIN_LEVEL',\r\n        message: `Admin level ${adminLevel} is not standard για Greece`,\r\n        element: relation\r\n      });\r\n    }\r\n\r\n    // Validate names\r\n    issues.push(...BoundaryNameProcessor.validateNames(tags));\r\n\r\n    // Assemble geometry\r\n    const ringsResult = RingAssembler.assembleRings(relation.members, ways, nodes);\r\n    if (!ringsResult.ok) {\r\n      return ResultUtils.error(ringsResult.error);\r\n    }\r\n\r\n    const { outer, inner } = ringsResult.data;\r\n\r\n    // Create geometry\r\n    let geometry: Polygon | MultiPolygon;\r\n\r\n    if (outer.length === 1) {\r\n      // Simple polygon\r\n      const coordinates = inner.length > 0 ? [outer[0]!, ...inner] : [outer[0]!];\r\n      geometry = {\r\n        type: 'Polygon',\r\n        coordinates\r\n      };\r\n    } else {\r\n      // MultiPolygon\r\n      const polygons = outer.map(ring => [ring]);\r\n      geometry = {\r\n        type: 'MultiPolygon',\r\n        coordinates: polygons\r\n      };\r\n    }\r\n\r\n    // Process properties\r\n    const properties = this.processProperties(tags, relation.id);\r\n\r\n    const feature: OSMBoundaryFeature = {\r\n      type: 'Feature',\r\n      geometry,\r\n      properties\r\n    };\r\n\r\n    return ResultUtils.ok(feature);\r\n  }\r\n\r\n  /**\r\n   * Processes OSM tags σε feature properties\r\n   */\r\n  private static processProperties(\r\n    tags: Record<string, string>,\r\n    id: number\r\n  ): OSMBoundaryFeature['properties'] {\r\n    const nameData = BoundaryNameProcessor.extractNameVariants(tags);\r\n    const adminLevel = parseInt(tags.admin_level || '0', 10);\r\n\r\n    return {\r\n      id,\r\n      type: 'relation',\r\n      admin_level: adminLevel.toString(),\r\n      admin_level_name: GreekAdminHierarchy.getAdminLevelName(adminLevel as AdminLevel),\r\n      name: nameData.primary,\r\n      name_el: nameData.greek,\r\n      name_en: nameData.english,\r\n      official_name: nameData.official,\r\n      boundary: tags.boundary || 'administrative',\r\n      place: tags.place,\r\n      population: tags.population,\r\n      population_formatted: tags.population ?\r\n        BoundaryStatsProcessor.formatPopulation(BoundaryStatsProcessor.parsePopulation(tags.population) || 0) :\r\n        undefined,\r\n      area: tags.area,\r\n      area_formatted: tags.area ?\r\n        BoundaryStatsProcessor.formatArea(BoundaryStatsProcessor.parseArea(tags.area) || 0) :\r\n        undefined,\r\n      wikidata: tags.wikidata,\r\n      wikipedia: tags.wikipedia,\r\n      search_variants: BoundaryNameProcessor.generateBoundarySearchVariants(tags),\r\n      // Include all original tags για flexibility\r\n      ...tags\r\n    };\r\n  }\r\n}","/**\r\n * @layera/osm - Overpass Repository Layer\r\n *\r\n * Enterprise repository pattern για OSM data με comprehensive query building,\r\n * caching integration, και robust error handling.\r\n *\r\n * Features:\r\n * - Type-safe query building\r\n * - Automatic caching με intelligent invalidation\r\n * - Multi-server failover\r\n * - Performance monitoring\r\n * - Batch query optimization\r\n * - Geographic indexing support\r\n */\r\n\r\nimport type { BBox, Point } from '../types/geo';\r\nimport type {\r\n  OSMBuildingCollection,\r\n  OSMBoundaryCollection,\r\n  OverpassFilter,\r\n  BuildingSearchConfig,\r\n  BoundarySearchConfig,\r\n  AdminLevel\r\n} from '../types/osm';\r\nimport type { AsyncResult } from '../types/result';\r\nimport { ResultUtils } from '../types/result';\r\nimport { OverpassHTTPClient, createHTTPClient } from '../http/client';\r\nimport { OSMCacheManager, createCacheManager } from '../cache/cache';\r\nimport { BuildingsParser } from '../parsers/buildings';\r\nimport { BoundariesParser } from '../parsers/boundaries';\r\nimport { CoordinateValidation } from '../utils/validation';\r\nimport { validateQueryString, createCacheKey, createSafeTagValue } from '../utils/strings';\r\n\r\n/**\r\n * Query builder για Overpass QL\r\n */\r\nexport class OverpassQueryBuilder {\r\n  private elements: string[] = [];\r\n  private filters: OverpassFilter[] = [];\r\n  private bbox?: BBox;\r\n  private timeout = 30;\r\n  private format: 'json' | 'xml' = 'json';\r\n  private output: 'out' | 'out geom' | 'out center' | 'out ids' = 'out geom';\r\n\r\n  /**\r\n   * Sets query timeout\r\n   */\r\n  setTimeout(seconds: number): this {\r\n    this.timeout = Math.max(1, Math.min(60, seconds));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Sets output format\r\n   */\r\n  setFormat(format: 'json' | 'xml'): this {\r\n    this.format = format;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Sets output verbosity\r\n   */\r\n  setOutput(output: 'out' | 'out geom' | 'out center' | 'out ids'): this {\r\n    this.output = output;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Sets bounding box για query\r\n   */\r\n  setBBox(bbox: BBox): this {\r\n    this.bbox = bbox;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Adds element type για query\r\n   */\r\n  addElement(element: 'node' | 'way' | 'relation'): this {\r\n    if (!this.elements.includes(element)) {\r\n      this.elements.push(element);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Adds filter για tags\r\n   */\r\n  addFilter(filter: OverpassFilter): this {\r\n    this.filters.push(filter);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Adds tag equals filter\r\n   */\r\n  addTagEquals(key: string, value: string): this {\r\n    return this.addFilter({\r\n      key,\r\n      value,\r\n      operator: '='\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Adds tag exists filter\r\n   */\r\n  addTagExists(key: string): this {\r\n    return this.addFilter({\r\n      key,\r\n      operator: 'exists'\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Adds tag regex filter\r\n   */\r\n  addTagRegex(key: string, pattern: string, caseSensitive = false): this {\r\n    return this.addFilter({\r\n      key,\r\n      value: pattern,\r\n      operator: '~',\r\n      caseSensitive\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Builds final Overpass QL query\r\n   */\r\n  build(): string {\r\n    const parts: string[] = [];\r\n\r\n    // Header\r\n    parts.push(`[out:${this.format}][timeout:${this.timeout}];`);\r\n\r\n    // Union query start\r\n    parts.push('(');\r\n\r\n    // Generate queries για each element type\r\n    for (const element of this.elements) {\r\n      const elementQuery = this.buildElementQuery(element as 'node' | 'way' | 'relation');\r\n      if (elementQuery) {\r\n        parts.push(`  ${elementQuery}`);\r\n      }\r\n    }\r\n\r\n    // Union query end\r\n    parts.push(');');\r\n\r\n    // Output\r\n    parts.push(`${this.output};`);\r\n\r\n    return parts.join('\\n');\r\n  }\r\n\r\n  private buildElementQuery(element: 'node' | 'way' | 'relation'): string {\r\n    const parts: string[] = [element];\r\n\r\n    // Add filters\r\n    for (const filter of this.filters) {\r\n      parts.push(this.buildFilterString(filter));\r\n    }\r\n\r\n    // Add bounding box\r\n    if (this.bbox) {\r\n      const bboxStr = `(${this.bbox.south},${this.bbox.west},${this.bbox.north},${this.bbox.east})`;\r\n      parts.push(bboxStr);\r\n    }\r\n\r\n    return parts.join('') + ';';\r\n  }\r\n\r\n  private buildFilterString(filter: OverpassFilter): string {\r\n    const key = createSafeTagValue(filter.key);\r\n\r\n    switch (filter.operator) {\r\n      case '=':\r\n        return `[\"${key}\"=\"${createSafeTagValue(filter.value || '')}\"]`;\r\n      case '!=':\r\n        return `[\"${key}\"!=\"${createSafeTagValue(filter.value || '')}\"]`;\r\n      case '~':\r\n        const regexFlag = filter.caseSensitive === false ? 'i' : '';\r\n        return `[\"${key}\"~\"${createSafeTagValue(filter.value || '')}\"${regexFlag}]`;\r\n      case '!~':\r\n        const negRegexFlag = filter.caseSensitive === false ? 'i' : '';\r\n        return `[\"${key}\"!~\"${createSafeTagValue(filter.value || '')}\"${negRegexFlag}]`;\r\n      case 'exists':\r\n        return `[\"${key}\"]`;\r\n      case '!exists':\r\n        return `[!\"${key}\"]`;\r\n      default:\r\n        return `[\"${key}\"]`;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Repository για OSM building data\r\n */\r\nexport class BuildingsRepository {\r\n  constructor(\r\n    private readonly httpClient: OverpassHTTPClient,\r\n    private readonly cache: OSMCacheManager\r\n  ) {}\r\n\r\n  /**\r\n   * Searches για buildings σε bounding box\r\n   */\r\n  async findInBBox(\r\n    bbox: BBox,\r\n    config: Partial<BuildingSearchConfig> = {}\r\n  ): AsyncResult<OSMBuildingCollection, Error> {\r\n    // Validate bounding box\r\n    const bboxValidation = CoordinateValidation.validateBBox(bbox);\r\n    if (!bboxValidation.valid) {\r\n      return ResultUtils.error(\r\n        new Error(`Invalid bounding box: ${bboxValidation.errors.map(e => e.message).join(', ')}`)\r\n      );\r\n    }\r\n\r\n    const fullConfig: BuildingSearchConfig = {\r\n      includeBuildingTypes: ['yes', 'house', 'residential', 'apartments', 'commercial', 'office'],\r\n      excludeBuildingTypes: [],\r\n      minArea: 0,\r\n      maxArea: Infinity,\r\n      includeAddresses: true,\r\n      ...config\r\n    };\r\n\r\n    // Generate cache key\r\n    const cacheKey = createCacheKey('buildings', { bbox, config: fullConfig });\r\n\r\n    // Check cache first\r\n    const cached = this.cache.buildings.get(cacheKey);\r\n    if (cached) {\r\n      return ResultUtils.ok(cached);\r\n    }\r\n\r\n    // Build query\r\n    const query = new OverpassQueryBuilder()\r\n      .setTimeout(30)\r\n      .setBBox(bbox)\r\n      .addElement('way')\r\n      .addElement('relation')\r\n      .addTagExists('building');\r\n\r\n    // Add building type filters\r\n    if (fullConfig.includeBuildingTypes.length > 0) {\r\n      const typePattern = fullConfig.includeBuildingTypes.join('|');\r\n      query.addTagRegex('building', `^(${typePattern})$`);\r\n    }\r\n\r\n    const queryString = query.build();\r\n\r\n    // Execute query\r\n    const response = await this.httpClient.executeQuery(queryString);\r\n    if (!response.ok) {\r\n      return ResultUtils.error(response.error);\r\n    }\r\n\r\n    // Parse response\r\n    let overpassData;\r\n    try {\r\n      overpassData = JSON.parse(response.data);\r\n    } catch (error) {\r\n      return ResultUtils.error(new Error('Failed to parse Overpass response'));\r\n    }\r\n\r\n    const parseResult = BuildingsParser.parseOverpassResponse(overpassData);\r\n    if (!parseResult.ok) {\r\n      return ResultUtils.error(\r\n        new Error(`Parse error: ${parseResult.error.map(e => e.message).join(', ')}`)\r\n      );\r\n    }\r\n\r\n    // Apply post-processing filters\r\n    let features = parseResult.data.features;\r\n\r\n    if (fullConfig.excludeBuildingTypes.length > 0) {\r\n      features = features.filter(f =>\r\n        !fullConfig.excludeBuildingTypes.includes(f.properties.building)\r\n      );\r\n    }\r\n\r\n    const result: OSMBuildingCollection = {\r\n      type: 'FeatureCollection',\r\n      features\r\n    };\r\n\r\n    // Cache result\r\n    this.cache.buildings.set(cacheKey, result);\r\n\r\n    return ResultUtils.ok(result);\r\n  }\r\n\r\n  /**\r\n   * Finds buildings near a point\r\n   */\r\n  async findNearPoint(\r\n    point: Point,\r\n    radiusMeters: number,\r\n    config: Partial<BuildingSearchConfig> = {}\r\n  ): AsyncResult<OSMBuildingCollection, Error> {\r\n    // Convert radius to approximate degrees\r\n    const degreeRadius = radiusMeters / 111000;\r\n\r\n    const bbox: BBox = {\r\n      south: point.lat - degreeRadius,\r\n      west: point.lng - degreeRadius,\r\n      north: point.lat + degreeRadius,\r\n      east: point.lng + degreeRadius\r\n    };\r\n\r\n    return this.findInBBox(bbox, config);\r\n  }\r\n\r\n  /**\r\n   * Gets building by OSM ID\r\n   */\r\n  async findById(id: number, type: 'way' | 'relation'): AsyncResult<OSMBuildingCollection, Error> {\r\n    const cacheKey = createCacheKey('building-by-id', { id, type });\r\n\r\n    // Check cache\r\n    const cached = this.cache.buildings.get(cacheKey);\r\n    if (cached) {\r\n      return ResultUtils.ok(cached);\r\n    }\r\n\r\n    // Manual query για specific ID\r\n    const queryString = `\r\n      [out:json][timeout:10];\r\n      (\r\n        ${type}(${id});\r\n      );\r\n      out geom;\r\n    `;\r\n\r\n    const response = await this.httpClient.executeQuery(queryString);\r\n    if (!response.ok) {\r\n      return ResultUtils.error(response.error);\r\n    }\r\n\r\n    let overpassData;\r\n    try {\r\n      overpassData = JSON.parse(response.data);\r\n    } catch (error) {\r\n      return ResultUtils.error(new Error('Failed to parse Overpass response'));\r\n    }\r\n\r\n    const parseResult = BuildingsParser.parseOverpassResponse(overpassData);\r\n    if (!parseResult.ok) {\r\n      return ResultUtils.error(\r\n        new Error(`Parse error: ${parseResult.error.map(e => e.message).join(', ')}`)\r\n      );\r\n    }\r\n\r\n    // Cache result\r\n    this.cache.buildings.set(cacheKey, parseResult.data, 60 * 60 * 1000); // 1 hour cache για specific buildings\r\n\r\n    return ResultUtils.ok(parseResult.data);\r\n  }\r\n}\r\n\r\n/**\r\n * Repository για OSM boundary data\r\n */\r\nexport class BoundariesRepository {\r\n  constructor(\r\n    private readonly httpClient: OverpassHTTPClient,\r\n    private readonly cache: OSMCacheManager\r\n  ) {}\r\n\r\n  /**\r\n   * Searches για administrative boundaries by name\r\n   */\r\n  async searchByName(\r\n    name: string,\r\n    config: Partial<BoundarySearchConfig> = {}\r\n  ): AsyncResult<OSMBoundaryCollection, Error> {\r\n    // Validate input\r\n    const validation = validateQueryString(name);\r\n    if (!validation.valid) {\r\n      return ResultUtils.error(new Error(validation.reason));\r\n    }\r\n\r\n    const fullConfig: BoundarySearchConfig = {\r\n      adminLevels: [4, 6, 8], // Region, Regional Unit, Municipality\r\n      searchVariants: true,\r\n      exactMatch: false,\r\n      fallbackToPartial: true,\r\n      maxResults: 10,\r\n      ...config\r\n    };\r\n\r\n    const cacheKey = createCacheKey('boundaries-by-name', { name, config: fullConfig });\r\n\r\n    // Check cache\r\n    const cached = this.cache.boundaries.get(cacheKey);\r\n    if (cached) {\r\n      return ResultUtils.ok(cached);\r\n    }\r\n\r\n    // Build query\r\n    const query = new OverpassQueryBuilder()\r\n      .setTimeout(30)\r\n      .addElement('relation')\r\n      .addTagEquals('boundary', 'administrative');\r\n\r\n    // Add admin level filters\r\n    if (fullConfig.adminLevels.length > 0) {\r\n      const levelPattern = fullConfig.adminLevels.join('|');\r\n      query.addTagRegex('admin_level', `^(${levelPattern})$`);\r\n    }\r\n\r\n    // Add name search\r\n    if (fullConfig.exactMatch) {\r\n      query.addTagEquals('name', name);\r\n    } else {\r\n      // Case-insensitive partial match\r\n      query.addTagRegex('name', name, false);\r\n    }\r\n\r\n    const queryString = query.build();\r\n    console.log('🔍 Generated Boundary Search Query:', queryString);\r\n\r\n    const response = await this.httpClient.executeQuery(queryString);\r\n    if (!response.ok) {\r\n      return ResultUtils.error(response.error);\r\n    }\r\n\r\n    let overpassData;\r\n    try {\r\n      overpassData = JSON.parse(response.data);\r\n    } catch (error) {\r\n      return ResultUtils.error(new Error('Failed to parse Overpass response'));\r\n    }\r\n\r\n    const parseResult = BoundariesParser.parseOverpassResponse(overpassData);\r\n    if (!parseResult.ok) {\r\n      return ResultUtils.error(\r\n        new Error(`Parse error: ${parseResult.error.map(e => e.message).join(', ')}`)\r\n      );\r\n    }\r\n\r\n    // Limit results\r\n    let features = parseResult.data.features;\r\n    if (fullConfig.maxResults > 0) {\r\n      features = features.slice(0, fullConfig.maxResults);\r\n    }\r\n\r\n    const result: OSMBoundaryCollection = {\r\n      type: 'FeatureCollection',\r\n      features\r\n    };\r\n\r\n    // Cache result για longer time (boundaries change rarely)\r\n    this.cache.boundaries.set(cacheKey, result, 2 * 60 * 60 * 1000); // 2 hours\r\n\r\n    return ResultUtils.ok(result);\r\n  }\r\n\r\n  /**\r\n   * Gets boundary by admin level and name\r\n   */\r\n  async findByAdminLevel(\r\n    adminLevel: AdminLevel,\r\n    name?: string\r\n  ): AsyncResult<OSMBoundaryCollection, Error> {\r\n    const cacheKey = createCacheKey('boundaries-by-admin-level', { adminLevel, name });\r\n\r\n    // Check cache\r\n    const cached = this.cache.boundaries.get(cacheKey);\r\n    if (cached) {\r\n      return ResultUtils.ok(cached);\r\n    }\r\n\r\n    const query = new OverpassQueryBuilder()\r\n      .setTimeout(30)\r\n      .addElement('relation')\r\n      .addTagEquals('boundary', 'administrative')\r\n      .addTagEquals('admin_level', adminLevel.toString());\r\n\r\n    if (name) {\r\n      const validation = validateQueryString(name);\r\n      if (!validation.valid) {\r\n        return ResultUtils.error(new Error(validation.reason));\r\n      }\r\n      query.addTagRegex('name', name, false);\r\n    }\r\n\r\n    const queryString = query.build();\r\n\r\n    const response = await this.httpClient.executeQuery(queryString);\r\n    if (!response.ok) {\r\n      return ResultUtils.error(response.error);\r\n    }\r\n\r\n    let overpassData;\r\n    try {\r\n      overpassData = JSON.parse(response.data);\r\n    } catch (error) {\r\n      return ResultUtils.error(new Error('Failed to parse Overpass response'));\r\n    }\r\n\r\n    const parseResult = BoundariesParser.parseOverpassResponse(overpassData);\r\n    if (!parseResult.ok) {\r\n      return ResultUtils.error(\r\n        new Error(`Parse error: ${parseResult.error.map(e => e.message).join(', ')}`)\r\n      );\r\n    }\r\n\r\n    // Cache result\r\n    this.cache.boundaries.set(cacheKey, parseResult.data, 2 * 60 * 60 * 1000);\r\n\r\n    return ResultUtils.ok(parseResult.data);\r\n  }\r\n\r\n  /**\r\n   * Gets boundary containing a point\r\n   */\r\n  async findContainingPoint(\r\n    point: Point,\r\n    adminLevel?: AdminLevel\r\n  ): AsyncResult<OSMBoundaryCollection, Error> {\r\n    // Validate point\r\n    const pointValidation = CoordinateValidation.validatePoint(point);\r\n    if (!pointValidation.valid) {\r\n      return ResultUtils.error(\r\n        new Error(`Invalid point: ${pointValidation.errors.map(e => e.message).join(', ')}`)\r\n      );\r\n    }\r\n\r\n    const cacheKey = createCacheKey('boundaries-containing-point', { point, adminLevel });\r\n\r\n    // Check cache\r\n    const cached = this.cache.boundaries.get(cacheKey);\r\n    if (cached) {\r\n      return ResultUtils.ok(cached);\r\n    }\r\n\r\n    const query = new OverpassQueryBuilder()\r\n      .setTimeout(30)\r\n      .addElement('relation')\r\n      .addTagEquals('boundary', 'administrative');\r\n\r\n    if (adminLevel) {\r\n      query.addTagEquals('admin_level', adminLevel.toString());\r\n    }\r\n\r\n    // Use point-in-polygon query - this is a simplified approach\r\n    // Full implementation would require more sophisticated geometry operations\r\n    const buffer = 0.01; // Small buffer για point search\r\n    const bbox: BBox = {\r\n      south: point.lat - buffer,\r\n      west: point.lng - buffer,\r\n      north: point.lat + buffer,\r\n      east: point.lng + buffer\r\n    };\r\n    query.setBBox(bbox);\r\n\r\n    const queryString = query.build();\r\n\r\n    const response = await this.httpClient.executeQuery(queryString);\r\n    if (!response.ok) {\r\n      return ResultUtils.error(response.error);\r\n    }\r\n\r\n    let overpassData;\r\n    try {\r\n      overpassData = JSON.parse(response.data);\r\n    } catch (error) {\r\n      return ResultUtils.error(new Error('Failed to parse Overpass response'));\r\n    }\r\n\r\n    const parseResult = BoundariesParser.parseOverpassResponse(overpassData);\r\n    if (!parseResult.ok) {\r\n      return ResultUtils.error(\r\n        new Error(`Parse error: ${parseResult.error.map(e => e.message).join(', ')}`)\r\n      );\r\n    }\r\n\r\n    // Cache result για moderate time\r\n    this.cache.boundaries.set(cacheKey, parseResult.data, 30 * 60 * 1000); // 30 minutes\r\n\r\n    return ResultUtils.ok(parseResult.data);\r\n  }\r\n}\r\n\r\n/**\r\n * Main repository manager\r\n */\r\nexport class OSMRepositoryManager {\r\n  public readonly buildings: BuildingsRepository;\r\n  public readonly boundaries: BoundariesRepository;\r\n\r\n  constructor(\r\n    private readonly httpClient: OverpassHTTPClient,\r\n    private readonly cache: OSMCacheManager\r\n  ) {\r\n    this.buildings = new BuildingsRepository(httpClient, cache);\r\n    this.boundaries = new BoundariesRepository(httpClient, cache);\r\n  }\r\n\r\n  /**\r\n   * Gets performance metrics από all repositories\r\n   */\r\n  getMetrics(): {\r\n    http: any;\r\n    cache: any;\r\n  } {\r\n    return {\r\n      http: this.httpClient.getHealthStatus(),\r\n      cache: this.cache.getAllStats()\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Clears all caches\r\n   */\r\n  clearCaches(): void {\r\n    this.cache.clearAll();\r\n  }\r\n\r\n  /**\r\n   * Performs cleanup operations\r\n   */\r\n  cleanup(): void {\r\n    this.cache.cleanupAll();\r\n    this.httpClient.clearOldMetrics();\r\n  }\r\n}\r\n\r\n/**\r\n * Creates default repository manager\r\n */\r\nexport const createRepositoryManager = (): OSMRepositoryManager => {\r\n  const httpClient = createHTTPClient();\r\n  const cache = createCacheManager();\r\n\r\n  return new OSMRepositoryManager(httpClient, cache);\r\n};"],"mappings":"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","names":["NetworkError","TimeoutError","GeoUtils","point","bbox","LeafletCompat","ResultUtils","error","OSMTypeGuards","TimeoutError","NetworkError","CoordinateValidation","OSMValidation","QueryValidation","BuildingClassifier","AddressProcessor","HeightProcessor","GreekAdminHierarchy","BoundaryNameProcessor","BoundaryStatsProcessor","RingAssembler"]}